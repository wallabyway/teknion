!function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.constructor=Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension,Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.load=function(){var a=this,b=this.viewer,c=Autodesk.Viewing.UI;return this.tool=new Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool(b),b.toolController.registerTool(this.tool),this.createUI(),this.onToolChanged=function(b){if(-1!==b.toolName.indexOf("firstperson")&&a.firstPersonToolButton){var d=b.active?c.Button.State.ACTIVE:c.Button.State.INACTIVE;a.firstPersonToolButton.setState(d)}},b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.createUI=function(){var a=this.viewer;if(a.getToolbar){var b=this,c=Autodesk.Viewing.UI,d=a.getToolbar(!0),e=d.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.firstPersonToolButton=new c.Button("toolbar-firstPersonTool"),this.firstPersonToolButton.setToolTip("First person"),this.firstPersonToolButton.onClick=function(d){var e=b.firstPersonToolButton.getState();e===c.Button.State.INACTIVE?a.setActiveNavigationTool("firstperson"):e===c.Button.State.ACTIVE&&a.setActiveNavigationTool()},this.firstPersonToolButton.setIcon("adsk-icon-first-person");var f=e.getControl("toolbar-cameraSubmenuTool");f?e.addControl(this.firstPersonToolButton,{index:e.indexOf(f.getId())}):e.addControl(this.firstPersonToolButton)}},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.unload=function(){var a=this.viewer;if(a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.firstPersonToolButton){var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.firstPersonToolButton.getId()),this.firstPersonToolButton=null}return a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool(),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FirstPerson",Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension)}(),function(){AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool=function(a){function b(a){if(p)return!1;var b=a.ctrlKey||e&&a.metaKey,c=a.metaKey&&!e;return b||c||a.shiftKey||a.altKey}var c,d=Autodesk.Viewing.Private,e=-1!=navigator.userAgent.search("Mac OS"),f=a.navigation,g=a.container,h=f.getCamera(),i=["firstperson"],j={SHIFT:0,ALT:0,CONTROL:0},k=Autodesk.Viewing.theHotkeyManager.KEYCODES,l=!1,m=!0,n=!1,o=0,p=null,q=new THREE.Clock(!0),r=-1,s=5e3,t=1,u=1,v=2,w=0,x=0,y=0,z=-1e20,A=0,B=0,C=-1e20,D=0,E=0,F=!1,G=!1,H=!1,I=!1,J=!1,K=!1,L=h.fov,M=h.isPerspective,N=!1;(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(c=new Autodesk.Viewing.Extensions.GamepadModule(a));var O=!1;this.isActive=function(){return l},this.getNames=function(){return i},this.getName=function(){return i[0]},this.activate=function(b){q.start(),M=h.isPerspective,f.toPerspective(),L=h.fov,f.setVerticalFov(75,!0),t=a.model.getUnitScale();var d=a.model.getBoundingBox().size();u=Math.max(Math.min(Math.min(d.x,d.y),d.z)/10,1e-4),a.canvas.focus(),l=!0,a.getFirstPersonToolPopup()&&!N&&T(),addCrosshair(),a.impl.pauseHighlight(!0),c&&c.activate(this.getName())},this.deactivate=function(b){l=!1,q.stop(),R(),removeCrosshair(),a.impl.pauseHighlight(!1),c&&c.deactivate()},this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"},this.adjustSpeed=function(a){0===a?v=2:(v*=a>0?1.1:.9)<.01&&(v=.01)},this.handleGesture=function(a){switch(a.pointers&&a.pointers.length>0&&(a.pageX=a.pointers[0].pageX,a.pageY=a.pointers[0].pageY),a.type){case"dragstart":return p="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===p&&this.handleMouseMove(a);case"dragend":return"drag"===p&&(this.handleButtonUp(a,0),p=null,!0)}return!1},this.handleSingleClick=function(a,b){return!1},this.handleButtonDown=function(a,c){R(),o+=1<<c;var d=b(a);return!(0===c&&!d)||(x=a.pageX-window.innerWidth/2,A=a.pageY-window.innerHeight/2,z=a.pageX,C=a.pageY,D=E=0,y=B=0,n=!0,!0)},this.handleMouseMove=function(a){var b=z<-1e10?0:a.pageX-z,c=C<-1e10?0:a.pageY-C;return z=a.pageX,C=a.pageY,n===m&&(D+=.0035*b,E+=.0035*c),!0},this.handleButtonUp=function(a,b){return o-=1<<b,0!==b||!n||(D=E=0,y=B=0,n=!1,!0)},this.handleKeyDown=function(a,b){R();var c=!1;switch(b){case k.ESCAPE:break;case k.TAB:c=!1;break;case k.SHIFT:j.SHIFT=1,c=!0;break;case k.CONTROL:j.CONTROL=1,c=!0;break;case k.ALT:j.ALT=1,c=!0;break;case k.SPACE:j.SPACE=1,c=!0;break;case k.EQUALS:this.adjustSpeed(1),c=!0;break;case k.DASH:this.adjustSpeed(-1),c=!0;break;case k.ZERO:this.adjustSpeed(0),c=!0;break;case k.UP:case k.w:F=!0,c=!0;break;case k.LEFT:case k.a:H=!0,c=!0;break;case k.DOWN:case k.s:G=!0,c=!0;break;case k.RIGHT:case k.d:I=!0,c=!0;break;case k.q:J=!0,c=!0;break;case k.e:K=!0,c=!0;break;case k.g:case k.F1:c=!0}return c},this.handleKeyUp=function(a,b){var c=!1;switch(b){case k.TAB:c=!1;break;case k.SHIFT:j.SHIFT=0,c=!0;break;case k.CONTROL:j.CONTROL=0,c=!0;break;case k.ALT:j.ALT=0,c=!0;break;case k.SPACE:j.SPACE=0,c=!0;break;case k.UP:case k.w:F=!1,c=!0,P();break;case k.LEFT:case k.a:H=!1,c=!0,P();break;case k.DOWN:case k.s:G=!1,c=!0,P();break;case k.RIGHT:case k.d:I=!1,c=!0,P();break;case k.q:J=!1,c=!0,P();break;case k.e:K=!1,c=!0,P();break;case k.g:y=B=0,m=!m,S(m),c=!0;break;case k.F1:T(),c=!0}return c},this.handleWheelInput=function(a){return f.getReverseZoomDirection()&&(a*=-1),w+=a,!0},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(a){return!1},this.handleBlur=function(a){return F=G=!1,H=I=!1,J=K=!1,!1},this.update=function(){if(!l||!f.isActionEnabled("walk"))return!1;var a=q.getDelta();if(r>-1){(new Date).getTime()-r>s&&R()}h.isPerspective||(console.log("Lost perspective mode: resetting view."),f.toPerspective());var b=h.clone(),d=a*v*u*(1===j.SHIFT?4:1),e=.5*a*u*(1===j.SHIFT?4:1);if(0!=w){var g=1*w*u*(1===j.SHIFT?4:1);b.translateZ(-g),w=0}F&&b.translateZ(-d),G&&b.translateZ(d),H&&b.translateX(-d),I&&b.translateX(d),J&&b.translateY(e),K&&b.translateY(-e);var i=b.position,k=0!==i.distanceToSquared(h.position),m=b.target,n=h.target.clone().sub(h.position),o=n.clone().cross(h.up).normalize();if(0!=E){var p=new THREE.Quaternion;p.setFromAxisAngle(o,-E);var t=n.clone();t.applyQuaternion(p);var x=h.worldup.clone(),y=t.angleTo(x),z=THREE.Math.degToRad(5);y>=z&&y<=Math.PI-z&&(n.applyQuaternion(p),b.up.applyQuaternion(p)),E=0}if(0!=D){var A=new THREE.Quaternion;A.setFromAxisAngle(h.worldup,-D),n.applyQuaternion(A),b.up.applyQuaternion(A),D=0}m=i.clone().add(n);var B=0!==m.distanceToSquared(h.target);return(k||B)&&(f.setView(i,m),f.orientCameraUp()),c&&(h=c.update(h)),h.dirty};var P=function(){O||(d.logger.track({category:"tool_used",name:"FirstPerson_tool"}),O=!0)},Q=function(a,b,c,d,e){Autodesk.Viewing.Private.HudMessage&&(Autodesk.Viewing.Private.HudMessage.displayMessage(g,a,c,d,e),b>0?(r=(new Date).getTime(),s=b):(r=-1,s=0))},R=function(){Autodesk.Viewing.Private.HudMessage&&Autodesk.Viewing.Private.HudMessage.dismiss(),r=-1},S=function(a){R();var b=a?"Press the primary mouse button and drag to change the view orientation":"Move the cursor to change the view orientation";Q({msgTitleKey:"First Person Tool",messageKey:b,messageDefaultValue:b},0,function(){})},T=function(){R(),Q({msgTitleKey:"First Person Tool",messageKey:"Use the WASD and QE keys to move",messageDefaultValue:"Use the WASD and QE keys to move",checkboxChecked:N},0,function(){},null,function(b){N=b.target.checked,a.setFirstPersonToolPopup(!b.target.checked)})};addCrosshair=function(){d.stringToDOM&&(this.crosshair=d.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>f'),a.canvasWrap.appendChild(this.crosshair))},removeCrosshair=function(){this.crosshair&&this.crosshair.parentNode&&this.crosshair.parentNode.removeChild(this.crosshair)}}}();