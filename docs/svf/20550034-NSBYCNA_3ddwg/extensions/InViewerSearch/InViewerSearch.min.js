function ResultCollection(){this.partialResults=[],this.resultIDArray={},this.resultSetArray=[],this.resultArrayBufferArray=[],this.metaInfoArray=[],this.resultSetIndex={},this.resultCount=0}!function(a){"use strict";function b(a){return a&&0!==a.length?a.replace(/^#?\?/,"").split("&").map(function(a){return a.split("=").map(function(a){return decodeURIComponent(a)})}):null}function c(a){return"object"!=typeof a||null===a?a:(Object.getOwnPropertyNames&&Object.getOwnPropertyNames(a).forEach(function(b){var d=a[b];"object"!=typeof d||null===d||Object.isFrozen(d)||c(d)}),Object.freeze(a))}function d(a,b,c,d,e,f,g){function h(a,b){return function(){var b,d=null,e=null;4===i.readyState&&(b=i.status||a||-1,e=!i.response||"application/json"!==i.getResponseHeader("Content-Type")&&"json"!==i.responseType?i.response:JSON.parse(i.response),j[b]||(j[b]=!0,200!==b&&(d=i.status||a||"unknown error"),d?c(d,g?e:null):c(null,e)))}}if(c=c||function(){},!a||!b)return console.error("Invalid URL or Request Headers for the Query Service REST API"),void setTimeout(function(){c("Invalid URL or Request Headers for the Query Service REST API",null)},0);var i=new XMLHttpRequest;i.open(e||"GET",a),Object.keys(b).forEach(function(a){void 0!==b[a]&&null!==b[a]&&i.setRequestHeader(a,b[a])});var j=[];i.onreadystatechange=h(),i.onload=h(),i.onerror=h(null,"Error"),i.ontimeout=h(null,"TimeOut"),i.onabort=h(null,"Abort"),i.timeout=d||Q,f?i.send(f):i.send()}function e(){var a,b,c=+new Date;E&&F&&(b=c-U,U=c,document.hidden?(V+=b,a={documentVisibleDuration:b,totalDocumentVisibleDuration:V,totalDocumentNotVisibleDuration:W},w(E,F,"documentNotVisible",a)):(W+=b,a={documentNotVisibleDuration:b,totalDocumentVisibleDuration:V,totalDocumentNotVisibleDuration:W},w(E,F,"documentVisible",a)))}function f(){var a,b={},c=+new Date;E&&F&&(a=c-U,U=c,document.hidden?W+=a:V+=a,b={totalDocumentVisibleDuration:V,totalDocumentNotVisibleDuration:W},w(E,F,"documentUnloaded",b))}function g(a,b){E=a,F=b}function h(a){var b={};return a.token&&(b[X.TOKEN_HEADER_NAME]=a.token),a.oauth2Token&&(b[X.AUTHORIZATION_HEADER_NAME]=a.oauth2Token?"Bearer "+a.oauth2Token:void 0),b[X.ANON_SESSION_HEADER_NAME]=a.token||a.oauth2Token?"false":"true",b[X.CLIENT_ID_HEADER_NAME]=a.clientId,b[X.CLIENT_FEATURE_ID_HEADER_NAME]=a.clientFeatureId,b[X.SESSION_ID_HEADER_NAME]=a.sessionId,a.userId&&(b[X.EXTRA_USER_ID_HEADER_NAME]=a.userId),a.cacheControlReq&&(b[X.CACHE_CONTROL_HEADER_NAME]=a.cacheControlReq),a.acmNameSpace&&(b[X.ACM_NAMESPACES_HEADER_NAME]=a.acmNameSpace),I&&(b[X.DEBUG_HEADER_NAME]=I),b[X.CONTENT_TYPE_HEADER_NAME]="application/json",b[X.ACCEPT_HEADER_NAME]="application/json",b}function i(a){var b=null;return a[X.AUTHORIZATION_HEADER_NAME]&&"apidev"!==O&&"apistg"!==O&&"apiprod"!==O&&(b="'"+X.AUTHORIZATION_HEADER_NAME+"' header for OAUTH2 not valid for "+O+" endpoint. Use one of apidev/apistg/apiprod endpoints."),!a[X.TOKEN_HEADER_NAME]||"apidev"!==O&&"apistg"!==O&&"apiprod"!==O||(b="'"+X.AUTHORIZATION_HEADER_NAME+"' header for OAUTH1 not valid for "+O+" endpoint."),a[X.TOKEN_HEADER_NAME]&&a[X.AUTHORIZATION_HEADER_NAME]&&(b="'"+X.AUTHORIZATION_HEADER_NAME+"' and '"+X.AUTHORIZATION_HEADER_NAME+"' headers can not coexist."),a[X.EXTRA_USER_ID_HEADER_NAME]&&!a[X.AUTHORIZATION_HEADER_NAME]&&(b="'"+X.AUTHORIZATION_HEADER_NAME+"' OAUTH2 header must be used w/ '"+X.EXTRA_USER_ID_HEADER_NAME+"' header."),a[X.CLIENT_ID_HEADER_NAME]||(b="'"+X.CLIENT_ID_HEADER_NAME+"' header is required for all requests."),a[X.CLIENT_FEATURE_ID_HEADER_NAME]||(b="'"+X.CLIENT_FEATURE_ID_HEADER_NAME+"'header is required for all requests."),"application/json"!==a[X.CONTENT_TYPE_HEADER_NAME]&&(b="'"+X.CONTENT_TYPE_HEADER_NAME+"' header must be application/json for all requests."),a[X.TOKEN_HEADER_NAME]||a[X.AUTHORIZATION_HEADER_NAME]||a[X.SESSION_ID_HEADER_NAME]&&a[X.ANON_SESSION_HEADER_NAME]||(b="'"+X.TOKEN_HEADER_NAME+"' or '"+X.AUTHORIZATION_HEADER_NAME+"' header needs to be a valid value or both '"+X.SESSION_ID_HEADER_NAME+"' and '"+X.ANON_SESSION_HEADER_NAME+"' header need to be specified."),b}function j(a){var b=null,c=null;return a||(b="queryParams: needs to be specified."),a.pid||0===a.pid||(b="queryParams.pid: needs to be a valid Profile Id."),a.pid.length<=0&&(b="queryParams.pid: Profile Id needs to be a string with length greater than zero."),a.query||(c="queryParams.query empty."),a.page&&(a.pageOffset||a.pageSize)&&(c="either queryParams.page or queryParams.pageOffset and queryParams.pageSize must be set."),a.page||a.pageOffset||a.pageSize||(c="queryParams.page, queryParams.pageOffset, queryParams.pageSize empty."),(a.page<0||a.page>100)&&(c="queryParams.page should be a positive integer between 1 and 100"),a.pageOffset<0&&(c="queryParams.pageOffset should be a positive integer greater than 1"),(a.pageSize<0||a.pageSize>100)&&(c="queryParams.pageSize should be a positive integer between 1 and 100"),{err:b,warn:c}}function k(a,b,c){var d=null;return(!b||b&&"function"!=typeof b)&&(d="cb: callback was not a function"),a.pid||(d="pid: needs to be specified."),a.pid.length<=0&&(d="pid: Profile Id needs to be a string with length greater than zero."),a.document&&a.document.length<=0&&(d="document: Document needs to be a string with length greater than zero."),c&&(a.userQueries||(d="userQueries: userQueries is empty, nothing to save."),a.userQueries.userData||(d="userQueries.userData: User data is missing.")),d}function l(a,b){var c=a;return b.pid&&(c+="?pid="+b.pid),b.query&&(c+="&query="+encodeURIComponent(b.query)),b.language&&(c+="&language="+encodeURIComponent(b.language)),b.modifier&&(c+="&modifier="+encodeURIComponent(b.modifier)),b.filters&&(c+="&filters="+encodeURIComponent(b.filters)),b.sort&&"relevance"!==b.sort&&(c+="&sort="+encodeURIComponent(b.sort)),b.page&&1!==b.page&&(c+="&page="+encodeURIComponent(""+b.page)),b.pageOffset&&0!==b.pageOffset&&(c+="&offset="+encodeURIComponent(""+b.pageOffset)),b.pageSize&&0!==b.pageSize&&(c+="&pagesize="+encodeURIComponent(""+b.pageSize)),O!==M&&(c+="&env="+encodeURIComponent(O)),c=c.replace(/^\?&/,"?")}function m(a,b,c){return-1===a.indexOf(Y.escapeCharacter)?a:a.split(b).join(c)}function n(a){return a=a||"",a=m(a,Y.escapeCharacter,Z.escapeCharacterEscSeq),a=m(a,Y.arrayListItemDelimiter,Z.arrayListItemDelimiterEscSeq),a=m(a,Y.arrayListValueDelimiter,Z.arrayListValueDelimiterEscSeq)}function o(a){return a.map(function(a){for(var b=a[0],c=1;c<a.length;c++)b+=Y.arrayListValueDelimiter+a[c];return b}).join(Y.arrayListItemDelimiter)}function p(a){return a.map(function(a){if(-1!==Y.reservedArrayListFilterNames.indexOf(a[0])&&Array.isArray(a[1])){var b=o(a[1]);return n(a[0])+Y.nameValueDelimiter+b}return n(a[0])+Y.nameValueDelimiter+n(a[1])}).join(Y.listItemDelimiter)}function q(a,b,c){if(!a||!b||!c)return[];for(var d=[],e="",f="",g=!1,h=0;h<a.length;h++)e=a[h],e===c?(g=!g,f+=e):e!==b||g?(f+=e,g=!1):(d.push(f),f="",g=!1);return f.length&&d.push(f),d}function r(a){return q(a,Y.arrayListItemDelimiter,Y.escapeCharacter).map(function(a){return q(a,Y.arrayListValueDelimiter,Y.escapeCharacter)})}function s(a){var b=[];return a.map(function(a){return-1!==Y.reservedArrayListFilterNames.indexOf(a[0])?(b=r(a[1]),[a[0],b]):a})}function t(a){return a.map(function(a){return q(a,Y.nameValueDelimiter,Y.escapeCharacter)})}function u(a){return q(a,Y.listItemDelimiter,Y.escapeCharacter)}function v(a){return a&&a.length?s(t(u(a))):[]}function w(a,b,c,e,f){if(f&&"function"!=typeof f)throw new Error("Callback was not a function");f=f||function(){};var g=P+S.Log+"?queryId="+a+"&type="+encodeURIComponent(c)+"&sessionId="+(b.sessionId||"")+"&userId="+(b.userId||"")+"&clientId="+(b.clientId||"")+"&clientFeatureId="+(b.clientFeatureId||"")+"&body="+encodeURIComponent(JSON.stringify(e))+"&_n="+Math.floor(1e5*Math.random()),h=function(a,b){a&&console.debug("Logged(err:"+(a||"noerr")+" info:"+(b||"-")+"): "+g),f(a)},i={};i[X.CONTENT_TYPE_HEADER_NAME]="text/plain",d(g,i,h)}function x(b,c){var d,e;d={url:document&&document.location&&document.location.href,userAgent:navigator.userAgent,hardwareConcurrency:navigator.hardwareConcurrency,language:navigator.language,maxTouchPoints:navigator.maxTouchPoints,versionInfo:L,performance:null},K||(a&&a.performance?(e=y(),e.searchSDKTimings={fetchStartToSearchSDKLoaded:T-e.timing.fetchStart,fetchStartToSearchSDKInstantiated:J-e.timing.fetchStart,fetchStartToNow:+new Date-e.timing.fetchStart},e.timingDelta={},e.timing&&(e.timingDelta.navigationStartToDomInteractive=e.timing.domInteractive-e.timing.navigationStart,e.timingDelta.dns=e.timing.domainLookupEnd-e.timing.domainLookupStart,e.timingDelta.htmlDownloadTime=e.timing.responseEnd-e.timing.responseStart,e.timingDelta.tcpConnectionSetup=e.timing.connectEnd-e.timing.connectStart,e.timing.secureConnectionStart&&(e.timingDelta.secureConnectionSetup=e.timing.connectEnd-e.timing.secureConnectionStart),Object.keys(e.timing).forEach(function(a){0!==e.timing[a]&&(e.timingDelta["fetchStartTo"+a[0].toUpperCase()+a.slice(1)]=e.timing[a]-e.timing.fetchStart)})),delete e.timing,d.performance=e):(d.performance={},d.noPerformance=!0),w(b,c,"performance",d)),K=!0}function y(){if(!a||!a.performance)return{};var b=function(b){return a.performance[b]?Object.keys(Object.getPrototypeOf(a.performance[b])).reduce(function(c,d){return a.performance[b][d]>=0&&(c[d]=a.performance[b][d]),c},{}):null};return Object.keys(Object.getPrototypeOf(a.performance)).reduce(function(c,d){return 0!==d.indexOf("onwebkit")&&a.performance[d]&&"object"==typeof a.performance[d]&&(c[d]=b(d)),c},{})}function z(a,b,c){var d,e;c&&(e="SERP",d=[].concat(c.queryResults||[],c.federatedResults||[]),d.forEach(function(c,d){C(c,d+1,a,b,e,"")}))}function A(a,b,c){var d;c&&(d="suggestions",(c.suggestionGroups||[]).forEach(function(c){var e=c.name;c.suggestions.forEach(function(c,f){C(c,f+1,a,b,d,e)})}),(c.textSuggestions||[]).forEach(function(c,e){B(c,e,a,b,d,"")}))}function B(a,b,c,d,e,f){a.logClick=function(){var g={position:b,url:"",querySource:e,subQuerySource:f};a.suggestion&&(g.title=a.suggestion),w(c,d,"click",g)}}function C(a,b,c,d,e,f){a.logClick=function(){var g={position:b,url:"",querySource:e,subQuerySource:f};a.searchResultId&&(g.id=a.searchResultId.id,g.sourceSystem=a.searchResultId.sourceSystem),a.url&&(g.url=a.url),w(c,d,"click",g)}}function D(a){O=a&&N.hasOwnProperty(a)?a:M,P=N[O];var e=this;this.getApiVersion=function(){return L.version},this.getServerMinRestApiVersion=function(){return L.minRestApiVersion},this.getBuildDate=function(){return L.buildDate},this.getBuildNumber=function(){return L.buildNumber},this.getServiceEnvironments=function(){return Object.keys(N)},this.getFilterConfig=function(){return Y},this.reservedFilterStringToFilterArray=function(a){return v(a)},this.reservedFilterArrayToFilterString=function(a){return p(a)},this.getLanguageFromBcp47Code=function(a){return $[a]},this.sanitizeAndHighlightString=function(a,b,c){var d,e,f=!1;return a?(b=b||"<em class='highlight'>",c=c||"</em>",e=document.createElement("div"),e.textContent=a,d=e.innerHTML,d=d.replace(/[\uE000\uE001]/g,function(d,e,g){return""!==d||f?""===d&&f?(f=!1,c):void console.warn("Warning: Incorrect number of highlight tokens in string: "+a):(f=!0,b)}),f&&(d+=c,console.warn("Warning: Incorrect number of highlight tokens in string: "+a)),d):""},this.removeHighlightTokens=function(a){return a?a=a.replace(/[\uE000\uE001]/g,""):""},this.query=function(a,b,e){var f,k=j(a);if(k&&k.err)return console.error("Invalid Query Parameters for the Query Service REST API - "+k),void setTimeout(function(){e("Invalid Query Parameters for the Query Service REST API - "+k.err,null)},0);k&&k.warn&&console.warn("Query Parameters for the Query Service REST API - "+k.warn),f=l(P+S.Query,a);var m=h(b),n=i(m);if(n)return console.error("Invalid Request Headers for the Query Service REST API - "+n),void setTimeout(function(){e("Invalid Request Headers for the Query Service REST API - "+n,null)},0);d(f,m,function(a,d){!a&&d&&(z(d.queryId,b,d),c(d),x(d.queryId,b),g(d.queryId,b)),e(a,d)})},this.findCategories=function(a,b,c){var e,f=j(a);if(f&&f.err)return console.error("Invalid Query Parameters for the Query Service REST API - "+f),void setTimeout(function(){c("Invalid Query Parameters for the Query Service REST API - "+f.err,null)},0);f&&f.warn&&console.warn("Query Parameters for the Query Service REST API - "+f.warn),e=l(P+S.Categories,a);var g=h(b),k=i(g);if(k)return console.error("Invalid Request Headers for the Query Service REST API - "+k),void setTimeout(function(){c("Invalid Query Parameters for the Query Service REST API - "+k,null)},0);d(e,g,c)},this.suggestionTimeoutId=null,this.lastSentSuggestionNum=-1,this.lastDisplayedSuggestionNum=-1,this.suggest=function(a,b,c){var f=function(a,b,c){var f,k,m=j(a);if(m&&m.err)return console.error("Invalid Query Parameters for the Query Service REST API - "+m),void setTimeout(function(){c("Invalid Query Parameters for the Query Service REST API - "+m.err,null)},0);m&&m.warn&&console.warn("Query Parameters for the Query Service REST API - "+m.warn),k=e.lastSentSuggestionNum+1,e.lastSentSuggestionNum=k,f=l(P+S.Suggestions,a);var n=h(b),o=i(n);if(o)return console.error("Invalid Request Headers for the Query Service REST API - "+o),void setTimeout(function(){c("Invalid Request Headers for the Query Service REST API - "+o,null)},0);d(f,n,function(a,d){k>e.lastDisplayedSuggestionNum&&(e.lastDisplayedSuggestionNum=k,a||(A(d.queryId,b,d),x(d.queryId,b),g(d.queryId,b)),c(a,d))})};clearTimeout(e.suggestionTimeoutId),e.suggestionTimeoutId=setTimeout(function(){f(a,b,c)},R)},this.logEvent=w,this.queryServiceInfo=function(a,b){var c=P+S.Health,e=h(a),f=i(e);if(f)return console.error("Invalid Request Headers for the Query Service REST API - "+f),void setTimeout(function(){b("Invalid Request Headers for the Query Service REST API - "+f,null)},0);d(c,e,function(a,c){var d,e;if(d=L.minRestApiVersion.split(".").map(function(a){return parseFloat(a)}),!a&&c.versionInfo&&c.versionInfo.version){e=c.versionInfo.version.split(".").map(function(a){return parseFloat(a)});for(var f=!1,g=0;g<e.length||g<d.length;){if((e[g]||0)>(d[g]||0)){f=!0;break}if((e[g]||0)<(d[g]||0)){f=!1;break}g+=1}f=f||g===d.length,f||console.error("Error: Remote API version ("+c.versionInfo.version+") is older than required ("+L.minRestApiVersion+")")}b(a,c)})},this.queryParamsToUrl=function(a,b,c,d){var e;if(!b||!c||!c.pushState)return console.error("queryParamsToUrl() requres a History object in the urlLocation parameter such as window.history."),!1;e=new URL(b),e.search=new URL(l(P+S.Query,a)).search;try{c.pushState(null,"",e)}catch(a){document.location.hash=e.search}return!0},this.urlParametersToQueryParams=function(a){var c={pid:void 0,query:null,modifier:null,filters:"",sort:"",page:1,language:"",oauth2Token:null,env:null},d={pid:1},e={access_token:"oauth2Token",expires_in:"oauth2TokenExpiresIn"},f=new URL(a);return b((f.search||"").slice(1)+"&"+(f.hash||"").slice(1)).forEach(function(a){void 0===typeof c[a[0]]||d[a[0]]||(c[e[a[0]]||a[0]]=a[1])}),c},this.getUserQueries=function(a,b,c){var e=k(a,c);if(e)return console.error("Invalid Query Parameters for the Query Service REST API - "+e),void setTimeout(function(){c("Invalid Query Parameters for the Query Service REST API - "+e,null)},0);var f=P+S.SavedQueries+"?pid="+a.pid+"&document="+(a.document?a.document:"")+"&_n="+Math.floor(1e5*Math.random()),g=h(b),j=i(g);if(j)return console.error("Invalid Request Headers for the Query Service REST API - "+j),void setTimeout(function(){c("Invalid Request Headers for the Query Service REST API - "+j,null)},0);d(f,g,function(a,b){c(a,b)},null,null,null,!0)},this.saveUserQueries=function(a,b,c){var e=k(a,c,!0);if(e)return console.error("Invalid Query Parameters for the Query Service REST API - "+e),void setTimeout(function(){c("Invalid Query Parameters for the Query Service REST API - "+e,null)},0);var f=P+S.SavedQueries+"?pid="+a.pid,g=h(b),j=i(g);if(j)return console.error("Invalid Request Headers for the Query Service REST API - "+j),void setTimeout(function(){c("Invalid Request Headers for the Query Service REST API - "+j,null)},0);var l=JSON.stringify(a.userQueries);d(f,g,function(a,b){c(a,b)},null,"PUT",l,!0)}}var E,F,G=G||function(b){var c=void 0!==a&&null!==a?a:self;return b.split(".").forEach(function(a){c[a]=c[a]||{},c=c[a]}),c},H=new G("Autodesk.Search"),I=I||!1,J=+new Date,K=!1,L=Object.freeze({version:"3.0.3",buildDate:"2017-01-27T14:10:26",buildNumber:"236",minRestApiVersion:"1.40.4"}),M="prod",N=Object.freeze({localdev:"http://search-localdev.api.autodesk.com:8080/qs",dev:"https://dev.search.api.autodesk.com/qs","dev-dr":"https://dev.search-dr.api.autodesk.com/qs",stg:"https://search-staging.api.autodesk.com/qs","stg-dr":"https://search-staging-dr.api.autodesk.com/qs",prod:"https://search.api.autodesk.com/qs","prod-dr":"https://search-dr.api.autodesk.com/qs",apidev:"https://developer-dev.api.autodesk.com/search",apistg:"https://developer-stg.api.autodesk.com/search",apiprod:"https://developer.api.autodesk.com/search"}),O=M,P=N[O],Q=null,R=250,S=Object.freeze({Query:"/v3/search",Categories:"/v3/categories",Suggestions:"/v3/suggestions",Log:"/v2/log",Health:"/v2/health",SavedQueries:"/v3/savedqueries"}),T=+new Date,U=+new Date,V=0,W=0;document.addEventListener&&document.addEventListener("visibilitychange",e,!1),a.addEventListener&&a.addEventListener("beforeunload",f,!1);var X=Object.freeze({TOKEN_HEADER_NAME:"x-ads-token",ANON_SESSION_HEADER_NAME:"x-ads-anon-session",CLIENT_ID_HEADER_NAME:"x-ads-client-id",CLIENT_FEATURE_ID_HEADER_NAME:"x-ads-client-feature-id",SESSION_ID_HEADER_NAME:"x-ads-session-id",DEBUG_HEADER_NAME:"x-ads-debug",EXTRA_USER_ID_HEADER_NAME:"x-ads-ex-user-id",ACM_NAMESPACES_HEADER_NAME:"x-ads-search-acm-namespaces",CACHE_CONTROL_HEADER_NAME:"Cache-Control",CONTENT_TYPE_HEADER_NAME:"Content-Type",ACCEPT_HEADER_NAME:"Accept",AUTHORIZATION_HEADER_NAME:"Authorization"}),Y=c({arrayListItemDelimiter:"'",arrayListValueDelimiter:"*",escapeCharacter:"\\",reservedArrayListFilterNames:["resourceIds"]}),Z=c({arrayListItemDelimiterEscSeq:Y.escapeCharacter+Y.arrayListItemDelimiter,arrayListValueDelimiterEscSeq:Y.escapeCharacter+Y.arrayListValueDelimiter,escapeCharacterEscSeq:Y.escapeCharacter+Y.escapeCharacter}),$=c({"pt-BR":"PTB",cs:"CSY",en:"ENU","en-us":"ENU",fr:"FRA",de:"DEU",hu:"HUN",it:"ITA",ja:"JPN",ko:"KOR",pl:"PLK",ru:"RUS","zh-CN":"CHS",es:"ESP","es-ES":"ESP","zh-TW":"CHT"});D.prototype.constructor=D,H.SearchQueryAPI=D}(window),function(){"use strict";var a=Autodesk.Viewing.Private,b=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),c=a.ENABLE_INLINE_WORKER||!1,d=a.LMV_WORKER_URL,e=function(){var a=d.indexOf(".min.js")>0;this.propertyWorkerUrl=a?"searchworker.min.js":"searchworker.js",this.propertyWorkerFetchingScript=!1,this.propertyWorkerDataUrl=null,this.propertyWorkerFetchingCbs=[]},f=e.prototype;f.initPropertyWorkerScript=function(b,d){var e=this;if(c&&!this.propertyWorkerDataUrl){if(this.propertyWorkerFetchingCbs.push({successCB:b}),this.propertyWorkerFetchingScript)return;var f=new XMLHttpRequest,g=this.propertyWorkerUrl,h=a.getResourceUrl(this.propertyWorkerUrl);h&&(g=h),f.open("GET",g,!0),f.withCredentials=!1,f.onload=function(){e.propertyWorkerFetchingScript=!1;var a;window.URL=window.URL||window.webkitURL;try{a=new Blob([f.responseText],{type:"application/javascript"})}catch(b){a=new BlobBuilder,a.append(f.responseText),a=a.getBlob()}e.propertyWorkerDataUrl=URL.createObjectURL(a);var b=e.propertyWorkerFetchingCbs.concat();e.propertyWorkerFetchingCbs=[];for(var c=0;c<b.length;++c)b[c].successCB&&b[c].successCB()},e.propertyWorkerFetchingScript=!0,f.send()}else b&&b()},f.initInViewerSearchWorkersScripts=function(a,b){this.initPropertyWorkerScript(a,b)},f.createPropertyWorker=function(){return c?new Worker(this.propertyWorkerDataUrl):new Worker(a.getResourceUrl(this.propertyWorkerUrl))},b.WorkerUtils=new e}(),function(){"use strict";function a(a,b,c){var d,e=a.viewer.model.is2d(),f=function(b,c){return a.isNodeVisible(b,c)};a.inViewerSearchThisView&&(d=function(b,c,d,e){a.highlightNodeInViewer(b,c,d,e,p)},a.inViewerSearchThisView.initialize(a.qsApiService,a.viewerProperties,b,e,a.thisViewDom||m,d,f,c),a.options.uiEnabled&&a.thisViewDom&&a.thisViewDom.addEventListener("click",function(b){var c=b.target.getAttribute("class");c&&c.includes("item-result")&&a.updateRecentQueries(a.inViewerSearchThisView.searchString)})),a.inViewerSearchThisItem&&!a.inViewerSearchThisItem.initialized&&(d=function(b,c,d,e){a.highlightNodeInViewer(b,c,d,e,q)},a.inViewerSearchThisItem.initialize(a.qsApiService,a.viewerProperties,b,a.thisItemDom||n,d,f,c,function(b){a.changeToThisViewTabAndSelectNode(b)}),a.options.uiEnabled&&a.thisItemDom&&a.thisItemDom.addEventListener("click",function(b){var c=b.target.getAttribute("class");c&&(c.includes("item-result")||c.includes("geometry-name"))&&a.updateRecentQueries(a.inViewerSearchThisItem.searchString)})),a.inViewerSearchThisProject&&(a.inViewerSearchThisProject.initialize(a.qsApiService,a.thisProjectDom||o),a.options.uiEnabled&&a.thisProjectDom&&a.thisProjectDom.addEventListener("click",function(b){var c=b.target.getAttribute("class");c&&(c.includes("item-result")||c.includes("category-name"))&&a.updateRecentQueries(a.inViewerSearchThisProject.searchString)}))}function b(a,b,c){var d=b.model.getDocumentNode(),e=d?b.model.getDocumentNode().parent:null;e?setTimeout(function(){c(e)},0):(a.noBubbleData=!0,a.inViewerSearchThisItem&&(delete a.inViewerSearchThisItem,a.inViewerSearchThisItem=null),k.logger.warn("InViewerSearch Extension: no ViewingApplication is being used so relatedItemsTab will not be visible"),setTimeout(function(){c(null)},0))}function c(a){var b;a.options.uiEnabled&&a.searchToolButton&&a.inViewerSearchPanel&&(b=a.inViewerSearchPanel.isVisible(),a.searchToolButton.setState(b?j.Button.State.ACTIVE:j.Button.State.INACTIVE),a.searchToolButton.setToolTip(i.i18n.translate("Search")))}function d(d,e){var f=d.viewer,g=k.env,h=d.getCurrentGeometry(),j=d.cacheObj.searchInfoThisItem;d.showingTabs=!1;var l=function(){var a;a=(!d.inViewerSearchThisView||d.inViewerSearchThisView.initialized)&&(!d.inViewerSearchThisItem||d.inViewerSearchThisItem.initialized),a?(d.initialized=!0,d.options.uiEnabled&&d.viewer&&d.viewer.getPropertyPanel&&(d.extensionViewer=d.viewer.getPropertyPanel(!0)),j||c(d),e(!0)):d.inViewerSearchThisView.initialized&&(j||c(d))};b(d,f,function(b){var c,e=[],f="";if(b&&(e=b.getRootNode().search({type:"geometry"}),f=b.findPropertyDbPath()),d.flatGUIDS=e,k.logger.debug("InViewerSearchExtension - has sharedPropertyDBPath: "+f),d.qsApiService){var j={count:{}};c=0,e.forEach(function(a){a.data&&(c+=a.data.size?a.data.size:0,a.data.role&&(j.count[a.data.role]=j.count[a.data.role]+1||1))}),j.size=c;var m=i.getGlobal(),n=m.LMV_VIEWER_VERSION+"."+m.LMV_VIEWER_PATCH;d.qsApiService.initialize(n,g,d.options.clientId,d.options.sessionId),d.qsApiService.logInitEvent(d.viewer.model.getData().urn,j,d.options,"")}d.viewerProperties&&!d.viewerProperties.initialized&&d.viewerProperties.initialize(d.viewer,d.noBubbleData,d.flatGUIDS,h,d.options.thresholdSearchMaxNodes,d.qsApiService,f),d.options.uiEnabled&&!d.initialized&&d.createTabs(),a(d,h,l)})}function e(a,b){var c,d,e,f,g,h=[].slice.call(b.parentElement.children);if(a.enabled){h.forEach(function(a){a.classList.remove("selected")});var i=b.getAttribute("tabId");g=i===q?n:i===p?m:o,b.classList.add("selected"),a.selectedTab=b,a.qsApiService.logTabClickEvent(i),c=b.parentElement.parentElement.children[1],d=[].slice.call(c.children),g===m?(f=a.inViewerSearchThisView,a.highlightNodeInViewer(f.clicked,f.controller.searchResultIds,f.clicked,!1)):g===n&&(e=a.inViewerSearchThisItem,a.highlightNodeInViewer(e.selectedNodeId,e.currentGeoSearchedIds,e.selectedNodeId,!1)),d.forEach(function(a){a.id===g?a.classList.remove("hidden"):a.classList.add("hidden")})}}function f(a,b,c,d,f){var g,h;return g=document.createElement("div"),g.className="tab-item "+c,g.setAttribute("tabId",f),g.addEventListener("click",function(){e(a,this)},!1),h=document.createElement("label"),h.appendChild(document.createTextNode(d)),g.appendChild(h),g}function g(a,b){var c,d,e,g,h,i;i=0,c=document.createElement("div"),d=document.createElement("div"),d.className="tab-content",b.options.loadedModelTab.enabled&&b.inViewerSearchThisView&&(i++,c.appendChild(f(b,m,"this-view",b.options.loadedModelTab.displayName,p)),e=document.createElement("div"),e.id=m,e.className="tab-content-this-view hidden",b.thisViewDom=e,d.appendChild(e)),b.options.relatedItemsTab.enabled&&b.inViewerSearchThisItem&&(i++,c.appendChild(f(b,n,"this-item",b.options.relatedItemsTab.displayName,q)),g=document.createElement("div"),g.className="tab-content-this-item hidden",g.id=n,b.thisItemDom=g,d.appendChild(g)),b.options.serverSearchTab.enabled&&(i++,c.appendChild(f(b,o,"this-project",b.options.serverSearchTab.displayName,r)),h=document.createElement("div"),h.className="tab-content-this-project hidden",h.id=o,b.thisProjectDom=h,d.appendChild(h)),c.className="tab-items tabs-count-"+i,c.childNodes[0].classList.add("selected"),b.selectedTab=c.childNodes[0],d.childNodes[0].classList.remove("hidden"),a.appendChild(c),a.appendChild(d),b.tabContent=d}function h(a){var b=a.getCurrentGeometry(),c=a.viewer.model.is2d();a.options.uiEnabled&&a.viewer&&a.viewer.getPropertyPanel&&(a.extensionViewer=a.viewer.getPropertyPanel(!0)),a.viewerProperties.updateCurrentGeometry(b,function(d,e){var f=a.cacheObj.searchInfoThisItem.node;a.inViewerSearchThisView&&a.inViewerSearchThisView.updateCurrentGeometry(b,e,d,c,f,a.viewer),a.inViewerSearchThisItem&&a.inViewerSearchThisItem.updateCurrentGeometry(b,a.viewer),a.disabledPanel(!0)}),a.addToolbarUI(!0)}var i=Autodesk.Viewing,j=Autodesk.Viewing.UI,k=Autodesk.Viewing.Private,l=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),m="in-viewer-search-this-view",n="in-viewer-search-this-item",o="in-viewer-search-this-project",p="this-view-tab",q="this-item-tab",r="this-project-tab",s=null,t=null,u=Object.freeze({BACKSPACE:8,SPACE:32,ENTER:13});l.InViewerSearchMain=function(a,b,c){this.viewer=a,this.cacheObj=c,this.options=b,this.is2DMode=null,this.initialized=!1,this.toolbarTools=null,this.qsApiService=new l.QsApiService,this.viewerProperties=new l.ViewerPropertiesService(a),this.queries=new l.InViewerSearchQueries(a,b),this.noBubbleData=!1,this.inViewerSearchPanel=null,this.inViewerSearchThisView=null,this.inViewerSearchThisItem=null,this.inViewerSearchThisProject=null,this.geometryLoadedCallback=null,this.tabsElem=null,this.searchBarElem=null,this.queriesContainer=null,this.saveLastQuery=null,this.recentSearches=null,this.flatGUIDS={},this.container=null,this.searchToolButton=null,this.showingTabs=!1,this.initCb=null,this.closeCallback=null,this.workersScriptsInitialized=!1,this.initWorkersScripts=null,this.thisProjectDom=null,this.thisItemDom=null,this.thisViewDom=null,this.extensionViewer=null,this.enabled=!0},l.InViewerSearchMain.prototype.constructor=l.InViewerSearchMain,l.InViewerSearchMain.prototype.load=function(){var a=this,b=this.viewer;if(!(this.options&&this.options.loadedModelTab&&this.options.relatedItemsTab&&this.options.serverSearchTab)||!(this.options.loadedModelTab.enabled||this.options.relatedItemsTab.enabled||this.options.serverSearchTab.enabled))return k.logger.log("InViewerSearch Extension - all search types disabled, nothing to do."),!1;l.WorkerUtils.initInViewerSearchWorkersScripts(function(){a.workersScriptsInitialized=!0,a.initWorkersScripts&&a.initWorkersScripts(),k.logger.info("InViewerSearch Extension: workers fetched.")},function(){k.logger.warn("InViewerSearch Extension: error fetching workers.")}),this.options.loadedModelTab.enabled&&!this.inViewerSearchThisView&&(this.inViewerSearchThisView=new l.InViewerSearchThisView(b,this.options)),this.options.relatedItemsTab.enabled&&!this.inViewerSearchThisItem&&(this.inViewerSearchThisItem=new l.InViewerSearchThisItem(b,this.options,this.cacheObj)),this.options.serverSearchTab.enabled&&!this.inViewerSearchThisProject&&(this.inViewerSearchThisProject=new l.InViewerSearchThisProject(this.options)),this.options.uiEnabled&&!this.inViewerSearchPanel&&(this.inViewerSearchPanel=new l.InViewerSearchPanel(b,"in-viewer-search",i.i18n.translate("Search"),this.options,this.qsApiService),this.container=this.inViewerSearchPanel.container,this.inViewerSearchPanel.addCloseHandler(function(){a.queries&&a.queries.closeSettingsPanel()}),this.inViewerSearchPanel.addEventListener(this.inViewerSearchPanel.closer,"click",this.closeCallback)),this.options.uiEnabled&&!a.searchToolButton&&this.addToolbarUI(),this.onInitialized=function(b){b&&(a.initialized=!0,c(a),a.initCb&&a.initCb())},this.geometryLoadedCallback=function(){a.workersScriptsInitialized?d(a,a.onInitialized):a.initWorkersScripts=function(){d(a,a.onInitialized)}};var e=function(){b.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e),b.getObjectTree(function(){a.geometryLoadedCallback()},function(){k.logger.warn("InViewerSearch Extension - failed getObjectTree"),a.geometryLoadedCallback()})};return b.getObjectTree(function(){a.geometryLoadedCallback()},function(){if(b.model&&b.model.getData){var c=b.model.getData();c&&c.hasOwnProperty("hasObjectProperties")&&a.geometryLoadedCallback()}else b.addEventListener(i.GEOMETRY_LOADED_EVENT,e)}),!0},l.InViewerSearchMain.prototype.update=function(a,b,c){this.viewer=a,this.cacheObj=c,this.options=b;var d=this;this.container.classList.remove("hidden");var e=function(){d.viewer.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,f),h(d),d.cacheObj.inViewerSearch=null},f=function(){a.getObjectTree(function(){e()},function(){k.logger.warn("InViewerSearch Extension - failed getObjectTree"),e()})};return this.viewer.getObjectTree(function(){f()},function(){if(d.viewer.model&&d.viewer.model.getData){var a=d.viewer.model.getData();a&&a.hasOwnProperty("hasObjectProperties")&&f()}else d.viewer.addEventListener(i.GEOMETRY_LOADED_EVENT,f)}),!0},l.InViewerSearchMain.prototype.disabledPanel=function(a){this.container.classList.add("disabled"),a&&this.container.classList.remove("disabled"),this.enabled=a},l.InViewerSearchMain.prototype.addToolbarUI=function(a){var b,c=this,d=this.viewer;if(d.getToolbar){var e=d.getToolbar(!1);this.toolbarTools=e.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID),b=new j.Button("toolbar-in-viewer-search"),b.setToolTip(i.i18n.translate("Search")),b.setIcon("adsk-button-icon-search"),a||(b.setToolTip(i.i18n.translate("Loading Search")),b.setState(j.Button.State.DISABLED)),b.addEventListener("click",function(){if(c.inViewerSearchPanel){var a=c.inViewerSearchPanel.isVisible();c.qsApiService.logGeneralEvent(a?"searchWindowClose":"searchWindowOpen"),c.inViewerSearchPanel.setVisible(!a),c.searchBarElem.focus(),c.queries&&c.queries.closeSettingsPanel()}},!1),b.addClass("in-viewer-search-button"),c.inViewerSearchPanel&&c.inViewerSearchPanel.addVisibilityListener(function(a){b.setState(a?j.Button.State.ACTIVE:j.Button.State.INACTIVE)}),c.searchToolButton=b,c.toolbarTools.addControl(b)}},l.InViewerSearchMain.prototype.unload=function(){if(this.cacheObj.searchInfoThisItem){this.cacheObj.inViewerSearch=this,this.viewer.getPropertyPanel()&&this.viewer.getPropertyPanel().setVisible(!1);var a=this.viewer.config.extensions;a&&a.indexOf("Autodesk.InViewerSearch")<0&&this.container.classList.add("hidden")}else this.initialized=!1,this.options.uiEnabled&&(this.closeSearch(),this.toolbarTools&&this.toolbarTools.removeControl(this.searchToolButton)),this.geometryLoadedCallback&&this.viewer.removeEventListener(i.GEOMETRY_LOADED_EVENT,this.geometryLoadedCallback),this.inViewerSearchThisView&&this.inViewerSearchThisView.initialized&&this.inViewerSearchThisView.uninitialize(),this.inViewerSearchThisItem&&this.inViewerSearchThisItem.initialized&&this.inViewerSearchThisItem.uninitialize(),
this.inViewerSearchThisProject&&this.inViewerSearchThisProject.initialized&&this.inViewerSearchThisProject.uninitialize(),this.inViewerSearchPanel&&this.inViewerSearchPanel.uninitialize(),this.viewerProperties.uninitialize(),delete this.searchToolButton,delete this.inViewerSearchThisView,delete this.inViewerSearchThisItem,delete this.inViewerSearchThisProject,delete this.inViewerSearchPanel,delete this.qsApiService,delete this.viewerProperties;return!0},l.InViewerSearchMain.prototype.updateRecentQueries=function(a){this.queries.updateRecentQueries(a)},l.InViewerSearchMain.prototype.highlightNodeInViewer=function(a,b,c,d,e){var f=this.selectedTab.getAttribute("tabId");if(!e||e===f){this.viewer.model.is2d();this.viewer.navigation.setRequestHomeView(!0),a?(this.viewer.isolate(a),this.viewer.select(a),c&&this.extensionViewer&&this.extensionViewer.container?this.extensionViewer.setVisible(!0):c||this.extensionViewer.setVisible(!1)):(b||(f===p?b=this.inViewerSearchThisView.controller.searchResultIds:f===q&&(b=this.inViewerSearchThisItem.currentGeoSearchedIds)),this.viewer.clearSelection(),this.viewer.isolate(b),this.extensionViewer&&this.extensionViewer.container&&this.extensionViewer.setVisible(!1)),d&&this.viewer.fitToView()}},l.InViewerSearchMain.prototype.closeSearch=function(){var a=this;a.hideTabs(),a.inViewerSearchThisView&&a.inViewerSearchThisView.clearSearch(),a.inViewerSearchThisItem&&a.inViewerSearchThisItem.clearSearch(),a.inViewerSearchThisProject&&a.inViewerSearchThisProject.clearSearch(),this.queries&&this.queries.closeSettingsPanel(),this.searchBarElem&&(this.searchBarElem.value=""),e(this,this.tabsElem.firstChild.firstChild)},l.InViewerSearchMain.prototype.createTabs=function(){if(this.inViewerSearchPanel&&this.inViewerSearchPanel.scrollContainer){var a,b,c,d=this,e=this.inViewerSearchPanel?this.inViewerSearchPanel.scrollContainer:null,f="onsearch"in document.documentElement;this.searchBarElem||(b=document.createElement("input"),b.className="in-viewer-search-bar",b.id="in-viewer-search-bar",b.type="search",this.options.searchDefaultText&&(b.placeholder=this.options.searchDefaultText),b.addEventListener("keyup",function(a){var c=a.target.value.trim(),e=a.which||a.keyCode;f||e!==u.ENTER?c&&c.length>=3?(e===u.BACKSPACE||e===u.SPACE||e>40&&e<128||e>185&&e<193||e>218&&e<223)&&(clearTimeout(t),t=setTimeout(function(){d.saveLastQuery=!1,d.uiSearch()},200)):d.hideTabs():b.onsearch(a)}),b.onsearch=function(a){var b=a.target.value.trim();clearTimeout(t),b?t=setTimeout(function(){d.saveLastQuery=!0,d.uiSearch()},200):d.hideTabs()},this.searchBarElem=b,a=document.createElement("div"),a.className="queries-container",this.queriesContainer=a,this.queries.initialize(a,d.qsApiService,d.searchBarElem,d.getCurrentGeometry(),d.getDocumentName(),function(){d.uiSearch()}),c=document.createElement("div"),c.className="tabs-wrapper hidden",g(c,d),this.tabsElem=c,e&&(e.appendChild(b),this.searchBarElem.focus(),e.appendChild(a),e.appendChild(c)))}},l.InViewerSearchMain.prototype.search=function(a,b,c,d,e){var f=a.trim();f&&(this.qsApiService.generateQueryId(),this.inViewerSearchThisView&&(e||b)&&this.inViewerSearchThisView.search(f,s,b),this.inViewerSearchThisItem&&(e||c)&&this.inViewerSearchThisItem.search(f,c),this.inViewerSearchThisProject&&(e||d)&&this.inViewerSearchThisProject.search(f,d),this.saveLastQuery&&this.updateRecentQueries(f))},l.InViewerSearchMain.prototype.uiSearch=function(a){var b=this.searchBarElem,c=b.value.toLocaleLowerCase();s=a,c?(this.showTabs(),this.search(c,null,null,null,!0)):this.hideTabs()},l.InViewerSearchMain.prototype.showTabs=function(){var a,b;this.showingTabs||(a=this.tabsElem,a.classList.remove("hidden"),b=this.queriesContainer,b.classList.add("hidden"),this.showingTabs=!0)},l.InViewerSearchMain.prototype.changeToThisViewTabAndSelectNode=function(a){var b;this.options.loadedModelTab&&this.options.loadedModelTab.enabled&&(b=this.tabsElem,e(this,b.firstChild.firstChild),this.inViewerSearchThisView.selectNode(null,a,!0))},l.InViewerSearchMain.prototype.hideTabs=function(){this.showingTabs&&(this.extensionViewer&&this.extensionViewer.container&&this.extensionViewer.setVisible(!1),this.viewer.showAll(),this.viewer.clearSelection(),this.queriesContainer.classList.remove("hidden"),this.tabsElem.classList.add("hidden"),this.showingTabs=!1,this.searchBarElem.focus())},l.InViewerSearchMain.prototype.isNodeVisible=function(a,b){if(this.viewer.model&&this.viewer.model.getData()){var c=this.viewer.model.getData();if(this.viewer.model.is2d()){var d=c.fragments.dbId2fragId[a];this.viewer.model.isFragVisible(d)&&b()}else c&&c.instanceTree&&c.instanceTree.nodeAccess.enumNodeFragments(a,function(){b()})}},l.InViewerSearchMain.prototype.getCurrentGeometry=function(){return k.docItemId},l.InViewerSearchMain.prototype.getDocumentName=function(){var a="";if(this.viewer.model&&this.viewer.model.getDocumentNode()){this.viewer.model.getDocumentNode().getRootNode().children.forEach(function(b){b.data.name&&(a=b.data.name)})}return a}}(),function(){"use strict";function a(a,b){var c=0,d=b.length;if(!a)return{message:"params object is missing, it should be an object with the fields categoryName, categoryModifier and page specify."};for(;c<d;){if(!a.hasOwnProperty(b[c]))return{message:b[c]+" is missing in params object."};c++}return null}var b=Autodesk.Viewing,c=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),d={searchDefaultText:"",uiEnabled:!0,clientId:"adsk.viewer.defaultClientId",sessionId:"adsk.viewer.defaultSessionId",thresholdSearchMaxNodes:5e4,savedQueries:{},loadedModelTab:{enabled:!0,displayName:"This View",pageSize:50},relatedItemsTab:{enabled:!0,displayName:"This Item",pageSize:20},serverSearchTab:{enabled:!1,displayName:"This Project",parameters:{pid:"",filters:"",language:"ENU",baseURL:"",urlCallback:""},pageSize:20}},e=function(a,c){var e;b.Extension.call(this,a,c),this.initialized=!1,this.viewer=a,this.toolbarTools=null,c||(c={}),c.inViewerSearchConfig=c.inViewerSearchConfig||d,this.options=c.inViewerSearchConfig,this.options.thresholdSearchMaxNodes=this.options.thresholdSearchMaxNodes||d.thresholdSearchMaxNodes,e=Autodesk.Viewing.Private.GuiViewer3D&&a instanceof Autodesk.Viewing.Private.GuiViewer3D,this.options.uiEnabled=e&&(void 0===this.options.uiEnabled?d.uiEnabled:this.options.uiEnabled),this.options.serverSearchTab=this.options.serverSearchTab||d.serverSearchTab,this.options.relatedItemsTab=this.options.relatedItemsTab||d.relatedItemsTab,this.options.loadedModelTab=this.options.loadedModelTab||d.loadedModelTab,this.options.savedQueries=this.options.savedQueries||d.savedQueries,this.options.serverSearchTab.displayName=this.options.serverSearchTab.displayName||d.serverSearchTab.displayName,this.options.relatedItemsTab.displayName=this.options.relatedItemsTab.displayName||d.relatedItemsTab.displayName,this.options.loadedModelTab.displayName=this.options.loadedModelTab.displayName||d.loadedModelTab.displayName};e.populateDefaultOptions=function(a){a.inViewerSearchConfig={uiEnabled:!0,clientId:void 0,sessionId:void 0,savedQueries:{profileId:"simple"},serverSearchTab:{enabled:!0,displayName:"This Project",parameters:{pid:"",filters:"",language:"ENU",baseURL:"",urlCallback:""},pageSize:20},relatedItemsTab:{enabled:!0,displayName:"This Item",pageSize:20},loadedModelTab:{enabled:!0,displayName:"This View",pageSize:50}}},e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=c.InViewerSearchExtension,e.prototype.load=function(){return this.cache=this.getCache(),avp.injectCSS("extensions/InViewerSearch/InViewerSearch.min.css"),this.cache&&this.cache.inViewerSearch?this.inViewerSearchMain=this.cache.inViewerSearch:this.inViewerSearchMain=new c.InViewerSearchMain(this.viewer,this.options,this.getCache()),this.inViewerSearchMain&&this.cache&&this.cache.inViewerSearch?(this.cache.inViewerSearch=null,this.inViewerSearchMain.update(this.viewer,this.options,this.cache)):this.inViewerSearchMain.load(),!0},e.prototype.unload=function(){return this.inViewerSearchMain.unload(),this.cache&&this.cache.searchInfoThisItem?this.inViewerSearchMain.disabledPanel():(delete this.inViewerSearchMain,this.inViewerSearchMain=null,this.options.initialized=!1,this.options.inViewerSearchMain=null),!0},e.prototype.addInitListener=function(a){this.inViewerSearchMain.initialized?setTimeout(function(){a()},0):this.inViewerSearchMain.initCb=a},e.prototype.searchModel=function(a,b,c){var d=a.trim(),e=this.inViewerSearchMain,f=null;return b&&b.page&&(f=b.page),d?e.inViewerSearchThisView?void(f&&1!==f?d!==e.inViewerSearchThisView.searchString?this.search(d,function(){e.inViewerSearchThisView.getPage(f,c)}):e.inViewerSearchThisView.getPage(f,c):e.inViewerSearchThisView.search(d,null,c)):void c({message:"Search model is not enabled."}):void c({message:"Nothing to search."})},e.prototype.searchDocument=function(a,b,c){var d,e,f=a.trim(),g=this.inViewerSearchMain,h=g.inViewerSearchThisItem;return b&&(d=b.page,e=b.geometryId),f?h?void(d&&1!==d?g.inViewerSearchThisItem.getPage(e,d,c):h.search(f,c)):void c({message:"Search document is not enabled."}):void c({message:"Nothing to search"})},e.prototype.queryService=function(b,c,d){var e,f=b.trim(),g=this.inViewerSearchMain;if(!f)return void d({message:"Nothing to search"});if(!g.inViewerSearchThisProject)return void d({message:"Server search is not enabled."});if(c&&Object.keys(c).length){var h=a(c,["categoryName","categoryModifier","page"]);if(h)return void d(h);if((e=c.page)<0)return void d({page:e,message:"Invalid page number, it must be a positive number."});g.inViewerSearchThisProject.getPage({name:c.categoryName,modifier:c.categoryModifier},e,d)}else g.inViewerSearchThisProject.search(f,d)},c.InViewerSearchExtension=e,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.InViewerSearch",e)}(),function(){"use strict";var a=Autodesk.Viewing.UI,b=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");b.InViewerSearchPanel=function(b,c,d,e,f){var g=this;this.viewer=b,this.qsApiService=f,a.DockingPanel.call(this,b.container,c,d,e),this.container.classList.add("inViewerSearchPanel"),e=e||{},e.heightAdjustment||(e.heightAdjustment=40),e.marginTop||(e.marginTop=0),e.left=!0,this.createScrollContainer(e),this.options=e,this.selectedNodes=[],this.uiCreated=!1,this.addVisibilityListener(function(a){a&&(g.uiCreated||g.createUI(),g.resizeToContent())})},b.InViewerSearchPanel.prototype=Object.create(a.DockingPanel.prototype),b.InViewerSearchPanel.prototype.constructor=b.InViewerSearchPanel,b.InViewerSearchPanel.prototype.createUI=function(){},b.InViewerSearchPanel.prototype.addClass=function(a,b){return null!==this.tree&&this.tree.addClass(a,b)},b.InViewerSearchPanel.prototype.removeClass=function(a,b){return null!==this.tree&&this.tree.removeClass(a,b)},b.InViewerSearchPanel.prototype.initializeCloseHandler=function(a){var b=this;a.setAttribute("id","in-viewer-search-close"),b.addEventListener(a,"click",function(){b.setVisible(!1),b.qsApiService.logGeneralEvent("searchWindowClose"),b.closeCb&&b.closeCb()},!1)},b.InViewerSearchPanel.prototype.addCloseHandler=function(a){this.closeCb=a},a.InViewerSearchPanel=b.InViewerSearchPanel}(),function(){"use strict";function a(a){var b=null;try{b=JSON.parse(a)}catch(a){q.logger.error("JSON parse error: "+a)}return b}function b(a,b,c,d,e){if(a.enabled){var f=a.searchBarElem;if(e){var g=a.userDocumentQueries.documentQueries.queries[0].querySet.indexOf(e);a.qsApiService.logSavedQuerySearchClickEvent(g,a.documentUrn,e.geometry,e.queryId,e.query)}b&&(f.value=b,a.uiSearch(c),a.updateRecentQueries(b))}}function c(a,c){var d=document.createElement("li");d.className="recent-item";var e=document.createElement("div");e.className="text-container";var f=document.createElement("label");if(f.appendChild(document.createTextNode(c)),f.addEventListener("click",function(){b(a,c)},!1),a.savedQueriesEnabled){var g=document.createElement("div");g.className="save-query-icon",g.addEventListener("click",function(){a.saveQuery(c)},!1),d.appendChild(g)}return e.appendChild(f),d.appendChild(e),d}function d(a,b,d){var e,f,g,h;d||(e=document.createElement("label"),e.className="recent-label",e.appendChild(document.createTextNode(p.i18n.translate("Recent Queries"))),b.appendChild(e)),f=document.createElement("ul"),f.className="recent-searches-list dockingPanelScroll",g=a.getRecentQueries(),g.forEach(function(b){f.appendChild(c(a,b))}),g.length<1&&(h=document.createElement("li"),h.className="recent-item empty-list",h.appendChild(document.createTextNode(p.i18n.translate("Recent Queries Empty"))),f.appendChild(h)),b.appendChild(f)}function e(a,c){var d=document.createElement("li");d.className="saved-query-item",d.setAttribute(w,c.queryId);var e=decodeURIComponent(c.query),f=document.createElement("div");f.className="delete-query-icon",f.addEventListener("click",function(){a.showDeleteConfirmation(e,d,c.queryId)});var g=document.createElement("div");g.className="text-container";var h=document.createElement("label");return h.appendChild(document.createTextNode(e)),h.addEventListener("click",function(){b(a,e,null,d,c)}),d.appendChild(f),g.appendChild(h),d.appendChild(g),d}function f(a,b){var c=p.i18n.translate("{0} saved of {1} allocated").replace("{0}",b.used).replace("{1}",b.max);a.appendChild(document.createTextNode(c))}function g(a,b){var c=document.createElement("div");c.className="user-allocation";var d=document.createElement("label");d.className="quota-text",f(d,b),a.quotaHTML=d;var e=document.createElement("div");return e.className="seetings-icon adsk-button-icon adsk-icon-settings",e.title=p.i18n.translate("Saved queries settings"),e.addEventListener("click",function(){a.openSettingsPanel()}),c.appendChild(d),c.appendChild(e),c}function h(){var a=document.createElement("p");return a.className="no-queries-saved",a.appendChild(document.createTextNode(p.i18n.translate("There are no queries saved for this document"))),a}function i(a,b,c){var d=!0,f=b.userData.allocation,i=g(a,f);c.appendChild(i);var j=document.createElement("ul");if(j.className="saved-queries-list dockingPanelScroll",a.savedQueriesList=j,b.documentQueries){var k=b.documentQueries;if(k.queries&&k.queries.length){k.queries[0].querySet.forEach(function(b){var c=e(a,b);j.appendChild(c),d=!1})}}if(c.appendChild(j),d){a.savedQueriesList.classList.add("hidden");var l=h();c.appendChild(l)}}function j(a,b,c){if(b){var e=document.createElement("div");e.className="queries-accordion";var f=document.createElement("div");f.className="queries-title saved-queries-title non-clickable",f.setAttribute(v,u),f.addEventListener("click",function(){a.toggleSection(u)}),a.savedQueriesTitle=f,f.appendChild(document.createTextNode(p.i18n.translate("Saved Queries")));var g=document.createElement("div");g.className="queries-content "+u,a.savedQueriesContent=g,i(a,b,g);var h=document.createElement("div");h.className="queries-title recent-queries-title",h.setAttribute(v,t),h.addEventListener("click",function(){a.toggleSection(t)}),h.appendChild(document.createTextNode(p.i18n.translate("Recent Queries"))),a.recentQueriesTitle=h;var j=document.createElement("div");j.className="queries-content hidden "+t,a.recentQueriesElem=j,d(a,a.recentQueriesElem,!0),e.appendChild(f),a.selectedSection=u,a.savedQueriesContent=g,e.appendChild(g),e.appendChild(h),a.recentQueriesContent=j,e.appendChild(j),c.appendChild(e)}}function k(a){for(var b=a.replace(/-/g,"+").replace(/_/g,"/");b.length%4;)b+="=";return atob(b)}function l(a){var b=k(a),c=b.indexOf("?version=");return window.btoa(b.slice(0,c))}function m(a,b,c,d){var e,f=!1,g=b.userData;b.documentQueries?e=b.documentQueries:(e={document:{id:a.documentUrn,name:encodeURIComponent(a.documentName),idType:"urn"},queries:[{querySet:[],creationDate:(new Date).getTime(),lastModifiedDate:(new Date).getTime()}]},b.documentQueries=e);var h=e.queries[0];if(h.querySet.forEach(function(a){decodeURIComponent(a.query)===d&&(f=!0)}),f)return null;var i={query:encodeURIComponent(d),queryId:THREE.Math.generateUUID(),geometry:c};return h.querySet.unshift(i),h.lastModifiedDate=(new Date).getTime(),g.allocation.used=g.allocation.used+1,g.lastModifiedDate=(new Date).getTime(),a.qsApiService.logSavedQuerySaveClickEvent(0,a.documentUrn,i.geometry,i.queryId,i.query),i}function n(a,b,c){var d=b.userData,e=b.documentQueries.queries[0],f=0;e.querySet.forEach(function(a,b){a.queryId===c&&(f=b)});var g=e.querySet[f];a.qsApiService.logSavedQueryDeleteClickEvent(f,b.documentQueries.document.id,g.geometry,g.queryId,g.query),e.querySet.splice(f,1),e.lastModifiedDate=(new Date).getTime(),d.allocation.used=d.allocation.used-1,d.lastModifiedDate=(new Date).getTime()}function o(a,b){a.initialized=!0,a.initCb&&a.initCb(b)}var p=Autodesk.Viewing,q=(Autodesk.Viewing.UI,Autodesk.Viewing.Private),r=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),s=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch.Helper"),t="recent-queries",u="saved-queries",v="adsksectionkey",w="adskqueryid";r.InViewerSearchQueries=function(a,b){this.viewer=a,this.options=b,this.container=null,this.savedQueriesEnabled=!1,this.qsApiService=null,this.userDocumentQueries=null,this.currentGeometry="",this.documentName="",this.settingsPanel=null,this.enabled=!0,this.messageTimer=null,this.savedQueriesUIEnabled=!1,this.container=null,this.initialized=!1,this.recentQueriesElem=null,this.quotaHTML=null,this.savedQueriesContent=null,this.saveLastQuery=null,this.recentQueries=null,this.loading=null,this.savedQueriesContent=null,this.recentQueriesContent=null,this.savedQueriesTitle=null,this.recentQueriesTitle=null,this.selectedSection=null,this.savedQueriesList=null,this.searchBarElem=null,this.documentUrn="",this.initCb=null},r.InViewerSearchQueries.prototype.constructor=r.InViewerSearchQueries,r.InViewerSearchQueries.prototype.initialize=function(a,b,c,e,g,h){var i=this;this.qsApiService=b,this.container=a,this.toggleLoadingMessage(!0),this.searchBarElem=c,this.uiSearch=h,this.currentGeometry=e,this.documentName=g,this.options.savedQueries&&this.options.savedQueries.profileId?(this.profileId=this.options.savedQueries.profileId,this.savedQueriesEnabled=!0,this.documentUrn=l(this.viewer.model.getData().urn),this.settingsPanel=new r.InViewerSearchSettingsPanel(this.viewer,"in-viewer-search-settings",p.i18n.translate("Saved Queries Settings"),this.options,this.qsApiService,this.profileId,function(){i.toggleEnable(!0)},this.documentUrn,function(a,b){i.updateUserQueries(a,b)}),this.settingsPanel.createContainers(f),this.getQueries(function(b){i.savedQueriesUIEnabled=!0,j(i,b,a),i.toggleLoadingMessage(!1),o(i)},function(a,b){q.logger.error("InViewerSearch Extension: Error getting saved queries for document, with error="+b),i.recentQueriesElem=i.container,d(i,i.recentQueriesElem),i.toggleLoadingMessage(!1),o(i,a)})):(q.logger.warn("InViewerSearch Extension: Saved queries disabled"),i.recentQueriesElem=i.container,d(i,i.recentQueriesElem),i.toggleLoadingMessage(!1),o(i,"errr"))},r.InViewerSearchQueries.prototype.toggleMessage=function(a,b,c){var d=this;c?r.Helper.showMessageWithTimer(d,a):r.Helper.toggleMessage(d,a,b)},r.InViewerSearchQueries.prototype.toggleLoadingMessage=function(a){this.toggleMessage(p.i18n.translate("Loading"),a)},r.InViewerSearchQueries.prototype.toggleSection=function(a){this.enabled&&this.selectSection!==a&&(this.selectSection=a,a===u?(this.savedQueriesContent.classList.remove("hidden"),this.savedQueriesTitle.classList.add("non-clickable"),this.recentQueriesContent.classList.add("hidden"),this.recentQueriesTitle.classList.remove("non-clickable")):(this.recentQueriesContent.classList.remove("hidden"),this.recentQueriesTitle.classList.add("non-clickable"),this.savedQueriesTitle.classList.remove("non-clickable"),this.savedQueriesContent.classList.add("hidden")))},r.InViewerSearchQueries.prototype.updateUserQueries=function(a,b){this.userDocumentQueries.userData=a,this.updateQuota(a),b&&(this.userDocumentQueries.documentQueries=b,b.queries&&b.queries.length&&this.updateSavedQueriesList(null,!1,b.queries[0].querySet))},r.InViewerSearchQueries.prototype.updateQuota=function(a){this.quotaHTML.removeChild(this.quotaHTML.childNodes[0]),f(this.quotaHTML,a.allocation)},r.InViewerSearchQueries.prototype.updateSavedQueriesList=function(a,b,c){var d=this.savedQueriesList,f=this;if(a)if(b)d.removeChild(a),d.childNodes.length||(this.savedQueriesContent.appendChild(h()),this.savedQueriesList.classList.contains("hidden")||this.savedQueriesList.classList.add("hidden"));else{var g=e(f,a);d.insertBefore(g,d.childNodes[0]);var i=this.savedQueriesContent.lastChild;i.classList.contains("no-queries-saved")&&this.savedQueriesContent.removeChild(i),this.savedQueriesList.classList.contains("hidden")&&this.savedQueriesList.classList.remove("hidden")}else c.length?(this.savedQueriesList.classList.remove("hidden"),this.savedQueriesList.innerHTML="",c.forEach(function(a){var b=e(f,a);f.savedQueriesList.appendChild(b)})):(this.savedQueriesList.innerHTML="",this.savedQueriesList.classList.add("hidden"),this.savedQueriesContent.getElementsByClassName("no-queries-saved").length||this.savedQueriesContent.appendChild(h()))},r.InViewerSearchQueries.prototype.toggleEnable=function(a){a?(this.enabled=!0,this.container.classList.remove("disabled")):this.container.classList.contains("disabled")||(this.enabled=!1,this.container.classList.add("disabled"))},r.InViewerSearchQueries.prototype.openSettingsPanel=function(){if(this.enabled){this.settingsPanel&&(this.settingsPanel.setVisible(!0),this.toggleEnable(!1))}},r.InViewerSearchQueries.prototype.closeSettingsPanel=function(){this.settingsPanel&&(this.settingsPanel.setVisible(!1),this.toggleEnable(!0))},r.InViewerSearchQueries.prototype.getQueries=function(a,b){var c=this;this.qsApiService.getUserQueries(this.profileId,this.documentUrn,function(d,e){d?b(d,e):(c.userDocumentQueries=e,c.userDocumentQueries.documentQueries=e.documentQueries[0],a(e))})},r.InViewerSearchQueries.prototype.saveQuery=function(a){if(this.enabled){var b=function(a,b,c,d){c&&(a.userDocumentQueries=c),a.toggleLoadingMessage(!1),q.logger.error("InViewerSearch Extension: Error saving document queries, with error="+b),d?a.toggleMessage(d,!0,!0):a.toggleMessage(p.i18n.translate("An error occur while saving query, please try again later"),!0,!0)};this.toggleMessage(p.i18n.translate("Saving"),!0,!1);var c=this,d=s.copyQueries(this.userDocumentQueries),e=m(c,this.userDocumentQueries,this.currentGeometry,a);if(!e)return this.toggleMessage("",!1),void this.toggleMessage(p.i18n.translate("The query is already saved."),!0,!0);var f=this.userDocumentQueries.userData,g=this.userDocumentQueries.documentQueries;this.qsApiService.saveUserQueries(this.profileId,this.userDocumentQueries,function(h,i){h?(400===h&&i.indexOf("The object to save is not up to date.")>=0&&c.getQueries(function(a){b(c,i,null,p.i18n.translate("Error saving query cause query list was outdated. Review list and retry operation.")),c.updateQuota(c.userDocumentQueries.userData),c.updateSavedQueriesList(null,null,c.userDocumentQueries.documentQueries.queries[0].querySet)},function(a,e){b(c,e,d)}),400===h&&i.indexOf("User exceeded maximum number of queries")>=0?b(c,i,d,p.i18n.translate("Maximum number of queries saved exceeded, please delete some queries or contact to your administrator")):b(c,i,d)):(f.version=i.userDataVersion,g.version=i.documentQueriesVersion,c.updateQuota(f),c.updateSavedQueriesList(e),c.toggleSection(u),c.updateRecentQueries(a,!0),c.toggleMessage("",!1))})}},r.InViewerSearchQueries.prototype.showDeleteConfirmation=function(a,b,c){if(this.enabled){var d=this;this.toggleEnable(!1);var e=s.showDeletePopup(this.container,a,function(){d.container.removeChild(e),d.toggleEnable(!0),d.deleteQuery(b,c)},function(){d.toggleEnable(!0),d.container.removeChild(e)})}},r.InViewerSearchQueries.prototype.deleteQuery=function(a,b){if(this.enabled){var c=function(a,b,c){a.userDocumentQueries=c,a.toggleLoadingMessage(!1),q.logger.error("InViewerSearch Extension: Error deleting document queries, with error="+b),a.toggleMessage(p.i18n.translate("An error occur while deleting query, please try again later"),!0,!0)};this.toggleMessage(p.i18n.translate("Deleting"),!0,!1);var d=this,e=s.copyQueries(this.userDocumentQueries);n(d,this.userDocumentQueries,b);var f=this.userDocumentQueries.userData,g=this.userDocumentQueries.documentQueries;this.qsApiService.saveUserQueries(this.profileId,this.userDocumentQueries,function(b,h){b?400===b&&h.indexOf("The object to save is not up to date.")>=0?d.getQueries(function(a){d.toggleMessage("",!1),d.toggleMessage(p.i18n.translate("Error deleting query cause query list was outdated. Review list and retry operation."),!0,!0),d.updateQuota(d.userDocumentQueries.userData),d.updateSavedQueriesList(null,null,d.userDocumentQueries.documentQueries.queries[0].querySet)},function(a,b){c(d,b,e)}):c(d,h,e):(f.version=h.userDataVersion,g.version=h.documentQueriesVersion,d.updateQuota(f),d.updateSavedQueriesList(a,!0),d.toggleMessage("",!1))})}},r.InViewerSearchQueries.prototype.getRecentQueries=function(){return this.recentQueries||(this.recentQueries=a(window.localStorage.recentSearches||"[]")),this.recentQueries},r.InViewerSearchQueries.prototype.updateRecentQueries=function(a,b){var d,e,f,g;if(a)if(d=this,this.recentQueries||this.getRecentQueries(),e=this.recentQueries.indexOf(a),b&&e>=0){if(g=this.recentQueriesElem.getElementsByClassName("recent-searches-list")[0],this.recentQueries.splice(e,1),g.removeChild(g.childNodes[e]),window.localStorage.recentSearches=JSON.stringify(this.recentQueries),this.recentQueries.length<1){var h=document.createElement("li");h.className="recent-item empty-list",h.appendChild(document.createTextNode(p.i18n.translate("Recent Queries Empty"))),g.appendChild(h)}}else 0!==e&&(g=this.recentQueriesElem.getElementsByClassName("recent-searches-list")[0],e>0&&(this.recentQueries.splice(e,1),g.removeChild(g.childNodes[e]),e=-1),e<0&&(this.recentQueries=[a].concat(this.recentQueries.slice(0,20)),window.localStorage.recentSearches=JSON.stringify(this.recentQueries),d.options.uiEnabled&&(f=g.children[0],f.className.indexOf("empty-list")>=0&&f.parentNode.removeChild(f),g.insertBefore(c(d,a),g.childNodes[0]))))},r.InViewerSearchQueries.prototype.addInitListener=function(a){if(this.initialized)return void a();this.initCb=a},r.InViewerSearchQueries.prototype.getUserDocumentQueries=function(){return this.userDocumentQueries}}(),function(){"use strict";function a(a,b,c){var d=b.queries[0].querySet,e=document.createElement("div");e.className="document-queries-container";var i=document.createElement("label");i.className="document-name",i.appendChild(document.createTextNode(decodeURIComponent(b.document.name))),i.addEventListener("click",function(){a.toggleQueries(e)}),e.appendChild(i);var j=b.document.id,k=document.createElement("ul");return k.className="document-list",k.setAttribute(f,j),k.setAttribute(h,c),d.forEach(function(b){var c=document.createElement("li");c.className="saved-query-item",c.setAttribute(g,b.queryId);var d=decodeURIComponent(b.query),e=document.createElement("div");e.className="delete-query-icon",e.addEventListener("click",function(){a.showDeleteConfirmation(d,c,b.queryId)});var f=document.createElement("div");f.className="text-container";var h=document.createElement("label");h.appendChild(document.createTextNode(d)),c.appendChild(e),f.appendChild(h),c.appendChild(f),k.appendChild(c)}),e.appendChild(k),e}var b=Autodesk.Viewing.UI,c=Autodesk.Viewing.Private,d=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),e=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch.Helper"),f="adskdocumentid",g="adskqueryid",h="adskdocumentindex";d.InViewerSearchSettingsPanel=function(a,c,d,e,f,g,h,i,j){var k=this;this.viewer=a,this.qsApiService=f,this.queriesString=[],this.profileId=g,this.setAllocationLabelText=null,this.enableSearchPanel=h,this.currentDocument=i,this.updateCurrentQueriesList=j,b.DockingPanel.call(this,a.container,c,d,e),this.container.classList.add("viewer-search-settings-panel"),e=e||{},e.heightAdjustment||(e.heightAdjustment=40),e.marginTop||(e.marginTop=0),this.options=e,this.selectedNodes=[],this.spaceLegend=null,this.uiCreated=!1,this.documentsQueriesHTML=null,this.userSpaceHTML=null,this.searchHTML=null,this.message=null,this.userData=null,this.documentQueries=[],this.addVisibilityListener(function(a){a&&k.initializeQueries(),k.resizeToContent()})},d.InViewerSearchSettingsPanel.prototype=Object.create(b.DockingPanel.prototype),d.InViewerSearchSettingsPanel.prototype.constructor=d.InViewerSearchPanel,d.InViewerSearchSettingsPanel.prototype.createUI=function(){},d.InViewerSearchSettingsPanel.prototype.toggleLoadingMessage=function(a){var b=this;e.toggleMessage(b,av.i18n.translate("Loading"),a)},d.InViewerSearchSettingsPanel.prototype.toggleMessage=function(a,b,c){var e=this;c?d.Helper.showMessageWithTimer(e,a):d.Helper.toggleMessage(e,a,b)},d.InViewerSearchSettingsPanel.prototype.addClass=function(a,b){return null!==this.tree&&this.tree.addClass(a,b)},d.InViewerSearchSettingsPanel.prototype.removeClass=function(a,b){return null!==this.tree&&this.tree.removeClass(a,b)},d.InViewerSearchSettingsPanel.prototype.initializeCloseHandler=function(a){var b=this;a.setAttribute("id","in-viewer-search-settings-close"),b.addEventListener(a,"click",function(){b.setVisible(!1),b.enableSearchPanel(!0),b.qsApiService.logGeneralEvent("searchSettingsWindowClose")},!1)},d.InViewerSearchSettingsPanel.prototype.showUserSpace=function(a){this.userSpaceHTML.innerHTML="";var b=document.createElement("p");b.className="space-legend",this.setAllocationLabelText(b,a.allocation),this.spaceLegend=b;var c=document.createElement("div");c.className="user-space-bar";var d=document.createElement("div");d.className="used-space-bar";var e=a.allocation.used,f=a.allocation.max,g=100*e/f;d.style.width=g+"%",c.appendChild(d),c.appendChild(b);var h=document.createElement("label");h.className="space-label",h.appendChild(document.createTextNode(av.i18n.translate("Space"))),this.userSpaceHTML.appendChild(h),this.userSpaceHTML.appendChild(c),this.searchHTML=null},d.InViewerSearchSettingsPanel.prototype.updateUserSpace=function(a){this.spaceLegend.innerHTML="",this.setAllocationLabelText(this.spaceLegend,a.allocation);var b=this.userSpaceHTML.getElementsByClassName("used-space-bar")[0],c=a.allocation.used,d=a.allocation.max,e=100*c/d;b.style.width=e+"%"},d.InViewerSearchSettingsPanel.prototype.updateQueriesList=function(a,b){var c=a.parentNode;if(c.removeChild(a),!c.childNodes.length){var d=c.parentNode;d.parentNode.removeChild(d)}if(!this.documentsQueriesHTML.childNodes.length){var e=document.createElement("p");e.className="no-queries-saved",e.appendChild(document.createTextNode(av.i18n.translate("No queries saved"))),this.documentsQueriesHTML.appendChild(e)}},d.InViewerSearchSettingsPanel.prototype.showAllQueries=function(b){var c=this;if(this.documentsQueriesHTML.innerHTML="",b.forEach(function(b,d){var e=b.queries;b.document&&c.currentDocument===b.document.id&&c.updateCurrentQueriesList(c.userData,b),e.length&&e[0].querySet&&e[0].querySet.length&&c.documentsQueriesHTML.appendChild(a(c,b,d))}),!this.documentsQueriesHTML.childNodes.length){var d=document.createElement("p");d.className="no-queries-saved",d.appendChild(document.createTextNode(av.i18n.translate("No queries saved"))),this.documentsQueriesHTML.appendChild(d)}},d.InViewerSearchSettingsPanel.prototype.toggleQueries=function(a){a.classList.contains("collapsed")?a.classList.remove("collapsed"):a.classList.add("collapsed")},d.InViewerSearchSettingsPanel.prototype.showDeleteConfirmation=function(a,b,c){var d=this,f=e.showDeletePopup(this.container,a,function(){d.container.removeChild(f),d.deleteQueries(b,c)},function(){d.container.removeChild(f)})},d.InViewerSearchSettingsPanel.prototype.deleteQueries=function(a,b){
var d=this,g=function(a,b,d,e,f){a.userData=d,a.documentQueries[f]=e,c.logger.error("InViewerSearch Extension: Error deleting document queries, with error="+b),a.toggleMessage(av.i18n.translate("An error occur while deleting query, please try again later"),!0,!0)};this.toggleMessage(av.i18n.translate("Deleting"),!0,!1);var i=this.userData,j=a.parentNode,k=j.getAttribute(h),l=j.getAttribute(f),m=this.documentQueries[k],n=e.copyDocumentQueries(m),o=e.copyUserData(this.userData),p=m.queries[0],q=0;p.querySet.forEach(function(a,c){a.queryId===b&&(q=c)}),p.querySet.splice(q,1),p.lastModifiedDate=(new Date).getTime(),i.allocation.used=i.allocation.used-1,i.lastModifiedDate=(new Date).getTime();var r={userData:i,documentQueries:m};this.qsApiService.saveUserQueries(this.profileId,r,function(b,c){b?400===b&&c.indexOf("The object to save is not up to date.")>=0?d.getAllQueries(function(a){d.toggleMessage(av.i18n.translate("Error deleting query cause query list was outdated. Review list and retry operation."),!0,!0)},function(a,b){g(d,b,o,n,k)}):(d.toggleMessage("",!1),g(d,c,o,n,k)):(d.userData.version=c.userDataVersion,m.version=c.documentQueriesVersion,d.updateUserSpace(i),d.updateQueriesList(a,l),d.updateCurrentQueriesList(i,d.currentDocument===l?m:null),d.toggleMessage("",!1))})},d.InViewerSearchSettingsPanel.prototype.createContainers=function(a){var b=document.createElement("div");b.className="search-div",this.searchHTML=b;var c=document.createElement("div");c.className="queries-space-section",this.userSpaceHTML=c;var d=document.createElement("div");d.className="all-document-queries dockingPanelScroll",this.documentsQueriesHTML=d,this.container.appendChild(b),this.container.appendChild(c),this.container.appendChild(d),this.setAllocationLabelText=a},d.InViewerSearchSettingsPanel.prototype.getAllQueries=function(a,b){var c=this;this.qsApiService.getUserQueries(this.profileId,null,function(d,e){d?b(d,e):(c.userData=e.userData,c.documentQueries=e.documentQueries,c.showUserSpace(e.userData),c.showAllQueries(e.documentQueries),c.toggleLoadingMessage(!1),a(e))})},d.InViewerSearchSettingsPanel.prototype.initializeQueries=function(){var a=this;a.toggleLoadingMessage(!0),this.getAllQueries(function(a){},function(b,c){a.toggleLoadingMessage(!1),a.toggleMessage(av.i18n.translate("Error getting queries, please close and retry"),!0,!1)}),a.resizeToContent()},b.InViewerSearchSettingsPanel=d.InViewerSearchSettingsPanel}(),function(){"use strict";function a(a){var b=[],c=[],d=0,e=a.controller;return e.resultCollection.getResultSetArray().forEach(function(f,g){var h=[],i=[];d=0,f.forEach(function(b){var c={dbId:b.dbId,fieldName:b.fieldName,fieldValue:b.fieldValue,nodeName:b.nodeName};h.push(c),d<a.limit&&(i.push(c),d++)});var j=e.resultCollection.getMetaInfo(g);b.push({id:j.guid,name:j.name,results:h,moreResults:f.length>a.limit}),c.push({id:j.guid,name:j.name,results:i,moreResults:h.length>a.limit})}),a.resultsCopy=b,{page:1,results:c,resultCount:e.resultCollection.getResultCount()}}function b(a,b,c,d){var e,f,g;if(b.displayName)e=b.displayName;else{if(!(f=b.nodeName)&&a.currentGeometry===d){var h=a.viewer.model.getData();h&&h.instanceTree&&(f=h.instanceTree.getNodeName(b.dbId))}f||(f=c.viewerProperties.defaultNodeName()),f.indexOf(c.searchedString)>=0||b.hasOwnProperty("fieldName")&&"Name"===b.fieldName?e=c.viewerProperties.highlightText(f,c.searchedString):(g="[object Number]"===Object.prototype.toString.call(b.fieldValue)?String(b.fieldValue):b.fieldValue,e=c.viewerProperties.highlightText(f)+" ("+c.viewerProperties.highlightText(b.fieldName)+": "+c.viewerProperties.highlightText(g,c.searchedString)+")")}return e}function c(a,c,d,e,f){var g,h=document.createElement("li"),i=a.controller;g=b(a,d,i,f),a.currentGeometry===f&&d.dbId===a.selectedNodeId&&(a.selectedNode=h),h.className="item-result dbId_"+d.dbId,h.innerHTML=g,h.setAttribute("adskSearchGeoGuid",f),h.setAttribute("adskSearchDbId",d.dbId),h.setAttribute("adskSearchIndex",e),c.appendChild(h)}function d(a,b,c){var d;b&&b.children.length&&(b.lastChild.className.contains("more-items")||(d=document.createElement("li"),d.className="item-result more-items",d.textContent=o.i18n.translate("Load More"),d.addEventListener("click",function(b){a.qsApi.logLoadMoreClickEvent(c,"thisItem"),a.loadMoreItems(c,b)},!1),b.appendChild(d)))}function e(a,b,d){var e,f,g=0,h=0,i=a.geoPages;if(e=document.createElement("ul"),e.className="geometry-result-list",f=Math.min(b.length,a.limit),i[d]=f,d===a.currentGeometry){var j=0,k={};h=b.length,b.forEach(function(b){a.isNodeVisible(b.dbId,function(){k.hasOwnProperty(b.dbId)||(k[b.dbId]=1,g++,a.currentGeomResults.push(b),j<f&&(a.currentGeoSearchedIds.push(b.dbId),c(a,e,b,j,d),i[d]=j+1),j++)})})}else b.slice(0,f).forEach(function(b,f){d===a.currentGeometry&&a.currentGeoSearchedIds.push(b.dbId),c(a,e,b,f,d)});return{resultListDom:e,countInvisible:h-g}}function f(a,b,c){var d;return d=document.createElement("label"),d.className="geometry-name",d.setAttribute("adskGeomId",b.guid),d.setAttribute("adskGeomIndex",c),d.addEventListener("click",function(b){var c=b.currentTarget.getAttribute("adskGeomId"),d=parseInt(b.currentTarget.getAttribute("adskGeomIndex"),10);a.qsApi.logResultGeomClickEvent(d+1,c,a.currentGeometry===c,"thisItem"),a.toggleGeometry(b)},!1),d.textContent=b.name,d}function g(a,b,c){var d;return d=document.createElement("div"),d.className="geometry-results geometry_"+b.guid,d.className=d.className+(c>3?" collapsed":""),b.guid===a.currentGeometry&&(d.classList.add("hidden"),d.setAttribute("adskCheckedForVisibleNodes",!0)),d}function h(a,b,c,d,h,i){var j,k,l,m,n=a.controller,o=d.guid;return l=e(a,c,o),m=l.resultListDom,k=f(a,d,h),j=g(a,d,n.geometriesCount),o===a.currentGeometry&&m.children.length>0&&j.className.indexOf("hidden")>=0&&j.classList.remove("hidden"),n.bruteSearch&&h<n.geometriesCount-1?b.insertBefore(j,b.childNodes[h]):b.appendChild(j),j.appendChild(k),j.appendChild(m),a.geometriesContainer[o]=j,i-=l.countInvisible}function i(a,b){var c,d,e;b&&(c=b.getAttribute("term"),d=b.getAttribute("ctx"),e=o.i18n.translate("Results Count"),e=e.split("{0}").join(a),e=e.split("{1}").join(c),e=e.split("{2}").join(d),b.textContent=e)}function j(a,b,c,e,f,g,j,k){var l,m,n,p,q=f.guid;b.textContent="",n=document.createElement("div"),n.id="result-count-this-item-wrapper",n.className="result-count",m=o.i18n.translate("Results Count").split("{0}").join(g).split("{1}").join(c).split("{2}").join(a.options.relatedItemsTab.displayName),l=document.createElement("span"),l.id="result-count-this-item",l.setAttribute("term",c),l.setAttribute("ctx",a.options.relatedItemsTab.displayName),l.textContent=m,a.resultCountDom=l,n.appendChild(l),b.appendChild(n),p=document.createElement("div"),p.className="geometries-results-container dockingPanelScroll",j||(p.className=p.className+" too-many-geometries"),b.appendChild(p);var r;g=h(a,p,e,f,k,g),a.geoPages[q]>=a.limit&&(r=a.geometriesContainer[q],e.length>a.geoPages[q]&&d(a,r.children[1],q)),a.controller.resultCollection.setResultCount(g),i(g,a.resultCountDom)}function k(a,b,e,f,g,j){var k,l,m,n,o,p=a.controller,q=f.guid;if(e&&e.length){if(a.geometriesContainer.hasOwnProperty(q)){if(a.geoPages[q]<a.limit)if(o=a.geometriesContainer[q],k=o.children[1],l=e.length,m=a.geoPages[q],n=0,m>0&&(n=m),l>a.limit?(a.geoPages[q]=a.limit,l=a.limit):a.geoPages[q]=a.geoPages[q]+(l-m),q===a.currentGeometry){var r=0,s={};e.forEach(function(b){g--,a.isNodeVisible(b.dbId,function(){s.hasOwnProperty(b.dbId)||(o.className.indexOf("hidden")>=0&&o.classList.remove("hidden"),s[b.dbId]=1,g++,a.currentGeomResults.push(b),n<=r&&r<l&&(a.currentGeoSearchedIds.push(b.dbId),c(a,k,b,r,q),a.geoPages[q]=r),r++)})})}else e.slice(n,l).forEach(function(b,d){c(a,k,b,d,q)})}else g=h(a,b,e,f,j,g);if(a.geoPages[q]>=a.limit){p.resultCollection.getResultSetLength(q)>a.geoPages[q]&&(o=a.geometriesContainer[q],d(a,o.children[1],q))}}a.controller.resultCollection.setResultCount(g),i(g,a.resultCountDom)}function l(a,b,c){a.innerHTML="";var d=document.createElement("p");d.className="no-results-this-item",d.textContent=o.i18n.translate("No Results").split("{0}").join(b).split("{1}").join(c),a.appendChild(d)}function m(a,b,c){function d(){var a=(new Date).getTime()-g;p.logger.log("Execution time INIT: "+a),b.logTimeEvent("initTime",a,"thisItem"),f.initialized=!0}function e(a,c){h=(new Date).getTime();var d=f.viewerProperties.areAllGeometriesLoaded();f.viewerProperties.bruteSearch(a,function(a,g,i,j){var k,l,m,n;f.lastSearchedString===a&&(f.resultCollection.setResultSetArray(g),f.searchInItemEnded=i,f.searchedString=a,f.geometriesCount++,f.bruteSearch=!0,m=new ResultCollection,e&&i&&(b.logSearchResponseTime("bruteSearchTime",a,(new Date).getTime()-h,"thisItem"),b.logSearchResults(f.resultCollection.getResultCount(),a,"bruteSearch","thisItem")),j?(n=g.getResultSetIndex(j),k=g.getResultSet(n),l=g.getMetaInfo(n),k&&m.setResultSet(l,k),c(m,d,i,j)):c(g,d,i,j))})}var f=this,g=null,h=null;f.initialized=!1,f.searchInItemEnded=!1,f.isBigModel=!1,f.bigAmountGeometries=!1,f.viewerProperties=a,f.searchedString="",f.lastSearchedString="",f.geometriesCount=0,f.bruteSearch=!1,f.resultCollection=new ResultCollection,f.initializeAttributes=function(a,b){f.initialized=!1,f.isBigModel?(p.logger.log("Using Brute Force in This Item"),d(),b()):(p.logger.log("Using Fullproof in This Item"),f.viewerProperties.getGeometriesAttributes(function(){d(),b()}))},f.initialize=function(a){g=(new Date).getTime();var b=function(b,c,e){if(f.loadingGeom=b,f.bigAmountGeometries=e,f.isBigModel=f.viewerProperties.hasTooManyNodes(),1===f.viewerProperties.getTotalCountGeometries())return d(),void a();c&&f.initializeAttributes(b,function(){e||a()}),e&&a()};f.viewerProperties.initPropertyDatabases(!c,b)},f.doSearch=function(a,c){if(f.resultCollection.resetResultCollection(),f.searchInItemEnded=!1,f.lastSearchedString=a,f.geometriesCount=0,f.bruteSearch=!1,f.isBigModel=f.viewerProperties.hasTooManyNodes(),f.isBigModel||!f.initialized)p.logger.log("Using Brute Force in This Item"),e(a,c);else{p.logger.log("Using Fullproof in This Item");var d=+new Date,g=f.viewerProperties.areAllGeometriesLoaded();f.viewerProperties.doSearch(a,function(a,e,h){f.lastSearchedString===a&&(f.resultCollection.copyResultCollection(e),f.searchInItemEnded=h,f.searchedString=a,f.geometriesCount=e.getResultSetArrayLength(),h&&(b.logSearchResponseTime("searchTime",a,new Date-d,"thisItem"),b.logSearchResults(f.resultCollection.getResultCount(),a,"fullproof-StringSearch","thisItem")),c(e,g,h))})}}}var n,o=Autodesk.Viewing,p=Autodesk.Viewing.Private,q=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");q.InViewerSearchThisItem=function(a,b,c){n=this,this.viewer=a,this.options=b,this.container=null,this.initialized=!1,this.controller=null,this.qsApi=null,this.searchString=null,this.geoPages={},this.currentGeometry=null,this.limit=b.relatedItemsTab.pageSize,this.clicked=null,this.cacheObj=c,this.loading=null,this.stillLoadingAlertElemId="this-item-loading-alert",this.stillLoadingAlertElem=null,this.geometriesContainer={},this.resultCountDom=null,this.currentGeoSearchedIds=[],this.selectedNode=null,this.selectedNodeId=null,this.highlightNodeInViewer=null,this.enabled=!0,this.isNodeVisible=null,this.currentGeomResults=[],this.listeners=[]},q.InViewerSearchThisItem.prototype.constructor=q.InViewerSearchThisItem,q.InViewerSearchThisItem.prototype.initialize=function(a,b,c,d,e,f,g){var h=this;this.qsApi=a,this.highlightNodeInViewer=e,this.currentGeometry=c,this.isNodeVisible=f,this.options.uiEnabled&&(this.container=d,this.container.addEventListener("click",this.clickHandler),this.container.addEventListener("dblclick",this.clickHandler)),this.controller=new m(b,a,this.options.loadedModelTab.enabled),this.controller.initialize(function(){h.initialized=!0,g(),h.listeners&&h.listeners.length&&(h.listeners.forEach(function(a){a()}),h.listeners=[])})},q.InViewerSearchThisItem.prototype.uninitialize=function(){this.options.uiEnabled&&this.container.removeEventListener("click",this.clickHandler),this.controller&&(this.controller=null)};var r=function(a){var b,c,d,e=a.target,f=!1;if(n.enabled){for(;e&&this.container!==e&&!f;)(f=e.hasAttribute("adskSearchDbId"))||(e=e.parentNode);f&&(b=e.getAttribute("adskSearchGeoGuid"),c=parseInt(e.getAttribute("adskSearchDbId"),10),d=parseInt(e.getAttribute("adskSearchIndex"),10),"click"===a.type?n.currentGeometry===b?setTimeout(function(){n.qsApi.logResultClickEvent(d+1,c,!0,"thisItem"),n.selectNode(e,c)},0):n.loadGeometryInViewer(b,c,d,e):"dblclick"===a.type?n.currentGeometry===b&&setTimeout(function(){n.selectNode(e,c),n.viewer.fitToView()},0):a.type)}};q.InViewerSearchThisItem.prototype.clickHandler=function(a){a&&(n.mouseClickTimeout&&(clearTimeout(n.mouseClickTimeout),n.mouseClickTimeout=null),n.mouseClickTimeout=setTimeout(function(){r.call(n,a)},200))},q.InViewerSearchThisItem.prototype.selectNode=function(a,b){this.selectedNode&&(this.selectedNode.classList.remove("selected"),this.selectedNode=null),this.selectedNodeId===b?(this.selectedNodeId=null,this.selectedNode=null):(this.selectedNodeId=b,this.selectedNode=a,a.classList.add("selected")),this.highlightNodeInViewer(this.selectedNodeId,this.currentGeoSearchedIds,this.selectedNodeId,!1)},q.InViewerSearchThisItem.prototype.toggleLoadingMessage=function(a){var b,c=this.loading;a&&!c?(c=document.createElement("div"),c.className="loading this-item-loading",b=document.createElement("span"),b.textContent=o.i18n.translate("Loading"),c.appendChild(b),this.container.appendChild(c),this.loading=c):!a&&c&&(c.parentNode&&c.parentNode.removeChild(c),this.loading=null)},q.InViewerSearchThisItem.prototype.search=function(b,c){var d=this,e=(d.controller,b.trim());if(!this.initialized){var f=function(){d.search(b,c)};return void this.listeners.push(f)}this.clearSearch(),e&&(this.searchString=e,this.options.uiEnabled&&this.toggleLoadingMessage(!0),this.controller.doSearch(e,function(b,f,g,h){if(d.options.uiEnabled)d.showResults(e,b,f,h);else if(g){var i=a(d);c(i)}}))},q.InViewerSearchThisItem.prototype.loadGeometryInViewer=function(a,b,c,d){var e=this.cacheObj,f=this.controller,g=f.viewerProperties.getGeometry(a),h=g?g.data:{guid:a};this.selectedNode&&this.selectedNode.classList.remove("selected"),this.selectedNode=d,this.selectedNodeId=b,this.viewer.getPropertyPanel().setVisible(!1),this.qsApi.logResultClickEvent(c+1,b,!1,"thisItem"),e.searchInfoThisItem={node:b,str:this.searchString};var i=function(){p.logger.error("Error loading geometry")},j=function(){p.logger.log("success loading geometry")};this.enabled=!1,this.viewer.dispatchEvent({type:o.LOAD_GEOMETRY_EVENT,data:{item:h,onSuccessCb:j,onErrorCb:i}})},q.InViewerSearchThisItem.prototype.toggleGeometry=function(a){-1===a.target.parentElement.className.indexOf("collapsed")?a.target.parentElement.classList.add("collapsed"):a.target.parentElement.classList.remove("collapsed")},q.InViewerSearchThisItem.prototype.showResults=function(a,b,c,d){var e,f,g,h,i=this.controller,m=this,n=m.container,p=n.children.length>1,q=this.stillLoadingAlertElem,r=null;b&&b.getResultSetArrayLength()?(g=i.viewerProperties.getSortedGeometries(),i.viewerProperties.prepHighlighter(a),m.toggleLoadingMessage(!1),g.forEach(function(d){(e=b.getResultSetIndex(d.guid))>=0&&(f=i.resultCollection.getResultCount(),h=b.getResultSet(e),p?(r=n.children[1],k(m,r,h,d,f,e,i.bruteSearch)):(j(m,n,a,h,d,f,c,e,i.bruteSearch),p=!0))})):i.searchInItemEnded&&(m.toggleLoadingMessage(!1),l(n,a,m.options.relatedItemsTab.displayName)),c||!i.searchInItemEnded||q||(q=document.createElement("div"),q.id=m.stillLoadingAlertElemId,q.className="alert-geometries-loading",q.textContent=o.i18n.translate("Geometries Loading"),this.stillLoadingAlertElem=q,n.appendChild(q))},q.InViewerSearchThisItem.prototype.clearSearch=function(){this.container&&this.options.uiEnabled&&(this.container.innerHTML="",this.geometriesContainer={},this.stillLoadingAlertElem=null,this.resultCountDom=null,this.currentGeoSearchedIds=[]),this.geoPages={},this.currentGeomResults=[],this.toggleLoadingMessage(!1)},q.InViewerSearchThisItem.prototype.getPage=function(a,b,c){var d,e,f,g,h,i,j=this.controller,k=this;if(!this.initialized){var l=function(){k.getPage(a,b,c)};return void this.listeners.push(l)}if(b<1)return h={message:"Invalid page number, it must be a positive number."},void c(h);var m=k.limit*(b-1);if(g={id:"",name:"",results:[],moreResults:!1},a){if(!(d=k.resultsCopy[j.resultCollection.getResultSetIndex(a)]))return h={page:b,results:[],message:"The geometry "+a+" doesn't exists."},void c(h);e=d.results,f=e.slice(m,m+k.limit),g={id:d.guid,name:d.name,results:f,moreResults:e.length>m+k.limit},h={page:b,results:[g],resultCount:j.resultCollection.getResultCount()}}else i=k.resultsCopy.map(function(a){return{id:a.id,name:a.name,results:a.results.slice(m,m+k.limit),moreResults:a.results.length>m+k.limit}}),h={page:b,results:i,resultCount:j.resultCollection.getResultCount()};c(h)},q.InViewerSearchThisItem.prototype.loadMoreItems=function(a,b){var e,f,g,h,i,j=this.controller,k=this,l=k.geoPages[a],m=l;e=j.resultCollection.getResultSet(a),a===this.currentGeometry&&(e=k.currentGeomResults),f=e.slice(l,l+k.limit),k.geoPages[a]=k.geoPages[a]+k.limit,g=this.geometriesContainer[a],h=g.children[1],b.target.parentNode.removeChild(b.target),i=e.length>k.geoPages[a],f.forEach(function(b){k.currentGeoSearchedIds.push(b.dbId),c(k,h,b,m,a),m++}),i&&d(k,h,a),f.length&&k.highlightNodeInViewer(k.selectedNodeId,k.currentGeoSearchedIds,k.selectedNodeId,!1)},q.InViewerSearchThisItem.prototype.updateCurrentGeometry=function(a){var b=this.controller,e=this;this.currentGeometry=a;var f=this.selectedNodeId;this.geoPages[this.currentGeometry]=0;var g=b.resultCollection.getResultSet(this.currentGeometry),h=b.resultCollection.getResultCount();this.currentGeomResults=[],this.currentGeoSearchedIds=[];var j={},k=0,l=this.geometriesContainer[this.currentGeometry],m=!l.hasAttribute("adskCheckedForVisibleNodes");if(l&&m){var n=l.children[1];n.innerHTML="",g&&g.length&&g.forEach(function(a){h--,e.isNodeVisible(a.dbId,function(){j.hasOwnProperty(a.dbId)||(j[a.dbId]=1,h++,e.currentGeomResults.push(a),k<e.limit&&(e.currentGeoSearchedIds.push(a.dbId),c(e,n,a,k,e.currentGeometry),e.geoPages[e.currentGeometry]=k),k++)})}),e.currentGeomResults.length||l.classList.add("hidden"),l.setAttribute("adskCheckedForVisibleNodes",!0),p.logger.log("count "+h),b.resultCollection.setResultCount(h),i(h,e.resultCountDom);e.currentGeomResults.length>e.limit&&d(e,n,this.currentGeometry),this.selectedNodeId=null,this.selectNode(this.selectedNode,f),this.enabled=!0}else this.selectedNodeId=null,this.selectNode(this.selectedNode,f),this.enabled=!0;this.cacheObj.searchInfoThisItem=null}}(),function(){"use strict";function a(a,b,c,d){var e=a,f=/^https?:\/\//i;try{d?e=d(c):c.url&&(0===c.url.search(f)?e=c.url:(e=b+"/"+c.url,e=e.replace(/([^:]\/)\/+/g,"$1")))}catch(a){e=null}return e||a}function b(a,b,c){var e,f;a.textContent="",f=document.createElement("p"),f.className="no-results-this-project",e=d.i18n.translate("No Results"),e=e.split("{0}").join(b),e=e.split("{1}").join(c),f.textContent=e,a.appendChild(f)}function c(a){function b(b,c){var d=[];b&&(b.forEach(function(b){var c;b.suggestionCount>0&&(c={modifier:b.modifier,name:b.displayName,categoryResults:[],moreItems:b.suggestionCount>3},b.suggestions.forEach(function(b){var d={name:a.sanitizeAndHighlightString(b.title,"<b>","</b>"),logClick:b.logClick,url:b.url,resultData:b};c.categoryResults.push(d)}),e.count=e.count+b.suggestionCount,d.push(c),e.categoriesIndex[c.name]=d.length-1)}),e.categories=d),c(e.categories)}function c(c,d,e){c?(a.logErrorEvent("Error getting suggestions: "+c,"in_viewer_search_this_project","handleResult","thisProject"),e([])):d&&d.suggestionGroups&&b(d.suggestionGroups,e)}function d(b,c,d){var f,h,i;b?(a.logErrorEvent("Error getting more item results: "+b,"in_viewer_search_this_project","loadMoreResults","thisProject"),d(b,null,null)):c&&c.queryResults&&(f=[],i=e.categories[e.categoriesIndex[g]].categoryResults,c.queryResults.forEach(function(b){var c={name:a.sanitizeAndHighlightString(b.title,"<b>","</b>"),logClick:b.logClick,url:b.url,resultData:b};f.push(c),i.push(c)}),h=c.queryResultCount>i.length,d(null,f,h))}var e=this,f={},g="",h={};e.categories=null,e.categoriesIndex={},e.count=0,e.projectResults=null,e.search=function(b,d,g,i,j,k){1===j&&(e.categories=null,e.count=0,h={}),f={query:d,sort:g,filters:i};var l=+new Date;a.search(b,d,g,i,j,function(b,e){a.logSearchResponseTime("searchTime",d,new Date-l,"thisProject"),c(b,e,k)},"thisProject")},e.uninitialize=function(){},e.getMoreResults=function(b,c,e,i,j){var k=2;g=c,c&&h.hasOwnProperty(c.name)&&(k=h[c.name]),j&&(k=j),a.getMoreResults(b,e,f.query,f.sort,f.filters,k,function(a,b){d(a,b,i)}),j||(h[c.name]=k+1)}}var d=Autodesk.Viewing,e=Autodesk.Viewing.Private,f=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");f.InViewerSearchThisProject=function(a){this.options=a,this.initialized=!1,this.controller=null,this.qsApi=null,this.container=null,this.contextMenu=null,this.urlCb=null,this.loadingId="this-project-loading",this.listeners=[],this.searchParams=null,a&&a.serverSearchTab&&a.serverSearchTab.parameters&&(this.searchParams=a.serverSearchTab.parameters),this.loadingElementDom=null,self.categoriesContainerDom=null},f.InViewerSearchThisProject.prototype.constructor=f.InViewerSearchThisProject,f.InViewerSearchThisProject.prototype.initialize=function(a,b){var d=this,f=+new Date;if(this.qsApi=a,!d.options||!d.options.serverSearchTab||!d.searchParams)return void e.logger.warn("Error initializing server search tab: missing options.");this.urlCb=d.searchParams.urlCallback,this.baseURL=d.searchParams.baseURL?d.searchParams.baseURL.replace(/\/$/g,""):"",this.fallbackURL=d.searchParams.fallbackURL,this.controller=new c(a),this.options.uiEnabled&&(this.container=b,window.addEventListener("click",function(){d.contextMenu&&d.contextMenu.classList.add("hidden")},!1)),a.logTimeEvent("initTime",new Date-f,"thisProject"),this.initialized=!0,this.listeners&&this.listeners.length&&(this.listeners.forEach(function(a){a()}),this.listeners=[])},f.InViewerSearchThisProject.prototype.uninitialize=function(){this.controller&&this.controller.uninitialize()},f.InViewerSearchThisProject.prototype.openMenu=function(b,c){var f,g,h,i=this.contextMenu,j=a(this.fallbackURL,this.baseURL,c,this.urlCb),k=this.container,l=k.getBoundingClientRect();c.logClick(),b.stopPropagation(),i.textContent="",j?(f=document.createElement("div"),f.className="menu-item open-another-window",f.innerHTML="<a href='"+j+"' target='_blank'>"+d.i18n.translate("Open Another Window")+"</a>",g=document.createElement("div"),g.className="menu-item open-this-window",g.innerHTML="<a href='"+j+"' target='_self'>"+d.i18n.translate("Open This Window")+"</a>",i.appendChild(f),i.appendChild(g),h=b.pageX-l.left+b.currentTarget.offsetLeft-10,h>195&&(h-=145),i.style.top=b.pageY-7+"px",i.style.left=h+"px",i.className=i.className.replace(" hidden","")):e.logger.warn("The url for "+c.name+" is empty")},f.InViewerSearchThisProject.prototype.toggleCategory=function(a){-1===a.target.parentElement.className.indexOf("collapsed")?a.target.parentElement.classList.add("collapsed"):a.target.parentElement.classList.remove("collapsed")},f.InViewerSearchThisProject.prototype.toggleLoadingMessage=function(a){var b=this.loadingElementDom;a&&!b?(b=document.createElement("div"),b.id=this.loadingId,b.className="loading",b.innerHTML="<span>"+d.i18n.translate("Loading")+"</span>",this.loadingElementDom=b,this.container.appendChild(b)):!a&&b&&(b.parentNode&&b.parentNode.removeChild(b),this.loadingElementDom=null)},f.InViewerSearchThisProject.prototype.loadMoreItems=function(a,b){var c=this,d=this.controller,e=a.target.parentElement;this.toggleLoadingMessage(!0),d.getMoreResults(this.searchParams.pid,b.name,b.modifier,function(b,d,f){var g;f||a.target.parentNode.removeChild(a.target),c.toggleLoadingMessage(!1),b||(d.forEach(function(a){var b=document.createElement("li");b.innerHTML=a.name,b.className="item-result",b.addEventListener("click",function(b){c.openMenu(b,a)},!1),f?e.insertBefore(b,e.childNodes[e.childElementCount-1]):e.appendChild(b)}),g=this.categoriesContainerDom,g.scrollTop=g.scrollTop+70)})},f.InViewerSearchThisProject.prototype.getPage=function(a,b,c){var d=this;if(!this.initialized){var e=function(){d.getPage(a,b,c)};return void this.listeners.push(e)}var f=this.controller;this.options.uiEnabled&&this.toggleLoadingMessage(!0),f.getMoreResults(this.searchParams.pid,a.name,a.modifier,function(a,d,e){var g={page:b,results:d,resultsCount:f.count,moreItems:e,message:a};c(g)},b)},f.InViewerSearchThisProject.prototype.showResults=function(a,c){var e,f,g,h,i=this,j=this.container,k=this.controller;this.toggleLoadingMessage(!1),j.textContent="",i.qsApi.logSearchResults(k.count,a,"elasticsearch","thisProject"),k.count>0?(e=document.createElement("div"),e.className="result-count",f=d.i18n.translate("Results Count"),f=f.split("{0}").join(k.count),f=f.split("{1}").join(a),f=f.split("{2}").join(i.options.serverSearchTab.displayName),g=document.createElement("span"),g.id="result-count-this-project",g.textContent=f,e.appendChild(g),j.appendChild(e),h=document.createElement("div"),h.className="categories-results-container dockingPanelScroll",j.appendChild(h),i.categoriesContainerDom=h,i.contextMenu=document.createElement("div"),i.contextMenu.className="context-menu hidden",j.appendChild(i.contextMenu),c.forEach(function(a,b){var c,e,f,g;c=document.createElement("div"),c.id="category_"+a.name,c.className="category-results",e=document.createElement("label"),e.className="category-name",e.setAttribute("adskCatId",a.name),e.setAttribute("adskCatIndex",b.toString()),e.addEventListener("click",function(a){var b=a.currentTarget.getAttribute("adskCatId"),c=parseInt(a.currentTarget.getAttribute("adskCatIndex"),10);i.qsApi.logResultGeomClickEvent(c+1,b,!1,"thisProject"),i.toggleCategory(a)},!1),e.innerText=a.name,c.appendChild(e),f=document.createElement("ul"),f.className="category-result-list",[].slice.call(a.categoryResults).forEach(function(a,b){var c=document.createElement("li");c.className="item-result",c.innerHTML=a.name,c.setAttribute("adskItemId",a.url),c.setAttribute("adskItemIndex",b.toString()),c.addEventListener("click",function(b){var c=b.currentTarget.getAttribute("adskItemId"),d=parseInt(b.currentTarget.getAttribute("adskItemIndex"),10);i.qsApi.logResultClickEvent(d+1,c,!1,"thisProject"),i.openMenu(b,a)},!1),f.appendChild(c)}),a.moreItems&&(g=document.createElement("li"),g.className="more-items item-result",g.textContent=d.i18n.translate("Load More"),g.addEventListener("click",function(b){i.qsApi.logLoadMoreClickEvent(a.name,"thisProject"),i.loadMoreItems(b,a)},!1),f.appendChild(g)),c.appendChild(f),h.appendChild(c)})):b(j,a,i.options.serverSearchTab.displayName)},f.InViewerSearchThisProject.prototype.search=function(a,b){var c=this;if(!this.initialized){var d=function(){c.search(a,b)};return void this.listeners.push(d)}var e=this.controller,f=a.trim();if(this.clearSearch(),!this.searchParams.pid||!this.searchParams.filters)return void c.displayMessage("This feature has not been configured.");f&&(this.searchString=f,this.options.uiEnabled&&this.toggleLoadingMessage(!0),this.controller.search(this.searchParams.pid,f,"dateModifiedDescending",this.searchParams.filters,1,function(a){c.options.uiEnabled?c.showResults(f,a):b({page:1,results:a,resultCount:e.count})}))},f.InViewerSearchThisProject.prototype.displayMessage=function(a){var b,c;this.container&&this.options.uiEnabled&&(b=this.container,this.toggleLoadingMessage(!1),b.textContent="",c=document.createElement("p"),c.className="display-message",c.textContent=a,b.appendChild(c))},f.InViewerSearchThisProject.prototype.clearSearch=function(){var a;this.container&&this.options.uiEnabled&&(a=this.container,a.textContent="",this.toggleLoadingMessage(!1))}}(),function(){"use strict";function a(a){a.nodeNotVisibleAlert&&(a.viewer.container.removeChild(a.nodeNotVisibleAlert),a.nodeNotVisibleAlert=null,clearTimeout(a.nodeNotVisibleAlertTimer))}function b(a){a.noVisibleNodesAlert&&(a.viewer.container.removeChild(a.noVisibleNodesAlert),a.noVisibleNodesAlert=null,clearTimeout(a.noVisibleNodesAlertTimer))}function c(a,b,c,d){var e=document.createElement("li");e.innerHTML=b.displayNameSanitized,e.setAttribute("adskSearchDbId",b.dbId),e.setAttribute("adskSearchIndex",d),e.className="item-result dbId_"+b.dbId,a.highlightNode===b.dbId&&(a.selectedNode=e,e.className+=" selected",a.selectNode(e,b.dbId,!0)),a.resultsDom=e,c.appendChild(e)}function d(a,b,c){var d,e;a.textContent="",e=j.i18n.translate("No Results").split("{0}").join(b).split("{1}").join(c),d=document.createElement("p"),d.className="no-results-this-view",d.textContent=e,a.appendChild(d)}function e(a,b,c,d){var e,f,g;if(!(f=b.nodeName)){var h=a.viewer.model.getData();f=h&&h.instanceTree?h.instanceTree.getNodeName(b.dbId):c.viewerProperties.defaultNodeName(),b.nodeName=f}return f&&f.indexOf(d)>=0||b.hasOwnProperty("fieldName")&&"Name"===b.fieldName?g=c.viewerProperties.highlightText(f,d):b.hasOwnProperty("fieldName")&&b.hasOwnProperty("fieldValue")?(e="[object Number]"===Object.prototype.toString.call(b.fieldValue)?String(b.fieldValue):b.fieldValue,g=c.viewerProperties.highlightText(f)+" ("+c.viewerProperties.highlightText(b.fieldName)+": "+c.viewerProperties.highlightText(e,d)+")"):g=c.viewerProperties.highlightText(f),g}function f(a,b){var c,d,e,f;(f=b.resultCountDOM)&&(c=f.getAttribute("term"),d=f.getAttribute("ctx"),e=j.i18n.translate("Results Count"),e=e.split("{0}").join(a),e=e.split("{1}").join(c),e=e.split("{2}").join(d),f.textContent=e)}function g(a,b,d){var g,h,i,k,l,m=a.container,n=a.controller,o=d?d.length:0,p=a.limit,q=a.offset,r=q+p;o<p&&(r=q+o),o&&(a.options.uiEnabled&&(a.toggleLoadingMessage(!1),a.resultList||(m.textContent="",g=document.createElement("div"),g.className="result-count",h=document.createElement("span"),h.id="result-count-this-view",h.setAttribute("term",b),h.setAttribute("ctx",a.options.loadedModelTab.displayName),i=j.i18n.translate("Results Count"),h.textContent=i.split("{0}").join(o).split("{1}").join(b).split("{2}").join(a.options.loadedModelTab.displayName),a.resultCountDOM=h,g.appendChild(h),m.appendChild(g),a.resultList=document.createElement("ul"),a.resultList.className="search-result-list dockingPanelScroll",a.resultList.addEventListener("scroll",function(){this.scrollTop>a.scrollOffset&&(a.loadMoreResults(),a.scrollOffset=a.scrollOffset+a.limitScroll)}),m.appendChild(a.resultList))),n.viewerProperties.prepHighlighter(b),d.slice(q,o).forEach(function(d,f){d.hasOwnProperty("dbId")||(d={fieldName:d.name,fieldValue:d.value,dbId:d.id,nodeName:d.nodeName}),a.isNodeVisible(d.dbId,function(){n.searchedIds.hasOwnProperty(d.dbId)||(k=e(a,d,n,b),l={displayNameSanitized:k,dbId:d.dbId,fieldName:d.fieldName,fieldValue:d.fieldValue,nodeName:d.nodeName},n.resultSetArray.push(l),n.searchResultIds.push(d.dbId),n.searchedIds[d.dbId]=1,n.resultCount++,a.options.uiEnabled&&n.resultCount<=p&&q<r&&(c(a,l,a.resultList,f),q+=1))})}),a.offset=q,a.options.uiEnabled&&f(n.resultCount,a))}function h(a,b,c){function d(){var b=(new Date).getTime()-g;k.logger.log("Execution time INIT: "+b),a.logTimeEvent("initTime",b,"thisView"),f.initialized=!0}function e(b,c){var d=(new Date).getTime(),e=function(e){f.searchEnded=!0,a.logSearchResponseTime("bruteSearchTime",b,(new Date).getTime()-d,"thisView"),a.logSearchResults(e.length,b,"bruteSearch","thisView"),c(b,e,!0)},g=function(){f.searchEnded=!0,a.logErrorEvent("LMV search bruteForceSearch failed","in_viewer_search_this_view","bruteSearch","thisView"),c(b,null,!0)};f.viewerProperties.bruteSearchCurrent(b,e,g)}var f=this,g=null;f.initialized=!1,f.searchResultIds=[],f.searchedIds={},f.resultCount=0,f.resultSetArray=[],f.searchEnded=null,
f.viewerProperties=b,f.isBigModel=!1,f.isSharedPropertyDb=!1,f.currentGeometry=c,f.initializeAllAttributes=function(a){g=(new Date).getTime(),f.isBigModel=f.viewerProperties.hasTooManyNodes(!0),f.currentGeometry||(f.isBigModel=!0),f.isBigModel?(k.logger.log("Using Brute Force in This View"),d(),a()):(k.logger.log("Using Fullproof in This View"),f.viewerProperties.getCurrentGeometryAttributes(function(){d(),a()}))},f.doSearch=function(b,c){var d;f.searchResultIds=[],f.searchedIds={},f.resultCount=0,f.resultSetArray=[],f.searchEnded=!1,f.isBigModel?e(b,c):(d=(new Date).getTime(),f.viewerProperties.doSearch(b,function(b,e,g){var h=[];e.getResultCount()&&e.hasResultSet(f.currentGeometry)&&(h=e.getResultSet(f.currentGeometry)),c(b,h,g),g&&(a.logSearchResponseTime("searchTime",b,(new Date).getTime()-d,"thisView"),a.logSearchResults(f.resultCount,b,"fullproof-StringSearch","thisView"))}))}}var i,j=Autodesk.Viewing,k=Autodesk.Viewing.Private,l=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");l.InViewerSearchThisView=function(a,b){i=this,this.options=b,this.viewer=a,this.container=null,this.initialized=!1,this.controller=null,this.resultList=null,this.clicked=null,this.is2DMode=null,this.qsApi=null,this.searchString=null,this.highlightNode=null,this.scrollOffset=500,this.limitScroll=200,this.limit=b.loadedModelTab.pageSize,this.offset=0,this.mouseClickTimeout=null,this.loadingId="this-view-loading",this.loadingDom=null,this.resultsDom=null,this.resultCountDOM=null,this.highlightNodeInViewer=null,this.fittedToView=!1,this.isNodeVisible=null,this.listeners=[]},l.InViewerSearchThisView.prototype.constructor=l.InViewerSearchThisView,l.InViewerSearchThisView.prototype.initialize=function(c,d,e,f,g,i,j,k){var l=this;this.qsApi=c,this.highlightNodeInViewer=i,this.is2DMode=f,this.isNodeVisible=j,this.options.uiEnabled&&(this.container=g,this.container.addEventListener("click",this.clickHandler),this.container.addEventListener("dblclick",this.clickHandler),this.container.addEventListener("hover",this.clickHandler),window.addEventListener("click",function(){a(l),b(l)},!1)),this.controller=new h(c,d,e),this.controller.initializeAllAttributes(function(){l.initialized=!0,k(),l.listeners&&l.listeners.length&&(l.listeners.forEach(function(a){a()}),l.listeners=[])})},l.InViewerSearchThisView.prototype.uninitialize=function(){this.options.uiEnabled&&(this.container.removeEventListener("click",this.clickHandler),this.container.removeEventListener("dblclick",this.clickHandler),this.container.removeEventListener("hover",this.clickHandler)),this.controller&&(this.controller=null)};var m=function(a){for(var b,c,d=a.target,e=!1;d&&this.container!==d&&!e;)(e=d.hasAttribute("adskSearchDbId"))||(d=d.parentNode);e&&(b=parseInt(d.getAttribute("adskSearchDbId"),10),c=parseInt(d.getAttribute("adskSearchIndex"),10),"click"===a.type?setTimeout(function(){i.showNodeProperties(a,b,c)},0):"dblclick"===a.type?setTimeout(function(){i.showNodeProperties(a,b,c,!0),i.viewer.fitToView()},0):"hover"===a.type&&i.viewer.impl.rolloverObjectNode(b))};l.InViewerSearchThisView.prototype.clickHandler=function(a){a&&(clearTimeout(i.mouseClickTimeout),i.mouseClickTimeout=setTimeout(function(){m.call(i,a)},200))},l.InViewerSearchThisView.prototype.search=function(a,b,c){var d=this;if(!this.initialized){var e=function(){d.search(a,b,c)};return void this.listeners.push(e)}var f=this.controller,h=a.trim();this.clearSearch(),h&&(this.searchString=h,d.resultList=null,this.options.uiEnabled&&(this.toggleLoadingMessage(!0),this.highlightNode=b),this.controller.doSearch(h,function(a,b,e){if(d.options.uiEnabled)d.showResults(a,b,e);else if(g(d,a,b),e){var h={page:1,results:f.resultSetArray.slice(0,d.limit),resultCount:f.resultCount,moreResults:f.resultCount>d.limit};c(h)}}))};var n=function(a,b){var c;c=a.selectedNode,c&&c.classList.remove("selected"),b&&(a.selectedNode=b,b&&b.classList.add("selected"))};l.InViewerSearchThisView.prototype.showNodeProperties=function(a,b,c,d){var e=this;this.qsApi.logResultClickEvent(c+1,b,!0,"thisView"),this.clicked===b?(this.clicked=null,this.highlightNodeInViewer(null,this.controller.searchResultIds,!!d,!1),d?n(e,a.target):n(e,null)):this.selectNode(a.target,b,!1)},l.InViewerSearchThisView.prototype.selectNode=function(a,b,c){var d,e,f,g=this,h=!1,i=this.controller;if(this.clicked=b,!a&&this.container.children.length>1)for(e=this.container.children[1].children,length=e.length,d=0,f="/\bdbId_"+b+"\b/";!h&&d<length;)e[d].className.match(f)&&(h=!0,a=e[d]),d++;this.highlightNodeInViewer(this.clicked,this.controller.searchResultIds,!0,!1),n(g,a),c&&a&&a.parentNode&&(a.parentNode.scrollTop=a.offsetTop),a||(i.searchResultIds.length?i.searchResultIds.indexOf(b)<0&&(this.clicked=null,this.showAlertNodeNotVisible()):(this.clicked=null,this.showAlertNoVisibleNodes()))},l.InViewerSearchThisView.prototype.clearSearch=function(){this.offset=0,this.scrollOffset=500,this.limitScroll=200,this.clicked=null,this.selectedNode=null,this.highlightNode=null,this.options.uiEnabled&&(this.container&&(this.container.textContent=""),this.controller&&this.controller.searchResultIds&&this.controller.searchResultIds.length>0&&(this.toggleLoadingMessage(!1),this.controller.searchResultIds=[],this.controller.resultSetArray=[],this.controller.resultCount=0,this.resultList=null),this.loadingDom=null,this.resultsDom=null,this.resultCountDOM=null,this.resultList=null)},l.InViewerSearchThisView.prototype.toggleLoadingMessage=function(a){var b=this.loadingDom;a&&!b?(b=document.createElement("div"),b.id=this.loadingId,b.className="loading",b.textContent=j.i18n.translate("Loading"),this.loadingDom=b,this.container.appendChild(b)):b&&(b.parentNode&&b.parentNode.removeChild(b),this.loadingDom=null)},l.InViewerSearchThisView.prototype.loadMoreResults=function(){var a,b,d=this.controller,e=this,f=this.offset,g=d.resultCount;if(g>f){for(a=f+e.limit,b=f;b<a;b++)g>b&&c(e,d.resultSetArray[b],e.resultList,b);e.offset=f+e.limit}},l.InViewerSearchThisView.prototype.getPage=function(a,b){var c=this;if(!this.initialized){var d=function(){c.getPage(a,b)};return void this.listeners.push(d)}var e,f,g=this.controller;if(a<1)return f={page:a,message:"Invalid page number, it must be a positive number.",moreResults:!1},void b(f);var h=c.limit*(a-1);if(g.resultCount<h)return f={page:a,results:[],resultCount:g.resultCount,moreResults:!1,message:"That page doesn't exists."},void b(f);e=g.resultSetArray.slice(h,h+c.limit),f={page:a,results:e,resultCount:g.resultCount,moreResults:g.resultCount>h+c.limit},b(f)},l.InViewerSearchThisView.prototype.showAlertNodeNotVisible=function(){var b=this;this.nodeNotVisibleAlert=document.createElement("div"),this.nodeNotVisibleAlert.className="alert-node-not-visible",this.nodeNotVisibleAlert.textContent=j.i18n.translate("Selected Node Result Not Visible"),this.viewer.container.appendChild(this.nodeNotVisibleAlert),this.nodeNotVisibleAlertTimer=setTimeout(function(){a(b)},7e3)},l.InViewerSearchThisView.prototype.showAlertNoVisibleNodes=function(){var a=this;this.noVisibleNodesAlert=document.createElement("div"),this.noVisibleNodesAlert.className="alert-no-visible-nodes",this.noVisibleNodesAlert.textContent=j.i18n.translate("No Visible Node Results For Geometry"),this.viewer.container.appendChild(this.noVisibleNodesAlert),this.noVisibleNodesAlertTimer=setTimeout(function(){b(a)},7e3)},l.InViewerSearchThisView.prototype.showResults=function(a,b,c){var e=this,f=this.controller,h=e.container;g(e,a,b),c&&(f.resultCount<1||!e.resultList.childNodes.length)&&(e.toggleLoadingMessage(!1),d(h,a,e.options.loadedModelTab.displayName)),c&&e.highlightNode&&(f.searchedIds.hasOwnProperty(e.highlightNode)||this.selectNode(null,e.highlightNode,!1)),f.searchResultIds&&f.searchResultIds.length&&this.highlightNodeInViewer(e.highlightNode,null,e.highlightNode,!1),c&&(f.searchedIds={}),f.searchEnded=c},l.InViewerSearchThisView.prototype.updateCurrentGeometry=function(a,b,c,d,e){var f=this.controller;this.clearSearch(),this.is2DMode=d,this.highlightNode=e;var g=f.viewerProperties.hasTooManyNodes(!0);f.isBigModel&&!g&&(f.initialized=!1,f.viewerProperties.getCurrentGeometryAttributes(function(){f.initialized=!0})),f.currentGeometry=a,f.searchResultIds=[],f.searchedIds={},f.resultCount=0,f.resultSetArray=[];var h=[];b&&b.hasResultSet(a)&&(h=b.getResultSet(a)),this.showResults(c,h,!0)}}(),function(){"use strict";function a(a,b){var c=new XMLHttpRequest;c.open("GET",f.endpoint.getApiEndpoint()+"/userprofile/v1/users/@me",!0),c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("Authorization","Bearer "+k.oauth2Token),c.responseType="json",c.onload=function(){if(200===c.status&&c.response){var d="string"==typeof c.response?JSON.parse(c.response):c.response;d?a(d):b(c.status,"Can't get user data from response.")}else b(c.status)},c.onerror=b,c.ontimeout=b,c.send()}function b(a){return n?(n.indexOf("autodesk")>=0?(k.token=null,k.oauth2Token=e.token.accessToken):(k.token=e.token.getAccessToken?e.token.getAccessToken():null,k.oauth2Token=null),a&&(k.clientFeatureId=h+(a?"."+a:"")),k):k}function c(a){a&&e.logger.log("InViewerSearch Extension: recieved "+a)}function d(){var a=!!window.chrome&&!!window.chrome.webstore;if(a)return"Chrome";var b=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;if(b)return"Opera";if("undefined"!=typeof InstallTrigger)return"Firefox";if(Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0)return"Safari";var c=!!document.documentMode;return c?"Internet Explorer":c||!window.StyleMedia?!a&&!b||!window.CSS?"Unknown":"Blink":"Edge"}var e=Autodesk.Viewing.Private,f=Autodesk.Viewing,g=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),h="adsk.viewer";g.QsApiService=function(){this.qsAPI=null};var i=g.QsApiService.prototype,j={pid:"",query:"",sort:"",page:1,filters:"",language:"ENU",modifier:null},k={},l=null,m=null,n=null,o=null,p=Object.freeze({development:"apidev",staging:"apistg",production:"apiprod",autodeskstaging:"apistg",autodeskdevelopment:"apidev",autodeskproduction:"apiprod"});i.initialize=function(a,c,d,f){k={token:null,oauth2Token:null,clientId:d,sessionId:f,clientFeatureId:"",userId:""},o=a,n=c.toLowerCase(),this.qsAPI=new Autodesk.Search.SearchQueryAPI(p[n]),b(""),this.getUserId(function(a){k.userId=a.userId},function(a,b){e.logger.log("InViewerSearch Extension: QsApi sessionInfo.userId not set: "+a)})},i.generateQueryId=function(){var a=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(a+=performance.now()),m="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)})},i.getUserId=function(b,c){k.userId?b(k.userId):a(b,c)},i.search=function(a,c,d,f,g,h,i){this.qsAPI||e.logger.log("InViewerSearch Extension: QsApi not initialized"),l=c,j.pid=a,j.page=g,j.query=c,j.sort=d,j.filters=f;var k=b(i);this.qsAPI.suggest(j,k,h)},i.getMoreResults=function(a,c,d,f,g,h,i){this.qsAPI||e.logger.log("InViewerSearch Extension: QsApi not initialized"),l=d,j.pid=a,j.page=h,j.query=d,j.sort=f,j.filters=g,j.modifier=c;var k=b();this.qsAPI.query(j,k,i)},i.getUserQueries=function(a,c,d){var e=b("init");this.qsAPI.getUserQueries({pid:a,document:c},e,function(a,b){a&&b&&b.hasOwnProperty("errors")&&(b=b.errors.length?b.errors[0].detail:""),d(a,b)})},i.saveUserQueries=function(a,c,d){var e=b("init");this.qsAPI.saveUserQueries({pid:a,userQueries:c},e,function(a,b){a&&b&&b.hasOwnProperty("errors")&&(b=b.errors.length?b.errors[0].detail:""),d(a,b)})},i.logEvent=function(a,b,d){this.qsAPI&&this.qsAPI.logEvent(m,b,a,d,c)},i.logInitEvent=function(a,c,e,f){var g={viewerVersion:o,id:a,modelInfo:c,url:window.location.href,browser:d(),userAgent:window.navigator.userAgent,options:e},h=b(f);this.logEvent("inViewer.initialization",h,g)},i.logGeneralEvent=function(a,c){var d="inViewer."+a,e=b(c);this.logEvent(d,e,"")},i.logTimeEvent=function(a,c,d){var e="inViewer."+a,f={};f[a+"DurationMs"]=c;var g=b(d);this.logEvent(e,g,f)},i.logSearchResponseTime=function(a,c,d,e){var f="inViewer."+a,g={queryString:c};g[a+"DurationMs"]=d;var h=b(e);this.logEvent(f,h,g)},i.logSearchResults=function(a,c,d,e){var f={resultCount:a||0,queryString:c,algorithm:d},g=b(e);this.logEvent("inViewer.searchResults",g,f)},i.logTabClickEvent=function(a){var c=b(a);this.logEvent("inViewer.tabClick",c,null)},i.logResultClickEvent=function(a,b,c,d){this.logResultComponentClickEvent("inViewer.resultClick",a,b,c,d)},i.logResultGeomClickEvent=function(a,b,c,d,e){this.logResultComponentClickEvent("inViewer.resultGeomClick",a,b,c,d,e)},i.logResultComponentClickEvent=function(a,c,d,e,f,g){var h={position:c,nodeId:d,clickedCurrentGeometry:e};g&&(h.geometry=g);var i=b(f);this.logEvent(a,i,h)},i.logLoadMoreClickEvent=function(a,c){var d={id:a},e=b(c);this.logEvent("inViewer.loadMoreClick",e,d)},i.logErrorEvent=function(a,c,d,e){var f={file:c,method:d,querySource:"inViewer",message:a},g=b(e);this.logEvent("inViewer.error",g,f)},i.logSavedQueryClickEvent=function(a,c,d,e,f,g){var h="inViewer.savedQueries."+a,i={position:c+1,document:d,currentGeometry:e,queryId:f,query:g},j=b("saved-queries");this.logEvent(h,j,i)},i.logSavedQuerySearchClickEvent=function(a,b,c,d,e){this.logSavedQueryClickEvent("search",a,b,c,d,e)},i.logSavedQueryDeleteClickEvent=function(a,b,c,d,e){this.logSavedQueryClickEvent("delete",a,b,c,d,e)},i.logSavedQuerySaveClickEvent=function(a,b,c,d,e){this.logSavedQueryClickEvent("save",a,b,c,d,e)},i.sanitizeAndHighlightString=function(a,b,c){return this.qsAPI.sanitizeAndHighlightString(a,b,c)}}(),function(){"use strict";function a(a){var b=null;return a?([].slice.call(a).forEach(function(a){b||(b=a.urn())&&(b=b.substr(0,b.lastIndexOf("/")+1),b.indexOf("output/Resource")>0&&(b=b.substr(0,b.lastIndexOf("Resource")+9)))}),b||h.logger.warn("InViewerSearch Extension: No URN found for geometry")):h.logger.warn("InViewerSearch Extension: No URN to retrieve from in getUrnFromChildren()"),b}function b(a,b){var c=a.name.toUpperCase(),d=b.name.toUpperCase();return c<d?-1:c>d?1:0}function c(a){if(!a.model)return 0;var b=a.model.getData();return b.instanceTree&&b.instanceTree.objectCount?b.instanceTree.objectCount:b.instanceTree&&b.instanceTree.children?b.instanceTree.children.length:0}function d(a){return a.replace(B,"\\$&")}function e(a,b,c){var d,e=new Uint16Array(a),f=e.length,g=[];if(f){var h="",i=Math.pow(2,16)-1;for(d=0;d<f;d+=i)d+i>f&&(i=f-d),h+=String.fromCharCode.apply(null,e.subarray(d,d+i));g=JSON.parse(h),g?b&&b(g):c&&c("buffer was invalid")}return g}function f(a){var b,c=new ResultCollection,d=a.meta?a.meta:null,f=a.resultSetIndex,g=a.results?a.results:null;return d&&Object.keys(d),Object.keys(f).forEach(function(a){b=f[a],c.setResultSet({guid:d[b].guid,name:d[b].name},e(g[b]))}),c}var g=Autodesk.Viewing,h=Autodesk.Viewing.Private,i=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");i.ViewerPropertiesService=function(){this.worker=void 0,this.viewerpropertiesworker=void 0,this.initialized=!1,this.viewer=null,this.isGeometry=!1,this.isSearchInProgress=!1,this.isSearchInProgressTimer=null,this.searchingString="",this.cbSecond=null};var j,k,l,m=i.ViewerPropertiesService.prototype,n={},o=null,p=null,q=null,r=0,s=null,t=0,u=null,v=!1,w={},x=!1,y=null,z=null,A=[],B=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,C=0;m.uninitialize=function(){void 0!==this.worker&&(this.worker.terminate(),this.worker=void 0,self.viewerpropertiesworker=void 0),this.initialized=!1},m.initialize=function(a,b,c,d,e,f,k){if(this.viewer=a,s=f,b)void 0!==this.worker&&(this.worker.terminate(),this.worker=void 0,this.viewerpropertiesworker=void 0);else{n={};this.viewer.model.getData().acmSessionId;p=c,o=d,p.forEach(function(a){a.data.guid===o&&(q=a)}),t=0,u=k,v=!!u,r=c.length,h.logger.info("Number of geometries: "+r),w={url:"",itemUrl:g.endpoint.getItemApi(),basePath:a.model.getData().basePath},w=h.initLoadContext(w),j=e,void 0===this.viewerpropertiesworker?(this.worker=i.WorkerUtils.createPropertyWorker(),this.viewerpropertiesworker=this.worker):this.worker=this.viewerpropertiesworker,this.worker.postMessage({operation:"SET_DEBUG",enable:h.ENABLE_DEBUG,level:h.logger.level})}this.initialized=!0},m.getSortedGeometries=function(){if(A&&A.length)return A;var a=[];return p.forEach(function(b){a.push(b.data)}),A=a.sort(b)},m.initPropertyDatabases=function(b,c){var d,e=this,f=[],g=0;(l=b)||(g=1);var i=function(a){var b=a.data;if(!b.assetRequest)switch(b.operation){case"PROP_DB_CREATED":h.logger.log("Received PROP_DB_CREATED for "+b.guid+" containing "+b.objCount+" nodes"),(l||b.guid!==o)&&(t++,n[b.guid].objCount=b.objCount,t===C&&e.worker.removeEventListener("message",i),c(n,t===C,!1));break;case"PROCESS_BRUTE_SEARCH_OK":case"BRUTE_SEARCH_OK":h.logger.info("Indexing is still on going and brute force search is in progress");break;case"GEOMETRIES_ATTR_ERR":case"GEOMETRY_ATTR_ERR":case"GEOMETRIES_ATTR_OK":case"GEOMETRY_ATTR_OK":h.logger.info("Indexing is still on going");break;default:h.logger.warn("Received unexpected event, "+b.operation+", for "+b.str)}};u?(p.forEach(function(a){d=a.data.guid,t<300&&(n.hasOwnProperty(d)||(n[d]={geometry:a.data,hasSharedProperties:!0,objCount:0,propdb_loaded:!0}),t++,C++)}),c(n,r>1,!1)):(p.forEach(function(b){var c,d=b.data.guid;(l||d!==o)&&g<300&&(n.hasOwnProperty(d)||(n[d]={geometry:b.data},c=a(b.children),f.push({urn:c,geo:b.data}),g++))}),C=f.length,C?(e.worker.addEventListener("message",i),e.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:f,context:w})):c(n,!0,!1))},m.initSharedPropertyDatabase=function(a){var b=this,c="_sharedPropertyDatabase_",d=function(e){var f=e.data;if(!f.assetRequest)switch(f.operation){case"PROP_DB_CREATED":h.logger.log("Received PROP_DB_CREATED for "+f.guid+" containing "+f.objCount),f.guid===c&&(n[c].objCount=f.objCount,n[c].loading=!1,b.worker.removeEventListener("message",d),n[c].sharedDbInit&&n[c].sharedDbInit(),a());break;default:h.logger.warn("Received unexpected event, "+f.operation+", for "+f.str)}};n.hasOwnProperty(c)?n[c].loading?n[c].sharedDbInit=a:a():(n[c]={isShared:!0,loading:!0},n[o]={isShared:!0,geometry:q.data},b.worker.addEventListener("message",d),b.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:[{urn:u,geo:{guid:c}}],context:w}))},m.initCurrentPropertyDatabase=function(b,c){var d,e,f=this;if(u)this.initSharedPropertyDatabase(function(){var a=q;n.hasOwnProperty(b)||(n[b]={geometry:a.data,hasSharedProperties:!0,objCount:0,propdb_loaded:!0}),c()});else{var g=function(a){var b=a.data;if(!b.assetRequest)switch(b.operation){case"PROP_DB_CREATED":n[b.guid].objCount=b.objCount,b.guid===o&&(t++,C++,f.worker.removeEventListener("message",g),c());break;default:h.logger.warn("An unexpected message was received: "+b.operation)}};n.hasOwnProperty(b)?c():(d=q||{},n[o]={geometry:d.data,propdb_loaded:!0},e=a(d.children),f.worker.addEventListener("message",g),f.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:[{urn:e,geo:d.data}],context:w}))}},m.getCurrentGeometryAttributes=function(a){var b=this;n.hasOwnProperty(o)&&n[o].propdb_loaded||this.initCurrentPropertyDatabase(o,function(){b.getGeometryAttributes(o,function(){a()})})},m.getGeometryAttributes=function(a,b){var c=this,d=function(e){var f=e.data;switch(f.operation){case"GEOMETRY_ATTR_OK":c.worker.removeEventListener("message",d),b();break;case"GEOMETRY_ATTR_ERR":c.worker.removeEventListener("message",d),h.logger.warn("InViewerSearch Extension: No attributes found for: "+a),b();break;default:h.logger.warn("InViewerSearch Extension: Invalid operation found:  Operation: "+(f.operation||"")+" Error: "+(f.error||"")+" Place: "+(f.place||"")+" Method: "+(f.method||""))}};this.worker.addEventListener("message",d),this.worker.postMessage({operation:"GEOMETRY_ATTR",guid:a,sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:v})},m.getGeometriesAttributes=function(a){var b=this,c=function(d){var e=d.data;switch(e.operation){case"GEOMETRIES_ATTR_OK":a(),b.worker.removeEventListener("message",c);break;case"GEOMETRIES_ATTR_ERR":h.logger.info("InViewerSearch Extension: No attributes found for: "+e.geometry.guid),e.ended&&(a(),b.worker.removeEventListener("message",c));break;default:h.logger.warn("InViewerSearch Extension: Invalid operation found:  Operation: "+(e.operation||"")+" Error: "+(e.error||"")+" Place: "+(e.place||"")+" Method: "+(e.method||""))}};!l&&v?a({},v,!0):(this.worker.addEventListener("message",c),this.worker.postMessage({operation:"GEOMETRIES_ATTR",sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:v,loadAll:l}))},m.getGeometry=function(a){var b=null;return p.forEach(function(c){c.data.guid===a&&(b=c)}),b},m.orderGeometriesByName=function(a){var b=[];return this.getSortedGeometries().forEach(function(c){a.hasResultSet(c.guid)&&b.push(a.getResultSetArray(c.guid))}),b},m.getTotalCountGeometries=function(){return r>300?300:r},m.areMoreGeometriesToLoad=function(){return r>300},m.areAllGeometriesLoaded=function(){return t===C},m.updateCurrentGeometry=function(a,b){o=a;var c=this,d=function(a){var e,g=a.data;switch(g.operation){case"UPDATE_CURRENT_OK":c.worker.removeEventListener("message",d),e=f(g),b(g.str,e,g.ended);break;default:h.logger.warn("Received unexpected event, "+g.operation+", for "+g.str)}};this.worker.addEventListener("message",d),this.worker.postMessage({operation:"UPDATE_CURRENT",current:o})},m.hasTooManyNodes=function(a){var b=c(this.viewer);if(!v&&!a){if(this.getTotalCountGeometries()>100)return!0;Object.keys(n).forEach(function(a){a!==o&&n[a].objCount&&(b+=n[a].objCount)})}return h.logger.log("Total number of nodes in model: "+b),j<b},m.bruteSearchCurrent=function(a,b,c){var d=function(a){x=!1,b(a),y&&(y(a),y=null)},e=function(){x=!1,h.logger.warn("A call to viewer native search failed for query string: "+a),c(),z&&z()};if(o&&!n.hasOwnProperty(o)){t++,C++;var f=q||{};n[o]={geometry:f.data}}x?(y=b,z=c):(x=!0,this.viewer.search(a,d,e,[],!0))},m.bruteSearch=function(a,b){var c=this,d=this.getSortedGeometries(),e=function(a){var d,g=a.data;switch(g.operation){case"PROCESS_BRUTE_SEARCH_OK":case"BRUTE_SEARCH_OK":d=f(g),c.cbSecond&&c.cbSecond(g.str,d,g.ended),b(g.str,d,g.ended,g.geometry),g.ended&&(c.worker.removeEventListener("message",e),c.cbSecond=null,c.isSearchInProgress=!1,c.searchingString=null,h.logger.debug("The last "+g.operation+" messgage received for query '"+g.str+"' Ready for another search"));break;case"PROP_DB_CREATED":h.logger.log("Property DB is created. Passing the message through.");break;default:h.logger.warn("Received unexpected event, "+g.operation+", for "+g.str)}},g=function(b){var e={geometry:o,results:b};c.worker.postMessage({operation:"PROCESS_BRUTE_SEARCH",str:a,results:e,sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:v,geometries:d})},i=function(){c.worker.postMessage({operation:"PROCESS_BRUTE_SEARCH",str:a,results:{geometry:o,results:[]},sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:v,geometries:d})};this.worker.addEventListener("message",e),this.bruteSearchCurrent(a,g,i),v||this.worker.postMessage({operation:"BRUTE_SEARCH",str:a,currentGeo:o,geometries:d})},m.highlightText=function(a,b){return"[object String]"!==Object.prototype.toString.call(a)&&h.logger.warn("Error: Non-string sent to highlightText(). Check type, and if correct, convert to String() first."),b?a.replace(k,'<span class="bolder">$1</span>'):a},m.prepHighlighter=function(a){k=new RegExp("("+d(a)+")","gi")},m.doSearch=function(a,b){var c,d=this,e=function(a){var c,g=a.data;switch(g.operation){case"SEARCH_RESULT":c=f(g),d.cbSecond&&d.cbSecond(g.str,c,g.ended),b(g.str,c,g.ended),g.ended&&(d.worker.removeEventListener("message",e),d.cbSecond=null,d.isSearchInProgress=!1,d.searchingString=null,h.logger.debug("The last "+g.operation+" messgage received for query '"+g.str+"' Ready for another search"));break;case"OLD_SEARCH_RESULT":d.worker.removeEventListener("message",e),d.isSearchInProgress=!1;break;case"PROCESS_BRUTE_SEARCH_OK":case"BRUTE_SEARCH_OK":h.logger.info("Indexing is still building and brute force search is in progress");break;default:h.logger.warn("Received unexpected event, "+g.operation+", for "+g.str)}};clearTimeout(d.isSearchInProgressTimer),!0===d.isSearchInProgress?a===d.searchingString?d.cbSecond=b:d.isSearchInProgressTimer=setTimeout(function(){d.doSearch(a,b)},100):(v&&(c={},Object.keys(n).forEach(function(a){"_sharedPropertyDatabase_"!==a&&(c[a]={guid:n[a].geometry.guid,name:n[a].geometry.name})})),h.logger.debug("Submitting a new search request for query '"+a+"'"),d.isSearchInProgress=!0,d.searchingString=a,d.worker.addEventListener("message",e),d.worker.postMessage({operation:"SEARCH",str:a,isSharedPropertyDb:v,geometries:c}))},m.defaultNodeName=function(){return"Untitled Node"}}(),function(){"use strict";var a=Autodesk.Viewing,b=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch.Helper");b.toggleMessage=function(a,b,c){c&&!a.message?(a.message=document.createElement("div"),a.message.className="message-container",a.message.appendChild(document.createTextNode(b)),a.container.appendChild(a.message)):!c&&a.message&&(a.message.parentNode&&a.message.parentNode.removeChild(a.message),a.message=null)},b.showMessageWithTimer=function(a,c){a.messageTimer&&clearTimeout(a.messageTimer),b.toggleMessage(a,c,!0),a.messageTimer=setTimeout(function(){b.toggleMessage(a,c,!1)},5e3)},b.copyDocumentQueries=function(a){var b={document:{id:a.document.id,name:a.document.name,idType:a.document.idType},queries:[],version:a.version};return a.queries.forEach(function(a){var c={creationDate:a.creationDate,lastModifiedDate:a.lastModifiedDate,name:a.name,querySet:[]};a.querySet.forEach(function(a){var b={query:a.query,queryId:a.queryId,geometry:a.geometry};c.querySet.push(b)}),b.queries.push(c)}),b},b.copyUserData=function(a){return{allocation:{used:a.allocation.used,max:a.allocation.max},lastModifiedDate:a.lastModifiedDate,creationDate:a.creationDate,version:a.version}},b.copyQueries=function(a){var c={userData:b.copyUserData(a.userData),documentQueries:{}};return a.documentQueries&&(c.documentQueries=b.copyDocumentQueries(a.documentQueries)),c},b.showDeletePopup=function(b,c,d,e){var f=document.createElement("div");f.className="message-container delete-popup";var g=document.createElement("div");g.className="text-container";var h=a.i18n.translate("Are you sure you want to delete the query from your list?").replace("{0}",c);g.appendChild(document.createTextNode(h));var i=document.createElement("button");i.className="delete-button",i.addEventListener("click",function(){d()}),i.appendChild(document.createTextNode(a.i18n.translate("Delete")));var j=document.createElement("button");return j.className="cancel-button",j.addEventListener("click",function(){e()}),j.appendChild(document.createTextNode(a.i18n.translate("Cancel"))),f.appendChild(g),f.appendChild(i),f.appendChild(j),b.appendChild(f),f}}(),ResultCollection.prototype.resetResultCollection=function(){this.partialResults=[],this.resultIDArray={},this.resultSetArray=[],this.resultArrayBufferArray=[],this.metaInfoArray=[],this.resultSetIndex={},this.resultCount=0},ResultCollection.prototype.getResultCount=function(){return this.resultCount},ResultCollection.prototype.setResultCount=function(a){this.resultCount=a},ResultCollection.prototype.getResultSetArray=function(){return this.resultSetArray},ResultCollection.prototype.recalcResultCount=function(){var a,b;for(this.resultCount=0,b=this.resultSetArray.length,a=0;a<b;a++)this.resultCount+=this.resultSetArray[a].length},ResultCollection.prototype.getResultSetIndex=function(a){return this.resultSetIndex.hasOwnProperty(a)?this.resultSetIndex[a]:-1},ResultCollection.prototype.hasResult=function(a,b){return!(!this.resultIDArray.hasOwnProperty(a)||this.resultIDArray[a].indexOf(b)<0)},ResultCollection.prototype.trackResult=function(a,b){return this.resultIDArray.hasOwnProperty(a)?!(this.resultIDArray[a].indexOf(b)>=0)&&(this.resultIDArray[a].push(b),!0):(this.resultIDArray[a]=[],this.resultIDArray[a].push(b),!0)},ResultCollection.prototype.getResultSetIndexArray=function(){return this.resultSetIndex},ResultCollection.prototype.addResult=function(a,b,c){return!!this.trackResult(a.guid,b)&&(this.resultSetIndex.hasOwnProperty(a.guid)?(this.resultSetArray[this.resultSetIndex[a.guid]].push(c),this.resultCount++):this.setResultSet({guid:a.guid,name:a.name},[c]),!0)},ResultCollection.prototype.setResultSet=function(a,b){a&&a.guid&&(this.resultSetIndex.hasOwnProperty(a.guid)?this.resultSetArray[this.resultSetIndex(a.guid)]=b:(this.metaInfoArray.push(a),this.resultSetArray.push(b),this.resultSetIndex[a.guid]=this.resultSetArray.length-1),this.recalcResultCount())},ResultCollection.prototype.replaceResultSet=function(a,b){return!(this.resultSetArray.length<=a||!b)&&(this.resultSetArray[a]=b,this.recalcResultCount(),!0)},ResultCollection.prototype.getResultSet=function(a){if("number"==typeof a){if(!this.resultSetArray||this.resultSetArray.length<=a)return null}else{if("string"!=typeof a)return null;if((a=this.getResultSetIndex(a))<0)return null}return this.resultSetArray[a]},ResultCollection.prototype.hasResultSet=function(a){if("number"==typeof a){if(!this.resultSetArray||this.resultSetArray.length<=a)return!1}else{if("string"!=typeof a)return!1;if((a=this.getResultSetIndex(a))<0)return!1}return!0},ResultCollection.prototype.setResultSetArray=function(a){this.resultSetArray=a.resultSetArray,this.resultSetIndex=a.resultSetIndex,this.resultCount=a.resultCount,this.partialResults=[],this.resultIDArray={},this.resultArrayBufferArray=[],this.metaInfoArray=[]},ResultCollection.prototype.getMetaInfo=function(a){return this.metaInfoArray.length<=a?null:this.metaInfoArray[a]},ResultCollection.prototype.getMetaInfo=function(a){return"number"!=typeof a?null:!this.metaInfoArray||this.metaInfoArray.length<=a?null:this.metaInfoArray[a]},ResultCollection.prototype.getMetaInfoArray=function(){return this.metaInfoArray},ResultCollection.prototype.getResultArrayBuffer=function(a){return this.resultArrayBufferArray.length<=a?null:this.resultArrayBufferArray[a]},ResultCollection.prototype.addResultArrayBuffer=function(a){return this.resultArrayBufferArray.push(a)},ResultCollection.prototype.getResultArrayBufferArray=function(){return this.resultArrayBufferArray},ResultCollection.prototype.getResultSetLength=function(a){if("number"==typeof a){if(!this.resultSetArray||this.resultSetArray.length<=a)return-1}else{if("string"!=typeof a)return-1;if((a=this.getResultSetIndex(a))<0)return-1}return this.resultSetArray[a].length},ResultCollection.prototype.getResultSetArrayLength=function(){return this.resultSetArray?this.resultSetArray.length:0},ResultCollection.prototype.getMetaInfoArrayLength=function(){return this.metaInfoArray?this.metaInfoArray.length:0},ResultCollection.prototype.getResultArrayBufferArrayLength=function(){return this.resultArrayBufferArray?this.resultArrayBufferArray.length:0},ResultCollection.prototype.copyResultCollection=function(a,b,c){var d,e,f;if(void 0!==c&&null!==c||(c=!0),this.resultCount=a.resultCount,this.resultSetArray=a.resultSetArray,this.resultSetIndex=a.resultSetIndex,this.metaInfoArray=a.metaInfoArray,this.resultIDArray=a.resultIDArray,b)for(this.resultArrayBufferArray=[],a.resultArrayBufferArray=[],d=a.getResultSetArrayLength(),e=0;e<d;e++)f=this.arrayToArrayBuffer(this.resultSetArray[e],!0),a.addResultArrayBuffer(f.arrayBuffer),this.addResultArrayBuffer(f.arrayBufferStore);if(!b&&c)for(this.resultArrayBufferArray=[],d=this.getResultSetArrayLength(),e=0;e<d;e++)this.resultArrayBufferArray.push(this.arrayToArrayBuffer(this.resultSetArray[e]))},ResultCollection.prototype.arrayToArrayBuffer=function(a,b){var c,d,e,f=JSON.stringify(a),g=f.length,h=new ArrayBuffer(2*g),i=new Uint16Array(h);for(b&&(c=new ArrayBuffer(2*g),d=new Uint16Array(c)),e=0;e<g;e++)i[e]=f.charCodeAt(e),
b&&(d[e]=f.charCodeAt(e));return b?{arrayBuffer:h,arrayBufferStore:c}:h},ResultCollection.prototype.copyArrayBuffer=function(a){var b,c,d,e,f;if(this.resultArrayBufferArray.length<=a)return null;for(b=this.resultArrayBufferArray[a].byteLength,c=new ArrayBuffer(b),d=new Uint16Array(this.resultArrayBufferArray[a]),e=new Uint16Array(c),f=0;f<b;f++)e[f]=d[f];return c},ResultCollection.prototype.generateArrayBufferArray=function(){var a,b,c=[];if(this.resultCount)for(a=this.getResultArrayBufferArrayLength(),b=0;b<a;b++)c.push(this.copyArrayBuffer(b));return c},ResultCollection.prototype.loadResultCollectionFromObject=function(a){this.partialResults=a.partialResults,this.resultIDArray=a.resultIDArray,this.resultSetArray=a.resultSetArray,this.resultArrayBufferArray=a.resultArrayBufferArray,this.metaInfoArray=a.metaInfoArray,this.resultSetIndex=a.resultSetIndex,this.resultCount=a.resultCount};