!function(){"use strict";var a=Autodesk.Viewing,b=Autodesk.Viewing.Private,c=AutodeskNamespace("Autodesk.Viewing.Extensions.Billboard"),d=function(b,c){a.Extension.call(this,b,c)};d.prototype=Object.create(a.Extension.prototype),d.prototype.constructor=d,d.prototype.load=function(){b.injectCSS("extensions/Billboard/Billboard.min.css");var d=this;this.tool=new c.BillboardTool(this.viewer),this.viewer.toolController.registerTool(this.tool),this.onExplodeBinded=this.onExplode.bind(this),this.onSectionBinded=this.onSection.bind(this),this.viewer.addEventListener(a.CAMERA_CHANGE_EVENT,this.tool.onCameraChange),this.viewer.addEventListener(a.VIEWER_RESIZE_EVENT,this.tool.handleResize),this.viewer.addEventListener(a.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),this.viewer.addEventListener(a.CUTPLANES_CHANGE_EVENT,this.onSectionBinded),this.HOTKEYS_ID="Autodesk.Billboard.Hotkeys";var e=[{keycodes:[a.theHotkeyManager.KEYCODES.ENTER],onRelease:function(){if(d.tool)return d.tool.enterEditAnnotation()}}];return a.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,e),!0},d.prototype.unload=function(){return a.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.viewer.removeEventListener(a.CAMERA_CHANGE_EVENT,this.tool.onCameraChange),this.viewer.removeEventListener(a.VIEWER_RESIZE_EVENT,this.tool.handleResize),this.viewer.removeEventListener(a.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),this.viewer.removeEventListener(a.CUTPLANES_CHANGE_EVENT,this.onSectionBinded),this.clearAnnotations(),this.viewer.toolController.deregisterTool(this.tool),this.tool=null,!0},d.prototype.isActive=function(){return this.tool.isActive()},d.prototype.enterEditMode=function(){return this.tool.isActive()||this.viewer.toolController.activateTool("billboard"),!0},d.prototype.leaveEditMode=function(){return this.tool.isActive()&&this.viewer.toolController.deactivateTool("billboard"),!0},d.prototype.generateData=function(){return this.tool.generateData()},d.prototype.loadData=function(a){this.tool.loadData(a)},d.prototype.showAnnotations=function(){this.tool&&this.tool.showAnnotations()},d.prototype.hideAnnotations=function(){this.tool&&this.tool.hideAnnotations()},d.prototype.clearAnnotations=function(){this.tool&&this.tool.clearAnnotations()},d.prototype.showNumberMarkers=function(){this.tool&&this.tool.showNumMarkers()},d.prototype.hideNumberMarkers=function(){this.tool&&this.tool.hideNumMarkers()},d.prototype.onExplode=function(a){1*a.scale==0?this.showNumberMarkers():(this.hideAnnotations(),this.hideNumberMarkers())},d.prototype.onSection=function(a){Array.isArray(a.planes)&&a.planes.length>0?(this.hideAnnotations(),this.hideNumberMarkers()):this.showNumberMarkers()},c.BillboardExtension=d,a.theExtensionManager.registerExtension("Autodesk.Billboard",d)}(),function(){"use strict";var a=Autodesk.Viewing,b=(Autodesk.Viewing.Private,AutodeskNamespace("Autodesk.Viewing.Extensions.Billboard"));a.ANNOTATION_CREATED_EVENT="annotationCreated",a.ANNOTATION_DELETED_EVENT="annotationDeleted";var c=function(b){a.ToolInterface.call(this),this.names=["billboard"];var c=this,d=!1,e=!1,f=!1,g=1,h=null,i=null,j=null,k=null,l=null;this.annotations=[],this.numMarkers=[],this.filter={seedURN:!0,objectSet:!0,viewport:!0,tags:!0,renderOptions:!1,cutplanes:!0},this.isActive=function(){return d},this.getCursor=function(){return"url(data:;base64,AAABAAEAGBgAAAEAIACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAAAkAABMLAAATCwAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABJAAAAtAAAAEkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMSEhL/sbGx/wAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEwgICP99fX3//////wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAdCAgI/3p6ev///////////wAAAP8AAADWAAAAqAAAAHwAAABJAAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHQAAAHQEBAT/AAAABAAAABMSEhL/hISE/////////////////+Li4v/W1tb/qKio/319ff9KSkr/EhIS/wAAAHQAAAAdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEHR0d/3R0dP9kZGT/AAAAdAAAABMSEhL/sbGx//////////////////r6+v//////////////////////x8fH/3R0dP8dHR3/AAAARAAAAAAAAAAAAAAAAAAAADUzMzP/ra2t///////i4uL/VlZW/wQEBP8AAAD/MzMz/7m5uf///////////4qKiv9kZGT/hISE/7W1tf/t7e3///////////+tra3/MzMz/wAAADUAAAAAAAAAAAAAAJydnZ3//////+Li4v+Kior/MzMz/wAAADEAAAAAAAAAUCkpKf+5ubn//////wAAAP8AAABmAAAAgwAAALQ4ODj/ioqK/+Li4v//////nZ2d/wAAAJwAAAAAAAAAAAAAAOzv7+///////2RkZP8AAACMAAAANQAAAAAAAAAJAAAAAAAAAFApKSn/ubm5/wAAALQAAAAAAAAAAAAAAAAAAAA1AAAAjGRkZP//////7+/v/wAAAOwAAAAAAAAAAAAAAJydnZ3//////+Li4v+Kior/ODg4/wAAAP8ICAj/AAAAVwAAADUAAABQCwsL/////wD////U////1P///9T////U////AAcHB///////nZ2d/wAAAJwAAAAAAAAAAAAAADUzMzP/ra2t////////////7e3t/7W1tf+EhIT/VlZW/zMzM/8XFxf/FxcX/wAAAAAAAAD/AAAA/wAAAP8AAAD/AAAAADU1Nf+Ojo7/MzMz/wAAADUAAAAAAAAAAAAAAAAAAABEHR0d/3R0dP/Hx8f/////////////////////////////////ZWVl/wAAAAT////UAAAA/wAAAP/////UAAAAAHFxcf8dHR3/AAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHQAAAHQSEhL/SkpK/319ff+oqKj/zMzM/+jo6P/6+vr/QEBA/wAAAAb////UAAAA/wAAAP/////UAAAAAAAAAHQAAAAdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAASQAAAHwAAACoAAAAzAAAAOwAAAD5AAAA+wAAAAL////UAAAA/wAAAP/////UAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAD////UAAAA/wAAAP/////UAAAAAAAAAAD///8AAAAAAAAAAAAAAACMAAAA9gAAAIwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////U////1P///9T////UAAAA/wAAAP/////U////1P///9T////UAAAAAAAAAAAAAAD29vb2/0hISP8AAACQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////UAAAA/3R0dOr////UAAAA/wAAAP/////UdHR06gAAAP/////UAAAAAAAAAAAAAAD///////r6+v9OTk7/AAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////UAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP/////UAAAAAAAAAAAAAAD////////////6+vr/Tk5O/wAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////U////1P///9T////U////1P///9T////U////1P///9T////UAAAAAAAAAAAAAAD/////////////////+vr6/wAAAPkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcAAAA/wAAAP8AAAD/AAAA+QAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD/8f8A/+H/AP/B/wD9gA8A8AADAOAAAQDAAAAAwEAAAMChwADAAhAAwAIQAOAAEQDwABMA/AAfAP/+HwAf8AMAD/ADAAfwAwAD8AMAA///AAP//wA=), auto"},this.activate=function(){d=!0,b.clearSelection(),this.showAnnotations()},this.deactivate=function(){d=!1,this.billboard&&(this.billboard.annotationEditing?(this.billboard.dragging=!1,this.billboard.textArea.value?this.billboard.acceptButton.click():this.billboard.cancelButton.click()):this.destroyBillboard()),this.hideAnnotations()},this.onCameraChange=function(){c.updateBillboard(),c.updateAnnotations(),c.highlightAnnotation()},this.project=function(a){var c=b.navigation.getCamera(),d=b.navigation.getScreenViewport(),e=(new THREE.Vector3).copy(a);return e.project(c),new THREE.Vector3(Math.round((e.x+1)/2*d.width),Math.round((1-e.y)/2*d.height),e.z)},this.unproject=function(a){var c=b.navigation.getCamera(),d=b.navigation.getScreenViewport(),e=new THREE.Vector3;return e.x=a.x/d.width*2-1,e.y=-(a.y/d.height*2-1),e.z=a.z,e.unproject(c),e},this.createBillboard=function(d,e){if(!f){f=!0,this.billboard=document.createElement("div"),this.billboard.className="billboard-container",b.container.appendChild(this.billboard);var g=new THREE.Vector3(0,0,0),h=g.x-d.x,i=g.y-d.y;this.billboard.deltaX=e?e.deltaX:h,this.billboard.deltaY=e?e.deltaY:i,this.setBillboardPosition(d,e),this.moveHandler(this.billboard),this.billboard.intersectPoint=d,this.billboard.show=!0,e&&(this.billboard.annotationEditing=!0);var j=this.billboard.textArea=document.createElement("TEXTAREA");j.className="billboard-textarea",this.billboard.appendChild(j),j.setAttribute("rows","4"),j.setAttribute("maxlength","140"),j.focus(),e&&(j.value=e.childNodes[0].innerHTML);var k=document.createElement("div");k.className="billboard-control",this.billboard.appendChild(k);var l=this.billboard.acceptButton=document.createElement("div");l.className="billboard-button-accept",l.setAttribute("data-i18n","Accept"),l.textContent=a.i18n.translate("Accept"),l.addEventListener("click",function(){if(!c.billboard.dragging&&c.billboard.childNodes[0].value){var a=c.billboard.childNodes[0].value,b=c.billboard.deltaX,f=c.billboard.deltaY;e?c.createAnnotation(d,a,b,f,e.id):c.createAnnotation(d,a,b,f),c.destroyBillboard()}},!1),k.appendChild(l),e||l.classList.add("billboard-button-accept-greyout"),j.addEventListener("input",function(){j.value?l.classList.remove("billboard-button-accept-greyout"):l.classList.add("billboard-button-accept-greyout")});var m=this.billboard.cancelButton=document.createElement("div");m.className="billboard-button-cancel";var n;n=e?"Delete":"Cancel",m.setAttribute("data-i18n",n),m.textContent=a.i18n.translate(n),m.addEventListener("click",function(){c.billboard.dragging||(c.destroyBillboard(),e&&(c.destroyNumMarker(e.id),b.dispatchEvent({type:a.ANNOTATION_DELETED_EVENT,data:e.commObj})))},!1),k.appendChild(m),this.drawLeadLine(d,this.billboard),this.drawLeadPoint(d,this.billboard),b.utilities.setPivotPoint(d,!0,!0)}},this.destroyBillboard=function(){f=!1,b.impl.removeMultipleOverlays("billboard-line",this.billboard.line),b.impl.removeMultipleOverlays("billboard-point",this.billboard.point),b.container.removeChild(this.billboard),this.billboard=null},this.setBillboardPosition=function(a,b){var c;b?c=(new THREE.Vector3).copy(b.position):(c=(new THREE.Vector3).copy(a),c.x+=this.billboard.deltaX,c.y+=this.billboard.deltaY),this.billboard.position=c;var d=this.project(c);this.borderCheck(this.billboard,d),this.billboard.style.left=d.x+"px",this.billboard.style.top=d.y+"px"},this.updateBillboardPosition=function(){var a=this.project(this.billboard.position);this.borderCheck(this.billboard,a),this.billboard.style.left=a.x+"px",this.billboard.style.top=a.y+"px"},this.borderCheck=function(a,c){var d=b.navigation.getScreenViewport(),e=a.clientWidth,f=a.clientHeight;c.x<5&&(c.x=0),c.y<5&&(c.y=0),d.width-5<c.x+e&&(c.x=d.width-e),d.height-5<c.y+f&&(c.y=d.height-f)},this.createAnnotation=function(d,e,f,h,i){function j(){function a(){k.dragging?c.highlightAnnotation():k.classList.contains("billboard-annotation-highlight")?c.editAnnotation(d,k):c.highlightAnnotation(k)}var b,e=0;return function(){e++,1==e?b=setTimeout(function(){a(),e=0},250):(clearTimeout(b),e=0)}}var k=document.createElement("div");k.className="billboard-annotation",b.container.appendChild(k);var l=new THREE.Vector3(0,0,0);f=f||l.x-d.x,h=h||l.y-d.y,k.deltaX=f,k.deltaY=h,this.setAnnotationPosition(k,d),this.moveHandler(k),k.intersectPoint=d,k.show=!0,i?(k.id=i,this.annotations[i-1]=k):(k.id=g++,this.annotations.push(k),this.createNumMarker(k));var m=document.createElement("div");m.innerHTML=e,k.appendChild(m),this.drawLeadLine(d,k);var n={message:e,point3d:d},o=b.getExtension("Autodesk.Comments");(k.cPromise=o.createComment(n)).then(function(e){function f(){k.classList.contains("billboard-annotation-highlight")?c.editAnnotation(d,k):o.restoreComment(e,c.filter,!1)}k.commObj=e,k.addEventListener("click",j(),!1),k.addEventListener("dblclick",f,!1),a.isTouchDevice()&&Hammer(k).on("doubletap",f),b.dispatchEvent({type:a.ANNOTATION_CREATED_EVENT,data:e})},function(a){console.log("Create comments failed:"+a)})},this.destroyAnnotation=function(a){b.impl.removeMultipleOverlays("billboard-line",a.line),b.container.removeChild(a),this.annotations[a.id-1]=void 0},this.editAnnotation=function(a,b){f||(this.destroyAnnotation(b),this.createBillboard(a,b))},this.highlightAnnotation=function(a){for(var b=document.getElementsByClassName("billboard-annotation-highlight"),c=0;c<b.length;c++)b[c].classList.remove("billboard-annotation-highlight");a&&a.classList.add("billboard-annotation-highlight")},this.enterEditAnnotation=function(){for(var a=0;a<this.annotations.length;a++){var b=this.annotations[a];if(b&&b.classList.contains("billboard-annotation-highlight")){this.editAnnotation(b.intersectPoint,b);break}}},this.setAnnotationPosition=function(a,b){var c;f?c=(new THREE.Vector3).copy(this.billboard.position):(c=(new THREE.Vector3).copy(b),c.x+=a.deltaX,c.y+=a.deltaY),a.position=c;var d=this.project(c);a.style.left=d.x+"px",a.style.top=d.y+"px"},this.updateAnnotationPosition=function(a){var b=this.project(a.position);a.style.left=b.x+"px",a.style.top=b.y+"px"},this.drawLeadLine=function(a,b){b.line=[];var c=parseInt(b.style.left,10),d=parseInt(b.style.top,10)+b.childNodes[0].clientHeight,e=this.unproject(new THREE.Vector3(c,d,0));b.line.push(this.drawLine(a,e,2)),b.id?b.line.push(this.drawLine(a,e,1)):b.line.push(this.drawLine(a,e))},this.drawLine=function(a,c,d){h||(h=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1,depthWrite:!1}),i=new THREE.LineBasicMaterial({color:34181,linewidth:2,depthTest:!1,depthWrite:!1}),j=new THREE.LineBasicMaterial({color:16777215,linewidth:4,depthTest:!1,depthWrite:!1}),b.impl.createOverlayScene("billboard-line"));var e=new THREE.Geometry;e.vertices.push(a),e.vertices.push(c);var f;f=1==d?i:2==d?j:h;var g=new THREE.Line(e,f);return b.impl.addOverlay("billboard-line",g),g},this.drawLeadPoint=function(a,b){b.point=[],b.point.push(this.drawPoint(a,0)),b.point.push(this.drawPoint(a,1))},this.drawPoint=function(a,c){k||(k=new THREE.MeshBasicMaterial({color:0,opacity:1,transparent:!0,depthTest:!1,depthWrite:!1}),l=new THREE.MeshBasicMaterial({color:16777215,opacity:1,transparent:!0,depthTest:!1,depthWrite:!1}),b.impl.createOverlayScene("billboard-point"));var d=new THREE.Mesh(new THREE.SphereGeometry(1),c?k:l);return d.position.set(a.x,a.y,a.z),this.setPointScale(d,c?4:5),b.impl.addOverlay("billboard-point",d),d},this.setPointScale=function(a,b){var c=this.setScale(a,b);a.scale.x=c,a.scale.y=c,a.scale.z=c},this.setScale=function(a,c){var d=b.navigation,e=d.getCamera(),f=d.getEyeVector(),g=d.getPosition(),h=a.position.clone(),i=e.isPerspective?h.sub(g).dot(f.normalize()):d.getEyeVector().length(),j=d.getVerticalFov(),k=2*i*Math.tan(THREE.Math.degToRad(.5*j)),l=d.getScreenViewport(),m=window.devicePixelRatio||1;return c*k/(l.height*m)},this.createNumMarker=function(a){var d=document.createElement("div");d.className="billboard-marker",this.numMarkers.push(d),d.innerHTML=a.id,b.container.appendChild(d),d.position=a.intersectPoint,this.setNumMarkerPosition(d),d.id=a.id,d.addEventListener("click",function(){var a=c.annotations[this.id-1];a.show?c.hideAnnotation(a):c.showAnnotation(a)})},this.destroyNumMarker=function(a){b.container.removeChild(this.numMarkers[a-1]),this.numMarkers[a-1]=void 0},this.setNumMarkerPosition=function(a){var b=this.project(a.position);a.style.left=b.x-a.offsetWidth/2+"px",a.style.top=b.y-a.offsetHeight/2+"px"},this.updateBillboard=function(){this.billboard&&(this.updateBillboardPosition(),this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.updateAnnotations=function(){for(var a=0;a<this.annotations.length;a++)this.annotations[a]&&(this.updateAnnotationPosition(this.annotations[a]),this.updateLine(this.annotations[a]));for(var a=0;a<this.numMarkers.length;a++)this.numMarkers[a]&&this.setNumMarkerPosition(this.numMarkers[a])},this.updateLine=function(a){var c=a.line;if(b.impl.removeMultipleOverlays("billboard-line",c),!0===a.show){var d=a.intersectPoint;this.drawLeadLine(d,a)}},this.updatePoint=function(a){var c=a.point;b.impl.removeMultipleOverlays("billboard-point",c),!0===a.show&&this.drawLeadPoint(a.intersectPoint,a)},this.showBillboard=function(){this.billboard&&(this.billboard.show=!0,this.billboard.style.display="block",this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.hideBillboard=function(){this.billboard&&(this.billboard.show=!1,this.billboard.style.display="none",this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.showAnnotation=function(a){a.show=!0,a.style.display="block",this.updateLine(a)},this.showAnnotations=function(){for(var a=0;a<this.annotations.length;a++)this.annotations[a]&&this.showAnnotation(this.annotations[a])},this.hideAnnotation=function(a){a.show=!1,a.style.display="none",this.updateLine(a)},this.hideAnnotations=function(){for(var a=0;a<this.annotations.length;a++)this.annotations[a]&&this.hideAnnotation(this.annotations[a])},this.clearAnnotations=function(){for(var a=0;a<this.annotations.length;a++)this.annotations[a]&&(this.destroyNumMarker(this.annotations[a].id),this.destroyAnnotation(this.annotations[a]));g=1},this.generateData=function(){for(var a=[],c=b.getExtension("Autodesk.Comments"),d=0;d<this.annotations.length;d++)if(this.annotations[d]){var e=this.annotations[d].commObj,f=[this.annotations[d].deltaX,this.annotations[d].deltaY];c.factory.pushTag(e,{name:"textOffset",value:f}),a.push(e)}return a},this.loadData=function(a){for(var c=b.getExtension("Autodesk.Comments"),d=0;d<a.length;d++){c.factory.removeGlobalOffset(a[d]);var e=c.factory.getTagValue(a[d],"nodeOffset"),f=new THREE.Vector3(e[0],e[1],e[2]),g=c.factory.getTagValue(a[d],"textOffset");g?this.createAnnotation(f,a[d].body,g[0],g[1]):this.createAnnotation(f,a[d].body)}},this.showNumMarkers=function(){for(var a=0;a<this.numMarkers.length;a++)this.numMarkers[a]&&(this.numMarkers[a].style.visibility="visible")},this.hideNumMarkers=function(){for(var a=0;a<this.numMarkers.length;a++)this.numMarkers[a]&&(this.numMarkers[a].style.visibility="hidden")},this.moveHandler=function(a){function c(c){"touchmove"===c.type&&(c.screenX=c.touches[0].screenX,c.screenY=c.touches[0].screenY),l+=c.screenX-h,m+=c.screenY-i,f=j+l,g=k+m;var d=b.navigation.getScreenViewport(),e=a.clientWidth,o=a.clientHeight;f<5&&(f=0),g<5&&(g=0),d.width-5<f+e&&(f=d.width-e),d.height-5<g+o&&(g=d.height-o),a.style.left=f+"px",a.style.top=g+"px",n.updateLine(a),h=c.screenX,i=c.screenY,a.dragging=!0}function d(b){var e=n.project(a.intersectPoint),h=n.unproject(new THREE.Vector3(f,g,e.z));a.deltaX=h.x-a.intersectPoint.x,a.deltaY=h.y-a.intersectPoint.y,a.position.copy(h),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",d)}function e(b){"textarea"!==b.target.tagName.toLowerCase()&&("touchstart"===b.type&&(b.screenX=b.touches[0].screenX,b.screenY=b.touches[0].screenY),h=b.screenX,i=b.screenY,l=0,m=0,f=j=a.offsetLeft,g=k=a.offsetTop,a.dragging=!1,window.addEventListener("mousemove",c),window.addEventListener("mouseup",d),window.addEventListener("touchmove",c),window.addEventListener("touchend",d))}var f,g,h,i,j,k,l,m,n=this;a.addEventListener("mousedown",e),a.addEventListener("touchstart",e)},this.handleButtonDown=function(a,b){return e=!0,!1},this.handleButtonUp=function(a,b){return e=!1,!1},this.handleMouseMove=function(a){return!1},this.handleSingleClick=function(a,c){var d=b.impl.hitTest(a.canvasX,a.canvasY,!1);return d&&this.createBillboard(d.intersectPoint),!0},this.handleDoubleClick=function(a,b){return!0},this.handleSingleTap=function(a){return this.handleSingleClick(a)},this.handleDoubleTap=function(a){return!0},this.handleResize=function(){c.updateBillboard(),c.updateAnnotations(),c.highlightAnnotation()}};b.BillboardTool=c}(),function(){"use strict";var a=Autodesk.Viewing,b=a.UI,c=AutodeskNamespace("Autodesk.Billboard"),d=function(b,c){a.Extension.call(this,b,c)};d.populateDefaultOptions=function(a){a.experimental.push("--billboards")},d.prototype=Object.create(a.Extension.prototype),d.prototype.constructor=d,d.prototype.load=function(){var a=this.viewer.getExtension("Autodesk.Billboard");return a||(this.viewer.loadExtension("Autodesk.Billboard"),a=this.viewer.getExtension("Autodesk.Billboard")),a?(this.core=a,this.viewer.toolbar?this.createToolbarUI():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)),!0):(avp.logger.warn("Missing dependency:","Autodesk.Billboard"),!1)},d.prototype.unload=function(){return this.destroyToolbarUI(),this.core=null,!0},d.prototype.onToolbarCreated=function(){this.viewer.removeEventListener(a.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null,this.createToolbarUI()},d.prototype.createToolbarUI=function(){var c=this,d=this.viewer,e=d.getToolbar(!0);this.billboardToolButton=new b.Button("toolbar-billboardTool"),this.billboardToolButton.setToolTip("Billboard"),this.billboardToolButton.setIcon("adsk-icon-billboard"),this.billboardToolButton.onClick=function(a){var d=c.billboardToolButton.getState();d===b.Button.State.INACTIVE?(c.core.enterEditMode(),c.billboardToolButton.setState(b.Button.State.ACTIVE)):d===b.Button.State.ACTIVE&&(c.core.leaveEditMode(),c.billboardToolButton.setState(b.Button.State.INACTIVE))};var f=e.getControl(a.TOOLBAR.MODELTOOLSID);f&&f.addControl(this.billboardToolButton,{index:0})},d.prototype.destroyToolbarUI=function(){if(this.billboardToolButton){var b=this.viewer.getToolbar(!1);if(b){var c=b.getControl(a.TOOLBAR.MODELTOOLSID);c&&c.removeControl(this.billboardToolButton)}this.billboardToolButton=null}},c.BillboardGui=d,a.theExtensionManager.registerExtension("Autodesk.BillboardGui",d)}();