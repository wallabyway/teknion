!function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.domEvents=[],Autodesk.Viewing.Private.injectCSS("extensions/Markups/MarkupsGui.css")}var b="Autodesk.Viewing.MarkupsCore",c=AutodeskNamespace("Autodesk.Markups.Gui"),d=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),e=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var f=a.prototype,g=Autodesk.Viewing,h=g.Private;f.load=function(){var a=function(){this.core=this.viewer.getExtension(b),this.viewer.toolbar?this.createToolbarUI():(this.bindedOnToolbarCreated=this.onToolbarCreated.bind(this),this.viewer.addEventListener(g.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated)),this.onEditModeEnterBinded=this.onEditModeEnter.bind(this),this.onEditModeLeaveBinded=this.onEditModeLeave.bind(this),this.onEditModeChangeBinded=this.onEditModeChange.bind(this),this.onMarkupSelectedBinded=this.onMarkupSelected.bind(this),this.core.addEventListener(d.EVENT_EDITMODE_ENTER,this.onEditModeEnterBinded),this.core.addEventListener(d.EVENT_EDITMODE_LEAVE,this.onEditModeLeaveBinded),this.core.addEventListener(d.EVENT_EDITMODE_CHANGED,this.onEditModeChangeBinded),this.core.addEventListener(d.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded)}.bind(this),c=function(){h.logger.warn("Error getting dependency:",b)}.bind(this);return this.viewer.getExtension(b)?a():(h.logger.warn("Getting missing dependency:",b),this.viewer.loadExtension(b).then(a,c)),!0},f.unload=function(){return this.unhookAllEvents(),this.core.removeEventListener(d.EVENT_EDITMODE_ENTER,this.onEditModeEnterBinded),this.core.removeEventListener(d.EVENT_EDITMODE_LEAVE,this.onEditModeLeaveBinded),this.core.removeEventListener(d.EVENT_EDITMODE_CHANGED,this.onEditModeChangeBinded),this.core.removeEventListener(d.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),this.onEditModeEnterBinded=null,this.onEditModeLeaveBinded=null,this.onEditModeChangeBinded=null,this.onMarkupSelectedBinded=null,this.destroyToolbarUI(),this.bindedOnToolbarCreated&&(this.viewer.removeEventListener(g.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null),this.core=null,!0},f.onToolbarCreated=function(){this.viewer.removeEventListener(g.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null,this.createToolbarUI()},f.createToolbarUI=function(){var a=this,b=this.viewer,c=b.getToolbar(!0);this.markupToolButton=new Autodesk.Viewing.UI.Button("toolbar-markupTool"),this.markupToolButton.setToolTip("Markup"),this.markupToolButton.setIcon("adsk-icon-markup"),this.markupToolButton.onClick=function(){a.core.enterEditMode()};var d=c.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);d&&d.addControl(this.markupToolButton,{index:0})},f.destroyToolbarUI=function(){if(this.markupToolButton){var a=this.viewer.getToolbar(!1);if(a){var b=a.getControl(g.TOOLBAR.MODELTOOLSID);b&&b.removeControl(this.markupToolButton)}this.markupToolButton=null}},f.onEditModeEnter=function(){h.logger.log("ENTER edit mode"),this.showToolsUi()},f.onEditModeLeave=function(){h.logger.log("LEAVE edit mode"),this.hideToolsUi()},f.onEditModeChange=function(a){if(this.domToolSelect&&!this.ignoreChangeEvent)for(var b=this.core.editMode,c=this.domToolSelect.options,d=0,e=c.length;d<e;d++){var f=c[d];if(f.value===b.type){this.domToolSelect.selectedIndex=d;break}}},f.onMarkupSelected=function(a){var b=a.markup,c=this.core.editMode;this.setStylesUi(c,b)},f.showToolsUi=function(){this.createToolsUi();var a=this.core.isNavigationAllowed();this.setControlVisibility(".lmv-markup-gui-enterNavMode",a,"inline-block"),this.exitNavigationMode(),this.domContent.style.display="block",this.viewer.container.appendChild(this.domRoot)},f.hideToolsUi=function(){this.domRoot&&this.domRoot.parentNode&&this.domRoot.parentNode.removeChild(this.domRoot)},f.createToolsUi=function(){function a(a,b){return['<option value="',b,'">',a,"</option>"].join("")}if(!this.domRoot){var b=['<div class="lmv-markup-gui-toolbar-content">','<button class="lmv-markup-gui-collapse-btn">&lt;-&gt;</button>','<button class="lmv-markup-editmode-done">Exit</button>','<div class="lmv-markup-gui-collapse-content">','<div class="lmv-markup-gui-editMode">','<button class="lmv-markup-gui-enterNavMode">Navigate</button>','<button class="lmv-markup-gui-undo">&#8617;</button>','<button class="lmv-markup-gui-redo">&#8618;</button>',"<br>",'<button class="lmv-markup-gui-delete">Delete</button>','<button class="lmv-markup-gui-duplicate">Duplicate</button>',"<br>",'<button class="lmv-markup-gui-cut">Cut</button>','<button class="lmv-markup-gui-copy">Copy</button>','<button class="lmv-markup-gui-paste">Paste</button>',"<br>","<span>Markup:</span>",'<select class="lmv-markup-tool-select">',a("Arrow",d.MARKUP_TYPE_ARROW),a("Rectangle",d.MARKUP_TYPE_RECTANGLE),a("Circle",d.MARKUP_TYPE_CIRCLE),a("Text",d.MARKUP_TYPE_TEXT),a("Callout",d.MARKUP_TYPE_CALLOUT),a("Cloud",d.MARKUP_TYPE_CLOUD),a("PolyLine",d.MARKUP_TYPE_POLYLINE),a("Polycloud",d.MARKUP_TYPE_POLYCLOUD),a("Freehand",d.MARKUP_TYPE_FREEHAND),a("Highlight",d.MARKUP_TYPE_HIGHLIGHT),a("Dimension",d.MARKUP_TYPE_DIMENSION),"</select>","<br>",'<div class="lmv-markup-gui-style-options"></div>',"</div>",'<div class="lmv-markup-gui-navMode" style="display:none;">','<button class="lmv-markup-gui-exitNavMode">Back to Markup</button>',"</div>","</div>","</div>"].join("");this.domRoot=document.createElement("div"),this.domRoot.className="lmv-markup-gui-toolbar",this.domRoot.innerHTML=b,this.domContent=this.domRoot.querySelector(".lmv-markup-gui-collapse-content"),this.domToolSelect=this.domRoot.querySelector(".lmv-markup-tool-select"),this.domStylesRoot=this.domRoot.querySelector(".lmv-markup-gui-style-options"),this.hookEvent("click",".lmv-markup-gui-collapse-btn",this.onToggleCollapse.bind(this)),this.hookEvent("click",".lmv-markup-editmode-done",this.onEditModeDone.bind(this)),this.hookEvent("click",".lmv-markup-gui-enterNavMode",this.enterNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-exitNavMode",this.exitNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-undo",this.onUndoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-redo",this.onRedoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-delete",this.onDeleteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-cut",this.onCutClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-copy",this.onCopyClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-paste",this.onPasteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-duplicate",this.onDuplicateClick.bind(this)),this.hookEvent("change",".lmv-markup-tool-select",this.onSelectEditMode.bind(this)),this.hookEvent("change",".lmv-markup-gui-style-select",this.onStyleChange.bind(this)),this.setStylesUi(this.core.editMode)}},f.getEditModeClass=function(a){var b;switch(a){case d.MARKUP_TYPE_ARROW:b="EditModeArrow";break;case d.MARKUP_TYPE_RECTANGLE:b="EditModeRectangle";break;case d.MARKUP_TYPE_CIRCLE:b="EditModeCircle";break;case d.MARKUP_TYPE_TEXT:b="EditModeText";break;case d.MARKUP_TYPE_CALLOUT:b="EditModeCallout";break;case d.MARKUP_TYPE_CLOUD:b="EditModeCloud";break;case d.MARKUP_TYPE_POLYLINE:b="EditModePolyline";break;case d.MARKUP_TYPE_POLYCLOUD:b="EditModePolycloud";break;case d.MARKUP_TYPE_FREEHAND:b="EditModeFreehand";break;case d.MARKUP_TYPE_HIGHLIGHT:b="EditModeHighlight";break;case d.MARKUP_TYPE_DIMENSION:b="EditModeDimension"}return b?new(0,d[b])(this.core):null},f.onToggleCollapse=function(){var a=this.domContent.style.display;this.domContent.style.display="none"===a?"block":"none"},f.onEditModeDone=function(){this.core.hide()},f.enterNavigationMode=function(){this.core.allowNavigation(!0),this.setControlVisibility(".lmv-markup-gui-editMode",!1),this.setControlVisibility(".lmv-markup-gui-navMode",!0)},f.exitNavigationMode=function(){this.core.allowNavigation(!1),this.setControlVisibility(".lmv-markup-gui-editMode",!0),this.setControlVisibility(".lmv-markup-gui-navMode",!1)},f.onUndoClick=function(){this.core.undo()},f.onRedoClick=function(){this.core.redo()},f.onDeleteClick=function(){var a=this.core.getSelection();a&&this.core.deleteMarkup(a)},f.onCutClick=function(){this.core.cut()},f.onCopyClick=function(){this.core.copy()},f.onPasteClick=function(){this.core.paste()},f.onDuplicateClick=function(){this.core.getSelection()&&(this.core.copy(),this.core.paste())},f.onSelectEditMode=function(a){var b=a.target.value,c=this.getEditModeClass(b);return c?c.cancelEditModeChange?void h.logger.warn("There was a problem selecting current editMode"):(this.ignoreChangeEvent=!0,this.core.changeEditMode(c),this.ignoreChangeEvent=!1,this.setStylesUi(c),void this.domToolSelect.blur()):void h.error("Markup editMode not found for type: "+b)},f.onStyleChange=function(a){var b=a.target,c=b.options[b.selectedIndex],d=b.getAttribute("style-key"),e=b.getAttribute("value-type");b.blur();var f=this.core.getSelection(),g=f?f.getStyle():this.core.getStyle();g[d]=function(a,b){return"number"===b?Number(a):"boolean"===b?"true"===a:a}(c.value,e),this.core.setStyle(g)},f.setStylesUi=function(a,b){h.logger.log("set ui for "+a.type);var c=b?b.style:a.style,d=e.getStyleDefaultValues(c,this.core);this.domStylesRoot.innerHTML="";for(var f in d){var g=this.getUiForStyleKey(f,d[f],c[f]);this.domStylesRoot.appendChild(g)}},f.getUiForStyleKey=function(a,b,c){for(var d=b.default,e=[],f=b.values,g=0,h=f.length;g<h;++g){var i=['<option value="',f[g].value,'">',f[g].name,"</option>"].join("");e.push(i),this.valueEquals(f[g].value,c)&&(d=g)}var j=typeof f[0].value,k=document.createElement("div"),l=["<span>",a,"</span>",'<select class="lmv-markup-gui-style-select" style-key="',a,'" value-type="',j,'">',e.join(""),"</select>"].join("");return k.innerHTML=l,k.querySelector("select").selectedIndex=d,k},f.valueEquals=function(a,b){return a===b},f.setControlVisibility=function(a,b,c){var d=this.domRoot.querySelector(a);c||(c="block"),d.style.display=b?c:"none"},f.hookEvent=function(a,b,c){var d=function(a){this.matchesSelector(a.target,b)&&c(a)}.bind(this);this.domRoot.addEventListener(a,d),this.domEvents.push({str:a,handler:d})},f.unhookAllEvents=function(){var a=this.domRoot;this.domEvents.forEach(function(b){a.removeEventListener(b.str,b.handler)}),this.domEvents=[]},f.matchesSelector=function(a,b){return a.matches?a.matches(b):a.msMatchesSelector?a.msMatchesSelector(b):a.mozMatchesSelector?a.mozMatchesSelector(b):!!a.webkitMatchesSelector&&a.webkitMatchesSelector(b)},f.getStyleOptions=function(a){var b=a.getStyle();return c.getStyleDefaultValues(b,this.core)},c.MarkupsGui=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.MarkupsGui",a)}();