!function(a,b){"use strict";"undefined"!=typeof define&&define.amd?define("canvgModule",["rgbcolor","stackblur"],b):"undefined"!=typeof module&&module.exports&&(module.exports=b(require("rgbcolor"),require("stackblur"))),a.canvg=b(a.RGBColor,a.stackBlur)}("undefined"!=typeof window?window:this,function(a,b){function c(a){var b=[0,0,0],c=function(c,d){var e=a.match(c);null!=e&&(b[d]+=e.length,a=a.replace(c," "))};return a=a.replace(/:not\(([^\)]*)\)/g,"     $1 "),a=a.replace(/{[\s\S]*/gm," "),c(g,1),c(h,0),c(j,1),c(k,2),c(l,1),c(m,1),a=a.replace(/[\*\s\+>~]/g," "),a=a.replace(/[#\.]/g," "),c(n,2),b.join("")}function d(d){var f={opts:d};f.FRAMERATE=30,f.MAX_VIRTUAL_PIXELS=3e4,f.log=function(a){},1==f.opts.log&&"undefined"!=typeof console&&(f.log=function(a){console.log(a)}),f.init=function(a){var b=0;f.UniqueId=function(){return"canvg"+ ++b},f.Definitions={},f.Styles={},f.StylesSpecificity={},f.Animations=[],f.Images=[],f.ctx=a,f.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},f.init(),f.ImagesLoaded=function(){for(var a=0;a<f.Images.length;a++)if(!f.Images[a].loaded)return!1;return!0},f.trim=function(a){return a.replace(/^\s+|\s+$/g,"")},f.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm," ")},f.ajax=function(a){var b;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b?(b.open("GET",a,!1),b.send(null),b.responseText):null},f.parseXml=function(a){if("undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml){var b=new Windows.Data.Xml.Dom.XmlDocument,c=new Windows.Data.Xml.Dom.XmlLoadSettings;return c.prohibitDtd=!1,b.loadXml(a,c),b}if(!window.DOMParser)return a=a.replace(/<!DOCTYPE svg[^>]*>/,""),(b=new ActiveXObject("Microsoft.XMLDOM")).async="false",b.loadXML(a),b;try{var d=new DOMParser;return d.parseFromString(a,"image/svg+xml")}catch(b){return(d=new DOMParser).parseFromString(a,"text/xml")}},f.Property=function(a,b){this.name=a,this.value=b},f.Property.prototype.getValue=function(){return this.value},f.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},f.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);return(this.value+"").match(/%$/)&&(a/=100),a},f.Property.prototype.valueOrDefault=function(a){return this.hasValue()?this.value:a},f.Property.prototype.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a},f.Property.prototype.addOpacity=function(b){var c=this.value;if(null!=b.value&&""!=b.value&&"string"==typeof this.value){var d=new a(this.value);d.ok&&(c="rgba("+d.r+", "+d.g+", "+d.b+", "+b.numValue()+")")}return new f.Property(this.name,c)},f.Property.prototype.getDefinition=function(){var a=this.value.match(/#([^\)'"]+)/);return a&&(a=a[1]),a||(a=this.value),f.Definitions[a]},f.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},f.Property.prototype.getFillStyleDefinition=function(a,b){var c=this.getDefinition();if(null!=c&&c.createGradient)return c.createGradient(f.ctx,a,b);if(null!=c&&c.createPattern){if(c.getHrefAttribute().hasValue()){var d=c.attribute("patternTransform");c=c.getHrefAttribute().getDefinition(),d.hasValue()&&(c.attribute("patternTransform",!0).value=d.value)}return c.createPattern(f.ctx,a)}return null},f.Property.prototype.getDPI=function(a){return 96},f.Property.prototype.getEM=function(a){var b=12,c=new f.Property("fontSize",f.Font.Parse(f.ctx.font).fontSize);return c.hasValue()&&(b=c.toPixels(a)),b},f.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")},f.Property.prototype.toPixels=function(a,b){if(!this.hasValue())return 0;var c=this.value+"";if(c.match(/em$/))return this.numValue()*this.getEM(a);if(c.match(/ex$/))return this.numValue()*this.getEM(a)/2;if(c.match(/px$/))return this.numValue();if(c.match(/pt$/))return this.numValue()*this.getDPI(a)*(1/72);if(c.match(/pc$/))return 15*this.numValue();if(c.match(/cm$/))return this.numValue()*this.getDPI(a)/2.54;if(c.match(/mm$/))return this.numValue()*this.getDPI(a)/25.4;if(c.match(/in$/))return this.numValue()*this.getDPI(a);if(c.match(/%$/))return this.numValue()*f.ViewPort.ComputeSize(a);var d=this.numValue();return b&&d<1?d*f.ViewPort.ComputeSize(a):d},f.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/s$/)?1e3*this.numValue():(a.match(/ms$/),this.numValue())},f.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/deg$/)?this.numValue()*(Math.PI/180):a.match(/grad$/)?this.numValue()*(Math.PI/200):a.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var g={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return f.Property.prototype.toTextBaseline=function(){return this.hasValue()?g[this.value]:null},f.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(a,b,c,d,e,g){var h=null!=g?this.Parse(g):this.CreateFont("","","","","",f.ctx.font);return{fontFamily:e||h.fontFamily,fontSize:d||h.fontSize,fontStyle:a||h.fontStyle,fontWeight:c||h.fontWeight,fontVariant:b||h.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var a=this;this.Parse=function(b){for(var c={},d=f.trim(f.compressSpaces(b||"")).split(" "),e={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},g="",h=0;h<d.length;h++)e.fontStyle||-1==a.Styles.indexOf(d[h])?e.fontVariant||-1==a.Variants.indexOf(d[h])?e.fontWeight||-1==a.Weights.indexOf(d[h])?e.fontSize?"inherit"!=d[h]&&(g+=d[h]):("inherit"!=d[h]&&(c.fontSize=d[h].split("/")[0]),e.fontStyle=e.fontVariant=e.fontWeight=e.fontSize=!0):("inherit"!=d[h]&&(c.fontWeight=d[h]),e.fontStyle=e.fontVariant=e.fontWeight=!0):("inherit"!=d[h]&&(c.fontVariant=d[h]),e.fontStyle=e.fontVariant=!0):("inherit"!=d[h]&&(c.fontStyle=d[h]),e.fontStyle=!0);return""!=g&&(c.fontFamily=g),c}},f.ToNumberArray=function(a){for(var b=f.trim(f.compressSpaces((a||"").replace(/,/g," "))).split(" "),c=0;c<b.length;c++)b[c]=parseFloat(b[c]);return b},f.Point=function(a,b){this.x=a,this.y=b},f.Point.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},f.Point.prototype.applyTransform=function(a){var b=this.x*a[0]+this.y*a[2]+a[4],c=this.x*a[1]+this.y*a[3]+a[5];this.x=b,this.y=c},f.CreatePoint=function(a){var b=f.ToNumberArray(a);return new f.Point(b[0],b[1])},f.CreatePath=function(a){for(var b=f.ToNumberArray(a),c=[],d=0;d<b.length;d+=2)c.push(new f.Point(b[d],b[d+1]));return c},f.BoundingBox=function(a,b,c,d){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(a,b){null!=a&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=a,this.x2=a),a<this.x1&&(this.x1=a),a>this.x2&&(this.x2=a)),null!=b&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=b,this.y2=b),b<this.y1&&(this.y1=b),b>this.y2&&(this.y2=b))},this.addX=function(a){this.addPoint(a,null)},this.addY=function(a){this.addPoint(null,a)},this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1),this.addPoint(a.x2,a.y2)},this.addQuadraticCurve=function(a,b,c,d,e,f){var g=a+2/3*(c-a),h=b+2/3*(d-b),i=g+1/3*(e-a),j=h+1/3*(f-b);this.addBezierCurve(a,b,g,i,h,j,e,f)},this.addBezierCurve=function(a,b,c,d,e,f,g,h){var j=[a,b],k=[c,d],l=[e,f],m=[g,h];for(this.addPoint(j[0],j[1]),this.addPoint(m[0],m[1]),i=0;i<=1;i++){var n=function(a){return Math.pow(1-a,3)*j[i]+3*Math.pow(1-a,2)*a*k[i]+3*(1-a)*Math.pow(a,2)*l[i]+Math.pow(a,3)*m[i]},o=6*j[i]-12*k[i]+6*l[i],p=-3*j[i]+9*k[i]-9*l[i]+3*m[i],q=3*k[i]-3*j[i];if(0!=p){var r=Math.pow(o,2)-4*q*p;if(!(r<0)){var s=(-o+Math.sqrt(r))/(2*p);0<s&&s<1&&(0==i&&this.addX(n(s)),1==i&&this.addY(n(s)));var t=(-o-Math.sqrt(r))/(2*p);0<t&&t<1&&(0==i&&this.addX(n(t)),1==i&&this.addY(n(t)))}}else{if(0==o)continue;var u=-q/o;0<u&&u<1&&(0==i&&this.addX(n(u)),1==i&&this.addY(n(u)))}}},this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2},this.addPoint(a,b),this.addPoint(c,d)},f.Transform=function(a){var b=this;this.Type={},this.Type.translate=function(a){this.p=f.CreatePoint(a),this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)},this.unapply=function(a){a.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(a){var b=f.ToNumberArray(a);this.angle=new f.Property("angle",b[0]),this.cx=b[1]||0,this.cy=b[2]||0,this.apply=function(a){a.translate(this.cx,this.cy),a.rotate(this.angle.toRadians()),a.translate(-this.cx,-this.cy)},this.unapply=function(a){a.translate(this.cx,this.cy),a.rotate(-1*this.angle.toRadians()),a.translate(-this.cx,-this.cy)},this.applyToPoint=function(a){var b=this.angle.toRadians();a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]),a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(a){this.p=f.CreatePoint(a),this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(a){a.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(a){this.m=f.ToNumberArray(a),this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(a){var b=this.m[0],c=this.m[2],d=this.m[4],e=this.m[1],f=this.m[3],g=this.m[5],h=1/(b*(1*f-0*g)-c*(1*e-0*g)+d*(0*e-0*f));a.transform(h*(1*f-0*g),h*(0*g-1*e),h*(0*d-1*c),h*(1*b-0*d),h*(c*g-d*f),h*(d*e-b*g))},this.applyToPoint=function(a){a.applyTransform(this.m)}},this.Type.SkewBase=function(a){this.base=b.Type.matrix,this.base(a),this.angle=new f.Property("angle",a)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(a){this.base=b.Type.SkewBase,this.base(a),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(a){this.base=b.Type.SkewBase,this.base(a),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)},this.unapply=function(a){for(var b=this.transforms.length-1;b>=0;b--)this.transforms[b].unapply(a)},this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};for(var c=f.trim(f.compressSpaces(a)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),d=0;d<c.length;d++){var e=f.trim(c[d].split("(")[0]),g=c[d].split("(")[1].replace(")",""),h=this.Type[e];if(void 0!==h){var i=new h(g);i.type=e,this.transforms.push(i)}}},f.AspectRatio=function(a,b,c,d,e,g,h,i,j,k){var l=(b=(b=f.compressSpaces(b)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",m=b.split(" ")[1]||"meet",n=c/d,o=e/g,p=Math.min(n,o),q=Math.max(n,o);"meet"==m&&(d*=p,g*=p),"slice"==m&&(d*=q,g*=q),j=new f.Property("refX",j),k=new f.Property("refY",k),j.hasValue()&&k.hasValue()?a.translate(-p*j.toPixels("x"),-p*k.toPixels("y")):(l.match(/^xMid/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&a.translate(c/2-d/2,0),l.match(/YMid$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&a.translate(0,e/2-g/2),l.match(/^xMax/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&a.translate(c-d,0),l.match(/YMax$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&a.translate(0,e-g)),"none"==l?a.scale(n,o):"meet"==m?a.scale(p,p):"slice"==m&&a.scale(q,q),a.translate(null==h?0:-h,null==i?0:-i)},f.Element={},f.EmptyProperty=new f.Property("EMPTY",""),f.Element.ElementBase=function(a){this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(a,b){var c=this.attributes[a];return null!=c?c:(1==b&&(c=new f.Property(a,""),this.attributes[a]=c),c||f.EmptyProperty)},this.getHrefAttribute=function(){for(var a in this.attributes)if("href"==a||a.match(/:href$/))return this.attributes[a];return f.EmptyProperty},this.style=function(a,b,c){var d=this.styles[a];if(null!=d)return d;var e=this.attribute(a);if(null!=e&&e.hasValue())return this.styles[a]=e,e;if(1!=c){var g=this.parent;if(null!=g){var h=g.style(a);if(null!=h&&h.hasValue())return h}}return 1==b&&(d=new f.Property(a,""),this.styles[a]=d),d||f.EmptyProperty},this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(a.save(),this.style("mask").hasValue()){var b=this.style("mask").getDefinition();null!=b&&b.apply(a,this)}else if(this.style("filter").hasValue()){var c=this.style("filter").getDefinition();null!=c&&c.apply(a,this)}else this.setContext(a),this.renderChildren(a),this.clearContext(a);a.restore()}},this.setContext=function(a){},this.clearContext=function(a){},this.renderChildren=function(a){for(var b=0;b<this.children.length;b++)this.children[b].render(a)},this.addChild=function(a,b){var c=a;b&&(c=f.CreateElement(a)),c.parent=this,"title"!=c.type&&this.children.push(c)},this.addStylesFromStyleDefinition=function(){for(var b in f.Styles)if("@"!=b[0]&&e(a,b)){var c=f.Styles[b],d=f.StylesSpecificity[b];if(null!=c)for(var g in c){var h=this.stylesSpecificity[g];void 0===h&&(h="000"),d>h&&(this.styles[g]=c[g],this.stylesSpecificity[g]=d)}}};var b=new RegExp("^[A-Z-]+$");if(null!=a&&1==a.nodeType){for(h=0;h<a.attributes.length;h++){var c=a.attributes[h],d=function(a){return b.test(a)?a.toLowerCase():a}(c.nodeName);this.attributes[d]=new f.Property(d,c.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue())for(var g=this.attribute("style").value.split(";"),h=0;h<g.length;h++)if(""!=f.trim(g[h])){var i=g[h].split(":"),j=f.trim(i[0]),k=f.trim(i[1]);this.styles[j]=new f.Property(j,k)}for(this.attribute("id").hasValue()&&null==f.Definitions[this.attribute("id").value]&&(f.Definitions[this.attribute("id").value]=this),h=0;h<a.childNodes.length;h++){var l=a.childNodes[h];if(1==l.nodeType&&this.addChild(l,!0),this.captureTextNodes&&(3==l.nodeType||4==l.nodeType)){var m=l.value||l.text||l.textContent||"";""!=f.compressSpaces(m)&&this.addChild(new f.Element.tspan(l),!1)}}}},f.Element.RenderedElementBase=function(a){this.base=f.Element.ElementBase,this.base(a),this.setContext=function(a){if(this.style("fill").isUrlDefinition()?null!=(c=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(a.fillStyle=c):this.style("fill").hasValue()&&("currentColor"==(b=this.style("fill")).value&&(b.value=this.style("color").value),"inherit"!=b.value&&(a.fillStyle="none"==b.value?"rgba(0,0,0,0)":b.value)),this.style("fill-opacity").hasValue()){var b=new f.Property("fill",a.fillStyle);b=b.addOpacity(this.style("fill-opacity")),a.fillStyle=b.value}if(this.style("stroke").isUrlDefinition()){var c=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=c&&(a.strokeStyle=c)}else this.style("stroke").hasValue()&&("currentColor"==(d=this.style("stroke")).value&&(d.value=this.style("color").value),"inherit"!=d.value&&(a.strokeStyle="none"==d.value?"rgba(0,0,0,0)":d.value));if(this.style("stroke-opacity").hasValue()){var d=new f.Property("stroke",a.strokeStyle);d=d.addOpacity(this.style("stroke-opacity")),a.strokeStyle=d.value}if(this.style("stroke-width").hasValue()){var e=this.style("stroke-width").toPixels();a.lineWidth=0==e?.001:e}if(this.style("stroke-linecap").hasValue()&&(a.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(a.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(a.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var g=f.ToNumberArray(this.style("stroke-dasharray").value);void 0!==a.setLineDash?a.setLineDash(g):void 0!==a.webkitLineDash?a.webkitLineDash=g:void 0===a.mozDash||1==g.length&&0==g[0]||(a.mozDash=g);var h=this.style("stroke-dashoffset").numValueOrDefault(1);void 0!==a.lineDashOffset?a.lineDashOffset=h:void 0!==a.webkitLineDashOffset?a.webkitLineDashOffset=h:void 0!==a.mozDashOffset&&(a.mozDashOffset=h)}if(void 0!==a.font&&(a.font=f.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.style("transform",!1,!0).hasValue()&&new f.Transform(this.style("transform",!1,!0).value).apply(a),this.style("clip-path",!1,!0).hasValue()){var i=this.style("clip-path",!1,!0).getDefinition();null!=i&&i.apply(a)}this.style("opacity").hasValue()&&(a.globalAlpha=this.style("opacity").numValue())}},f.Element.RenderedElementBase.prototype=new f.Element.ElementBase,f.Element.PathElementBase=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.path=function(a){return null!=a&&a.beginPath(),new f.BoundingBox},this.renderChildren=function(a){this.path(a),f.Mouse.checkPath(this,a),""!=a.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?a.fill(this.style("fill-rule").value):a.fill()),""!=a.strokeStyle&&a.stroke();var b=this.getMarkers();if(null!=b){if(this.style("marker-start").isUrlDefinition()&&(c=this.style("marker-start").getDefinition()).render(a,b[0][0],b[0][1]),this.style("marker-mid").isUrlDefinition())for(var c=this.style("marker-mid").getDefinition(),d=1;d<b.length-1;d++)c.render(a,b[d][0],b[d][1]);this.style("marker-end").isUrlDefinition()&&(c=this.style("marker-end").getDefinition()).render(a,b[b.length-1][0],b[b.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},f.Element.PathElementBase.prototype=new f.Element.RenderedElementBase,f.Element.svg=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.baseClearContext=this.clearContext,this.clearContext=function(a){this.baseClearContext(a),f.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(a){a.strokeStyle="rgba(0,0,0,0)",a.lineCap="butt",a.lineJoin="miter",a.miterLimit=4,void 0!==a.font&&void 0!==window.getComputedStyle&&(a.font=window.getComputedStyle(a.canvas).getPropertyValue("font")),this.baseSetContext(a),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),a.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var b=f.ViewPort.width(),c=f.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){b=this.attribute("width").toPixels("x"),c=this.attribute("height").toPixels("y");var d=0,e=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(d=-this.attribute("refX").toPixels("x"),e=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(a.beginPath(),a.moveTo(d,e),a.lineTo(b,e),a.lineTo(b,c),a.lineTo(d,c),a.closePath(),a.clip())}if(f.ViewPort.SetCurrent(b,c),this.attribute("viewBox").hasValue()){var g=f.ToNumberArray(this.attribute("viewBox").value),h=g[0],i=g[1];b=g[2],c=g[3],f.AspectRatio(a,this.attribute("preserveAspectRatio").value,f.ViewPort.width(),b,f.ViewPort.height(),c,h,i,this.attribute("refX").value,this.attribute("refY").value),f.ViewPort.RemoveCurrent(),f.ViewPort.SetCurrent(g[2],g[3])}}},f.Element.svg.prototype=new f.Element.RenderedElementBase,f.Element.rect=function(a){this.base=f.Element.PathElementBase,this.base(a),this.path=function(a){var b=this.attribute("x").toPixels("x"),c=this.attribute("y").toPixels("y"),d=this.attribute("width").toPixels("x"),e=this.attribute("height").toPixels("y"),g=this.attribute("rx").toPixels("x"),h=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(h=g),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(g=h),g=Math.min(g,d/2),h=Math.min(h,e/2),null!=a&&(a.beginPath(),a.moveTo(b+g,c),a.lineTo(b+d-g,c),a.quadraticCurveTo(b+d,c,b+d,c+h),a.lineTo(b+d,c+e-h),a.quadraticCurveTo(b+d,c+e,b+d-g,c+e),a.lineTo(b+g,c+e),a.quadraticCurveTo(b,c+e,b,c+e-h),a.lineTo(b,c+h),a.quadraticCurveTo(b,c,b+g,c),a.closePath()),new f.BoundingBox(b,c,b+d,c+e)}},f.Element.rect.prototype=new f.Element.PathElementBase,f.Element.circle=function(a){this.base=f.Element.PathElementBase,this.base(a),this.path=function(a){var b=this.attribute("cx").toPixels("x"),c=this.attribute("cy").toPixels("y"),d=this.attribute("r").toPixels();return null!=a&&(a.beginPath(),a.arc(b,c,d,0,2*Math.PI,!0),a.closePath()),new f.BoundingBox(b-d,c-d,b+d,c+d)}},f.Element.circle.prototype=new f.Element.PathElementBase,f.Element.ellipse=function(a){this.base=f.Element.PathElementBase,this.base(a),this.path=function(a){var b=(Math.sqrt(2)-1)/3*4,c=this.attribute("rx").toPixels("x"),d=this.attribute("ry").toPixels("y"),e=this.attribute("cx").toPixels("x"),g=this.attribute("cy").toPixels("y");return null!=a&&(a.beginPath(),a.moveTo(e,g-d),a.bezierCurveTo(e+b*c,g-d,e+c,g-b*d,e+c,g),a.bezierCurveTo(e+c,g+b*d,e+b*c,g+d,e,g+d),a.bezierCurveTo(e-b*c,g+d,e-c,g+b*d,e-c,g),a.bezierCurveTo(e-c,g-b*d,e-b*c,g-d,e,g-d),a.closePath()),new f.BoundingBox(e-c,g-d,e+c,g+d)}},f.Element.ellipse.prototype=new f.Element.PathElementBase,f.Element.line=function(a){this.base=f.Element.PathElementBase,this.base(a),this.getPoints=function(){return[new f.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new f.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(a){var b=this.getPoints();return null!=a&&(a.beginPath(),a.moveTo(b[0].x,b[0].y),a.lineTo(b[1].x,b[1].y)),new f.BoundingBox(b[0].x,b[0].y,b[1].x,b[1].y)},this.getMarkers=function(){var a=this.getPoints(),b=a[0].angleTo(a[1]);return[[a[0],b],[a[1],b]]}},f.Element.line.prototype=new f.Element.PathElementBase,f.Element.polyline=function(a){this.base=f.Element.PathElementBase,this.base(a),this.points=f.CreatePath(this.attribute("points").value),this.path=function(a){var b=new f.BoundingBox(this.points[0].x,this.points[0].y);null!=a&&(a.beginPath(),a.moveTo(this.points[0].x,this.points[0].y));for(var c=1;c<this.points.length;c++)b.addPoint(this.points[c].x,this.points[c].y),null!=a&&a.lineTo(this.points[c].x,this.points[c].y);return b},this.getMarkers=function(){for(var a=[],b=0;b<this.points.length-1;b++)a.push([this.points[b],this.points[b].angleTo(this.points[b+1])]);return a.length>0&&a.push([this.points[this.points.length-1],a[a.length-1][1]]),a}},f.Element.polyline.prototype=new f.Element.PathElementBase,f.Element.polygon=function(a){this.base=f.Element.polyline,this.base(a),this.basePath=this.path,this.path=function(a){var b=this.basePath(a);return null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath()),b}},f.Element.polygon.prototype=new f.Element.polyline,f.Element.path=function(a){this.base=f.Element.PathElementBase,this.base(a);var b=this.attribute("d").value;for(b=b.replace(/,/gm," "),c=0;c<2;c++)b=b.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");b=(b=b.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2");for(var c=0;c<2;c++)b=b.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");b=b.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),b=f.compressSpaces(b),b=f.trim(b),this.PathParser=new function(a){this.tokens=a.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new f.Point(0,0),this.control=new f.Point(0,0),this.current=new f.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var a=new f.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(a)},this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a,a},this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a,a},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new f.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(a){return this.isRelativeCommand()&&(a.x+=this.current.x,a.y+=this.current.y),a},this.addMarker=function(a,b,c){null!=c&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(c)),this.addMarkerAngle(a,null==b?null:b.angleTo(a))},this.addMarkerAngle=function(a,b){this.points.push(a),this.angles.push(b)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(b),this.path=function(a){var b=this.PathParser;b.reset();var c=new f.BoundingBox;for(null!=a&&a.beginPath();!b.isEnd();)switch(b.nextCommand(),b.command){case"M":case"m":for(e=b.getAsCurrentPoint(),b.addMarker(e),c.addPoint(e.x,e.y),null!=a&&a.moveTo(e.x,e.y),b.start=b.current;!b.isCommandOrEnd();)e=b.getAsCurrentPoint(),b.addMarker(e,b.start),c.addPoint(e.x,e.y),null!=a&&a.lineTo(e.x,e.y);break;case"L":case"l":for(;!b.isCommandOrEnd();){var d=b.current,e=b.getAsCurrentPoint();b.addMarker(e,d),c.addPoint(e.x,e.y),null!=a&&a.lineTo(e.x,e.y)}break;case"H":case"h":for(;!b.isCommandOrEnd();)g=new f.Point((b.isRelativeCommand()?b.current.x:0)+b.getScalar(),b.current.y),b.addMarker(g,b.current),b.current=g,c.addPoint(b.current.x,b.current.y),null!=a&&a.lineTo(b.current.x,b.current.y);break;case"V":case"v":for(;!b.isCommandOrEnd();){var g=new f.Point(b.current.x,(b.isRelativeCommand()?b.current.y:0)+b.getScalar());b.addMarker(g,b.current),b.current=g,c.addPoint(b.current.x,b.current.y),null!=a&&a.lineTo(b.current.x,b.current.y)}break;case"C":case"c":for(;!b.isCommandOrEnd();){var h=b.current,i=b.getPoint(),j=b.getAsControlPoint(),k=b.getAsCurrentPoint();b.addMarker(k,j,i),c.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=a&&a.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"S":case"s":for(;!b.isCommandOrEnd();){var h=b.current,i=b.getReflectedControlPoint(),j=b.getAsControlPoint(),k=b.getAsCurrentPoint();b.addMarker(k,j,i),c.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=a&&a.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"Q":case"q":for(;!b.isCommandOrEnd();){var h=b.current,j=b.getAsControlPoint(),k=b.getAsCurrentPoint();b.addMarker(k,j,j),c.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=a&&a.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"T":case"t":for(;!b.isCommandOrEnd();){var h=b.current,j=b.getReflectedControlPoint();b.control=j,k=b.getAsCurrentPoint(),b.addMarker(k,j,j),c.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=a&&a.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"A":case"a":for(;!b.isCommandOrEnd();){var h=b.current,l=b.getScalar(),m=b.getScalar(),n=b.getScalar()*(Math.PI/180),o=b.getScalar(),p=b.getScalar(),k=b.getAsCurrentPoint(),q=new f.Point(Math.cos(n)*(h.x-k.x)/2+Math.sin(n)*(h.y-k.y)/2,-Math.sin(n)*(h.x-k.x)/2+Math.cos(n)*(h.y-k.y)/2),r=Math.pow(q.x,2)/Math.pow(l,2)+Math.pow(q.y,2)/Math.pow(m,2);r>1&&(l*=Math.sqrt(r),m*=Math.sqrt(r));var s=(o==p?-1:1)*Math.sqrt((Math.pow(l,2)*Math.pow(m,2)-Math.pow(l,2)*Math.pow(q.y,2)-Math.pow(m,2)*Math.pow(q.x,2))/(Math.pow(l,2)*Math.pow(q.y,2)+Math.pow(m,2)*Math.pow(q.x,2)));isNaN(s)&&(s=0);var t=new f.Point(s*l*q.y/m,s*-m*q.x/l),u=new f.Point((h.x+k.x)/2+Math.cos(n)*t.x-Math.sin(n)*t.y,(h.y+k.y)/2+Math.sin(n)*t.x+Math.cos(n)*t.y),v=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))},w=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(v(a)*v(b))},x=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(w(a,b))},y=x([1,0],[(q.x-t.x)/l,(q.y-t.y)/m]),z=[(q.x-t.x)/l,(q.y-t.y)/m],A=[(-q.x-t.x)/l,(-q.y-t.y)/m],B=x(z,A);w(z,A)<=-1&&(B=Math.PI),w(z,A)>=1&&(B=0);var C=1-p?1:-1,D=y+C*(B/2),E=new f.Point(u.x+l*Math.cos(D),u.y+m*Math.sin(D));if(b.addMarkerAngle(E,D-C*Math.PI/2),b.addMarkerAngle(k,D-C*Math.PI),c.addPoint(k.x,k.y),null!=a){var w=l>m?l:m,F=l>m?1:l/m,G=l>m?m/l:1;a.translate(u.x,u.y),a.rotate(n),a.scale(F,G),a.arc(0,0,w,y,y+B,1-p),a.scale(1/F,1/G),a.rotate(-n),a.translate(-u.x,-u.y)}}break;case"Z":case"z":null!=a&&a.closePath(),b.current=b.start}return c},this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],d=0;d<a.length;d++)c.push([a[d],b[d]]);return c}},f.Element.path.prototype=new f.Element.PathElementBase,f.Element.pattern=function(a){this.base=f.Element.ElementBase,this.base(a),this.createPattern=function(a,b){var c=this.attribute("width").toPixels("x",!0),d=this.attribute("height").toPixels("y",!0),e=new f.Element.svg;e.attributes.viewBox=new f.Property("viewBox",this.attribute("viewBox").value),e.attributes.width=new f.Property("width",c+"px"),e.attributes.height=new f.Property("height",d+"px"),e.attributes.transform=new f.Property("transform",this.attribute("patternTransform").value),e.children=this.children;var g=document.createElement("canvas");g.width=c,g.height=d;var h=g.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&h.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var i=-1;i<=1;i++)for(var j=-1;j<=1;j++)h.save(),e.attributes.x=new f.Property("x",i*g.width),e.attributes.y=new f.Property("y",j*g.height),e.render(h),h.restore();return a.createPattern(g,"repeat")}},f.Element.pattern.prototype=new f.Element.ElementBase,f.Element.marker=function(a){this.base=f.Element.ElementBase,this.base(a),this.baseRender=this.render,this.render=function(a,b,c){a.translate(b.x,b.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&a.rotate(c),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&a.scale(a.lineWidth,a.lineWidth),a.save();var d=new f.Element.svg;d.attributes.viewBox=new f.Property("viewBox",this.attribute("viewBox").value),d.attributes.refX=new f.Property("refX",this.attribute("refX").value),d.attributes.refY=new f.Property("refY",this.attribute("refY").value),d.attributes.width=new f.Property("width",this.attribute("markerWidth").value),d.attributes.height=new f.Property("height",this.attribute("markerHeight").value),d.attributes.fill=new f.Property("fill",this.attribute("fill").valueOrDefault("black")),
d.attributes.stroke=new f.Property("stroke",this.attribute("stroke").valueOrDefault("none")),d.children=this.children,d.render(a),a.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&a.scale(1/a.lineWidth,1/a.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&a.rotate(-c),a.translate(-b.x,-b.y)}},f.Element.marker.prototype=new f.Element.ElementBase,f.Element.defs=function(a){this.base=f.Element.ElementBase,this.base(a),this.render=function(a){}},f.Element.defs.prototype=new f.Element.ElementBase,f.Element.GradientBase=function(a){this.base=f.Element.ElementBase,this.base(a),this.stops=[];for(var b=0;b<this.children.length;b++){var c=this.children[b];"stop"==c.type&&this.stops.push(c)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(a){for(var b=0;b<this.attributesToInherit.length;b++){var c=this.attributesToInherit[b];!this.attribute(c).hasValue()&&a.attribute(c).hasValue()&&(this.attribute(c,!0).value=a.attribute(c).value)}},this.createGradient=function(a,b,c){var d=this;this.getHrefAttribute().hasValue()&&(d=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(d));var e=function(a){return c.hasValue()?new f.Property("color",a).addOpacity(c).value:a},g=this.getGradient(a,b);if(null==g)return e(d.stops[d.stops.length-1].color);for(var h=0;h<d.stops.length;h++)g.addColorStop(d.stops[h].offset,e(d.stops[h].color));if(this.attribute("gradientTransform").hasValue()){var i=f.ViewPort.viewPorts[0],j=new f.Element.rect;j.attributes.x=new f.Property("x",-f.MAX_VIRTUAL_PIXELS/3),j.attributes.y=new f.Property("y",-f.MAX_VIRTUAL_PIXELS/3),j.attributes.width=new f.Property("width",f.MAX_VIRTUAL_PIXELS),j.attributes.height=new f.Property("height",f.MAX_VIRTUAL_PIXELS);var k=new f.Element.g;k.attributes.transform=new f.Property("transform",this.attribute("gradientTransform").value),k.children=[j];var l=new f.Element.svg;l.attributes.x=new f.Property("x",0),l.attributes.y=new f.Property("y",0),l.attributes.width=new f.Property("width",i.width),l.attributes.height=new f.Property("height",i.height),l.children=[k];var m=document.createElement("canvas");m.width=i.width,m.height=i.height;var n=m.getContext("2d");return n.fillStyle=g,l.render(n),n.createPattern(m,"no-repeat")}return g}},f.Element.GradientBase.prototype=new f.Element.ElementBase,f.Element.linearGradient=function(a){this.base=f.Element.GradientBase,this.base(a),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(a,b){var c="objectBoundingBox"==this.gradientUnits()?b.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var d="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),e="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),f="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),g="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return d==f&&e==g?null:a.createLinearGradient(d,e,f,g)}},f.Element.linearGradient.prototype=new f.Element.GradientBase,f.Element.radialGradient=function(a){this.base=f.Element.GradientBase,this.base(a),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(a,b){var c=b.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var d="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),e="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),f=d,g=e;this.attribute("fx").hasValue()&&(f="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(g="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var h="objectBoundingBox"==this.gradientUnits()?(c.width()+c.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return a.createRadialGradient(f,g,0,d,e,h)}},f.Element.radialGradient.prototype=new f.Element.GradientBase,f.Element.stop=function(a){this.base=f.Element.ElementBase,this.base(a),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var b=this.style("stop-color",!0);""===b.value&&(b.value="#000"),this.style("stop-opacity").hasValue()&&(b=b.addOpacity(this.style("stop-opacity"))),this.color=b.value},f.Element.stop.prototype=new f.Element.ElementBase,f.Element.AnimateBase=function(a){this.base=f.Element.ElementBase,this.base(a),f.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var a=this.attribute("attributeType").value,b=this.attribute("attributeName").value;return"CSS"==a?this.parent.style(b,!0):this.parent.attribute(b,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(a){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+a;var b=!1;if(this.begin<this.duration){var c=this.calcValue();this.attribute("type").hasValue()&&(c=this.attribute("type").value+"("+c+")"),this.getProperty().value=c,b=!0}return b},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var a={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var b=a.progress*(this.values.value.length-1),c=Math.floor(b),d=Math.ceil(b);a.from=new f.Property("from",parseFloat(this.values.value[c])),a.to=new f.Property("to",parseFloat(this.values.value[d])),a.progress=(b-c)/(d-c)}else a.from=this.from,a.to=this.to;return a}},f.Element.AnimateBase.prototype=new f.Element.ElementBase,f.Element.animate=function(a){this.base=f.Element.AnimateBase,this.base(a),this.calcValue=function(){var a=this.progress();return a.from.numValue()+(a.to.numValue()-a.from.numValue())*a.progress+this.initialUnits}},f.Element.animate.prototype=new f.Element.AnimateBase,f.Element.animateColor=function(b){this.base=f.Element.AnimateBase,this.base(b),this.calcValue=function(){var b=this.progress(),c=new a(b.from.value),d=new a(b.to.value);if(c.ok&&d.ok){var e=c.r+(d.r-c.r)*b.progress,f=c.g+(d.g-c.g)*b.progress,g=c.b+(d.b-c.b)*b.progress;return"rgb("+parseInt(e,10)+","+parseInt(f,10)+","+parseInt(g,10)+")"}return this.attribute("from").value}},f.Element.animateColor.prototype=new f.Element.AnimateBase,f.Element.animateTransform=function(a){this.base=f.Element.AnimateBase,this.base(a),this.calcValue=function(){for(var a=this.progress(),b=f.ToNumberArray(a.from.value),c=f.ToNumberArray(a.to.value),d="",e=0;e<b.length;e++)d+=b[e]+(c[e]-b[e])*a.progress+" ";return d}},f.Element.animateTransform.prototype=new f.Element.animate,f.Element.font=function(a){this.base=f.Element.ElementBase,this.base(a),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var b=0;b<this.children.length;b++){var c=this.children[b];"font-face"==c.type?(this.fontFace=c,c.style("font-family").hasValue()&&(f.Definitions[c.style("font-family").value]=this)):"missing-glyph"==c.type?this.missingGlyph=c:"glyph"==c.type&&(""!=c.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[c.unicode]&&(this.glyphs[c.unicode]=[]),this.glyphs[c.unicode][c.arabicForm]=c):this.glyphs[c.unicode]=c)}},f.Element.font.prototype=new f.Element.ElementBase,f.Element.fontface=function(a){this.base=f.Element.ElementBase,this.base(a),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},f.Element.fontface.prototype=new f.Element.ElementBase,f.Element.missingglyph=function(a){this.base=f.Element.path,this.base(a),this.horizAdvX=0},f.Element.missingglyph.prototype=new f.Element.path,f.Element.glyph=function(a){this.base=f.Element.path,this.base(a),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},f.Element.glyph.prototype=new f.Element.path,f.Element.text=function(a){this.captureTextNodes=!0,this.base=f.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a);var b=this.style("dominant-baseline").toTextBaseline();null==b&&(b=this.style("alignment-baseline").toTextBaseline()),null!=b&&(a.textBaseline=b)},this.getBoundingBox=function(){var a=this.attribute("x").toPixels("x"),b=this.attribute("y").toPixels("y"),c=this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize);return new f.BoundingBox(a,b-c,a+Math.floor(2*c/3)*this.children[0].getText().length,b)},this.renderChildren=function(a){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(a,this,0);for(var b=0;b<this.children.length;b++)this.renderChild(a,this,this,b)},this.getAnchorDelta=function(a,b,c){var d=this.style("text-anchor").valueOrDefault("start");if("start"!=d){for(var e=0,f=c;f<b.children.length;f++){var g=b.children[f];if(f>c&&g.attribute("x").hasValue())break;e+=g.measureTextRecursive(a)}return-1*("end"==d?e:e/2)}return 0},this.renderChild=function(a,b,c,d){var e=c.children[d];e.attribute("x").hasValue()?(e.x=e.attribute("x").toPixels("x")+b.getAnchorDelta(a,c,d),e.attribute("dx").hasValue()&&(e.x+=e.attribute("dx").toPixels("x"))):(e.attribute("dx").hasValue()&&(b.x+=e.attribute("dx").toPixels("x")),e.x=b.x),b.x=e.x+e.measureText(a),e.attribute("y").hasValue()?(e.y=e.attribute("y").toPixels("y"),e.attribute("dy").hasValue()&&(e.y+=e.attribute("dy").toPixels("y"))):(e.attribute("dy").hasValue()&&(b.y+=e.attribute("dy").toPixels("y")),e.y=b.y),b.y=e.y,e.render(a);for(var d=0;d<e.children.length;d++)b.renderChild(a,b,e,d)}},f.Element.text.prototype=new f.Element.RenderedElementBase,f.Element.TextElementBase=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.getGlyph=function(a,b,c){var d=b[c],e=null;if(a.isArabic){var f="isolated";(0==c||" "==b[c-1])&&c<b.length-2&&" "!=b[c+1]&&(f="terminal"),c>0&&" "!=b[c-1]&&c<b.length-2&&" "!=b[c+1]&&(f="medial"),c>0&&" "!=b[c-1]&&(c==b.length-1||" "==b[c+1])&&(f="initial"),void 0!==a.glyphs[d]&&null==(e=a.glyphs[d][f])&&"glyph"==a.glyphs[d].type&&(e=a.glyphs[d])}else e=a.glyphs[d];return null==e&&(e=a.missingGlyph),e},this.renderChildren=function(a){var b=this.parent.style("font-family").getDefinition();if(null==b)""!=a.fillStyle&&a.fillText(f.compressSpaces(this.getText()),this.x,this.y),""!=a.strokeStyle&&a.strokeText(f.compressSpaces(this.getText()),this.x,this.y);else{var c=this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize),d=this.parent.style("font-style").valueOrDefault(f.Font.Parse(f.ctx.font).fontStyle),e=this.getText();b.isRTL&&(e=e.split("").reverse().join(""));for(var g=f.ToNumberArray(this.parent.attribute("dx").value),h=0;h<e.length;h++){var i=this.getGlyph(b,e,h),j=c/b.fontFace.unitsPerEm;a.translate(this.x,this.y),a.scale(j,-j);var k=a.lineWidth;a.lineWidth=a.lineWidth*b.fontFace.unitsPerEm/c,"italic"==d&&a.transform(1,0,.4,1,0,0),i.render(a),"italic"==d&&a.transform(1,0,-.4,1,0,0),a.lineWidth=k,a.scale(1/j,-1/j),a.translate(-this.x,-this.y),this.x+=c*(i.horizAdvX||b.horizAdvX)/b.fontFace.unitsPerEm,void 0===g[h]||isNaN(g[h])||(this.x+=g[h])}}},this.getText=function(){},this.measureTextRecursive=function(a){for(var b=this.measureText(a),c=0;c<this.children.length;c++)b+=this.children[c].measureTextRecursive(a);return b},this.measureText=function(a){var b=this.parent.style("font-family").getDefinition();if(null!=b){var c=this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize),d=0,e=this.getText();b.isRTL&&(e=e.split("").reverse().join(""));for(var g=f.ToNumberArray(this.parent.attribute("dx").value),h=0;h<e.length;h++)d+=(this.getGlyph(b,e,h).horizAdvX||b.horizAdvX)*c/b.fontFace.unitsPerEm,void 0===g[h]||isNaN(g[h])||(d+=g[h]);return d}var i=f.compressSpaces(this.getText());if(!a.measureText)return 10*i.length;a.save(),this.setContext(a);var j=a.measureText(i).width;return a.restore(),j}},f.Element.TextElementBase.prototype=new f.Element.RenderedElementBase,f.Element.tspan=function(a){this.captureTextNodes=!0,this.base=f.Element.TextElementBase,this.base(a),this.text=f.compressSpaces(a.value||a.text||a.textContent||""),this.getText=function(){return this.children.length>0?"":this.text}},f.Element.tspan.prototype=new f.Element.TextElementBase,f.Element.tref=function(a){this.base=f.Element.TextElementBase,this.base(a),this.getText=function(){var a=this.getHrefAttribute().getDefinition();if(null!=a)return a.children[0].getText()}},f.Element.tref.prototype=new f.Element.TextElementBase,f.Element.a=function(a){this.base=f.Element.TextElementBase,this.base(a),this.hasText=a.childNodes.length>0;for(var b=0;b<a.childNodes.length;b++)3!=a.childNodes[b].nodeType&&(this.hasText=!1);this.text=this.hasText?a.childNodes[0].value:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(a){if(this.hasText){this.baseRenderChildren(a);var b=new f.Property("fontSize",f.Font.Parse(f.ctx.font).fontSize);f.Mouse.checkBoundingBox(this,new f.BoundingBox(this.x,this.y-b.toPixels("y"),this.x+this.measureText(a),this.y))}else if(this.children.length>0){var c=new f.Element.g;c.children=this.children,c.parent=this,c.render(a)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){f.ctx.canvas.style.cursor="pointer"}},f.Element.a.prototype=new f.Element.TextElementBase,f.Element.image=function(a){this.base=f.Element.RenderedElementBase,this.base(a);var b=this.getHrefAttribute().value;if(""!=b){var c=b.match(/\.svg$/);if(f.Images.push(this),this.loaded=!1,c)this.img=f.ajax(b),this.loaded=!0;else{this.img=document.createElement("img"),1==f.opts.useCORS&&(this.img.crossOrigin="Anonymous");var d=this;this.img.onload=function(){d.loaded=!0},this.img.onerror=function(){f.log('ERROR: image "'+b+'" not found'),d.loaded=!0},this.img.src=b}this.renderChildren=function(a){var b=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),e=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");0!=e&&0!=g&&(a.save(),c?a.drawSvg(this.img,b,d,e,g):(a.translate(b,d),f.AspectRatio(a,this.attribute("preserveAspectRatio").value,e,this.img.width,g,this.img.height,0,0),a.drawImage(this.img,0,0)),a.restore())},this.getBoundingBox=function(){var a=this.attribute("x").toPixels("x"),b=this.attribute("y").toPixels("y"),c=this.attribute("width").toPixels("x"),d=this.attribute("height").toPixels("y");return new f.BoundingBox(a,b,a+c,b+d)}}},f.Element.image.prototype=new f.Element.RenderedElementBase,f.Element.g=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.getBoundingBox=function(){for(var a=new f.BoundingBox,b=0;b<this.children.length;b++)a.addBoundingBox(this.children[b].getBoundingBox());return a}},f.Element.g.prototype=new f.Element.RenderedElementBase,f.Element.symbol=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.render=function(a){}},f.Element.symbol.prototype=new f.Element.RenderedElementBase,f.Element.style=function(a){this.base=f.Element.ElementBase,this.base(a);for(var b="",d=0;d<a.childNodes.length;d++)b+=a.childNodes[d].data;b=b.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");for(var e=(b=f.compressSpaces(b)).split("}"),d=0;d<e.length;d++)if(""!=f.trim(e[d]))for(var g=e[d].split("{"),h=g[0].split(","),i=g[1].split(";"),j=0;j<h.length;j++){var k=f.trim(h[j]);if(""!=k){for(var l=f.Styles[k]||{},m=0;m<i.length;m++){var n=i[m].indexOf(":"),o=i[m].substr(0,n),p=i[m].substr(n+1,i[m].length-n);null!=o&&null!=p&&(l[f.trim(o)]=new f.Property(f.trim(o),f.trim(p)))}if(f.Styles[k]=l,f.StylesSpecificity[k]=c(k),"@font-face"==k)for(var q=l["font-family"].value.replace(/"/g,""),r=l.src.value.split(","),s=0;s<r.length;s++)if(r[s].indexOf('format("svg")')>0)for(var t=r[s].indexOf("url"),u=r[s].indexOf(")",t),v=r[s].substr(t+5,u-t-6),w=f.parseXml(f.ajax(v)).getElementsByTagName("font"),x=0;x<w.length;x++){var y=f.CreateElement(w[x]);f.Definitions[q]=y}}}},f.Element.style.prototype=new f.Element.ElementBase,f.Element.use=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a),this.attribute("x").hasValue()&&a.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").toPixels("y"))};var b=this.getHrefAttribute().getDefinition();this.path=function(a){null!=b&&b.path(a)},this.getBoundingBox=function(){if(null!=b)return b.getBoundingBox()},this.renderChildren=function(a){if(null!=b){var c=b;"symbol"==b.type&&((c=new f.Element.svg).type="svg",c.attributes.viewBox=new f.Property("viewBox",b.attribute("viewBox").value),c.attributes.preserveAspectRatio=new f.Property("preserveAspectRatio",b.attribute("preserveAspectRatio").value),c.attributes.overflow=new f.Property("overflow",b.attribute("overflow").value),c.children=b.children),"svg"==c.type&&(this.attribute("width").hasValue()&&(c.attributes.width=new f.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(c.attributes.height=new f.Property("height",this.attribute("height").value)));var d=c.parent;c.parent=null,c.render(a),c.parent=d}}},f.Element.use.prototype=new f.Element.RenderedElementBase,f.Element.mask=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b){var c=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),e=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");if(0==e&&0==g){for(var h=new f.BoundingBox,i=0;i<this.children.length;i++)h.addBoundingBox(this.children[i].getBoundingBox());var c=Math.floor(h.x1),d=Math.floor(h.y1),e=Math.floor(h.width()),g=Math.floor(h.height())}var j=b.attribute("mask").value;b.attribute("mask").value="";var k=document.createElement("canvas");k.width=c+e,k.height=d+g;var l=k.getContext("2d");this.renderChildren(l);var m=document.createElement("canvas");m.width=c+e,m.height=d+g;var n=m.getContext("2d");b.render(n),n.globalCompositeOperation="destination-in",n.fillStyle=l.createPattern(k,"no-repeat"),n.fillRect(0,0,c+e,d+g),a.fillStyle=n.createPattern(m,"no-repeat"),a.fillRect(0,0,c+e,d+g),b.attribute("mask").value=j},this.render=function(a){}},f.Element.mask.prototype=new f.Element.ElementBase,f.Element.clipPath=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a){var b=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var c=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){},b.call(a);for(var d=0;d<this.children.length;d++){var e=this.children[d];if(void 0!==e.path){var g=null;e.style("transform",!1,!0).hasValue()&&(g=new f.Transform(e.style("transform",!1,!0).value)).apply(a),e.path(a),CanvasRenderingContext2D.prototype.closePath=c,g&&g.unapply(a)}}c.call(a),a.clip(),CanvasRenderingContext2D.prototype.beginPath=b,CanvasRenderingContext2D.prototype.closePath=c},this.render=function(a){}},f.Element.clipPath.prototype=new f.Element.ElementBase,f.Element.filter=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b){var c=b.getBoundingBox(),d=Math.floor(c.x1),e=Math.floor(c.y1),f=Math.floor(c.width()),g=Math.floor(c.height()),h=b.style("filter").value;b.style("filter").value="";for(var i=0,j=0,k=0;k<this.children.length;k++){var l=this.children[k].extraFilterDistance||0;i=Math.max(i,l),j=Math.max(j,l)}var m=document.createElement("canvas");m.width=f+2*i,m.height=g+2*j;var n=m.getContext("2d");for(n.translate(-d+i,-e+j),b.render(n),k=0;k<this.children.length;k++)"function"==typeof this.children[k].apply&&this.children[k].apply(n,0,0,f+2*i,g+2*j);a.drawImage(m,0,0,f+2*i,g+2*j,d-i,e-j,f+2*i,g+2*j),b.style("filter",!0).value=h},this.render=function(a){}},f.Element.filter.prototype=new f.Element.ElementBase,f.Element.feMorphology=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b,c,d,e){}},f.Element.feMorphology.prototype=new f.Element.ElementBase,f.Element.feComposite=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b,c,d,e){}},f.Element.feComposite.prototype=new f.Element.ElementBase,f.Element.feColorMatrix=function(a){function b(a,b,c,d,e,f){return a[c*d*4+4*b+f]}function c(a,b,c,d,e,f,g){a[c*d*4+4*b+f]=g}function d(a,b){var c=e[a];return c*(c<0?b-255:b)}this.base=f.Element.ElementBase,this.base(a);var e=f.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var g=e[0];e=[.213+.787*g,.715-.715*g,.072-.072*g,0,0,.213-.213*g,.715+.285*g,.072-.072*g,0,0,.213-.213*g,.715-.715*g,.072+.928*g,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var h=e[0]*Math.PI/180,i=function(a,b,c){return a+Math.cos(h)*b+Math.sin(h)*c};e=[i(.213,.787,-.213),i(.715,-.715,-.715),i(.072,-.072,.928),0,0,i(.213,-.213,.143),i(.715,.285,.14),i(.072,-.072,-.283),0,0,i(.213,-.213,-.787),i(.715,-.715,.715),i(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.apply=function(a,e,f,g,h){for(var i=a.getImageData(0,0,g,h),f=0;f<h;f++)for(var e=0;e<g;e++){var j=b(i.data,e,f,g,h,0),k=b(i.data,e,f,g,h,1),l=b(i.data,e,f,g,h,2),m=b(i.data,e,f,g,h,3);c(i.data,e,f,g,h,0,d(0,j)+d(1,k)+d(2,l)+d(3,m)+d(4,1)),c(i.data,e,f,g,h,1,d(5,j)+d(6,k)+d(7,l)+d(8,m)+d(9,1)),c(i.data,e,f,g,h,2,d(10,j)+d(11,k)+d(12,l)+d(13,m)+d(14,1)),c(i.data,e,f,g,h,3,d(15,j)+d(16,k)+d(17,l)+d(18,m)+d(19,1))}a.clearRect(0,0,g,h),a.putImageData(i,0,0)}},f.Element.feColorMatrix.prototype=new f.Element.ElementBase,f.Element.feGaussianBlur=function(a){this.base=f.Element.ElementBase,this.base(a),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(a,c,d,e,g){void 0!==b.canvasRGBA?(a.canvas.id=f.UniqueId(),a.canvas.style.display="none",document.body.appendChild(a.canvas),b.canvasRGBA(a.canvas.id,c,d,e,g,this.blurRadius),document.body.removeChild(a.canvas)):f.log("ERROR: StackBlur.js must be included for blur to work")}},f.Element.feGaussianBlur.prototype=new f.Element.ElementBase,f.Element.title=function(a){},f.Element.title.prototype=new f.Element.ElementBase,f.Element.desc=function(a){},f.Element.desc.prototype=new f.Element.ElementBase,f.Element.MISSING=function(a){f.log("ERROR: Element '"+a.nodeName+"' not yet implemented.")},f.Element.MISSING.prototype=new f.Element.ElementBase,f.CreateElement=function(a){var b=a.nodeName.replace(/^[^:]+:/,"");b=b.replace(/\-/g,"");var c=null;return c=void 0!==f.Element[b]?new f.Element[b](a):new f.Element.MISSING(a),c.type=a.nodeName,c},f.load=function(a,b){f.loadXml(a,f.ajax(b))},f.loadXml=function(a,b){f.loadXmlDoc(a,f.parseXml(b))},f.loadXmlDoc=function(a,b){f.init(a);var c=function(b){for(var c=a.canvas;c;)b.x-=c.offsetLeft,b.y-=c.offsetTop,c=c.offsetParent;return window.scrollX&&(b.x+=window.scrollX),window.scrollY&&(b.y+=window.scrollY),b};1!=f.opts.ignoreMouse&&(a.canvas.onclick=function(a){var b=c(new f.Point(null!=a?a.clientX:event.clientX,null!=a?a.clientY:event.clientY));f.Mouse.onclick(b.x,b.y)},a.canvas.onmousemove=function(a){var b=c(new f.Point(null!=a?a.clientX:event.clientX,null!=a?a.clientY:event.clientY));f.Mouse.onmousemove(b.x,b.y)});var d=f.CreateElement(b.documentElement);d.root=!0,d.addStylesFromStyleDefinition();var e=!0,g=function(){f.ViewPort.Clear(),a.canvas.parentNode&&f.ViewPort.SetCurrent(a.canvas.parentNode.clientWidth,a.canvas.parentNode.clientHeight),1!=f.opts.ignoreDimensions&&(d.style("width").hasValue()&&(a.canvas.width=d.style("width").toPixels("x"),a.canvas.style.width=a.canvas.width+"px"),d.style("height").hasValue()&&(a.canvas.height=d.style("height").toPixels("y"),a.canvas.style.height=a.canvas.height+"px"));var c=a.canvas.clientWidth||a.canvas.width,g=a.canvas.clientHeight||a.canvas.height;if(1==f.opts.ignoreDimensions&&d.style("width").hasValue()&&d.style("height").hasValue()&&(c=d.style("width").toPixels("x"),g=d.style("height").toPixels("y")),f.ViewPort.SetCurrent(c,g),null!=f.opts.offsetX&&(d.attribute("x",!0).value=f.opts.offsetX),null!=f.opts.offsetY&&(d.attribute("y",!0).value=f.opts.offsetY),null!=f.opts.scaleWidth||null!=f.opts.scaleHeight){var h=null,i=null,j=f.ToNumberArray(d.attribute("viewBox").value);null!=f.opts.scaleWidth&&(d.attribute("width").hasValue()?h=d.attribute("width").toPixels("x")/f.opts.scaleWidth:isNaN(j[2])||(h=j[2]/f.opts.scaleWidth)),null!=f.opts.scaleHeight&&(d.attribute("height").hasValue()?i=d.attribute("height").toPixels("y")/f.opts.scaleHeight:isNaN(j[3])||(i=j[3]/f.opts.scaleHeight)),null==h&&(h=i),null==i&&(i=h),d.attribute("width",!0).value=f.opts.scaleWidth,d.attribute("height",!0).value=f.opts.scaleHeight,d.style("transform",!0,!0).value+=" scale("+1/h+","+1/i+")"}1!=f.opts.ignoreClear&&a.clearRect(0,0,c,g),d.render(a),e&&(e=!1,"function"==typeof f.opts.renderCallback&&f.opts.renderCallback(b))},h=!0;f.ImagesLoaded()&&(h=!1,g()),f.intervalID=setInterval(function(){var a=!1;if(h&&f.ImagesLoaded()&&(h=!1,a=!0),1!=f.opts.ignoreMouse&&(a|=f.Mouse.hasEvents()),1!=f.opts.ignoreAnimation)for(var b=0;b<f.Animations.length;b++)a|=f.Animations[b].update(1e3/f.FRAMERATE);"function"==typeof f.opts.forceRedraw&&1==f.opts.forceRedraw()&&(a=!0),a&&(g(),f.Mouse.runEvents())},1e3/f.FRAMERATE)},f.stop=function(){f.intervalID&&clearInterval(f.intervalID)},f.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(a,b){this.events.push({type:"onclick",x:a,y:b,run:function(a){a.onclick&&a.onclick()}})},this.onmousemove=function(a,b){this.events.push({type:"onmousemove",x:a,y:b,run:function(a){a.onmousemove&&a.onmousemove()}})},this.eventElements=[],this.checkPath=function(a,b){for(var c=0;c<this.events.length;c++){var d=this.events[c];b.isPointInPath&&b.isPointInPath(d.x,d.y)&&(this.eventElements[c]=a)}},this.checkBoundingBox=function(a,b){for(var c=0;c<this.events.length;c++){var d=this.events[c];b.isPointInBox(d.x,d.y)&&(this.eventElements[c]=a)}},this.runEvents=function(){f.ctx.canvas.style.cursor="";for(var a=0;a<this.events.length;a++)for(var b=this.events[a],c=this.eventElements[a];c;)b.run(c),c=c.parent;this.events=[],this.eventElements=[]}},f}var e,f=function(a,b,c){if(null!=a||null!=b||null!=c){"string"==typeof a&&(a=document.getElementById(a)),null!=a.svg&&a.svg.stop();var e=d(c||{});1==a.childNodes.length&&"OBJECT"==a.childNodes[0].nodeName||(a.svg=e);var g=a.getContext("2d");void 0!==b.documentElement?e.loadXmlDoc(g,b):"<"==b.substr(0,1)?e.loadXml(g,b):e.load(g,b)}else for(var h=document.querySelectorAll("svg"),i=0;i<h.length;i++){var j=h[i],k=document.createElement("canvas");k.width=j.clientWidth,k.height=j.clientHeight,j.parentNode.insertBefore(k,j),j.parentNode.removeChild(j);var l=document.createElement("div");l.appendChild(j),f(k,l.innerHTML)}};void 0!==Element.prototype.matches?e=function(a,b){return a.matches(b)}:void 0!==Element.prototype.webkitMatchesSelector?e=function(a,b){return a.webkitMatchesSelector(b)}:void 0!==Element.prototype.mozMatchesSelector?e=function(a,b){return a.mozMatchesSelector(b)}:void 0!==Element.prototype.msMatchesSelector?e=function(a,b){return a.msMatchesSelector(b)}:void 0!==Element.prototype.oMatchesSelector?e=function(a,b){return a.oMatchesSelector(b)}:("function"!=typeof jQuery&&"function"!=typeof Zepto||(e=function(a,b){return $(a).is(b)}),void 0===e&&(e=Sizzle.matchesSelector));var g=/(\[[^\]]+\])/g,h=/(#[^\s\+>~\.\[:]+)/g,j=/(\.[^\s\+>~\.\[:]+)/g,k=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,l=/(:[\w-]+\([^\)]*\))/gi,m=/(:[^\s\+>~\.\[:]+)/g,n=/([^\s\+>~\.\[:]+)/g;return"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(a,b,c,d,e,g){var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:b,offsetY:c,scaleWidth:d,scaleHeight:e};for(var i in g)g.hasOwnProperty(i)&&(h[i]=g[i]);f(this.canvas,a,h)}),f}),function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils"),b=Autodesk.Viewing,c=Autodesk.Viewing.Private;a.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS=5,a.MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS=12,a.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS=15,a.isTouchDevice=function(){return!(!b.isTouchDevice||"function"!=typeof Hammer)&&b.isTouchDevice()},a.createSvgElement=function(a){return document.createElementNS("http://www.w3.org/2000/svg",a)},a.setSvgParentAttributes=function(a){return a.setAttribute("version","1.1"),a.setAttribute("baseProfile","full"),a},a.createMarkupGroupSvg=function(b){b=b||[];var c=a.createSvgElement("g");c.setAttribute("cursor","default"),c.setAttribute("pointer-events","none");for(var d=0;d<b.length;d++)c.appendChild(b[d]);return c},a.createMarkupPathSvg=function(){var b=a.createSvgElement("g");b.setAttribute("cursor","inherit"),b.setAttribute("pointer-events","none");var c=a.createSvgElement("path");c.setAttribute("id","markup");var d=a.createSvgElement("path");return d.setAttribute("id","hitarea"),d.setAttribute("fill","transparent"),d.setAttribute("stroke","transparent"),b.markup=c,b.hitarea=d,b.appendChild(c),b.appendChild(d),b},a.setAttributeToMarkupSvg=function(a,b,c){a.markup.setAttribute(b,c)},a.updateMarkupPathSvgHitarea=function(b,c){var d=b.markup,e=b.hitarea,f=c.sizeFromClientToMarkups(0,a.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;f+=parseFloat(d.getAttribute("stroke-width"))+f;var g=d.getAttribute("fill"),h=d.getAttribute("stroke"),i=""!==h&&"none"!==h,j=""!==g&&"none"!==g;if(e.setAttribute("d",d.getAttribute("d")),e.setAttribute("stroke-width",f),
e.setAttribute("transform",d.getAttribute("transform")),c.duringEditMode&&!c.navigating){if(i&&j)return void b.setAttribute("pointer-events","painted");if(i)return void b.setAttribute("pointer-events","stroke");if(j)return void b.setAttribute("pointer-events","fill")}b.setAttribute("pointer-events","none")},a.createMarkupTextSvg=function(){var b=a.createSvgElement("g");b.setAttribute("cursor","default");var c="markup-clipper-"+a.getUniqueID(),d="url(#"+c+")",e=a.createSvgElement("clipPath");e.setAttribute("id",c),e.removeAttribute("pointer-events"),e.rect=a.createSvgElement("rect"),e.appendChild(e.rect);var f=a.createSvgElement("rect");f.setAttribute("id","markup-background"),f.removeAttribute("pointer-events");var g=a.createSvgElement("text");g.setAttribute("id","markup");var h=a.createSvgElement("rect");h.setAttribute("id","hitarea"),h.setAttribute("fill","transparent"),h.setAttribute("stroke","none"),h.setAttribute("stroke-width","0");var i=a.createSvgElement("g");return i.setAttribute("clip-path",d),i.appendChild(e),i.appendChild(f),i.appendChild(g),b.appendChild(i),b.appendChild(h),b.clipper=e,b.background=f,b.markup=g,b.hitarea=h,b},a.setMarkupTextSvgTransform=function(a,b,c){a.clipper.rect.setAttribute("transform",b),a.background.setAttribute("transform",b),a.markup.setAttribute("transform",c),a.hitarea.setAttribute("transform",b)},a.updateMarkupTextSvgHitarea=function(b,c,d,e){var f=b.hitarea,g=e.sizeFromClientToMarkups(0,a.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;f.setAttribute("x",-g),f.setAttribute("y",-g),f.setAttribute("width",c+2*g),f.setAttribute("height",d+2*g),b.setAttribute("pointer-events",e.navigating?"none":"painted")},a.updateMarkupTextSvgBackground=function(a,b,c,d){var e=a.background;e.setAttribute("x",0),e.setAttribute("y",0),e.setAttribute("width",b),e.setAttribute("height",c),e.setAttribute("fill",d)},a.updateMarkupTextSvgClipper=function(a,b,c){var d=a.clipper;d.rect.setAttribute("x",0),d.rect.setAttribute("y",0),d.rect.setAttribute("width",b),d.rect.setAttribute("height",c)},a.addSvgMetadata=function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","metadata"),d=document.createElement("markup_document");return c.appendChild(d),d.setAttribute("data-model-version",b["data-model-version"]),a.insertBefore(c,a.firstChild),c},a.addMarkupMetadata=function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","metadata"),d=document.createElement("markup_element");c.appendChild(d);for(var e in b)b.hasOwnProperty(e)&&d.setAttribute(e,b[e]);return a.insertBefore(c,a.firstChild),c},a.removeAllMetadata=function(a){if(a.getElementsByTagName)for(var b=a.getElementsByTagName("metadata"),c=0;c<b.length;++c){var d=b[c];d.parentNode&&d.parentNode.removeChild(d)}var e=a.children||a.childNodes;if(e)for(c=0;c<e.length;++c)this.removeAllMetadata(e[c])},a.transferChildNodes=function(a,b){for(var c=a.children||a.childNodes,d=[],e=0;e<c.length;++e)d.push(c[e]);d.forEach(function(a){b.appendChild(a)})},a.getUniqueID=function(){return THREE.Math.generateUUID()},a.getClipPathId=function(){for(var a=document.getElementsByTagName("clipPath"),b=a.length,c=0,d=0;d<b;++d){var e=a[d].id;-1!==e.indexOf("markup-clipper-")&&(e=e.replace("markup-clipper-",""),c=Math.max(c,e))}return c+1},a.svgNodeToString=function(a){function b(a,c){var d=a.hitarea,e=d&&d.parentNode;e&&(c.push({hitarea:d,parent:e}),e.removeChild(d));for(var f=a.childNodes,g=f.length,h=0;h<g;++h)b(f.item(h),c)}var c;try{var d=[];b(a,d);var e=new XMLSerializer;c=e.serializeToString(a),function(a){for(var b=a.length,c=0;c<b;++c){var d=a[c];d.parent.appendChild(d.hitarea)}}(d)}catch(a){c="",console.warn("svgNodeToString failed to generate string representation of domNode.")}return c},a.stringToSvgNode=function(a){var b=null;try{var c=new DOMParser,d=c.parseFromString(a,"text/xml");b=d.firstChild}catch(a){b=null,console.warn("stringToSvgNode failed to generate an HTMLElement from its string representation.")}return b},a.addTraitEventDispatcher=function(a){a.listeners={},a.addEventListener=function(a,b){void 0===this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b)},a.hasEventListener=function(a,b){if(void 0===this.listeners)return!1;var c=this.listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},a.removeEventListener=function(a,b){if(this.listeners[a]instanceof Array)for(var c=this.listeners[a],d=0,e=c.length;d<e;d++)if(c[d]===b){c.splice(d,1);break}},a.dispatchEvent=function(a){if("string"==typeof a&&(a={type:a}),a.target||(a.target=this),!a.type)throw new Error("event type unknown.");if(this.listeners[a.type]instanceof Array)for(var b=this.listeners[a.type].slice(),c=0;c<b.length;c++)b[c].call(this,a)}},a.removeTraitEventDispatcher=function(a){try{delete a.listeners,delete a.addEventListener,delete a.hasEventListener,delete a.removeEventListener,delete a.dispatchEvent}catch(a){}},a.worldToClient=function(b,c,d){var e=a.worldToViewport(b,c),f=a.viewportToClient(e.x,e.y,c);return f.z=0,d&&(f.x=Math.floor(f.x)+.5,f.y=Math.floor(f.y)+.5),f},a.clientToWorld=function(b,c,d,e){var f=a.clientToViewport(b,c,e);return f.z=d,f.unproject(e.impl.camera),f},a.clientToViewport=function(a,b,c){return c.impl.clientToViewport(a,b)},a.viewportToClient=function(a,b,c){return c.impl.viewportToClient(a,b)},a.worldToViewport=function(a,b){var c=new THREE.Vector3;return c.x=a.x,c.y=a.y,c.z=a.z,c.project(b.impl.camera),c},a.metersToModel=function(a,b){return 1/b.model.getUnitScale()*a},a.radiansToDegrees=function(a){return a*(180/Math.PI)},a.degreesToRadians=function(a){return a*(Math.PI/180)},a.sign=function(a){return a>=0?1:-1},a.areMarkupsPointsInClientRange=function(a,b,c,d){c=d.sizeFromClientToMarkups(0,c).y;var e=a.x-b.x,f=a.y-b.y;return c*c>=e*e+f*f},a.hideLmvUi=function(b){b.toolbar&&(b.setActiveNavigationTool(),a.dismissLmvHudMessage(),a.hideLmvPanels(!0,b),a.hideLmvToolsAndPanels(b))},a.restoreLmvUi=function(b){b.toolbar&&(a.dismissLmvHudMessage(),a.hideLmvPanels(!1,b),a.showLmvToolsAndPanels(b))},a.hideLmvPanels=function(a,b){var c=b.dockingPanels;if(c)for(var d=0;d<c.length;++d){var e=c[d],f=e.container;f.classList.contains("dockingPanelVisible")&&(f.style.display=a?"none":"block",e.visibilityChanged())}},a.showLmvToolsAndPanels=function(a){a&&a.model&&!a.model.is2d()&&a.displayViewCube(!0,!1);var b=document.getElementsByClassName("homeViewWrapper"),c=document.getElementsByClassName("infoButton"),d=document.getElementsByClassName("toolbar-animationSubtoolbar");if(b.length>0&&(b[0].style.display=""),c.length>0&&(c[0].style.display=""),d.length>0&&(d[0].style.display=""),a.toolbar)for(var e=a.toolbar.container,f=e.children.length,g=0;g<f;++g)e.children[g].style.display=""},a.hideLmvToolsAndPanels=function(a){a&&a.model&&!a.model.is2d()&&a.displayViewCube(!1,!1);var b=document.getElementsByClassName("homeViewWrapper"),c=document.getElementsByClassName("infoButton"),d=document.getElementsByClassName("toolbar-animationSubtoolbar");if(b.length>0&&(b[0].style.display="none"),c.length>0&&(c[0].style.display="none"),d.length>0){d[0].style.display="none";var e=a.impl.keyFrameAnimator;if(e&&!e.isPaused){e.pauseCameraAnimations(),e.pause();var f=a.modelTools.getControl("toolbar-animationPlay");f&&(f.setIcon("toolbar-animationPauseIcon"),f.setToolTip("Pause"))}}if(a.toolbar)for(var g=a.toolbar.container,h=g.children.length,i=0;i<h;++i)g.children[i].style.display="none"},a.dismissLmvHudMessage=function(){try{for(var a=!0;a;)a=Autodesk.Viewing.Private.HudMessage.dismiss()}catch(a){console.warn("[CO2]Failed to dismiss LMV HudMessage")}},a.createStyle=function(b,c){for(var d={},e=0;e<b.length;++e)d[b[e]]=null;for(var f=a.getStyleDefaultValues(d,c),e=0;e<b.length;++e){var g=b[e];d[g]=f[g].values[f[g].default].value}return d},a.copyStyle=function(a,b){for(var c in b)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},a.cloneStyle=function(a){var b={};for(var c in a)b[c]=a[c];return b},a.getStrokeWidth=function(a,b){return b.sizeFromClientToMarkups(0,a).y},a.createMarkupFromSVG=function(a,b){var d=a.childNodes[0].childNodes[0]||"",e=function(){var b=a.childNodes[1]||"",c=!1;if("string"!=typeof b){var d=b.getAttribute("d").split(" ");"z"===d[d.length-1].toLowerCase()&&(c=!0)}return c},f=function(){for(var a=[],b=d.getAttribute("locations").split(" ")||"",c=0;c<b.length;c+=2){var e={x:parseFloat(b[c]),y:parseFloat(b[c+1])};a.push(e)}return a},g=function(a){var b=new THREE.Vector3,c=d.getAttribute(a)||d.getAttribute(a.toLowerCase()),e=c.split(" ");return b.x=parseFloat(e[0]),b.y=parseFloat(e[1]),b},h=function(){return g("position")},i=function(){return g("size")},j=function(){var a=d.getAttribute("rotation")||"";return parseFloat(a)},k=function(){return d.getAttribute("text")||""};if("string"!=typeof d){var l,m,n,o,p,q,r,s,t,u,v,w=Autodesk.Viewing.Extensions.Markups.Core,x=b.getId(),y=function(a,b){for(var d=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-size","font-style","font-weight","stroke-linejoin"],e={},f=0;f<d.length;f++){var g=b.getAttribute(d[f]);if(null!=g)switch(d[f]){case"font-size":case"stroke-width":case"stroke-opacity":case"fill-opacity":e[d[f]]=parseFloat(g);break;case"stroke-linejoin":break;case"font-family":case"font-style":case"font-weight":case"stroke-color":case"fill-color":e[d[f]]=g;break;default:c.logger.warn("Style not recognized.")}}return e}(0,d),z=d.getAttribute("type")||"",A=null;switch(z){case w.MARKUP_TYPE_ARROW:p=g("tail"),q=g("head"),v=new w.CreateArrow(b,x,p,q,y);break;case w.MARKUP_TYPE_RECTANGLE:l=h(),m=i(),n=j(),v=new w.CreateRectangle(b,x,l,m,n,y);break;case w.MARKUP_TYPE_TEXT:l=h(),m=i(),s=k(),v=new w.CreateText(b,x,l,m,s,y);break;case w.MARKUP_TYPE_CALLOUT:l=h(),m=i(),s=k();var B=function(){return!!parseInt(d.getAttribute("isframeused"))}();v=new w.CreateCallout(b,x,l,m,s,y,B);break;case w.MARKUP_TYPE_CIRCLE:l=h(),m=i(),n=j(),v=new w.CreateCircle(b,x,l,m,n,y);break;case w.MARKUP_TYPE_CLOUD:l=h(),m=i(),n=j(),v=new w.CreateCloud(b,x,l,m,n,y);break;case w.MARKUP_TYPE_FREEHAND:l=h(),m=i(),n=j(),o=f(),v=new w.CreateFreehand(b,x,l,m,n,o,y);break;case w.MARKUP_TYPE_POLYLINE:l=h(),m=i(),n=j(),o=f(),r=e(),v=new w.CreatePolyline(b,x,l,m,n,o,y,r);break;case w.MARKUP_TYPE_POLYCLOUD:l=h(),m=i(),n=j(),o=f(),r=e(),v=new w.CreatePolycloud(b,x,l,m,n,o,y,r);break;case w.MARKUP_TYPE_HIGHLIGHT:l=h(),m=i(),n=j(),o=f(),v=new w.CreateHighlight(b,x,l,m,n,o,y);break;case w.MARKUP_TYPE_DIMENSION:t=g("firstAnchor"),u=g("secondAnchor"),s=k(),v=new w.CreateDimension(b,x,t,u,s,y);break;default:v=null}return v&&(v.addToHistory=!1,v.execute(),A=b.getMarkup(x)),A}},a.getStyleDefaultValues=function(b,c){function d(a){return{values:[{name:"100%",value:1},{name:"75%",value:.75},{name:"50%",value:.5},{name:"25%",value:.25},{name:"0%",value:0}],default:a?4:0}}var e=a.cloneStyle(b),f=a.getStrokeWidth(a.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS,c),g=a.getStrokeWidth(a.MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS,c);for(var h in e)switch(h){case"stroke-width":e[h]=function(a){return{values:[{name:"Thin",value:a/2},{name:"Normal",value:a},{name:"Thick",value:2*a},{name:"Very Thick",value:4*a}],default:1}}(f);break;case"stroke-linejoin":e[h]=function(){return{values:[{name:"Miter",value:"miter"},{name:"Round",value:"round"},{name:"Bevel",value:"bevel"}],default:0}}();break;case"font-size":e[h]=function(a){return{values:[{name:"Thin",value:a/2},{name:"Normal",value:a},{name:"Thick",value:2*a}],default:1}}(g);break;case"font-family":e[h]=function(){return{values:[{name:"Arial",value:"Arial"},{name:"Arial Black",value:"Arial Black"},{name:"Arial Narrow",value:"Arial Narrow"},{name:"Century Gothic",value:"Century Gothic"},{name:"Courier New",value:"Courier New"},{name:"Georgia",value:"Georgia"},{name:"Impact",value:"Impact"},{name:"Lucida Console",value:"Lucida Console"},{name:"Tahoma",value:"Tahoma"},{name:"Verdana",value:"Verdana"}],default:0}}();break;case"font-style":e[h]=function(){return{values:[{name:"Normal",value:"normal"},{name:"Italic",value:"italic"}],default:0}}();break;case"font-weight":e[h]=function(){return{values:[{name:"Normal",value:"normal"},{name:"Bold",value:"bold"}],default:0}}();break;case"stroke-color":case"fill-color":e[h]=function(){return{values:[{name:"red",value:"#ff0000"},{name:"green",value:"#00ff00"},{name:"blue",value:"#0000ff"},{name:"white",value:"#ffffff"},{name:"black",value:"#000000"},{name:"yellow",value:"#ffff00"}],default:0}}();break;case"stroke-opacity":var i=!1;e[h]=d(i);break;case"fill-opacity":var i=!0;e[h]=d(i)}return e},a.composeRGBAString=function(a,b){return!a||!b||b<=0?"none":["rgba("+parseInt("0x"+a.substr(1,2)),",",parseInt("0x"+a.substr(3,2)),",",parseInt("0x"+a.substr(5,2)),",",b,")"].join("")},a.checkLineSegment=function(a,b,c,d,e){function f(a,b){a=Math.round(a),b=Math.round(b);for(var c=0,d=0,e=-h;e<=h;e+=2*h)d+=g(a,b+e)?e:0;for(var f=-h;f<=h;f+=2*h)c+=g(a+f,b)?f:0;return{x:Math.round(a/h+c),y:Math.round((j-b)/h-d)}}function g(a,b){if(a<0||a>=i||b<0||b>=j)return!1;var c=4*(b*i+a);return 255!==k[c]||255!==k[c+1]||255!==k[c+2]}var h=window.devicePixelRatio||1;a*=h,b*=h,c*=h,d*=h;var i=e.width,j=e.height,k=e.buffer;a=Math.round(a),c=Math.round(c),b=Math.round(j-b),d=Math.round(j-d);var l=c-a,m=d-b,n=0!==l?m/l:1,o=a,p=b;if(0!==l&&Math.abs(n)<=1){if(a<=c){for(;o<=c;++o,p+=n)if(g(o,Math.round(p)))return f(o,p)}else for(;o>=c;--o,p-=n)if(g(o,Math.round(p)))return f(o,p)}else if(n=0!==l?1/n:0,b<=d){for(;p<=d;++p,o+=n)if(g(Math.round(o),p))return f(o,p)}else for(;p>=d;--p,o-=n)if(g(Math.round(o),p))return f(o,p)},a.checkPolygon=function(a,b){function c(a,b){for(var c=0,e=0,g=-f;g<=f;g+=2*f)e+=d(a,b+g)?g:0;for(var i=-f;i<=f;i+=2*f)c+=d(a+i,b)?i:0;return{x:Math.round(a/f)+c,y:Math.round((h-b)/f-e)}}function d(a,b){if(a<0||a>=g||b<0||b>=h)return!1;var c=4*(b*g+a);return(255!==i[c]||255!==i[c+1]||255!==i[c+2])&&e(a,b)}function e(b,c){for(var d=!1,e=a.vertexCount,f=0,g=e-1;f<e;g=f++)l[f]>c!=l[g]>c&&b<(k[g]-k[f])*(c-l[f])/(l[g]-l[f])+k[f]&&(d=!d);return d}if(!a||a.verxtexCount<3||!b)return null;for(var f=window.devicePixelRatio||1,g=b.width,h=b.height,i=b.buffer,j=a.vertexCount,k=Float32Array.from(a.xVertices),l=Float32Array.from(a.yVertices),m=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,p=Number.NEGATIVE_INFINITY,q=0;q<j;++q){var r=k[q]=k[q]*f,s=l[q]=h-l[q]*f;m=Math.min(m,r),n=Math.min(n,s),o=Math.max(o,r),p=Math.max(p,s)}if(o<0||m>g||p<0||n>h)return null;var t=Math.round(o-m),u=Math.round(p-n),v=Math.round(.5*(m+o)),w=Math.round(.5*(n+p)),x=v,y=w,z=1,A=1;do{for(var B=x+z,C=y+A;x<B;++x)if(d(x,y))return c(x,y);for(;y<C;++y)if(d(x,y))return c(x,y);for(z<t?(B=x-++z,++z):B=x-z,A<u?(C=y-++A,++A):C=y-A;x>B;--x)if(d(x,y))return c(x,y);for(;y>C;--y)if(d(x,y))return c(x,y)}while(z<t||A<u)},a.createStyleSheet=function(){var a=document.createElement("style");return a.appendChild(document.createTextNode("")),document.head.appendChild(a),a.sheet},a.addRuleToStyleSheet=function(a,b,c,d){"insertRule"in a?a.insertRule(b+"{"+c+"}",d):"addRule"in a&&a.addRule(b,c,d)},a.measureTextLines=function(b,c,d){var e=d.sizeFromMarkupsToClient(0,c["font-size"]).y,f=(new a.DomElementStyle).setAttribute("font-family",c["font-family"]).setAttribute("font-size",e+"px").setAttribute("font-weight",c["font-weight"]?"bold":"").setAttribute("font-style",c["font-style"]?"italic":"").removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString(),g=document.createElement("div");g.setAttribute("style",f),d.viewer.container.appendChild(g);for(var h=[],i=b.length,j=0;j<i;++j)g.innerHTML=b[j],h.push({line:b[j],width:g.clientWidth,height:g.clientHeight});return d.viewer.container.removeChild(g),h},a.createArcTo=function(a,b,c,d,e,f){return f.push(e?"a":"A"),f.push(c),f.push(d),f.push(0),f.push(1),f.push(1),f.push(a),f.push(b),f},a.createEllipsePath=function(b,c,d,e,f,g){var h=.5*d,i=.5*e;g.push(f?"m":"M"),g.push(b),g.push(c),a.createArcTo(d,0,h,i,!0,g),a.createArcTo(-d,0,h,i,!0,g),g.push("z")},a.createRectanglePath=function(a,b,c,d,e,f){f.push(e?"m":"M"),f.push(a),f.push(b),f.push("l"),f.push(c),f.push(0),f.push("l"),f.push(0),f.push(d),f.push("l"),f.push(-c),f.push(0),f.push("z")},a.renderToCanvas=function(c,d,e,f,g,h){var i=a.createSvgElement("svg");b.isIE11||i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("width",e),i.setAttribute("height",f),i.setAttribute("viewBox",d),d=d.split(" ");var j=c.parentNode.cloneNode(!0);j.setAttribute("transform","translate(0,"+(2*parseFloat(d[1])+parseFloat(d[3]))+") scale(1,-1)"),i.appendChild(j);var k=document.createElement("div"),l=i.cloneNode(!0);k.appendChild(l);var m=k.innerHTML;i=k=l=null;var n=function(){canvg(g.canvas,m,{ignoreMouse:!0,ignoreDimensions:!0,ignoreClear:!0,renderCallback:h})};if(b.isIE11)n();else{var o=new Image;o.onload=function(){g.drawImage(o,0,0),h()},o.onerror=function(){n()},o.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(m)))}},a.simplify=function(a,b,c){function d(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d}function e(a,b,c){var d=b.x,e=b.y,f=c.x-d,g=c.y-e;if(0!==f||0!==g){var h=((a.x-d)*f+(a.y-e)*g)/(f*f+g*g);h>1?(d=c.x,e=c.y):h>0&&(d+=f*h,e+=g*h)}return f=a.x-d,g=a.y-e,f*f+g*g}function f(a,b,c,d,g){for(var h,i=d,j=b+1;j<c;j++){var k=e(a[j],a[b],a[c]);k>i&&(h=j,i=k)}i>d&&(h-b>1&&f(a,b,h,d,g),g.push(a[h]),c-h>1&&f(a,h,c,d,g))}if(a.length<=2)return a;var g=void 0!==b?b*b:1;return a=c?a:function(a,b){for(var c,e=a[0],f=[e],g=1,h=a.length;g<h;g++)c=a[g],d(c,e)>b&&(f.push(c),e=c);return e!==c&&f.push(c),f}(a,g),a=function(a,b){var c=a.length-1,d=[a[0]];return f(a,0,c,b,d),d.push(a[c]),d}(a,g)}}(),function(){"use strict";function a(a,b,c){this.type=b,this.editor=a,this.targetId=c,this.addToHistory=!0,this.selectOnExecution=!0}AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),Autodesk.Viewing.Extensions.Markups.Core.EditAction=a,Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.execute=function(){this.editor.actionManager.execute(this)},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.redo=function(){},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.undo=function(){},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.merge=function(a){return!1},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.isIdentity=function(){return!1}}(),function(){"use strict";function a(a){this.historySize=a,this.undoStack=[],this.redoStack=[],c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;b.EVENT_HISTORY_CHANGED="EVENT_HISTORY_CHANGED";var d=a.prototype;d.execute=function(a){var c=this.redoStack,d=this.undoStack;c.splice(0,c.length),a.redo();var e=this.getEditActionGroup();e.isOpen()?e.addAction(a):(e.open(),e.addAction(a),e.close()),d.length>this.historySize&&d.splice(0,1);var f=a.selectOnExecution?a.targetId:-1;this.dispatchEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"execute",targetId:f}})},d.beginActionGroup=function(){var a=this.undoStack,b=a.length,c=null;0===b||a[b-1].isClosed()?(c=this.getEditActionGroup(),c.open()):console.warn("Markups - Undo/Redo - Action edit group already open.")},d.closeActionGroup=function(){var a=this.undoStack,b=a.length;if(0===b)return void console.warn("Markups - Undo/Redo - There is no action edit group to close.");var c=a[b-1];c.close()||console.warn("Markups - Undo/Redo - Action edit group already closed."),c.isEmpty()&&a.pop()},d.cancelActionGroup=function(){var a=this.undoStack,c=a.length;if(0===c)return void console.warn("Markups - Undo/Redo - There is no action edit group to close.");var d=a[c-1];if(!d.close())return void console.warn("Markups - Undo/Redo - Action edit group already closed.");d.undo(),a.pop(),this.dispatchEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"cancel",targetId:-1}})},d.undo=function(){var a=this.undoStack,c=this.redoStack;if(0!==a.length){var d=a.pop(),e=d.undo();c.push(d),this.dispatchEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"undo",targetId:e}})}},d.redo=function(){var a=this.undoStack,c=this.redoStack;if(0!==c.length){var d=c.pop(),e=d.redo();a.push(d),this.dispatchEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"redo",targetId:e}})}},d.clear=function(){this.undoStack.splice(0,this.undoStack.length),this.redoStack.splice(0,this.redoStack.length),this.dispatchEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"clear",targetId:-1}})},d.isUndoStackEmpty=function(){return 0===this.undoStack.length},d.isRedoStackEmpty=function(){return 0===this.redoStack.length},d.getEditActionGroup=function(){var a=this.undoStack,c=this.undoStack.length,d=null;return 0===c||a[c-1].isClosed()?(d=new b.EditActionGroup,a.push(d)):d=a[c-1],d},b.EditActionManager=a}(),function(){"use strict";function a(a,b,d){this.editor=a,this.viewer=a.viewer,this.type=b,this.selectedMarkup=null,this.dragging=!1,this.draggingAnnotationIniPosition=null,this.draggingMouseIniPosition=new THREE.Vector2,this.initialX=0,this.initialY=0,this.minSize=9,this.creating=!1,this.size={x:0,y:0},this.style=c.createStyle(d,this.editor),this.style=c.copyStyle(a.getDefaultStyle(),this.style),this.CREATION_METHOD_DRAG="CREATION_METHOD_DRAG",this.CREATION_METHOD_CLICK="CREATION_METHOD_CLICK",this.CREATION_METHOD_CLICKS="CREATION_METHOD_CLICKS",this.creationMethod=this.CREATION_METHOD_DRAG,c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;b.EVENT_EDITMODE_CREATION_BEGIN="EVENT_EDITMODE_CREATION_BEGIN",b.EVENT_EDITMODE_CREATION_END="EVENT_EDITMODE_CREATION_END",b.EVENT_MARKUP_DESELECT="EVENT_MARKUP_DESELECT";var d=a.prototype;d.destroy=function(){this.unselect(),c.removeTraitEventDispatcher(this)},d.unselect=function(){var a=!1,c=this.selectedMarkup;c&&(c.unselect(),this.selectedMarkup=null,a=!0),this.editor.editFrame.setMarkup(null),a&&this.dispatchEvent({type:b.EVENT_MARKUP_DESELECT})},d.creationBegin=function(){this.creating||(this.creating=!0,this.dispatchEvent({type:b.EVENT_EDITMODE_CREATION_BEGIN}))},d.creationEnd=function(){this.creating&&(this.creationMethod!==this.CREATION_METHOD_CLICK&&(this.selectedMarkup&&!this.isMinSizeValid()?this.creationCancel():(this.creationMethod===this.CREATION_METHOD_DRAG&&this.finishDragging(),this.selectedMarkup&&(this.editor.closeActionGroup(),this.unselect()))),this.creating=!1,this.dispatchEvent({type:b.EVENT_EDITMODE_CREATION_END}))},d.creationCancel=function(){this.editor.cancelActionGroup(),this.creationEnd(),this.selectedMarkup=null},d.setStyle=function(a){this.style=a;var c=this.selectedMarkup;if(c){new b.SetStyle(this.editor,c,a).execute()}},d.getStyle=function(){return this.style},d.setSelection=function(a){this.selectedMarkup!==a&&(this.unselect(),a&&a.select()),this.selectedMarkup=a;var b=this.editor;a&&b.bringToFront(a),this.creating||b.editFrame.setMarkup(a)},d.getSelection=function(){return this.selectedMarkup},d.deleteMarkup=function(a,b){return!1},d.isMinSizeValid=function(){if(0!==this.minSize){var a=this.editor.sizeFromMarkupsToClient(this.size.x,this.size.y);return a.x*a.x+a.y*a.y>=this.minSize*this.minSize}return!0},d.startDragging=function(){var a=this.selectedMarkup,b=this.editor.getMousePosition();a&&(this.dragging=!0,this.draggingAnnotationIniPosition=a.getClientPosition(),this.draggingMouseIniPosition.set(b.x,b.y))},d.finishDragging=function(){var a=this.dragging,b=this.selectedMarkup;this.dragging=!1,b&&a&&b.finishDragging()},d.getFinalMouseDraggingPosition=function(){var a=this.editor,b=a.getBounds(),d=a.getMousePosition(),e=this.initialX,f=this.initialY,g=Math.min(Math.max(b.x,d.x),b.x+b.width),h=Math.min(Math.max(b.y,d.y),b.y+b.height);if(g==e&&h==f&&(g++,h++),a.input.makeSameXY){var i=Math.abs(g-e),j=Math.abs(h-f),k=Math.max(i,j);g=e+k*c.sign(g-e),h=f+k*c.sign(h-f)}return{x:g,y:h}},d.notifyAllowNavigation=function(a){},d.onMouseMove=function(a){},d.onMouseDown=function(){},d.onMouseUp=function(a){this.creationMethod===this.CREATION_METHOD_DRAG&&this.creationEnd()},d.onMouseDoubleClick=function(a){this.creationMethod===this.CREATION_METHOD_CLICKS&&this.creationEnd()},d.onSave=function(){this.creating&&this.creationCancel()},d.getDraggingPosition=function(){var a=this.editor.getMousePosition(),b=a.x-this.draggingMouseIniPosition.x,c=a.y-this.draggingMouseIniPosition.y;return{x:this.draggingAnnotationIniPosition.x+b,y:this.draggingAnnotationIniPosition.y+c}},d.isInsideBounds=function(a,b,c){return a>=c.x&&a<=c.x+c.width&&b>=c.y&&b<=c.y+c.height},d.useWithSnapping=function(){return this.viewer.model.is2d()},d.isTextInputHelperActive=function(){return this.textInputHelper&&this.textInputHelper.isActive()},b.EditMode=a}(),function(){"use strict";function a(a,c,d){b.EditMode.call(this,a,c,d),this.smoothen=!0,this.bufferSize=8}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditMode.prototype);var d=a.prototype;d.deleteMarkup=function(a,b){if((a=a||this.selectedMarkup)&&a.type===this.type){var c=this.deletePen(a);return c.addToHistory=!b,c.execute(),!0}return!1},d.onMouseMove=function(a){if(b.EditMode.prototype.onMouseMove.call(this,a),this.selectedMarkup&&this.creating){var c=this.editor,d=c.getMousePosition(),e=this.movements,f=c.clientToMarkups(d.x,d.y);if(this.smoothen)this.appendToBuffer(f),this.amendPath();else{var g=this.lastX-d.x,h=this.lastY-d.y;e.length>1&&g*g+h*h<25?(e[e.length-1]=f,this.removeFromAbsolutePath(1)):(e.push(f),this.lastX=d.x,this.lastY=d.y),this.addToAbsolutePath([f])}this.setPen(this.position,this.size,this.absolutePath,!0).execute()}},d.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor;a.snapper&&a.snapper.clearSnapped();var c=a.getMousePosition();this.lastX=this.initialX=c.x,this.lastY=this.initialY=c.y;var d=this.position=a.clientToMarkups(this.initialX,this.initialY);this.movements=[d],this.smoothen&&(this.buffer=[],this.movementsLastIndex=null,this.appendToBuffer(d));var e=this.size=a.sizeFromClientToMarkups(1,1);a.beginActionGroup();var f=a.getId();this.createPen(f,d,e,0,[{x:0,y:0}]).execute(),this.createAbsolutePath(d),this.selectedMarkup=a.getMarkup(f),this.creationBegin()}},d.onMouseUp=function(){if(!this.creating)return void b.EditMode.prototype.onMouseUp.call(this);var a=this.movements,d=this.viewer.impl.camera.right-this.viewer.impl.camera.left,e=this.viewer.impl.camera.top-this.viewer.impl.camera.bottom,f=d*d+e*e;a=c.simplify(a,1e-8*f,!0);var g=a.map(function(a){return a.x}),h=a.map(function(a){return a.y}),i=Math.min.apply(null,g),j=Math.min.apply(null,h),k=Math.max.apply(null,g),l=Math.max.apply(null,h),m=k-i,n=l-j,o={x:i+.5*m,y:j+.5*n},p=this.size={x:m,y:n},q=a.map(function(a){return{x:a.x-o.x,y:a.y-o.y}});this.setPen(o,p,q,!1).execute(),b.EditMode.prototype.onMouseUp.call(this)},d.createPen=function(){console.error("createPen not implemented")},d.deletePen=function(){console.error("deletePen not implemented")},d.setPen=function(){console.error("setPen not implemented")},d.useWithSnapping=function(){return!1},d.createAbsolutePath=function(a){this.absolutePath="M"+ +a.x.toFixed(6)+" "+ +a.y.toFixed(6),this.absolutePathIndexes=[0]},d.removeFromAbsolutePath=function(a){(a=Math.min(a,this.absolutePathIndexes.length))>0&&(this.absolutePath=this.absolutePath.slice(0,this.absolutePathIndexes[this.absolutePathIndexes.length-a]),this.absolutePathIndexes.splice(this.absolutePathIndexes.length-a))},d.addToAbsolutePath=function(a){for(var b=0;b<a.length;b++)this.absolutePathIndexes.push(this.absolutePath.length),this.absolutePath+=" L"+ +a[b].x.toFixed(6)+" "+ +a[b].y.toFixed(6)},d.appendToBuffer=function(a){for(this.buffer.push(a);this.buffer.length>this.bufferSize;)this.buffer.shift()},d.amendPath=function(){var a=this.getAveragePoint(0);if(a){this.movementsLastIndex&&(this.removeFromAbsolutePath(this.movements.length-this.movementsLastIndex),this.movements.splice(this.movementsLastIndex));var b=[a];this.movementsLastIndex=this.movements.length+1;for(var c=2;c<this.buffer.length;c+=2){var d=this.getAveragePoint(c);b.push(d)}this.addToAbsolutePath(b),this.movements.push.apply(this.movements,b)}},d.getAveragePoint=function(a){var b=this.buffer.length;if(b%2==1||b>=this.bufferSize){for(var c,d=0,e=0,f=0,g=a;g<b;g++)f++,c=this.buffer[g],d+=c.x,e+=c.y;return{x:d/f,y:e/f}}return null},b.EditModePen=a}(),function(){"use strict";function a(a,b,d){this.id=a,this.type="",this.editor=b,this.viewer=b.viewer,this.position={x:0,y:0},this.size={x:0,y:0},this.rotation=0,this.style=c.createStyle(d,this.editor),this.style=c.copyStyle(b.getDefaultStyle(),this.style),this.highlightColor="#FAFF3C",this.constraintWidth=!1,this.constraintHeight=!1,this.constraintRotation=!1,this.highlighted=!1,this.selected=!1,c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils,d=Autodesk.Viewing;b.MARKUP_TYPE_ARROW="arrow",b.MARKUP_TYPE_TEXT="label",b.MARKUP_TYPE_RECTANGLE="rectangle",b.MARKUP_TYPE_CIRCLE="ellipse",b.MARKUP_TYPE_CLOUD="cloud",b.MARKUP_TYPE_FREEHAND="freehand",b.MARKUP_TYPE_HIGHLIGHT="highlight",b.MARKUP_TYPE_POLYLINE="polyline",b.MARKUP_TYPE_POLYCLOUD="polycloud",b.MARKUP_TYPE_CALLOUT="callout",b.MARKUP_TYPE_DIMENSION="dimension";var e=a.prototype;b.Markup=a,e.destroy=function(){this.unselect(),this.setParent(null)},e.setParent=function(a){var b=this.shape;b.parentNode&&b.parentNode.removeChild(b),a&&a.appendChild(b)},e.clone=function(){var a=Object.create(this.__proto__),b=this.getCloneOverrides();for(var c in this)if(this.hasOwnProperty(c)){var d=this[c];b.hasOwnProperty(c)?a[c]=b[c]:d.clone instanceof Function?a[c]=d.clone():d instanceof Function?a[c]=d.bind(a):d.nodeType?a[c]=d.cloneNode(!0):d instanceof Object?a[c]=JSON.parse(JSON.stringify(d)):a[c]=d}return this.cloneShape(a),a},e.cloneShape=function(a){a.shape.markup=a.shape.childNodes.item(0),a.shape.hitarea=a.shape.childNodes.item(1),a.bindDomEvents()},e.getCloneOverrides=function(){return{viewer:this.viewer,editor:this.editor,hammer:null,listeners:{}}},e.select=function(){this.selected||(this.selected=!0,this.highlighted=!1,this.updateStyle(),this.dispatchEvent({type:b.EVENT_MARKUP_SELECTED,markup:this}))},e.unselect=function(){this.selected=!1},e.highlight=function(a){this.interactionsDisabled||(this.highlighted=a,this.updateStyle())},e.getStyle=function(){return c.cloneStyle(this.style)},e.setStyle=function(a){c.copyStyle(a,this.style),this.updateStyle()},e.updateStyle=function(){},e.edit=function(){this.dispatchEvent({type:b.EVENT_MARKUP_ENTER_EDITION,markup:this})},e.cancel=function(){this.dispatchEvent({type:b.EVENT_MARKUP_CANCEL_EDITION,markup:this})},e.deleteMarkup=function(){this.dispatchEvent({type:b.EVENT_MARKUP_DELETE_EDITION,markup:this})},e.getEditMode=function(){return console.warn("EditMode of markup type"+this.type+" not defined."),null},e.getClientPosition=function(){var a=this.position;return this.editor.positionFromMarkupsToClient(a.x,a.y)},e.getClientSize=function(){var a=this.size;return this.editor.sizeFromMarkupsToClient(a.x,a.y)},e.setRotation=function(a){this.rotation=a,this.updateStyle()},e.getRotation=function(){return this.rotation},e.setPosition=function(a,b){this.position.x=a,this.position.y=b,this.updateStyle()},e.setSize=function(a,b,c){this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},e.isWidthConstrained=function(){return this.constraintWidth},e.isHeightConstrained=function(){return this.constraintHeight},e.isRotationConstrained=function(){return this.constraintRotation},e.disableInteractions=function(a){this.interactionsDisabled=a},e.setStrokeWidth=function(a){},e.constrainsToBounds=function(a){},e.onMouseDown=function(a){this.interactionsDisabled||(this.select(),this.editor.editFrame.startDrag(a))},e.generatePoint3d=function(a){function b(b,e){
var f=c.checkLineSegment(b.x,b.y,e.x,e.y,a),g=f&&d.clientToWorld(f.x,f.y);return g&&g.point}var d=this.viewer,e=this.generateBoundingPolygon(),f=e.xVertices,g=e.yVertices,h=new THREE.Vector2(f[0]+f[1],g[0]+g[1]).multiplyScalar(.5),i=new THREE.Vector2(f[0]+f[3],g[0]+g[3]).multiplyScalar(.5),j=new THREE.Vector2(f[2]+f[1],g[2]+g[1]).multiplyScalar(.5),k=new THREE.Vector2(f[2]+f[3],g[2]+g[3]).multiplyScalar(.5),l=i.clone().add(j).multiplyScalar(.5);return b(l,j)||b(l,i)||b(l,h)||b(l,k)||function(b){var e=c.checkPolygon(b,a),f=e&&d.clientToWorld(e.x,e.y);return f&&f.point}(e)},e.generateBoundingBox=function(){for(var a={min:{x:0,y:0},max:{x:0,y:0}},b=this.generateBoundingPolygon(),c=b.vertexCount,d=b.xVertices,e=b.yVertices,f=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,j=0;j<c;++j){var k=d[j],l=e[j];f=Math.min(f,k),g=Math.min(g,l),h=Math.max(h,k),i=Math.max(i,l)}return a.min.x=f,a.min.y=g,a.max.x=h,a.max.y=i,a},e.generateBoundingPolygon=function(){var a=this.getClientPosition(),b=this.getClientSize();b.x*=.5,b.y*=.5;var c=new THREE.Vector3(-b.x,-b.y).add(a),d=new THREE.Vector3(b.x,-b.y).add(a),e=new THREE.Vector3(b.x,b.y).add(a),f=new THREE.Vector3(-b.x,b.y).add(a);if(0!==this.rotation){var g=(new THREE.Matrix4).makeTranslation(-a.x,-a.y,0),h=(new THREE.Matrix4).makeRotationZ(this.rotation),i=(new THREE.Matrix4).makeTranslation(a.x,a.y,0),j=i.multiply(h).multiply(g);c.applyMatrix4(j),d.applyMatrix4(j),e.applyMatrix4(j),f.applyMatrix4(j)}return{vertexCount:4,xVertices:new Float32Array([c.x,d.x,e.x,f.x]),yVertices:new Float32Array([c.y,d.y,e.y,f.y])}},e.setMetadata=function(){return null},e.setMouseDisabledWhenTouching=function(a){if(a.isFirst)this.shape.removeEventListener("mousedown",this.onMouseDownBinded);else if(a.isFinal){var b=this;setTimeout(function(){b.shape.addEventListener("mousedown",b.onMouseDownBinded)},10)}},e.bindDomEvents=function(){c.isTouchDevice()&&(this.hammer=new Hammer.Manager(this.shape,{recognizers:[d.GestureRecognizers.singletap],inputClass:d.isIE11?Hammer.PointerEventInput:Hammer.TouchInput}),this.onSingleTapBinded=function(a){this.onMouseDown(a)}.bind(this),this.onHammerInputBinded=function(a){this.setMouseDisabledWhenTouching(a)}.bind(this),this.hammer.on("singletap",this.onSingleTapBinded),this.hammer.on("hammer.input",this.onHammerInputBinded)),this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseOutBinded=function(){this.highlight(!1)}.bind(this),this.onMouseOverBinded=function(){this.highlight(!0)}.bind(this),this.shape.addEventListener("mousedown",this.onMouseDownBinded),this.shape.addEventListener("mouseout",this.onMouseOutBinded),this.shape.addEventListener("mouseover",this.onMouseOverBinded)},e.renderToCanvas=function(a,b,d,e,f){c.renderToCanvas(this.shape,b,d,e,a,f)},e.getPath=function(){},e.getTransform=function(){return["translate(",this.position.x,",",this.position.y,")","rotate(",c.radiansToDegrees(-this.rotation),")"].join(" ")}}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity"];b.Markup.call(this,a,d,e),this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.set=function(a,b,c,d){this.rotation=0,this.isAbsoluteCoords=d,this.isAbsoluteCoords?this.updatePath(c):(this.locations=c.slice(0),this.size.x=0===b.x?1:b.x,this.size.y=0===b.y?1:b.y,this.setSize(a,b.x,b.y),this.updateStyle())},d.setPosition=function(a,b){this.position.x=a,this.position.y=b;var d=this.shape,e=this.getTransform();c.setAttributeToMarkupSvg(d,"transform",e),c.updateMarkupPathSvgHitarea(d,this.editor)},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]);c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke-linejoin","round"),c.setAttributeToMarkupSvg(b,"stroke-linecap","round"),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill","none"),this.updatePath(d),c.updateMarkupPathSvgHitarea(b,this.editor)},d.updatePath=function(a){var b=this.shape,d=this.isAbsoluteCoords?"scale(1)":this.getTransform();c.setAttributeToMarkupSvg(b,"transform",d),c.setAttributeToMarkupSvg(b,"d",a)},d.setSize=function(a,b,c){b=0===b?1:b,c=0===c?1:c;for(var d=this.locations,e=d.length,f=b/this.size.x,g=c/this.size.y,h=0;h<e;++h){var i=d[h];i.x*=f,i.y*=g}this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),a.locations=this.locations.map(function(a){return[a.x,a.y].join(" ")}).join(" "),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=[],b=this.locations,c=b.length;if(c>1){a.push("M"),a.push(+b[0].x.toFixed(6)),a.push(+b[0].y.toFixed(6));for(var d=1;d<c;++d){var e=b[d-1],f=b[d];a.push("l"),a.push(+(f.x-e.x).toFixed(6)),a.push(+(f.y-e.y).toFixed(6))}}return a},b.MarkupPen=a}(),function(){"use strict";function a(){this.reset()}function b(a){var b=[];for(var c in a){var d=a[c];b.push(c),b.push(":"),b.push(d),b.push("; ")}return b.join("")}var c=Autodesk.Viewing.Extensions.Markups.Core.Utils,d=["-ms-","-webkit-","-moz-","-o-"],e=a.prototype;e.reset=function(){return this.attributes={},this.dirty=!1,this.styleString="",this},e.setAttribute=function(a,b,c){if(this.attributes[a]=b,c&&c.allBrowsers){var e=this;d.forEach(function(c){e.attributes[c+a]=b})}return this.dirty=!0,this},e.removeAttribute=function(a){Array.isArray(a)||(a=[a]);var b=this;return a.forEach(function(a){a in b.attributes&&(delete b.attributes[a],b.dirty=!0)}),this},e.getStyleString=function(){return this.dirty&&(this.styleString=b(this.attributes),this.dirty=!1),this.styleString},e.clone=function(){var a=new c.DomElementStyle,b=this.attributes;for(var d in b)a.setAttribute(d,b[d]);return a},c.DomElementStyle=a}(),function(){"use strict";function a(a,b){this.containingDiv=a,this.editor=b,this.selectionLayer=c(),this.frameMargin=10,this.selection={x:0,y:0,width:0,height:0,rotation:0,element:null,active:!1,dragging:!1,resizing:!1,handle:{}},j.bind(this)(),w.isTouchDevice()&&(this.hammer=new Hammer.Manager(this.selectionLayer,{recognizers:[x.GestureRecognizers.drag,x.GestureRecognizers.doubletap,x.GestureRecognizers.doubletap2,x.GestureRecognizers.pan,x.GestureRecognizers.pinch],inputClass:x.isIE11?Hammer.PointerEventInput:Hammer.TouchInput}),this.onHammerDragBinded=this.onHammerDrag.bind(this),this.onHammerDoubleTapBinded=this.onHammerDoubleTap.bind(this),this.onTouchPanBinded=this.onTouchPan.bind(this),this.onTouchPinchBinded=this.onTouchPinch.bind(this),this.hammer.on("dragstart dragmove dragend",this.onHammerDragBinded),this.hammer.on("doubletap",this.onHammerDoubleTapBinded),this.hammer.on("doubletap2",this.onHammerDoubleTapBinded),this.hammer.on("panstart panmove panend",this.onTouchPanBinded),this.hammer.on("pinchstart pinchmove pinchend",this.onTouchPinchBinded),this.hammer.get("drag").requireFailure("pinch"),this.hammer.get("drag").requireFailure("pan")),o.bind(this)(),p.bind(this)(),r.bind(this)(),q.bind(this)(),this.containingDiv.appendChild(this.selectionLayer),w.addTraitEventDispatcher(this)}function b(a){a.pageX=a.pointers[0].clientX,a.pageY=a.pointers[0].clientY}function c(){var a=document.createElement("div");return a.style.position="absolute",a.style.top=0,a.style.bottom=0,a.style.left=0,a.style.right=0,a.style.overflow="hidden",a.style.visibility="hidden",s(a,!1),a}function d(a,b){var c=document.createElement("div");c.style.position="absolute",c.style.height=a+"px",c.style.width=a+"px",c.style.background=A,c.style.borderColor=z,c.style.borderWidth="1px",c.style.borderStyle="solid",f(c,b),c.className="selector-drag-point autodesk-markups-extension-core-make-me-bigger sdp-handle-"+b,c.setAttribute("data-sdp-handle",b);var d=-a-2;switch(b){case"n":c.style.top=d+"px",c.style.left="calc(50% - "+a/2+"px)",c.style.position="relative",c.style.margin=0;break;case"s":c.style.top="calc(100% - "+(a+2)+"px)",c.style.left="calc(50% - "+a/2+"px)",c.style.position="relative",c.style.margin=0;break;case"w":c.style.left=d+"px",c.style.top="50%",c.style.transform="translate3d(0, -50%, 0)";break;case"e":c.style.right=d+"px",c.style.top="50%",c.style.transform="translate3d(0, -50%, 0)";break;case"nw":c.style.top=d+"px",c.style.left=d+"px";break;case"ne":c.style.top=d+"px",c.style.right=d+"px";break;case"sw":c.style.bottom=d+"px",c.style.left=d+"px";break;case"se":c.style.bottom=d+"px",c.style.right=d+"px"}return c}function e(){var a=document.createElement("div");return a.style.position="absolute",a.style.background=A,a.style.border="1px solid rgba(30, 30, 255, 0.25)",a.style.height="18px",a.style.width="18px",a.style.borderRadius="10px",a.style.boxSizing="border-box",a.classList.add("selector-rotate-point"),a.style.left="50%",a.style.transform="translate3d(-50%, 0px, 0px)",a.style.top="-70px",a.classList.add("autodesk-markups-extension-core-make-me-bigger"),a}function f(a,b){var c;switch(b){case"n":case"s":c="ns-resize";break;case"w":case"e":c="ew-resize";break;case"ne":case"sw":c="nesw-resize";break;case"nw":case"se":c="nwse-resize"}a.style.cursor=c}function g(a){["n","s","w","e","nw","ne","sw","se"].forEach(function(b){this.selection.handle[b]=d(16,b),a.appendChild(this.selection.handle[b])}.bind(this))}function h(a){return u(a,".selector-drag-point")}function i(a){return u(a,".selector-rotate-point")}function j(){var a=document.createElement("div");return a.style.position="absolute",a.style.border="1px solid "+z,a.style.zIndex=1,a.style.cursor="move",a.style.boxSizing="border-box",s(a,!0),a.classList.add("selector-box"),g.bind(this)(a),this.selection.rotationHandle=e(),a.appendChild(this.selection.rotationHandle),this.selection.element=a,x.isMobileDevice()||(this.onWheelBinded=this.onWheel.bind(this),this.selection.element.addEventListener("wheel",this.onWheelBinded),this.selection.element.addEventListener("DOMMouseScroll",this.onWheelBinded)),this.selectionLayer.appendChild(this.selection.element),l.bind(this)(!1),a}function k(a,b){return"translate3d("+a+"px,"+b+"px,0)"}function l(a){this.selection.active=a,this.selection.element.style.display=a?"block":"none"}function m(a,b,c){this.selection.x=a,this.selection.y=b,this.selection.rotation=c;var d=this.markup.getClientSize();d.x+=2*this.frameMargin,d.y+=2*this.frameMargin,this.selection.element.style.msTransform=k(a,b)+" rotate("+c+"rad)",this.selection.element.style.msTransformOrigin=d.x/2+"px "+d.y/2+"px",this.selection.element.style.webkitTransform=k(a,b)+" rotate("+c+"rad)",this.selection.element.style.webkitTransformOrigin=d.x/2+"px "+d.y/2+"px",this.selection.element.style.transform=k(a,b)+" rotate("+c+"rad)",this.selection.element.style.transformOrigin=d.x/2+"px "+d.y/2+"px"}function n(a,b){this.selection.width=a,this.selection.height=b,this.selection.element.style.width=a+"px",this.selection.element.style.height=b+"px"}function o(){this.selection.element.addEventListener("mousedown",this._onRepositionMouseDown.bind(this))}function p(){this.selectionLayer.addEventListener("mousedown",this._onResizeMouseDown.bind(this))}function q(){this.selection.element.addEventListener("mousedown",this._onRotationMouseDown.bind(this))}function r(){var a=function(a){if(!a.defaultPrevented){this.selection.dragging=!1;var b=this.editor.editMode;b&&b.onMouseDoubleClick(this.markup)}}.bind(this);this.selectionLayer.addEventListener("dblclick",a)}function s(a,b){a.style.pointerEvents=b?"auto":"none"}function t(a,b){return Math.atan2(b.y-a.y,b.x-a.x)}function u(a,b){return a.matches?a.matches(b):a.msMatchesSelector?a.msMatchesSelector(b):a.mozMatchesSelector?a.mozMatchesSelector(b):!!a.webkitMatchesSelector&&a.webkitMatchesSelector(b)}var v=Autodesk.Viewing.Extensions.Markups.Core,w=Autodesk.Viewing.Extensions.Markups.Core.Utils,x=Autodesk.Viewing,y=Autodesk.Viewing.Private;v.EVENT_EDITFRAME_EDITION_START="EVENT_EDITFRAME_EDITION_START",v.EVENT_EDITFRAME_EDITION_END="EVENT_EDITFRAME_EDITION_END";var z="rgba(30, 30, 255, 0.30)",A="gainsboro",B=a.prototype;B.setSelection=function(a,b,c,d,e){var f=this.frameMargin,g=2*f;n.bind(this)(c+g,d+g),m.bind(this)(a-f,b-f,e),l.bind(this)(!0),this.selectionLayer.style.visibility="visible"},B.setMarkup=function(a){if(this.hammer&&this.hammer.set({enable:null!==a}),this.markup=a,l.bind(this)(!1),a){var b=a.getClientSize(),c=a.getClientPosition(),d=b.x,e=b.y,f=a.getRotation();this.setSelection(c.x-d/2,c.y-e/2,d,e,f),this.enableResizeHandles(),this.enableRotationHandle(),a.preventReposition?this.selectionLayer.firstChild.style.cursor="":this.selectionLayer.firstChild.style.cursor="move"}},B.startDrag=function(a){this.markup&&this.markup.preventReposition||(this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),this._onRepositionMouseDown(a,this.editor.getMousePosition()))},B.isActive=function(){return this.selection.active},B.isDragging=function(){return this.selection.dragging},B.isResizing=function(){return this.selection.resizing},B.isRotating=function(){return this.selection.rotating},B.onMouseMove=function(a){},B.onMouseUp=function(a){},B.onWheel=function(a){this.editor.viewer.toolController.mousewheel(a)},B.onTouchPan=function(a){this.editor.viewer.toolController.getTool("gestures").distributeGesture(a),a.preventDefault()},B.onTouchPinch=function(a){this.editor.viewer.toolController.getTool("gestures").distributeGesture(a),a.preventDefault()},B.onHammerDrag=function(a){function c(a,b,c){var d=b.getBoundingClientRect();a.mousePosition.x=c.pageX-d.left,a.mousePosition.y=c.pageY-d.top}switch(b(a),a.type){case"dragstart":c(this.editor.input,this.editor.svg,a),this.editor.callSnapperMouseDown(),i(a.target)?this._onRotationMouseDown(a):h(a.target)?this._onResizeMouseDown(a):this.startDrag(a),a.preventDefault();break;case"dragmove":c(this.editor.input,this.editor.svg,a),this.editor.callSnapperMouseMove(),this.onMouseMove(a),a.preventDefault();break;case"dragend":c(this.editor.input,this.editor.svg,a),this.onMouseUp(a),a.preventDefault()}},B.onHammerDoubleTap=function(a){b(a),function(a,b,c){var d=b.getBoundingClientRect();a.mousePosition.x=c.pageX-d.left,a.mousePosition.y=c.pageY-d.top}(this.editor.input,this.editor.svg,a),this.selection.dragging=!1,this.editor.editMode&&this.editor.editMode.onMouseDoubleClick(this.markup)},B.enableResizeHandles=function(){var a,b=this.markup;if(b.isHeightConstrained()||b.isWidthConstrained()){for(var c in this.selection.handle)(a=this.selection.handle[c])&&(a.style.display="none");b.isHeightConstrained()||(this.selection.handle.n.style.display="block",this.selection.handle.s.style.display="block"),b.isWidthConstrained()||(this.selection.handle.w.style.display="block",this.selection.handle.e.style.display="block")}else for(var c in this.selection.handle)(a=this.selection.handle[c])&&(a.style.display="block")},B.enableRotationHandle=function(){var a=this.markup,b=this.selection.rotationHandle,c=a.isRotationConstrained()?"none":"block";b.style.display=c},B._handleRightClickDown=function(a){return!(x.isMobileDevice()||!y.isRightClick(a,this.editor.viewer.navigation))&&(this.editor.input.onMouseDownRightClick(a),!0)};var C=!1;B._onRepositionMouseDown=function(a,b){if(!this._handleRightClickDown(a)){C=!x.isMobileDevice()&&x.isTouchDevice();var c=!(a instanceof MouseEvent);if((c||!h(a.target)&&!i(a.target))&&(b=c?b:this.editor.getMousePosition(),this.initialCursor=b,this.initialPosition=this.markup.getClientPosition(),this.areAxisConstrained=!1,this.axisConstrains=new THREE.Vector2(1,1),this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),!this.selection.dragging)){if(this.selection.dragging=!0,this.editor.beginActionGroup(),a&&a.altKey){var d=this.editor;new v.CloneMarkup(d,d.getId(),this.markup,this.markup.position).execute()}this.dispatchEvent({type:v.EVENT_EDITFRAME_EDITION_START})}}},B._onRepositionMouseMove=function(a){if(C)return void(C=!1);if(this.selection.dragging&&this.markup&&!this.markup.preventReposition){var b=this.editor.getMousePosition(),c=this.editor.input.constrainAxis;this.areAxisConstrained!==c&&(this.areAxisConstrained=c,this.axisConstrains=c?new THREE.Vector2(0,0):new THREE.Vector2(1,1),this.initialPosition.x+=b.x-this.initialCursor.x,this.initialPosition.y+=b.y-this.initialCursor.y,this.initialCursor.x=b.x,this.initialCursor.y=b.y);var d={x:b.x-this.initialCursor.x,y:b.y-this.initialCursor.y};0===this.axisConstrains.x&&0===this.axisConstrains.y&&(Math.abs(d.x)>15?(this.axisConstrains.x=1,d.x+=d.x<0?15:-15):Math.abs(d.y)>15&&(this.axisConstrains.y=1,d.y+=d.y<0?15:-15));var e=this.initialPosition.x+d.x*this.axisConstrains.x,f=this.initialPosition.y+d.y*this.axisConstrains.y;m.bind(this)(e,f,this.selection.rotation);var g=this.editor.positionFromClientToMarkups(e,f);new v.SetPosition(this.editor,this.markup,g).execute()}},B._onRepositionMouseUp=function(){this.markup&&this.markup.preventReposition||(this.last=null,this.onMouseMove=function(){},this.onMouseUp=function(){},this.selection.dragging&&(this.editor.closeActionGroup(),this.selection.dragging=!1,this.dispatchEvent({type:v.EVENT_EDITFRAME_EDITION_END})))},B._onResizeMouseDown=function(a){if(!this._handleRightClickDown(a)){var b=a.target;if(h(b)){this.selection.handle.resizing=b;var c=this.selection.handle.resizing.getAttribute("data-sdp-handle");this.containingDiv.style.cursor=c+"-resize";var d=this.editor.getMousePosition(),e=this.markup.getClientPosition(),f=this.markup.getClientSize();this.initial={x:e.x,y:e.y,width:f.x,height:f.y,mouseX:d.x,mouseY:d.y},this.onMouseMove=this._onResizeMouseMove.bind(this),this.onMouseUp=this._onResizeMouseUp.bind(this),this.selection.resizing||(this.selection.resizing=!0,this.editor.beginActionGroup(),this.dispatchEvent({type:v.EVENT_EDITFRAME_EDITION_START}))}}},B._onResizeMouseMove=function(a){if(this.selection.resizing){var b=this.editor.getMousePosition(),c=this.initial,d={x:b.x-c.mouseX,y:b.y-c.mouseY},e=new THREE.Vector3(d.x,d.y,0),f=(new THREE.Matrix4).makeRotationZ(-this.selection.rotation);d=e.applyMatrix4(f);var g=c.x,h=c.y,i=c.width,j=c.height,k=new THREE.Vector3,l=this.selection.handle.resizing.getAttribute("data-sdp-handle");if(this.editor.input.keepAspectRatio&&-1!==["nw","ne","sw","se"].indexOf(l)){var m=new THREE.Vector3(d.x,d.y,0);switch(l){case"nw":d.set(-c.width,-c.height,0);break;case"ne":case"sw":d.set(c.width,-c.height,0);break;case"se":d.set(c.width,c.height,0)}d.normalize(),d=m.projectOnVector(d)}({n:function(){j-=d.y,k.y=d.y},s:function(){j+=d.y,k.y=d.y},w:function(){i-=d.x,k.x=d.x},e:function(){i+=d.x,k.x=d.x},nw:function(){this.n(),this.w()},ne:function(){this.n(),this.e()},sw:function(){this.s(),this.w()},se:function(){this.s(),this.e()}})[l]();var n=(new THREE.Matrix4).makeRotationZ(this.selection.rotation),o=k.applyMatrix4(n),p=this.editor.positionFromClientToMarkups(g+.5*o.x,h+.5*o.y),q=this.editor.sizeFromClientToMarkups(i,j);new v.SetSize(this.editor,this.markup,p,q.x,q.y).execute()}},B._onResizeMouseUp=function(a){this.selection.resizing=!1,this.selection.handle.resizing=null,this.containingDiv.style.cursor="",this.editor.closeActionGroup(),this.dispatchEvent({type:v.EVENT_EDITFRAME_EDITION_END}),this.onMouseMove=function(){},this.onMouseUp=function(){}};var D,E;B._onRotationMouseDown=function(a){this._handleRightClickDown(a)||i(a.target)&&(this.editor.beginActionGroup(),this.selection.rotating=!0,E=this.editor.getMousePosition(),D=this.selection.rotation||0,this.onMouseMove=this._onRotationMouseMove.bind(this),this.onMouseUp=this._onRotationMouseUp.bind(this),this.dispatchEvent({type:v.EVENT_EDITFRAME_EDITION_START}))},B._onRotationMouseMove=function(a){if(this.selection.rotating){var b=this.editor.getMousePosition(),c=this.markup.getClientPosition(),d=t(c,b),e=t(c,E),f=d-e+D;if(this.editor.input.snapRotations){var g=w.degreesToRadians(22.5);f=Math.ceil(f/g)*g}m.bind(this)(this.selection.x,this.selection.y,f);new v.SetRotation(this.editor,this.markup,f).execute()}},B._onRotationMouseUp=function(a){this.selection.rotating=!1,D=null,E=null,this.editor.closeActionGroup(),this.dispatchEvent({type:v.EVENT_EDITFRAME_EDITION_END})},v.EditFrame=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_ARROW,this.constraintHeight=!0,this.head=new THREE.Vector3,this.tail=new THREE.Vector3,this.size.y=3*this.style["stroke-width"],this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeArrow(this.editor)},d.set=function(a,b,c,d){var e=new THREE.Vector2(a,b),f=new THREE.Vector2(c,d),g=f.clone().sub(e).normalize();this.size.x=e.distanceTo(f),this.rotation=Math.acos(g.dot(new THREE.Vector2(1,0))),this.rotation=d>b?2*Math.PI-this.rotation:this.rotation;var h=this.head,i=this.tail;h.set(c,d,0),i.set(a,b,0),this.position.x=i.x+.5*(h.x-i.x),this.position.y=i.y+.5*(h.y-i.y),this.updateStyle()},d.setRotation=function(a){this.rotation=a;var b=Math.cos(-a),c=Math.sin(-a),d=new THREE.Vector2(b,c);d.multiplyScalar(.5*this.size.x);var e=new THREE.Vector2(this.position.x,this.position.y),f=e.clone().sub(d),g=e.clone().add(d);this.head.set(g.x,g.y,0),this.tail.set(f.x,f.y,0),this.updateStyle()},d.setSize=function(a,b,c){var d=Math.cos(-this.rotation),e=Math.sin(-this.rotation),f=new THREE.Vector2(d,e);f.multiplyScalar(.5*b);var g=new THREE.Vector2(a.x,a.y),h=g.clone().sub(f),i=g.clone().add(f);this.head.set(i.x,i.y,0),this.tail.set(h.x,h.y,0),this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=a["stroke-width"],e=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),f=this.getTransform();this.size.y=3*d,this.style["fill-color"]=a["stroke-color"],this.style["fill-opacity"]=a["stroke-opacity"],c.setAttributeToMarkupSvg(b,"d",this.getPath().join(" ")),c.setAttributeToMarkupSvg(b,"stroke-width",d),c.setAttributeToMarkupSvg(b,"stroke",e),c.setAttributeToMarkupSvg(b,"fill",e),c.setAttributeToMarkupSvg(b,"transform",f),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setPosition=function(a,b){var c=this.head,d=this.tail,e=c.x-d.x,f=c.y-d.y,g=a+.5*e,h=b+.5*f;c.x=g,c.y=h,d.x=g-e,d.y=h-f,this.position.x=d.x+.5*(c.x-d.x),this.position.y=d.y+.5*(c.y-d.y),this.updateStyle()},d.generatePoint3d=function(a){var b=this.editor.positionFromMarkupsToClient(this.head.x,this.head.y),d=this.editor.positionFromMarkupsToClient(this.tail.x,this.tail.y),e=b.clone().sub(d).normalize(),f=c.checkLineSegment(b.x,b.y,b.x+200*e.x,b.y+200*e.y,a),g=f&&this.viewer.clientToWorld(f.x,f.y);return g&&g.point},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.head=[this.head.x,this.head.y].join(" "),a.tail=[this.tail.x,this.tail.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=this.size.x,b=this.size.y,c=b/3,d=this.style["stroke-width"],e=a-3*d,f=a-e,g=.3*d;return["M",.5*-a,.5*-b+c,"l",e,0,"l",-g,-c,"l",f+g,1.5*c,"l",-f-g,1.5*c,"l",g,-c,"l",-e,0,"z"]},b.MarkupArrow=a}(),function(){"use strict";function a(a,d,e){var f=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];b.Markup.call(this,a,d,f),this.style["stroke-width"]=c.getStrokeWidth(c.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS,d),this.type=b.MARKUP_TYPE_CALLOUT,this.textShape=c.createMarkupTextSvg(),this.rectShape=c.createMarkupPathSvg(),this.shape=c.createMarkupGroupSvg([this.rectShape,this.textShape]),this.isFrameUsed=!0,this.constraintRotation=!0,this.size.x=e.x,this.size.y=e.y,this.currentText="",this.currentTextLines=[""],this.textDirty=!0,this.textSize={x:0,y:0},this.lineHeight=130,this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils,d=100;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var e=a.prototype;e.getEditMode=function(){return new b.EditModeCallout(this.editor)},e.set=function(a,b,c,d){this.position.x=a.x,this.position.y=a.y,this.size.x=b.x,this.size.y=b.y,this.setIsFilledFrameUsed(d),this.setText(c)},e.setSize=function(a,b,c){this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},e.setStyle=function(a){c.copyStyle(a,this.style),this.updateStyle()},e.setText=function(a){this.currentText=a,this.updateStyle()},e.getText=function(){return this.currentText},e.getTextLines=function(){return this.currentTextLines.concat()},e.updateStyle=function(){function a(){var a=this.style,b=this.rectShape,e=this.textShape,f=this.style["font-size"],g=this.style["font-family"],h=this.style["font-weight"],i=this.style["font-style"],j=this.style["stroke-width"],k=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]);this.rebuildTextSvg();var l=this.editor,m=this.getTextContainerTransform(),n=this.getTextTransform(),o=this.textSize;if(c.setAttributeToMarkupSvg(e,"font-family",g),c.setAttributeToMarkupSvg(e,"font-size",f*d),c.setAttributeToMarkupSvg(e,"fill",k),c.setAttributeToMarkupSvg(e,"font-weight",h),c.setAttributeToMarkupSvg(e,"font-style",i),c.setMarkupTextSvgTransform(e,m,n),c.updateMarkupTextSvgClipper(e,o.x,o.y),c.updateMarkupTextSvgHitarea(e,o.x,o.y,l),this.isFrameUsed){var p=this.getPath().join(" "),q=this.getTransform(),r=c.composeRGBAString(a["fill-color"],a["fill-opacity"]);c.setAttributeToMarkupSvg(b,"d",p),c.setAttributeToMarkupSvg(b,"stroke-width",j),c.setAttributeToMarkupSvg(b,"stroke",k),c.setAttributeToMarkupSvg(b,"transform",q),c.setAttributeToMarkupSvg(b,"fill",r),c.updateMarkupPathSvgHitarea(b,l)}this.applyingStyle=!1}this.applyingStyle=this.applyingStyle||!1,this.applyingStyle||(this.applyingStyle=!0,a.bind(this)(),requestAnimationFrame(a.bind(this)))},e.rebuildTextSvg=function(){var a=this.editor.duringEditMode&&this.editor.editMode;a&&a.type===this.type||(a=this.getEditMode());var b=c.cloneStyle(a.textInputHelper.style),e=a.textInputHelper.textArea.value;this.currentTextLines=a.textInputHelper.getTextValuesForMarkup(this).lines,a.selectedMarkup!==this&&(a.textInputHelper.textArea.value=e,a.textInputHelper.setStyle(b));var f=c.createSvgElement("text");f.setAttribute("id","markup"),f.setAttribute("alignment-baseline","middle"),this.textShape.childNodes[0].removeChild(this.textShape.markup),this.textShape.childNodes[0].appendChild(f),this.textShape.markup=f;var g=0,h=this.getLineHeight()*d;this.currentTextLines.forEach(function(a){var b=c.createSvgElement("tspan");b.setAttribute("x",0),b.setAttribute("y",g),b.textContent=a,f.appendChild(b),g+=h}.bind(this));var i=this.generateBoundingPolygon(),j=this.editor.sizeFromClientToMarkups(i.xVertices[1]-i.xVertices[0],i.yVertices[2]-i.yVertices[0]);this.textSize.x=Math.min(j.x,this.size.x),this.textSize.y=Math.min(j.y,this.size.y)},e.generateBoundingPolygon=function(){var a=this.getClientPosition(),b=this.getClientSize(),d=function(a,b,d){for(var e={w:0,h:0},a=c.measureTextLines(a,b,d),f=a.length,g=0;g<f;++g){var h=a[g];e.w=Math.max(e.w,h.width),e.h=e.h+h.height}return 0!==e.h&&(e.h+=d.sizeFromMarkupsToClient(0,.25*b["font-size"]).y),e}(this.currentTextLines,this.style,this.editor),e=Math.min(b.x,d.w),f=Math.min(b.y,d.h),g=new THREE.Vector2(.5*-b.x,.5*-b.y).add(a),h=new THREE.Vector2(g.x+e,g.y),i=new THREE.Vector2(h.x,h.y+f),j=new THREE.Vector2(g.x,i.y);return{vertexCount:4,xVertices:new Float32Array([g.x,h.x,i.x,j.x]),yVertices:new Float32Array([g.y,h.y,i.y,j.y])}},e.setIsFilledFrameUsed=function(a){this.isFrameUsed=a;var b=this.rectShape.parentNode===this.shape;a&&!b?this.shape.insertBefore(this.rectShape,this.shape.firstChild):!a&&b&&this.shape.removeChild(this.rectShape),this.updateStyle()},e.setIsFilledFrameVisible=function(a){this.rectShape.markup.style.display=a&&this.isFrameUsed?"block":"none"},e.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.text=String(this.currentText),a.isframeused=this.isFrameUsed?1:0,c.addMarkupMetadata(this.shape,a)},e.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},e.getLineHeight=function(){return this.style["font-size"]},e.getTextContainerTransform=function(){this.style["stroke-width"];return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y,")","rotate(",c.radiansToDegrees(-this.rotation),")","scale(1,-1)"].join(" ")},e.getTextTransform=function(){var a=this.getLineHeight();this.style["stroke-width"];return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y-a,")","rotate(",c.radiansToDegrees(-this.rotation),")","scale("+1/d+","+-1/d+")"].join(" ")},e.cloneShape=function(a){a.textShape=c.createMarkupTextSvg(),a.rectShape=c.createMarkupPathSvg(),a.shape=c.createMarkupGroupSvg([a.rectShape,a.textShape]),a.bindDomEvents()},e.getPath=function(){var a=this.style["stroke-width"],b=this.size.x+2*a,d=this.size.y+2*a,e=.5*-b,f=.5*-d,g=[];return c.createRectanglePath(e,f,b,d,!1,g),g},b.MarkupCallout=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_CIRCLE,this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeCircle(this.editor)},d.set=function(a,b){this.setSize(a,b.x,b.y)},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=c.composeRGBAString(a["fill-color"],a["fill-opacity"]),h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=this.size;if(1===a.x||1===a.y)return[""];var b=this.style["stroke-width"],d=a.x,e=a.y,f=d-b,g=e-b,h=.5*b,i=h-.5*d,j=[];return c.createEllipsePath(i,0,f,g,!1,j),j},b.MarkupCircle=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-linejoin","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_CLOUD,this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeCloud(this.editor)},d.set=function(a,b){this.setSize(a,b.x,b.y)},d.updateStyle=function(){
var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=c.composeRGBAString(a["fill-color"],a["fill-opacity"]),h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){function a(a,b,c,d,e){return e.push("a"),e.push(c),e.push(d),e.push(0),e.push(1),e.push(1),e.push(a),e.push(b),e}function b(b,c,d,e,f){switch(b){case"LT":return a(c,-d,c,d,f);case"RT":return a(c,d,c,d,f);case"RB":return a(-c,d,c,d,f);case"LB":return a(-c,-d,c,d,f)}}function d(a,b,c,d){var e=2*c,f=Math.abs(b-a-d),g=Math.round(f/e);e+=(f-e*g)/g,c=.5*e;var h=.05*e,i=3.5*c/3;return{count:g,radius:c,diameter:e,p1:{x:h,y:-i},p2:{x:e-h,y:-i},p3:{x:e,y:0}}}var e=this.position,f=this.size,g=this.style["stroke-width"],h=2*g,i=e.x,j=e.y,k=e.x+f.x,l=e.y+f.y,m=5*h,n=[];if(f.x<m||f.y<m){var o=f.x-g,p=f.y-g,q=.5*-f.x,r=0;c.createEllipsePath(q,r,o,p,!1,n)}else{var s=d(i,k,h,g),t=d(j,l,h,g),u=s.diameter,v=t.diameter,w=s.radius,x=t.radius;s=d(i+u,k-u,h,g),t=d(j+v,l-v,h,g);var y=.5*g,q=.5*-f.x+y+w,r=.5*-f.y+y+2*x;n.push("M"),n.push(q),n.push(r),b("LT",w,x,g,n),function(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(c.p1.x),b.push(c.p1.y),b.push(c.p2.x),b.push(c.p2.y),b.push(c.p3.x),b.push(c.p3.y)}(s,n),b("RT",w,x,g,n),function(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(-c.p1.y),b.push(c.p1.x),b.push(-c.p2.y),b.push(c.p2.x),b.push(-c.p3.y),b.push(c.p3.x)}(t,n),b("RB",w,x,g,n),function(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(-c.p1.x),b.push(-c.p1.y),b.push(-c.p2.x),b.push(-c.p2.y),b.push(-c.p3.x),b.push(-c.p3.y)}(s,n),b("LB",w,x,g,n),function(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(c.p1.y),b.push(-c.p1.x),b.push(c.p2.y),b.push(-c.p2.x),b.push(c.p3.y),b.push(-c.p3.x)}(t,n)}return n.push("z"),n},b.MarkupCloud=a}(),function(){"use strict";function a(a,e){var f=["stroke-width","stroke-color","stroke-opacity","font-size","font-family","font-style","font-weight"];b.Markup.call(this,a,e,f),this.type=b.MARKUP_TYPE_DIMENSION,this.constraintHeight=!0,this.constraintWidth=!0,this.firstAnchor=new THREE.Vector3,this.secondAnchor=new THREE.Vector3,this.shape=c.createMarkupPathSvg(),this.text=c.createMarkupTextSvg(),this.shape.appendChild(this.text),this.textSize={x:0,y:0},this.initialText=d,this.currentText=" ",this.viewer.model.is2d()||(this.preventReposition=!0,this.constraintRotation=!0),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils,d="Add Length";a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var e=a.prototype;e.getEditMode=function(){return new b.EditModeDimension(this.editor)},e.set=function(a,b,c,d,e){var f=new THREE.Vector2(a,b),g=new THREE.Vector2(c,d),h=g.clone().sub(f).normalize();this.size.x=f.distanceTo(g),this.rotation=Math.acos(h.dot(new THREE.Vector2(1,0))),this.rotation=d>b?2*Math.PI-this.rotation:this.rotation;var i=this.firstAnchor,j=this.secondAnchor;i.set(c,d,0),j.set(a,b,0),this.position.x=j.x+.5*(i.x-j.x),this.position.y=j.y+.5*(i.y-j.y),this.currentText=e,this.updateStyle()},e.setRotation=function(a){90===c.radiansToDegrees(a)&&(a=c.degreesToRadians(-90)),this.rotation=a;var b=Math.cos(-a),d=Math.sin(-a),e=new THREE.Vector2(b,d);e.multiplyScalar(.5*this.size.x);var f=new THREE.Vector2(this.position.x,this.position.y),g=f.clone().sub(e),h=f.clone().add(e);this.firstAnchor.set(h.x,h.y,0),this.secondAnchor.set(g.x,g.y,0),this.updateStyle()},e.setSize=function(a,b,c){var d=Math.cos(-this.rotation),e=Math.sin(-this.rotation),f=new THREE.Vector2(d,e);f.multiplyScalar(.5*b);var g=new THREE.Vector2(a.x,a.y),h=g.clone().sub(f),i=g.clone().add(f);this.firstAnchor.set(i.x,i.y,0),this.secondAnchor.set(h.x,h.y,0),this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.updateStyle()},e.updateStyle=function(){var a=this.style,b=this.shape,d=a["stroke-width"],e=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),f=this.getTransform();this.rebuildTextSvg(this.currentText),c.setAttributeToMarkupSvg(b,"d",this.getPath().join(" ")),c.setAttributeToMarkupSvg(b,"stroke-width",d/2),c.setAttributeToMarkupSvg(b,"stroke",e),c.setAttributeToMarkupSvg(b,"fill",e),c.setAttributeToMarkupSvg(b,"transform",f),c.updateMarkupPathSvgHitarea(b,this.editor)},e.rebuildTextSvg=function(a){var b=this.style,d=this.highlighted?this.highlightColor:c.composeRGBAString(b["stroke-color"],b["stroke-opacity"]),e=b["stroke-width"],f=c.createSvgElement("text");f.setAttribute("id","markup"),f.setAttribute("alignment-baseline","middle");var g=this.text,h=this.editor;g.childNodes[0].removeChild(g.markup),g.childNodes[0].appendChild(f),g.markup=f;var i=c.createSvgElement("tspan");i.textContent=a,f.appendChild(i);var j=c.measureTextLines([a],b,h)[0],k=this.textSize=h.sizeFromClientToMarkups(j.width,j.height),l=10*e/2,m=2*e/2,n=k.x+2*e>=this.size.x?m+l/2:m;this.size.y=l+k.y+n;var o=this.getTextTransform(.8*k.y+n,!0),p=this.getTextTransform(k.y+n,!1);c.setAttributeToMarkupSvg(g,"font-family",b["font-family"]),c.setAttributeToMarkupSvg(g,"font-size",b["font-size"]),c.setAttributeToMarkupSvg(g,"font-weight",b["font-weight"]),c.setAttributeToMarkupSvg(g,"font-style",b["font-style"]),c.setAttributeToMarkupSvg(g,"fill",d),c.setMarkupTextSvgTransform(g,p,o),c.updateMarkupTextSvgBackground(g,k.x,k.y,"none"),c.updateMarkupTextSvgClipper(g,k.x,k.y),c.updateMarkupTextSvgHitarea(g,k.x,k.y,h)},e.shouldFlip=function(){return this.firstAnchor.x<this.secondAnchor.x},e.getTextTransform=function(a,b){var d=this.shouldFlip()?-1:1;return b=b?-1:1,90===c.radiansToDegrees(this.rotation)&&(this.rotation=c.degreesToRadians(-90)),["translate(",this.position.x,",",this.position.y,")","rotate(",c.radiansToDegrees(-this.rotation),")","translate(",-d*this.textSize.x/2,",",-d*a,")","scale("+d+","+d*b+")"].join(" ")},e.setPosition=function(a,b){var c=this.firstAnchor,d=this.secondAnchor,e=c.x-d.x,f=c.y-d.y,g=a+.5*e,h=b+.5*f;c.x=g,c.y=h,d.x=g-e,d.y=h-f,this.position.x=d.x+.5*(c.x-d.x),this.position.y=d.y+.5*(c.y-d.y),this.updateStyle()},e.generatePoint3d=function(a){var b=this.editor.positionFromMarkupsToClient(this.firstAnchor.x,this.firstAnchor.y),d=this.editor.positionFromMarkupsToClient(this.secondAnchor.x,this.secondAnchor.y),e=b.clone().sub(d).normalize(),f=c.checkLineSegment(b.x,b.y,b.x+200*e.x,b.y+200*e.y,a),g=f&&this.viewer.clientToWorld(f.x,f.y);return g&&g.point},e.setMetadata=function(){this.text.setAttribute("pointer-events","none");var a=c.cloneStyle(this.style);return a.type=this.type,a.firstAnchor=[this.firstAnchor.x,this.firstAnchor.y].join(" "),a.secondAnchor=[this.secondAnchor.x,this.secondAnchor.y].join(" "),a.text=String(this.currentText),c.addMarkupMetadata(this.shape,a)},e.getText=function(){return this.currentText===this.initialText?"":this.currentText},e.getPath=function(){var a=this.style["stroke-width"],b=this.size.x-a,c=10*a/2;return["M",.5*-b,0,"l",0,c/2,"l",0,-c/2,"l",b,0,"l",0,c/2,"l",0,-c,"l",0,c/2,"l",-b,0,"l",0,-c/2,"z"]},e.cloneShape=function(a){a.shape=c.createMarkupPathSvg(),a.text=c.createMarkupTextSvg(),a.shape.appendChild(a.text),a.bindDomEvents()},b.MarkupDimension=a}(),function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core");a.EVENT_EDITMODE_CHANGED="EVENT_EDITMODE_CHANGED",a.EVENT_EDITMODE_ENTER="EVENT_EDITMODE_ENTER",a.EVENT_EDITMODE_LEAVE="EVENT_EDITMODE_LEAVE",a.EVENT_MARKUP_SELECTED="EVENT_MARKUP_SELECTED",a.EVENT_MARKUP_DRAGGING="EVENT_MARKUP_DRAGGING",a.EVENT_MARKUP_ENTER_EDITION="EVENT_MARKUP_ENTER_EDITION",a.EVENT_MARKUP_CANCEL_EDITION="EVENT_MARKUP_CANCEL_EDITION",a.EVENT_MARKUP_DELETE_EDITION="EVENT_MARKUP_DELETE_EDITION"}(),function(){"use strict";function a(a,c){b.MarkupPen.call(this,a,c),this.type=b.MARKUP_TYPE_FREEHAND}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.MarkupPen.prototype),a.prototype.constructor=a,a.prototype.getEditMode=function(){return new b.EditModeFreehand(this.editor)},b.MarkupFreehand=a}(),function(){"use strict";function a(a,c){b.MarkupPen.call(this,a,c),this.type=b.MARKUP_TYPE_HIGHLIGHT}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.MarkupPen.prototype),a.prototype.constructor=a,a.prototype.getEditMode=function(){return new b.EditModeHighlight(this.editor)},b.MarkupHighlight=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_POLYLINE,this.shape=c.createMarkupPathSvg("path"),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModePolyline(this.editor)},d.set=function(a,b,c,d){this.rotation=0,this.locations=c.concat(),this.size.x=0===b.x?1:b.x,this.size.y=0===b.y?1:b.y,this.closed=d,this.setSize(a,b.x,b.y),this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.style["stroke-width"],e=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),f=this.closed?c.composeRGBAString(a["fill-color"],a["fill-opacity"]):"none",g=this.getTransform();c.setAttributeToMarkupSvg(b,"d",this.getPath().join(" ")),c.setAttributeToMarkupSvg(b,"stroke-width",d),c.setAttributeToMarkupSvg(b,"stroke",e),c.setAttributeToMarkupSvg(b,"fill",f),c.setAttributeToMarkupSvg(b,"transform",g),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setSize=function(a,b,c){b=0===b?1:b,c=0===c?1:c;for(var d=this.locations,e=d.length,f=b/this.size.x,g=c/this.size.y,h=0;h<e;++h){var i=d[h];i.x*=f,i.y*=g}this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),a.locations=this.locations.map(function(a){return[a.x,a.y].join(" ")}).join(" "),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=[],b=this.locations,c=b.length;if(0===c)return" ";a.push("M"),a.push(b[0].x),a.push(b[0].y);for(var d=1;d<c;++d){var e=b[d-1],f=b[d];a.push("l"),a.push(f.x-e.x),a.push(f.y-e.y)}return this.closed&&a.push("z"),a},b.MarkupPolyline=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_POLYCLOUD,this.locations=[],this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModePolycloud(this.editor)},d.set=function(a,b,c,d){this.rotation=0,this.locations=c.concat(),this.size.x=0===b.x?1:b.x,this.size.y=0===b.y?1:b.y,this.closed=d,this.setSize(a,b.x,b.y),this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=this.closed?c.composeRGBAString(a["fill-color"],a["fill-opacity"]):"none",h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setSize=function(a,b,c){b=0===b?1:b,c=0===c?1:c;for(var d=this.locations,e=d.length,f=b/this.size.x,g=c/this.size.y,h=0;h<e;++h){var i=d[h];i.x*=f,i.y*=g}this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),a.locations=this.locations.map(function(a){return[a.x,a.y].join(" ")}).join(" "),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=this.style["stroke-width"],b=2*a,c=function(a){switch(a.length){case 0:case 1:return 1;case 2:var b=a[0],c=a[1];return b.y>c.y?1:-1;default:var d=a[0],e=a[1],f=a[2];return(e.x-d.x)*(e.y+d.y)+(f.x-e.x)*(f.y+e.y)<0?1:-1}}(this.locations),d=this.closed,e=[],f=function(a,b){for(var c=a.length,d=[],e=c-(b?0:1),f=0;f<e;++f){var g=a[f],h=a[(f+1)%c],i=h.x-g.x,j=h.y-g.y,k=Math.sqrt(i*i+j*j);d.push({index:f,pointA:new THREE.Vector3(g.x,g.y,0),pointB:new THREE.Vector3(h.x,h.y,0),vecAB:new THREE.Vector3(i/k,j/k,0),vecBA:new THREE.Vector3(-i/k,-j/k,0),length:k})}return d}(this.locations,d),g=function(a,b,c){for(var d=[],e=a.length,f=0;f<e;++f){var g=a[0!==f?f-1:e-1],h=a[f],i=g.vecBA.clone().cross(h.vecAB).z<0;g.length<b||h.length<b||0===f&&!c?d.push({pointA:h.pointA.clone(),pointB:h.pointA.clone(),radius:0,large:!1}):d.push({pointA:h.pointA.clone().add(g.vecBA.clone().multiplyScalar(b)),pointB:h.pointA.clone().add(h.vecAB.clone().multiplyScalar(b)),radius:b,large:i})}return d}(f,b,d),h=g.length;!function(a,b,c){for(var d=2*c,e=a.length,f=0;f<e;++f){var g=a[f],h=b[f],i=b[(f+1)%e];g.bodyA=g.vecAB.clone().multiplyScalar(h.radius).add(g.pointA),g.bodyB=g.vecBA.clone().multiplyScalar(i.radius).add(g.pointB),g.body=g.bodyB.clone().sub(g.bodyA).length(),g.bodyCount=Math.round(g.body/d),g.bodyDiameter=d+(g.body-d*g.bodyCount)/g.bodyCount,g.bodyRadius=.5*g.bodyDiameter}}(f,g,b);for(var i=0;i<h;++i)!function(a,b,c,d){b&&(d.push("M"),d.push(a.pointA.x),d.push(a.pointA.y));var e=1===c?a.large:!a.large;0!==a.radius&&(d.push("a"),d.push(a.radius),d.push(a.radius),d.push(0),d.push(e?1:0),d.push(1===c?1:0),d.push(a.pointB.x-a.pointA.x),d.push(a.pointB.y-a.pointA.y))}(g[i],0===i,c,e),function(a,b,c){var d=a.bodyRadius,e=a.bodyDiameter,f=.05*e,g=3.5*d/3,h=new THREE.Vector3(f,b*-g),i=new THREE.Vector3(e-f,b*-g),j=new THREE.Vector3(e,0),k=Math.acos(a.vecAB.x)*(a.vecAB.y<0?-1:1),l=(new THREE.Matrix4).makeRotationZ(k);h.applyMatrix4(l),i.applyMatrix4(l),j.applyMatrix4(l);for(var m=a.bodyCount,n=0;n<m;++n)c.push("c"),c.push(h.x),c.push(h.y),c.push(i.x),c.push(i.y),c.push(j.x),c.push(j.y)}(f[i],c,e);return d&&e.push("z"),e},b.MarkupPolycloud=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_RECTANGLE,this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeRectangle(this.editor)},d.set=function(a,b){this.position.x=a.x,this.position.y=a.y,this.size.x=b.x,this.size.y=b.y,this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=c.composeRGBAString(a["fill-color"],a["fill-opacity"]),h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=this.style["stroke-width"],b=this.size.x-a,d=this.size.y-a,e=.5*-b,f=.5*-d,g=[];return c.createRectanglePath(e,f,b,d,!1,g),g},b.MarkupRectangle=a}(),function(){"use strict";function a(a,d,e){var f=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];b.Markup.call(this,a,d,f),this.type=b.MARKUP_TYPE_TEXT,this.shape=c.createMarkupTextSvg(),this.constraintRotation=!0,this.size.x=e.x,this.size.y=e.y,this.currentText="",this.currentTextLines=[""],this.textDirty=!0,this.textSize={x:0,y:0},this.lineHeight=130,this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils,d=100;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var e=a.prototype;e.getEditMode=function(){return new b.EditModeText(this.editor)},e.set=function(a,b,c,d){this.position.x=a.x,this.position.y=a.y,this.size.x=b.x,this.size.y=b.y,this.setText(c,d)},e.setSize=function(a,b,c){this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},e.setStyle=function(a){c.copyStyle(a,this.style),this.updateStyle()},e.setText=function(a){this.currentText=a,this.updateStyle()},e.getText=function(){return this.currentText},e.getTextLines=function(){return this.currentTextLines.concat()},e.updateStyle=function(){function a(){var a=this.style,b=this.shape,e=this.style["font-size"],f=this.style["font-family"],g=this.style["font-weight"],h=this.style["font-style"],i=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),j=c.composeRGBAString(a["fill-color"],a["fill-opacity"]);this.rebuildTextSvg(),c.setAttributeToMarkupSvg(b,"font-family",f),c.setAttributeToMarkupSvg(b,"font-size",e*d),c.setAttributeToMarkupSvg(b,"fill",i),c.setAttributeToMarkupSvg(b,"font-weight",g),c.setAttributeToMarkupSvg(b,"font-style",h);var k=this.editor,l=this.getTransform(),m=this.getTextTransform(),n=this.textSize;c.setMarkupTextSvgTransform(b,l,m),c.updateMarkupTextSvgBackground(b,n.x,n.y,j),c.updateMarkupTextSvgClipper(b,n.x,n.y),c.updateMarkupTextSvgHitarea(b,n.x,n.y,k),this.applyingStyle=!1}this.applyingStyle=this.applyingStyle||!1,this.applyingStyle||(this.applyingStyle=!0,a.bind(this)(),requestAnimationFrame(a.bind(this)))},e.rebuildTextSvg=function(){var a=this.editor.duringEditMode&&this.editor.editMode;a&&a.type===this.type||(a=this.getEditMode());var b=c.cloneStyle(a.textInputHelper.style),e=a.textInputHelper.textArea.value;this.currentTextLines=a.textInputHelper.getTextValuesForMarkup(this).lines,a.selectedMarkup!==this&&(a.textInputHelper.textArea.value=e,a.textInputHelper.setStyle(b));var f=c.createSvgElement("text");f.setAttribute("id","markup"),f.setAttribute("alignment-baseline","middle"),this.shape.childNodes[0].removeChild(this.shape.markup),this.shape.childNodes[0].appendChild(f),this.shape.markup=f;var g=0,h=this.getLineHeight()*d;this.currentTextLines.forEach(function(a){var b=c.createSvgElement("tspan");b.setAttribute("x",0),b.setAttribute("y",g),b.textContent=a,f.appendChild(b),g+=h}.bind(this));var i=this.generateBoundingPolygon(),j=this.editor.sizeFromClientToMarkups(i.xVertices[1]-i.xVertices[0],i.yVertices[2]-i.yVertices[0]);this.textSize.x=Math.min(j.x,this.size.x),this.textSize.y=Math.min(j.y,this.size.y)},e.generateBoundingPolygon=function(){var a=this.getClientPosition(),b=this.getClientSize(),d=function(a,b,d){for(var e={w:0,h:0},a=c.measureTextLines(a,b,d),f=a.length,g=0;g<f;++g){var h=a[g];e.w=Math.max(e.w,h.width),e.h=e.h+h.height}return 0!==e.h&&(e.h+=d.sizeFromMarkupsToClient(0,.25*b["font-size"]).y),e}(this.currentTextLines,this.style,this.editor),e=Math.min(b.x,d.w),f=Math.min(b.y,d.h),g=new THREE.Vector2(.5*-b.x,.5*-b.y).add(a),h=new THREE.Vector2(g.x+e,g.y),i=new THREE.Vector2(h.x,h.y+f),j=new THREE.Vector2(g.x,i.y);return{vertexCount:4,xVertices:new Float32Array([g.x,h.x,i.x,j.x]),yVertices:new Float32Array([g.y,h.y,i.y,j.y])}},e.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.text=String(this.currentText),c.addMarkupMetadata(this.shape,a)},e.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},e.getLineHeight=function(){return this.style["font-size"]},e.getTransform=function(){return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y,")","rotate(",c.radiansToDegrees(-this.rotation),")","scale(1,-1)"].join(" ")},e.getTextTransform=function(){var a=this.getLineHeight();return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y-a,")","rotate(",c.radiansToDegrees(-this.rotation),")","scale("+1/d+","+-1/d+")"].join(" ")},e.cloneShape=function(a){a.shape=c.createMarkupTextSvg(),a.bindDomEvents()},b.MarkupText=a}(),function(){"use strict";function a(){Autodesk.Viewing.ToolInterface.call(this),this.names=["markups.core"],this.panTool=null,this.allowNav=!1,this.is2d=!1,this.coreExt=null,this.hotkeysEnabled=!0;var a=!1,b=!1;this.allowNavigation=function(a){this.allowNav=a},this.setCoreExtension=function(a){this.coreExt=a},this.setHotkeysEnabled=function(a){this.hotkeysEnabled=a},this.activate=function(a,b){this.panTool=b.toolController.getTool("pan"),this.panTool&&this.panTool.activate("pan"),this.is2d=b.model.is2d(),this.viewer=b},this.deactivate=function(a){this.panTool&&this.panTool.deactivate("pan")},this.handleKeyDown=function(c,d){if(!this.coreExt.editMode)return!1;if(!this.hotkeysEnabled)return!0;switch(d){case Autodesk.Viewing.KeyCode.CONTROL:a=!0;break;case Autodesk.Viewing.KeyCode.SHIFT:b=!0;break;case Autodesk.Viewing.KeyCode.x:a&&!this.allowNav&&this.coreExt.cut();break;case Autodesk.Viewing.KeyCode.c:a&&!this.allowNav&&this.coreExt.copy();break;case Autodesk.Viewing.KeyCode.v:a&&!this.allowNav&&this.coreExt.paste();break;case Autodesk.Viewing.KeyCode.d:a&&!this.allowNav&&(this.coreExt.copy(),this.coreExt.paste());break;case Autodesk.Viewing.KeyCode.z:!a||b||this.allowNav?a&&b&&!this.allowNav&&this.coreExt.redo():this.coreExt.undo();break;case Autodesk.Viewing.KeyCode.y:a&&!this.allowNav&&this.coreExt.redo();break;case Autodesk.Viewing.KeyCode.ESCAPE:this.coreExt.onUserCancel();break;case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:var e=this.coreExt.getSelection();e&&this.coreExt.deleteMarkup(e);break;case Autodesk.Viewing.KeyCode.F12:return!1}return!0},this.handleKeyUp=function(c,d){if(!this.coreExt.editMode)return!1;if(!this.hotkeysEnabled)return!0;switch(d){case Autodesk.Viewing.KeyCode.CONTROL:a=!1;break;case Autodesk.Viewing.KeyCode.SHIFT:b=!1}return!0},this.update=function(){return!!(this.allowNav&&this.panTool&&this.panTool.update)&&this.panTool.update()},this.handleSingleClick=function(a,b){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleClick)&&this.panTool.handleSingleClick(a,b)},this.handleDoubleClick=function(a,b){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleClick)&&this.panTool.handleDoubleClick(a,b)},this.handleSingleTap=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleTap)&&this.panTool.handleSingleTap(a)},this.handleDoubleTap=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleTap)&&this.panTool.handleDoubleTap(a)},this.handleWheelInput=function(a){return!this.allowNav&&!this.is2d||!(!this.panTool||!this.panTool.handleWheelInput)&&(this.coreExt.callSnapperMouseMove(),this.panTool.handleWheelInput(a))},this.handleButtonDown=function(a,b){return!(this.allowNav||this.is2d&&c.isRightClick(a,this.viewer.navigation))||!(!this.panTool||!this.panTool.handleButtonDown)&&this.panTool.handleButtonDown(a,b)},this.handleButtonUp=function(a,b){return!(this.allowNav||this.is2d&&c.isRightClick(a,this.viewer.navigation))||!(!this.panTool||!this.panTool.handleButtonUp)&&this.panTool.handleButtonUp(a,b)},this.handleMouseMove=function(a){return!this.allowNav&&!this.is2d||!(!this.panTool||!this.panTool.handleMouseMove)&&this.panTool.handleMouseMove(a)},this.handleGesture=function(a){return!this.allowNav&&!this.is2d||!(!this.panTool||!this.panTool.handleGesture)&&this.panTool.handleGesture(a)},this.handleBlur=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleBlur)&&this.panTool.handleBlur(a)}}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Private;b.MarkupTool=a}(),function(){"use strict";function a(a,d){Autodesk.Viewing.Extension.call(this,a,d),this.options=this.options||{},this.markups=[],this.styles={},this.activeLayer="",this.duringViewMode=!1,this.duringEditMode=!1,this.svgLayersMap={},this.actionManager=new b.EditActionManager(50),this.actionManager.addEventListener(b.EVENT_HISTORY_CHANGED,this.onEditActionHistoryChanged.bind(this)),this.nextId=0,this.clipboard=new b.Clipboard(this),this.input=new b.InputHandler,c.addTraitEventDispatcher(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onViewerResizeBinded=function(a){var b=this;b.onViewerResize(a),requestAnimationFrame(function(){b.duringViewMode&&b.onViewerResize(a)})}.bind(this),this.onMarkupSelectedBinded=this.onMarkupSelected.bind(this),this.onMarkupEnterEditionBinded=this.onMarkupEnterEdition.bind(this),this.onMarkupCancelEditionBinded=this.onMarkupCancelEdition.bind(this),this.onMarkupDeleteEditionBinded=this.onMarkupDeleteEdition.bind(this),this.onToolChangeBinded=this.onToolChange.bind(this),this.onUnitsCalibrationStartsBinded=this.onUnitsCalibrationStarts.bind(this),a.addEventListener(Autodesk.Viewing.Extensions.Measure.UNITS_CALIBRATION_STARTS_EVENT,this.onUnitsCalibrationStartsBinded);var e=c.createStyleSheet();c.addRuleToStyleSheet(e,".autodesk-markups-extension-core-make-me-bigger:after",'content:""; position:absolute; top:-10px; bottom:-10px; left:-10px; right:-10px;',0)}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),c=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils"),d=(Autodesk.Viewing.Extensions.Measure,Autodesk.Viewing.Extensions.Measure.Functions);a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a,b.MarkupsCore=a;var e=a.prototype;e.load=function(){var a=this.svg=c.createSvgElement("svg");c.setSvgParentAttributes(a);var d=new c.DomElementStyle;d.setAttribute("position","absolute"),d.setAttribute("left","0"),d.setAttribute("top","0"),d.setAttribute("transform","scale(1,-1)",{allBrowsers:!0}),d.setAttribute("transformOrigin","0, 0",{allBrowsers:!0}),a.setAttribute("style",d.getStyleString()),this.bounds={x:0,y:0,width:0,height:0},this.input.attachTo(this),this.editFrame=new b.EditFrame(this.viewer.container,this),this.editFrame.addEventListener(b.EVENT_EDITFRAME_EDITION_START,function(){this.disableMarkupInteractions(!0)}.bind(this)),this.editFrame.addEventListener(b.EVENT_EDITFRAME_EDITION_END,function(){this.disableMarkupInteractions(!1)}.bind(this));var e=this.options.markupToolClass||b.MarkupTool;return this.changeMarkupTool(e,!this.options.markupDisableHotkeys),this.snapper=new Autodesk.Viewing.Extensions.Measure.Snapper(this.viewer,{markupMode:!0}),this.viewer.toolController.registerTool(this.snapper),!0},e.changeMarkupTool=function(a,b){this.markupTool&&(this.viewer.toolController.deregisterTool(this.markupTool),this.markupTool=null),this.markupTool=new a,this.markupTool.setCoreExtension(this),this.markupTool.setHotkeysEnabled(b),this.viewer.toolController.registerTool(this.markupTool)},e.unload=function(){this.hide(),this.input.detachFrom(this),this.markupTool&&(this.viewer.toolController.deregisterTool(this.markupTool),this.markupTool=null),this.snapper&&(this.viewer.toolController.deregisterTool(this.snapper),this.snapper=null);var a=this.svg;return a&&this.onMouseDownBinded&&(a.removeEventListener("mousedown",this.onMouseDownBinded),this.onMouseDownBinded=null),a.parentNode&&a.parentNode.removeChild(a),this.editModeSvgLayerNode=null,this.svg=null,!0},a.prototype.toggleEditMode=function(){this.duringEditMode?this.leaveEditMode():this.enterEditMode()},a.prototype.enterEditMode=function(a){function d(a,b){if(a)for(var c=a.markups,d=0;d<c.length;d++){var e=c[d];e.disableInteractions(b)}}if(a&&!this.svgLayersMap[a])return console.warn("No such layer exists."),!1;if(!this.duringViewMode&&!this.show())return!1;if(!this.editModeSvgLayerNode){var e=c.createSvgElement("g");this.editModeSvgLayerNode={markups:[],svg:e},this.editModeSvgLayerNode.svg.setAttribute("cursor","default")}if(this.editModeSvgLayerNode.svg.parentNode==this.svg&&a||this.svg.appendChild(this.editModeSvgLayerNode.svg),this.svg.setAttribute("cursor","crosshair"),a){var f=this.svgLayersMap[a];if(f){var g=this.editModeSvgLayerNode.svg.parentNode;g&&g.removeChild(this.editModeSvgLayerNode.svg),d(this.editModeSvgLayerNode,!0);for(var h in this.svgLayersMap)for(var i=this.svgLayersMap[h].markups,j=0;j<i.length;j++){var k=i[j];h!==a.toString()?k.disableInteractions(!0):k.disableInteractions(!1)}this.activeLayer=a,this.editingLayer=a;var l=f.svg;l.parentNode&&this.svg.removeChild(l),this.markups=f.markups.slice(),this.svg.appendChild(l)}}else{if(this.editingLayer){for(var m=0;m<this.markups.length;m++){this.markups[m].disableInteractions(!0)}d(this.editModeSvgLayerNode,!1)}this.editingLayer="",this.editModeSvgLayerNode?this.markups=this.editModeSvgLayerNode.markups.slice():this.markups=[],this.activeLayer=""}return this.input.enterEditMode(),this.activateTool(!0),this.styles={},this.defaultStyle=null,this.duringEditMode=!0,this.changeEditMode(new b.EditModeArrow(this)),this.actionManager.clear(),this.dispatchEvent({type:b.EVENT_EDITMODE_ENTER}),this.allowNavigation(!1),!0},a.prototype.leaveEditMode=function(){return!this.duringEditMode||!this.duringViewMode||!!this.viewer&&(this.editMode.destroy(),this.editMode=null,this.duringEditMode=!1,this.snapper&&(this.snapper.indicator.clearOverlays(),this.snapper.clearSnapped()),this.editModeSvgLayerNode&&this.editModeSvgLayerNode.svg.parentNode&&this.svg.removeChild(this.editModeSvgLayerNode.svg),this.svg.setAttribute("cursor","default"),this.input.leaveEditMode(),this.editFrame.setMarkup(null),this.activateTool(!0),this.allowNavigation(!0),this.dispatchEvent({type:b.EVENT_EDITMODE_LEAVE}),!0)},a.prototype.toggle=function(){this.duringViewMode?this.hide():this.show()},a.prototype.show=function(){var a=this.viewer;if(!a||!a.model||!this.svg)return!1;if(this.duringViewMode||this.duringEditMode)return!0;a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded),a.container.appendChild(this.svg),this.input.enterViewMode(),c.hideLmvUi(a),this.onViewerRolloverObject=a.impl.rolloverObject,a.impl.rolloverObject=function(){},this.activateTool(!0);var b=a.impl.camera;return this.onViewerResize({width:b.clientWidth,height:b.clientHeight}),this.svgLayersMap={},this.duringViewMode=!0,this.allowNavigation(!0),!0},a.prototype.hide=function(){var a=this.viewer;if(!a||!this.duringViewMode)return!0;if(this.duringEditMode&&!this.leaveEditMode())return!1;a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded);var b=this.svg;return b.parentNode&&b.parentNode.removeChild(b),this.unloadMarkupsAllLayers(),c.removeAllMetadata(b),this.input.leaveViewMode(),c.restoreLmvUi(a),this.viewer.impl.rolloverObject=this.onViewerRolloverObject,this.activateTool(!1),this.duringViewMode=!1,!0},a.prototype.clear=function(){
if(!this.duringEditMode)return void console.warn("Clear only removes markups when in Edit Mode.");var a=this.editingLayer?this.svgLayersMap[this.editingLayer]:this.editModeSvgLayerNode;if(a){var b=a.markups,c=a.svg;if(c&&c.childNodes.length>0)for(;c.childNodes.length;)c.removeChild(c.childNodes[0]);for(;b.length>0;){var d=b[0];this.removeMarkup(d),d.destroy()}}},a.prototype.generateData=function(){var a=this.editModeSvgLayerNode.svg;this.editMode&&this.editMode.onSave(),c.removeAllMetadata(this.svg),this.activeLayer&&(a=this.svgLayersMap[this.activeLayer].svg);var b=c.createSvgElement("svg");c.transferChildNodes(this.svg,b),c.transferChildNodes(a,this.svg);var d={"data-model-version":"4"},e=c.addSvgMetadata(this.svg,d),f=[e];this.markups.forEach(function(a){var b=a.setMetadata();b&&f.push(b)});var g=c.svgNodeToString(this.svg);return f.forEach(function(a){a.parentNode.removeChild(a)}),c.transferChildNodes(this.svg,a),c.transferChildNodes(b,this.svg),b=null,g},a.prototype.generatePoints3d=function(){var a={markups:[],main:null},d=this.markups,e=d.length;if(0===e)return a;for(var f=this.viewer.impl.renderer().readbackTargetId(),g=0;g<e;++g){var h=d[g],i=h.generatePoint3d(f)||null;a.markups.push({id:h.id,type:h.type,point:i||null})}if(1===e){var j=a.markups[0].point;return a.main=j&&j.clone(),a}for(var g=0;g<e;++g){var k=a.markups[g];if(k.type===b.MARKUP_TYPE_ARROW&&null!==k.point)return a.main=k.point.clone(),a}for(var l=Number.POSITIVE_INFINITY,m=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,g=0;g<e;++g){var p=d[g].generateBoundingBox();l=Math.min(l,p.min.x),m=Math.min(m,p.min.y),n=Math.max(n,p.max.x),o=Math.max(o,p.max.y)}var q={};q.vertexCount=4,q.xVertices=new Float32Array([l,n,n,l]),q.yVertices=new Float32Array([m,m,o,o]);var r=c.checkPolygon(q,f),s=r&&this.viewer.clientToWorld(r.x,r.y);return a.main=s&&s.point,a},a.prototype.renderToCanvas=function(a,b){var c=this.bounds.width,d=this.bounds.height,e=this.getSvgViewBox(c,d),f=0,g=function(){b&&++f===this.markups.length&&b()}.bind(this);(this.svgLayersMap[this.activeLayer]||this.editModeSvgLayerNode).markups.forEach(function(b){b.renderToCanvas(a,e,c,d,g)})},a.prototype.changeEditMode=function(a){var d=this.editMode;d&&d.destroy(),a.addEventListener(b.EVENT_EDITMODE_CREATION_BEGIN,function(){this.disableMarkupInteractions(!0)}.bind(this)),a.addEventListener(b.EVENT_EDITMODE_CREATION_END,function(){this.disableMarkupInteractions(!1)}.bind(this)),a.addEventListener(b.EVENT_MARKUP_DESELECT,function(a){this.dispatchEvent(a)}.bind(this)),this.editMode=a,this.styles[a.type]=c.cloneStyle(a.getStyle()),this.dispatchEvent({type:b.EVENT_EDITMODE_CHANGED,target:a})},a.prototype.isNavigationAllowed=function(){return!this.viewer.impl.camera.isPerspective},a.prototype.allowNavigation=function(a){var b=this.editMode;this.navigating=a,a?(this.svg.setAttribute("pointer-events","none"),b&&this.selectMarkup(null)):this.svg.setAttribute("pointer-events","painted");for(var c=this.markups,d=c.length,e=0;e<d;++e)c[e].updateStyle();if(b&&b.notifyAllowNavigation(a),a&&(this.duringEditMode||this.duringViewMode)&&!this.isNavigationAllowed())return!1;a&&this.snapper&&(this.snapper.indicator.clearOverlays(),this.snapper.clearSnapped()),this.markupTool.allowNavigation(a)},a.prototype.disableMarkupInteractions=function(a){this.editModeSvgLayerNode&&this.editModeSvgLayerNode.svg.setAttribute("cursor",a?"inherit":"default"),this.markups.forEach(function(b){b.disableInteractions(a)})},Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.prototype.activateTool=function(a){if(a)this.cachedNavigationTool||(this.cachedNavigationTool=this.viewer.getActiveNavigationTool(),this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)),this.viewer.setActiveNavigationTool(this.markupTool.getName());else{if(this.cachedNavigationTool)this.viewer.setActiveNavigationTool(this.cachedNavigationTool),this.cachedNavigationTool=null;else{var b=this.viewer.getDefaultNavigationToolName();this.viewer.setActiveNavigationTool(b)}this.viewer.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)}},Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.prototype.onToolChange=function(a){if(a.toolName===this.markupTool.getName()){if(a.active){var b=this.isNavigationAllowed();this.viewer.setNavigationLockSettings({pan:b,zoom:b,orbit:!1,roll:!1,fov:!1,walk:!1,gotoview:!1})}this.viewer.setNavigationLock(a.active)}},Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.prototype.onUnitsCalibrationStarts=function(a){this.duringEditMode&&this.hide()},e.changeInputHandler=function(a){this.input.detachFrom(this),a.attachTo(this),this.input=a,this.duringEditMode&&a.enterEditMode(),this.duringViewMode&&a.enterViewMode()},a.prototype.copy=function(){this.clipboard.copy()},a.prototype.cut=function(){this.clipboard.cut()},a.prototype.paste=function(){this.clipboard.paste()},a.prototype.undo=function(){this.actionManager.undo()},a.prototype.redo=function(){this.actionManager.redo()},a.prototype.isUndoStackEmpty=function(){return this.actionManager.isUndoStackEmpty()},a.prototype.isRedoStackEmpty=function(){return this.actionManager.isRedoStackEmpty()},e.beginActionGroup=function(){this.actionManager.beginActionGroup()},e.closeActionGroup=function(){this.actionManager.closeActionGroup()},e.cancelActionGroup=function(){this.actionManager.cancelActionGroup()},e.getId=function(){return++this.nextId},e.onEditActionHistoryChanged=function(a){var b=a.data,c=this.editMode,d=c&&c.selectedMarkup&&c.selectedMarkup.id===b.targetId;if("undo"!==b.action&&-1!==b.targetId||"undo"===b.action&&d){var e=this.getMarkup(b.targetId);this.selectMarkup(e)}this.dispatchEvent(a)},a.prototype.getMarkup=function(a){for(var b=this.markups,c=b.length,d=0;d<c;++d)if(b[d].id==a)return b[d];return null},a.prototype.selectMarkup=function(a){if(a)if(this.editMode.type===a.type)this.editMode.setSelection(a);else{var b=a.getEditMode();b.setSelection(null),this.changeEditMode(b),this.setStyle(a.getStyle()),this.editMode.setSelection(a)}else this.editMode&&this.editMode.setSelection(null)},a.prototype.getSelection=function(){return this.editMode.getSelection()},a.prototype.deleteMarkup=function(a,b){(!this.editMode||this.editMode&&this.editMode.selectedMarkup.id!==a.id)&&(this.editMode=a.getEditMode()),this.editMode.deleteMarkup(a,b)},e.addMarkup=function(a){var c,d=this.activeLayer,e=this.svgLayersMap[d]||"";if(e){var f=e.svg;a.setParent(f),e.markups.push(a),c=e.markups.slice()}else a.setParent(this.editModeSvgLayerNode.svg),this.editModeSvgLayerNode.markups.push(a),c=this.editModeSvgLayerNode.markups.slice();a.addEventListener(b.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),a.addEventListener(b.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),a.addEventListener(b.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),a.addEventListener(b.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded),this.duringEditMode&&(this.markups=c)},e.removeMarkup=function(a){if(!a)return!1;var c=this;if(-1===function(a){var b,d=-1;if(c.editModeSvgLayerNode){var e=c.editModeSvgLayerNode.markups;if(-1!==(b=e.indexOf(a)))return e.splice(b,1),d=e.slice(),""===c.activeLayer&&(c.markups=d),d}if(c.svgLayersMap)for(var f in c.svgLayersMap){var g=c.svgLayersMap[f].markups;if(-1!==(b=g.indexOf(a)))return g.splice(b,1),d=g.slice(),c.activeLayer===f&&(c.markups=d),d}return d}(a))return!1;a.setParent(null),a.removeEventListener(b.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),a.removeEventListener(b.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),a.removeEventListener(b.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),a.removeEventListener(b.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded);var d=this.editMode;if(d){d.getSelection()===a&&this.selectMarkup(null)}},a.prototype.setStyle=function(a){var b=this.styles,d=this.editMode;c.copyStyle(a,b[d.type]),d.setStyle(b[d.type])},a.prototype.getStyle=function(){return c.cloneStyle(this.styles[this.editMode.type])},a.prototype.getDefaultStyle=function(){var a=["stroke-width","font-size","font-family","font-style","font-weight","stroke-color","stroke-opacity","fill-color","fill-opacity"];return this.defaultStyle=this.defaultStyle||c.createStyle(a,this),this.defaultStyle},e.bringToFront=function(a){this.sendMarkupTo(a,this.markups.length-1)},e.sendToBack=function(a){this.sendMarkupTo(a,0)},e.bringForward=function(a){var b=this.markups.indexOf(a);this.sendMarkupTo(a,b+1)},e.bringBackward=function(a){var b=this.markups.indexOf(a);this.sendMarkupTo(a,b-1)},e.sendMarkupTo=function(a,b){var c=this.markups,d=c.indexOf(a);if(!(-1===d||b<0||b>=c.length))if(c.splice(d,1),b=d>b?b-1:b,c.splice(b,0,a),a.setParent(null),this.activeLayer){var e=this.svgLayersMap[this.activeLayer].svg;a.setParent(e)}else a.setParent(this.editModeSvgLayerNode.svg)},a.prototype.loadMarkups=function(a,b){if(this.duringEditMode)return console.warn("Markups will not be loaded during the edit mode"),!1;if(!this.duringViewMode)return!1;if(!b)return console.warn("loadMarkups failed; missing 2nd argument 'layerId'"),!1;var d=c.stringToSvgNode(a);if(!d)return!1;var e=d.childNodes[0].childNodes[0];parseFloat(e.getAttribute("data-model-version"));if(b in this.svgLayersMap&&this.svg.children.length>0)return console.warn("This layer is already loaded, will not load again."),!1;this.activeLayer=b;var f=this.svgLayersMap[b];f&&delete this.svgLayersMap[b],f={markups:[],svgString:a,svg:this.createLayerNode()},this.svgLayersMap[b]=f;for(var g=d.childNodes,h=0;h<g.length;h++){var i=g[h],j=c.createMarkupFromSVG(i,this);j&&this.duringEditMode&&this.editingLayer!==this.activeLayer&&j.disableInteractions(!0)}var k=this.svgLayersMap[this.activeLayer].svg;return this.svg.appendChild(k),this.duringEditMode&&this.editingLayer!==this.activeLayer&&(this.activeLayer=this.editingLayer,this.editingLayer&&(this.markups=this.svgLayersMap[this.activeLayer].markups.slice())),!0},e.createLayerNode=function(){var a=c.createSvgElement("g");return a.setAttribute("cursor","default"),a},a.prototype.revertLayer=function(a){if(!a)return console.warn("revertLayer failed because no layerId was supplied."),!1;var b=this.svgLayersMap[a];if(!b)return console.warn("The supplied layer does not exist."),!1;this.duringEditMode&&this.leaveEditMode();var c=this.markups.slice();this.markups=b.markups;var d=b.svgString;if(this.unloadMarkups(a),this.loadMarkups(d,a),this.editingLayer){if(this.editingLayer!==a){this.markups=c;var e=this.svgLayersMap[this.editingLayer];e&&(e.markups=c)}}else this.editModeSvgLayerNode&&(this.editModeSvgLayerNode.markups=c);if(this.editingLayer||0===this.editingLayer.length){var f=0===this.editingLayer.length?this.editModeSvgLayerNode.svg:this.svgLayersMap[this.editingLayer].svg;f.parentNode==this.svg&&(this.svg.removeChild(f),this.svg.appendChild(f))}return!0},a.prototype.unloadMarkups=function(a){if(!a)return console.warn("unloadMarkups failed; No layerId provided."),!1;var b=this.svgLayersMap[a];if(!b)return console.warn("No such layer exists to unload."),!1;for(var c=b.markups.slice(),d=c.length,e=0;e<d;e++){var f=c[e];this.removeMarkup(f),f.destroy()}return b.svg.parentNode===this.svg&&this.svg.removeChild(b.svg),delete this.svgLayersMap[a],this.activeLayer.toString()===a.toString()&&(this.activeLayer=""),this.editingLayer&&this.editingLayer.toString()===a.toString()&&(this.editingLayer="",this.duringEditMode&&this.leaveEditMode()),!0},a.prototype.unloadMarkupsAllLayers=function(){this.activeLayer="";var a=this;!function(){if(a.editModeSvgLayerNode)for(var b=a.editModeSvgLayerNode.markups.slice(),c=b.length,d=0;d<c;d++){var e=b[d];a.removeMarkup(e),e.destroy()}}();var b;for(b in this.svgLayersMap)this.unloadMarkups(b)},a.prototype.hideMarkups=function(a){if(!a)return console.warn("hideMarkups failed; No layerId provided."),!1;var b=this.svgLayersMap[a];if(!b)return!1;var c=b.svg;return c.parentNode!=this.svg?(console.warn("Layer is already hidden."),!1):(this.svg.removeChild(c),!0)},a.prototype.showMarkups=function(a){if(!a)return console.warn("showMarkups failed; No layerId provided."),!1;var b=this.svgLayersMap[a];if(!b)return!1;var c=b.svg;this.svg.appendChild(c)},e.positionFromClientToMarkups=function(a,b){return this.clientToMarkups(a,b)},e.positionFromMarkupsToClient=function(a,b){return this.markupsToClient(a,b)},e.vectorFromClientToMarkups=function(a,b){var c=this.clientToMarkups(0,0),d=this.clientToMarkups(a,b);return{x:d.x-c.x,y:d.y-c.y}},e.vectorFromMarkupsToClient=function(a,b){var c=this.markupsToClient(0,0),d=this.markupsToClient(a,b);return{x:d.x-c.x,y:d.y-c.y}},e.sizeFromClientToMarkups=function(a,b){var c=this.clientToMarkups(0,0),d=this.clientToMarkups(a,b);return{x:Math.abs(d.x-c.x),y:Math.abs(d.y-c.y)}},e.sizeFromMarkupsToClient=function(a,b){var c=this.markupsToClient(0,0),d=this.markupsToClient(a,b);return{x:Math.abs(d.x-c.x),y:Math.abs(d.y-c.y)}},e.markupsToClient=function(a,b){var d=this.viewer.impl.camera,e=new THREE.Vector3(a,b,0);if(d.isPerspective){var f=this.viewer.impl.canvas.getBoundingClientRect();e.x=e.x/1e3*(.5*f.height)+.5*f.width,e.y=-e.y/1e3*(.5*f.height)+.5*f.height}else{e.applyMatrix4(d.matrixWorld),e.sub(d.position);var g=this.viewer.model.getData().globalOffset;g&&e.sub(g),e=c.worldToClient(e,this.viewer,!1),e.z=0}return e},e.clientToMarkups=function(a,b){var d=this.viewer.impl.camera,e=new THREE.Vector3(a,b,0);if(d.isPerspective){var f=this.viewer.impl.canvas.getBoundingClientRect();e.x=(e.x-.5*f.width)/(.5*f.height)*1e3,e.y=-(e.y-.5*f.height)/(.5*f.height)*1e3}else{e=c.clientToWorld(e.x,e.y,0,this.viewer);var g=this.viewer.model.getData().globalOffset;g&&e.add(g),e.add(d.position),e.applyMatrix4(d.matrixWorldInverse),e.z=0}return e},e.getSvgViewBox=function(a,b){var c=this.clientToMarkups(0,0),d=this.clientToMarkups(a,b),e=Math.min(c.x,d.x),f=Math.min(c.y,d.y);return[e,f,Math.max(c.x,d.x)-e,Math.max(c.y,d.y)-f].join(" ")},e.getBounds=function(){return this.bounds},e.getMousePosition=function(){return this.editMode.useWithSnapping()&&this.snapper&&this.snapper.isSnapped()?this.getSnapPosition():this.input.getMousePosition()},e.getSnapPosition=function(){var a=d.getSnapResultPosition(this.snapper.getSnapResult(),this.viewer),b=this.project(a);return{x:b.x,y:b.y}},e.project=function(a){var b=this.viewer.navigation.getCamera(),c=this.viewer.navigation.getScreenViewport(),d=(new THREE.Vector3).copy(a);return d.project(b),new THREE.Vector3(Math.round((d.x+1)/2*c.width),Math.round((1-d.y)/2*c.height),d.z)},e.onCameraChange=function(a){var b=this.getSvgViewBox(this.bounds.width,this.bounds.height);if("NaN NaN NaN NaN"!==b){this.svg&&this.svg.setAttribute("viewBox",b);var c=this.editMode;if(c){if(this.editFrame.isActive()){var d=c.getSelection();this.editFrame.setMarkup(d)}c.updateTextBoxStyle&&c.updateTextBoxStyle(),this.snapper&&c.useWithSnapping()&&this.snapper.indicator.render()}}},e.onViewerResize=function(a){this.bounds.x=0,this.bounds.y=0,this.bounds.width=a.width,this.bounds.height=a.height,this.svg&&(this.svg.setAttribute("width",this.bounds.width),this.svg.setAttribute("height",this.bounds.height)),this.onCameraChange()},e.callSnapperMouseDown=function(){if(this.editMode&&this.editMode.useWithSnapping()){var a=this.input.getMousePosition();this.snapper&&(this.snapper.onMouseDown(a),this.snapper.indicator.render())}else this.snapper&&(this.snapper.clearSnapped(),this.snapper.indicator.clearOverlays())},e.callSnapperMouseMove=function(){if(this.editMode&&this.editMode.useWithSnapping()){var a=this.input.getMousePosition();this.snapper&&(this.snapper.onMouseMove(a),this.snapper.indicator.render())}},e.onMouseMove=function(a){this.navigating||(this.editFrame.isActive()&&"mousemove"===a.type&&this.editFrame.onMouseMove(a),this.callSnapperMouseMove(),this.editMode&&this.editMode.onMouseMove(a))},e.onMouseDown=function(a){c.dismissLmvHudMessage(),this.callSnapperMouseDown();var b=this.getBounds(),d=this.getMousePosition();d.x>=b.x&&d.x<=b.x+b.width&&d.y>=b.y&&d.y<=b.y+b.height&&this.editMode.onMouseDown(a),this.editMode.creating||a.target!==this.svg||this.selectMarkup(null),this.ignoreNextMouseUp=!1},e.onMouseUp=function(a){if(!this.navigating)return this.editFrame.isActive()?void this.editFrame.onMouseUp(a):void(this.ignoreNextMouseUp||this.editMode.onMouseUp(a))},e.onMouseDoubleClick=function(a){this.navigating||this.editFrame.isActive()||this.editMode.onMouseDoubleClick(a)},e.onUserCancel=function(){this.editMode&&(this.editMode.creating?this.editMode.creationCancel():this.editMode.unselect())},e.onMarkupSelected=function(a){this.selectMarkup(a.markup),this.dispatchEvent(a)},e.onMarkupEnterEdition=function(a){},e.onMarkupCancelEdition=function(a){this.onUserCancel()},e.onMarkupDeleteEdition=function(a){this.removeMarkup(a.markup),this.editMode.deleteMarkup()},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.MarkupsCore",a)}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"CLONE-MARKUP",c),this.clone=d.clone(),this.clone.id=c,this.position={x:e.x,y:e.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor,b=this.clone,c=this.position;if(!a.getMarkup(this.targetId)){var d=b.clone();d.setPosition(c.x,c.y),a.addMarkup(d)}},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CloneMarkup=a}(),function(){"use strict";function a(a,d,e,f,g){b.EditAction.call(this,a,"CREATE-ARROW",d),this.selectOnExecution=!1,this.tail=f,this.head=e,this.style=c.cloneStyle(g)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupArrow(this.targetId,a);a.addMarkup(c),c.set(this.head.x,this.head.y,this.tail.x,this.tail.y),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateArrow=a}(),function(){"use strict";function a(a,d,e,f,g,h,i){b.EditAction.call(this,a,"CREATE-CALLOUT",d),this.text=g,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.style=c.cloneStyle(h),this.isFrameUsed=i}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=this.position,d=this.size,e=new b.MarkupCallout(this.targetId,a,d);a.addMarkup(e),e.setIsFilledFrameUsed(this.isFrameUsed),e.setSize(c,d.x,d.y),e.setText(this.text),e.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&(this.editor.removeMarkup(a),a.destroy())},b.CreateCallout=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-CIRCLE",d),this.selectOnExecution=!1,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.rotation=g,this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupCircle(this.targetId,a);a.addMarkup(c),c.setSize(this.position,this.size.x,this.size.y),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateCircle=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-CLOUD",d),this.selectOnExecution=!1,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.rotation=g,this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupCloud(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateCloud=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-DIMENSION",d),this.selectOnExecution=!1,this.secondAnchor=f,this.firstAnchor=e,this.text=g,this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupDimension(this.targetId,a);a.addMarkup(c),this.secondAnchor&&(c.set(this.firstAnchor.x,this.firstAnchor.y,this.secondAnchor.x,this.secondAnchor.y,this.text),c.setStyle(this.style))},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateDimension=a}(),function(){"use strict";function a(a,d,e,f,g,h,i){b.EditAction.call(this,a,"CREATE-FREEHAND",d),this.selectOnExecution=!1,this.position=e,this.size=f,this.rotation=g,this.movements=h.slice(0),this.style=c.cloneStyle(i)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupFreehand(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size,this.movements,!1),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateFreehand=a}(),function(){"use strict";function a(a,d,e,f,g,h,i){b.EditAction.call(this,a,"CREATE-HIGHLIGHT",d),this.selectOnExecution=!1,this.position=e,this.size=f,this.rotation=g,this.movements=h.slice(0),this.style=c.cloneStyle(i)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupHighlight(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size,this.movements,!1),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateHighlight=a}(),function(){"use strict";function a(a,d,e,f,g,h,i,j){b.EditAction.call(this,a,"CREATE-POLYCLOUD",d),this.selectOnExecution=!1,this.position=e,this.size=f,this.rotation=g,this.movements=h.concat(),this.style=c.cloneStyle(i),this.closed=j}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupPolycloud(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size,this.movements,this.closed),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreatePolycloud=a}(),function(){"use strict";function a(a,d,e,f,g,h,i,j){b.EditAction.call(this,a,"CREATE-POLYLINE",d),this.selectOnExecution=!1,this.position=e,this.size=f,this.rotation=g,this.movements=h.concat(),this.closed=j,this.style=c.cloneStyle(i)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupPolyline(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size,this.movements,this.closed),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreatePolyline=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-RECTANGLE",d),this.selectOnExecution=!1,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.rotation=g,this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupRectangle(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateRectangle=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-TEXT",d),this.text=g,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=this.position,d=this.size,e=new b.MarkupText(this.targetId,a,d);a.addMarkup(e),e.setSize(c,d.x,d.y),e.setText(this.text),e.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&(this.editor.removeMarkup(a),a.destroy())},b.CreateText=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-ARROW",c.id),this.createArrow=new b.CreateArrow(a,c.id,c.tail,c.head,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createArrow.undo()},c.undo=function(){this.createArrow.redo()},b.DeleteArrow=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-CALLOUT",c.id);var d={x:c.position.x,y:c.position.y},e={x:c.size.x,y:c.size.y};this.createCallout=new b.CreateCallout(a,c.id,d,e,c.getText(),c.getStyle(),c.isFrameUsed)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createCallout.undo()},c.undo=function(){this.createCallout.redo()},b.DeleteCallout=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-CIRCLE",c.id),this.createCircle=new b.CreateCircle(a,c.id,c.position,c.size,c.rotation,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createCircle.undo()},c.undo=function(){this.createCircle.redo()},b.DeleteCircle=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-CLOUD",c.id),this.createCloud=new b.CreateCloud(a,c.id,c.position,c.size,c.rotation,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createCloud.undo()},c.undo=function(){this.createCloud.redo()},b.DeleteCloud=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-DIMENSION",c.id),this.createDimension=new b.CreateDimension(a,c.id,c.secondAnchor,c.firstAnchor,c.currentText,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createDimension.undo()},c.undo=function(){this.createDimension.redo()},b.DeleteDimension=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-FREEHAND",c.id),this.createFreehand=new b.CreateFreehand(a,c.id,c.position,c.size,c.rotation,c.locations,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createFreehand.undo()},c.undo=function(){this.createFreehand.redo()},b.DeleteFreehand=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-HIGHLIGHT",c.id),this.createHighlight=new b.CreateHighlight(a,c.id,c.position,c.size,c.rotation,c.locations,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createHighlight.undo()},c.undo=function(){this.createHighlight.redo()},b.DeleteHighlight=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-POLYCLOUD",c.id),this.createPolycloud=new b.CreatePolycloud(a,c.id,c.position,c.size,c.rotation,c.locations,c.getStyle(),c.closed)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createPolycloud.undo()},c.undo=function(){this.createPolycloud.redo()},b.DeletePolycloud=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-POLYLINE",c.id),this.createPolyline=new b.CreatePolyline(a,c.id,c.position,c.size,c.rotation,c.locations,c.getStyle(),c.closed)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createPolyline.undo()},c.undo=function(){this.createPolyline.redo()},b.DeletePolyline=a}(),function(){"use strict";var a=Autodesk.Viewing.Extensions.Markups.Core,b=function(b,c){a.EditAction.call(this,b,"DELETE-RECTANGLE",c.id),this.createRectangle=new a.CreateRectangle(b,c.id,c.position,c.size,c.rotation,c.getStyle())};b.prototype=Object.create(a.EditAction.prototype),b.prototype.constructor=b;var c=b.prototype;c.redo=function(){this.createRectangle.undo()},c.undo=function(){this.createRectangle.redo()},a.DeleteRectangle=b}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-TEXT",c.id);var d={x:c.position.x,y:c.position.y},e={x:c.size.x,y:c.size.y};this.createText=new b.CreateText(a,c.id,d,e,c.getText(),c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createText.undo()},c.undo=function(){this.createText.redo()},b.DeleteText=a}(),function(){"use strict";function a(){this.actions=[],this.closed=!0}var b=Autodesk.Viewing.Extensions.Markups.Core,c=a.prototype;c.open=function(){return!!this.closed&&(this.closed=!1,!0)},c.close=function(){return!this.closed&&(this.closed=!0,!0)},c.undo=function(){for(var a=this.actions,b=a.length-1,c=-1,d=b;d>=0;--d){var e=a[d];e.undo(),-1!==e.targetId&&(c=e.targetId)}return c},c.redo=function(){for(var a=this.actions,b=a.length,c=-1,d=0;d<b;++d){var e=a[d];e.redo(),-1!==e.targetId&&(c=e.targetId)}return c},c.isOpen=function(){return!this.closed},c.isClosed=function(){return this.closed},c.isEmpty=function(){return 0===this.actions.length},c.addAction=function(a){return!this.closed&&(this.actions.push(a),this.compact(),!0)},c.compact=function(){for(var a=this.actions,b=a.length,c=0;c<b;++c){var d=a[c];if(d.isIdentity())a.splice(c,1),--b,--c;else for(var e=c+1;e<b;++e){var f=a[e];if(d.type===f.type&&d.merge(f)){a.splice(e,1),--b,--c;break}}}},b.EditActionGroup=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-ARROW",c.id),this.newHead={x:d.x,y:d.y},this.newTail={x:e.x,y:e.y},this.oldHead={x:c.head.x,y:c.head.y},this.oldTail={x:c.tail.x,y:c.tail.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newHead,this.newTail)},c.undo=function(){this.applyState(this.targetId,this.oldHead,this.oldTail)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newHead=a.newHead,this.newTail=a.newTail,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){
(Math.abs(d.head.x-b.x)>=1e-4||Math.abs(d.head.y-b.y)>=1e-4||Math.abs(d.tail.x-c.x)>=1e-4||Math.abs(d.tail.y-c.y)>=1e-4)&&d.set(b.x,b.y,c.x,c.y)}},c.isIdentity=function(){return this.newHead.x===this.oldHead.x&&this.newHead.y===this.oldHead.y&&this.newTail.x===this.oldTail.x&&this.newTail.y===this.oldTail.y},b.SetArrow=a}(),function(){"use strict";function a(a,c,d,e,f,g){b.EditAction.call(this,a,"SET-CALLOUT",c.id),this.newPosition={x:d.x,y:d.y},this.oldPosition={x:c.position.x,y:c.position.y},this.newSize={x:e.x,y:e.y},this.oldSize={x:c.size.x,y:c.size.y},this.newText=f,this.oldText=c.getText(),this.newIsFrameUsed=g,this.oldIsFrameUsed=c.isFrameUsed}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.newPosition,this.newSize,this.newText,this.newIsFrameUsed)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.oldPosition,this.oldSize,this.oldText,this.oldIsFrameUsed)},b.SetCallout=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-CIRCLE",c.id),this.newPosition={x:d.x,y:d.y},this.newSize={x:e.x,y:e.y},this.oldPosition={x:c.position.x,y:c.position.y},this.oldSize={x:c.size.x,y:c.size.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},c.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newSize=a.newSize,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){(Math.abs(d.position.x-b.x)>1e-4||Math.abs(d.size.y-c.y)>1e-4||Math.abs(d.position.y-b.y)>1e-4||Math.abs(d.size.y-c.y)>1e-4)&&d.set(b,c)}},c.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},b.SetCircle=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-CLOUD",c.id),this.newPosition={x:d.x,y:d.y},this.newSize={x:e.x,y:e.y},this.oldPosition={x:c.position.x,y:c.position.y},this.oldSize={x:c.size.x,y:c.size.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize,this.newStrokeWidth,this.newColor)},c.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize,this.oldStrokeWidth,this.oldColor)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newSize=a.newSize,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){(Math.abs(d.position.x-b.x)>1e-4||Math.abs(d.size.y-c.y)>1e-4||Math.abs(d.position.y-b.y)>1e-4||Math.abs(d.size.y-c.y)>1e-4)&&d.set(b,c)}},c.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},b.SetCloud=a}(),function(){"use strict";function a(a,c,d,e,f){b.EditAction.call(this,a,"SET-DIMENSION",c.id),this.newFirstAnchor={x:d.x,y:d.y},this.newSecondAnchor={x:e.x,y:e.y},this.oldFirstAnchor={x:c.firstAnchor.x,y:c.firstAnchor.y},this.oldSecondAnchor={x:c.secondAnchor.x,y:c.secondAnchor.y},this.newText=f,this.oldText=c.currentText}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.newFirstAnchor,this.newSecondAnchor,this.newText)},c.undo=function(){this.applyState(this.oldFirstAnchor,this.oldSecondAnchor,this.oldText)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newFirstAnchor=a.newFirstAnchor,this.newSecondAnchor=a.newSecondAnchor,this.newText=a.newText,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(this.targetId);d&&d.set(a.x,a.y,b.x,b.y,c)},c.isIdentity=function(){return this.newText===this.oldText&&(!this.newFirstAnchor||!this.newSecondAnchor||this.newFirstAnchor.x===this.oldFirstAnchor.x&&this.newFirstAnchor.y===this.oldFirstAnchor.y&&this.newSecondAnchor.x===this.oldSecondAnchor.x&&this.newSecondAnchor.y===this.oldSecondAnchor.y)},b.SetDimension=a}(),function(){"use strict";function a(a,c,d,e,f,g){b.EditAction.call(this,a,"SET-FREEHAND",c.id),this.position=d,this.size=e,this.locations=g?f:f.slice(0),this.isAbsoluteCoords=g}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.position,this.size,this.locations,this.isAbsoluteCoords)},c.undo=function(){},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.locations=a.isAbsoluteCoords?a.locations:a.locations.slice(0),this.position=a.position,this.size=a.size,this.isAbsoluteCoords=a.isAbsoluteCoords,!0)},c.isIdentity=function(){return!1},b.SetFreehand=a}(),function(){"use strict";function a(a,c,d,e,f,g){b.EditAction.call(this,a,"SET-HIGHLIGHT",c.id),this.position=d,this.size=e,this.locations=g?f:f.slice(0),this.isAbsoluteCoords=g}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.position,this.size,this.locations,this.isAbsoluteCoords)},c.undo=function(){},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.locations=a.isAbsoluteCoords?a.locations:a.locations.slice(0),this.position=a.position,this.size=a.size,this.isAbsoluteCoords=a.isAbsoluteCoords,!0)},c.isIdentity=function(){return!1},b.SetHighlight=a}(),function(){"use strict";function a(a,c,d,e,f,g){b.EditAction.call(this,a,"SET-POLYCLOUD",c.id),this.position=d,this.size=e,this.locations=f.concat(),this.closed=g}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.position,this.size,this.locations,this.closed)},c.undo=function(){},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.locations=a.locations.concat(),this.position=a.position,this.size=a.size,this.closed=a.closed,!0)},c.isIdentity=function(){return!1},b.SetPolycloud=a}(),function(){"use strict";function a(a,c,d,e,f,g){b.EditAction.call(this,a,"SET-POLYLINE",c.id),this.position=d,this.size=e,this.locations=f.concat(),this.closed=g}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.position,this.size,this.locations,this.closed)},c.undo=function(){},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.locations=a.locations.concat(),this.position=a.position,this.size=a.size,this.closed=a.closed,!0)},c.isIdentity=function(){return!1},b.SetPolyline=a}(),function(){"use strict";function a(a,c,d){b.EditAction.call(this,a,"SET-POSITION",c.id),this.newPosition={x:d.x,y:d.y},this.oldPosition={x:c.position.x,y:c.position.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setPosition(this.newPosition.x,this.newPosition.y)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setPosition(this.oldPosition.x,this.oldPosition.y)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,!0)},c.isIdentity=function(){var a=this.newPosition,b=this.oldPosition;return a.x===b.x&&a.y===b.y},b.SetPosition=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-RECTANGLE",c.id),this.newPosition={x:d.x,y:d.y},this.newSize={x:e.x,y:e.y},this.oldPosition={x:c.position.x,y:c.position.y},this.oldSize={x:c.size.x,y:c.size.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},c.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newSize=a.newSize,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){(Math.abs(d.position.x-b.x)>1e-4||Math.abs(d.size.y-c.y)>1e-4||Math.abs(d.position.y-b.y)>1e-4||Math.abs(d.size.y-c.y)>1e-4)&&d.set(b,c)}},c.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},b.SetRectangle=a}(),function(){"use strict";function a(a,c,d){b.EditAction.call(this,a,"SET-ROTATION",c.id);var e=c.getRotation();this.newRotation={angle:d},this.oldRotation={angle:e}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setRotation(this.newRotation.angle)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setRotation(this.oldRotation.angle)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newRotation=a.newRotation,!0)},c.isIdentity=function(){return this.newRotation.angle===this.oldRotation.angle},b.SetRotation=a}(),function(){"use strict";function a(a,c,d,e,f){b.EditAction.call(this,a,"SET-SIZE",c.id),this.newPosition={x:d.x,y:d.y},this.oldPosition={x:c.position.x,y:c.position.y},this.newWidth=e,this.oldWidth=c.size.x,this.newHeight=f,this.oldHeight=c.size.y}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setSize(this.newPosition,this.newWidth,this.newHeight)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setSize(this.oldPosition,this.oldWidth,this.oldHeight)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newWidth=a.newWidth,this.newHeight=a.newHeight,!0)},c.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newWidth===this.oldWidth&&this.newHeight===this.oldHeight},b.SetSize=a}(),function(){"use strict";function a(a,d,e){b.EditAction.call(this,a,"SET-STYLE",d.id),this.newStyle=c.cloneStyle(e),this.oldStyle=d.getStyle()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setStyle(this.newStyle)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setStyle(this.oldStyle)},b.SetStyle=a}(),function(){"use strict";function a(a,c,d,e,f){b.EditAction.call(this,a,"SET-TEXT",c.id),this.newPosition={x:d.x,y:d.y},this.oldPosition={x:c.position.x,y:c.position.y},this.newSize={x:e.x,y:e.y},this.oldSize={x:c.size.x,y:c.size.y},this.newText=f,this.oldText=c.getText()}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.newPosition,this.newSize,this.newText)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.oldPosition,this.oldSize,this.oldText)},b.SetText=a}(),function(){"use strict";function a(a){this.editor=a,this.content=null,this.pastePosition={x:0,y:0},c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils,d=a.prototype;d.copy=function(){var a=this.editor.getSelection();a&&(this.content=a.clone(),this.pastePosition.x=a.position.x,this.pastePosition.y=a.position.y)},d.cut=function(){var a=this.editor.getSelection();a&&(this.copy(),this.editor.deleteMarkup(a))},d.paste=function(){var a=this.content;if(a){var c=this.editor,d=this.pastePosition,e=c.sizeFromClientToMarkups(20,20);d.x+=e.x,d.y-=e.y;new b.CloneMarkup(c,c.getId(),a,d).execute()}},b.Clipboard=a}(),function(){"use strict";function a(){this.editor=null,this.mousePosition={x:0,y:0},this.makeSameXY=!1,this.snapRotations=!1,this.keepAspectRatio=!1,this.constrainAxis=!1,this.onWheelBinded=this.onWheel.bind(this),this.onTouchDragBinded=this.onTouchDrag.bind(this),this.onTouchPanBinded=this.onTouchPan.bind(this),this.onTouchPinchBinded=this.onTouchPinch.bind(this),this.onSingleTapBinded=this.onSingleTap.bind(this),this.onDoubleTapBinded=this.onDoubleTap.bind(this),this.onMouseMoveBinded=this.onMouseMove.bind(this),this.onMouseUpBinded=this.onMouseUp.bind(this),this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseDoubleClickBinded=this.onMouseDoubleClick.bind(this),this.onHammerInputBinded=this.onHammerInput.bind(this),this.isMouseDown=!1}function b(a,b){var c=a.editor.svg.getBoundingClientRect();a.makeSameXY=b.shiftKey,a.snapRotations=b.shiftKey,a.keepAspectRatio=b.shiftKey,a.constrainAxis=b.shiftKey,a.mousePosition.x=b.clientX-c.left,a.mousePosition.y=b.clientY-c.top}function c(a){a.shiftKey=!1,a.clientX=a.pointers[0].clientX,a.clientY=a.pointers[0].clientY}var d=Autodesk.Viewing.Extensions.Markups.Core,e=Autodesk.Viewing.Extensions.Markups.Core.Utils,f=Autodesk.Viewing,g=f.Private,h=!1,i=!1,j=a.prototype;j.attachTo=function(a){this.editor&&this.detachFrom(this.editor),this.editor=a,e.isTouchDevice()&&(this.hammer=new Hammer.Manager(a.svg,{recognizers:[f.GestureRecognizers.drag,f.GestureRecognizers.doubletap,f.GestureRecognizers.doubletap2,f.GestureRecognizers.singletap,f.GestureRecognizers.singletap2,f.GestureRecognizers.press,f.GestureRecognizers.pan,f.GestureRecognizers.pinch],inputClass:f.isIE11?Hammer.PointerEventInput:Hammer.TouchInput}),this.hammer.get("doubletap2").recognizeWith("doubletap"),this.hammer.get("singletap2").recognizeWith("singletap"),this.hammer.get("singletap").requireFailure("doubletap"))},j.onHammerInput=function(a){this.setMouseDisabledWhenTouching(a)},j.setMouseDisabledWhenTouching=function(a){if(a.isFirst)this.enableMouseButtons(!1);else if(a.isFinal){var b=this;setTimeout(function(){b.enableMouseButtons(i)},10)}},j.enableMouseButtons=function(a){a&&!h?(this.editor.svg.addEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.addEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.addEventListener("wheel",this.onWheelBinded),this.editor.svg.addEventListener("DOMMouseScroll",this.onWheelBinded),document.addEventListener("mousemove",this.onMouseMoveBinded),document.addEventListener("mouseup",this.onMouseUpBinded)):!a&&h&&(this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.removeEventListener("wheel",this.onWheelBinded),this.editor.svg.removeEventListener("DOMMouseScroll",this.onWheelBinded),document.removeEventListener("mousemove",this.onMouseMoveBinded),document.removeEventListener("mouseup",this.onMouseUpBinded)),i=h,h=a},j.detachFrom=function(a){this.hammer&&this.hammer.destroy(),document.removeEventListener("mousemove",this.onMouseMoveBinded),document.removeEventListener("mouseup",this.onMouseUpBinded),this.editor&&(this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded)),this.editor=a},j.enterEditMode=function(){this.hammer&&(this.hammer.on("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.on("panstart panmove panend",this.onTouchPanBinded),this.hammer.on("pinchstart pinchmove pinchend",this.onTouchPinchBinded),this.hammer.on("singletap",this.onSingleTapBinded),this.hammer.on("singletap2",this.onSingleTapBinded),this.hammer.on("doubletap",this.onDoubleTapBinded),this.hammer.on("doubletap2",this.onDoubleTapBinded),this.hammer.on("hammer.input",this.onHammerInputBinded),this.hammer.get("drag").requireFailure("pinch"),this.hammer.get("drag").requireFailure("pan")),f.isMobileDevice()||this.enableMouseButtons(!0)},j.leaveEditMode=function(){this.hammer&&(this.hammer.off("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.off("panstart panmove panend",this.onTouchPanBinded),this.hammer.off("pinchstart pinchmove pinchend",this.onTouchPinchBinded),this.hammer.off("singletap",this.onSingleTapBinded),this.hammer.off("singletap2",this.onSingleTapBinded),this.hammer.off("doubletap",this.onDoubleTapBinded),this.hammer.off("doubletap2",this.onDoubleTapBinded),this.hammer.off("hammer.input",this.onHammerInputBinded)),f.isMobileDevice()||this.enableMouseButtons(!1)},j.enterViewMode=function(){},j.leaveViewMode=function(){},j.getMousePosition=function(){return{x:this.mousePosition.x,y:this.mousePosition.y}},j.onWheel=function(a){f.isMobileDevice()||this.editor.viewer.toolController.mousewheel(a),a.preventDefault()},j.onMouseMove=function(a){b(this,a),f.isMobileDevice()||this.editor.viewer.toolController.mousemove(a),this.editor.onMouseMove(a),a.preventDefault()},j.onMouseDownRightClick=function(a){f.isIE11&&f.inFullscreen()||document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),this.editor.viewer.toolController.__clientToCanvasCoords(a),this.editor.markupTool.handleButtonDown(a,2)},j.onMouseUpRightClick=function(a){this.editor.viewer.toolController.__clientToCanvasCoords(a),this.editor.markupTool.handleButtonUp(a,2)},j.onMouseDown=function(a){if(b(this,a),!f.isMobileDevice()&&g.isRightClick(a,this.editor.viewer.navigation))return void this.onMouseDownRightClick(a);this.isMouseDown=!0,this.editor.onMouseDown(a),a.preventDefault()},j.onMouseUp=function(a){if(b(this,a),!f.isMobileDevice()&&g.isRightClick(a,this.editor.viewer.navigation))return void this.onMouseUpRightClick(a);this.isMouseDown=!1,this.editor.onMouseUp(a),a.preventDefault()},j.onMouseDoubleClick=function(a){b(this,a),this.editor.onMouseDoubleClick(a),a.preventDefault()},j.onTouchDrag=function(a){switch(c(a),a.type){case"dragstart":this.onMouseDown(a);break;case"dragmove":this.onMouseMove(a);break;case"dragend":this.onMouseUp(a)}a.preventDefault()},j.onTouchPan=function(a){this.editor.viewer.toolController.getTool("gestures").distributeGesture(a),a.preventDefault()},j.onTouchPinch=function(a){b(this,a),this.editor.viewer.toolController.getTool("gestures").distributeGesture(a),this.mousePosition.x=this.mousePosition.y=null,this.editor.callSnapperMouseMove(),a.preventDefault()},j.onSingleTap=function(a){c(a),this.onMouseDown(a),this.onMouseUp(a),a.preventDefault()},j.onDoubleTap=function(a){c(a),this.onMouseDoubleClick(a),a.preventDefault()},d.InputHandler=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_ARROW,c)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Measure,d=Autodesk.Viewing.Extensions.Measure.Functions;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var e=a.prototype;e.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new b.DeleteArrow(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},e.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,d=a.getMousePosition();if(this.initialX=d.x,this.initialY=d.y,this.size.x=0,this.size.y=0,this.lineSnapped=null,a.snapper){var e=a.snapper.getGeometryType();e!==c.SNAP_VERTEX&&e!==c.SNAP_EDGE&&e!==c.SNAP_MIDPOINT&&e!==c.SNAP_CIRCLE_CENTER||(this.lineSnapped=a.snapper.getEdge())}var f=3.5*this.style["stroke-width"],g=this.head=a.positionFromClientToMarkups(this.initialX,this.initialY),h={x:g.x+Math.cos(.25*Math.PI)*f,y:g.y+Math.sin(.25*-Math.PI)*f};(function(a,b,c,d){this.isInsideBounds(b.x,b.y,d)||(b.y=a.y+Math.sin(.25*Math.PI)*c,this.isInsideBounds(b.x,b.y,d)||(b.x=a.x+Math.cos(.25*-Math.PI)*c,this.isInsideBounds(b.x,b.y,d)||(b.y=a.y+Math.sin(.25*-Math.PI)*c)))}).bind(this)(g,h,f,a.getBounds()),a.beginActionGroup();var i=new THREE.Vector2(h.x-g.x,h.y-g.y);i.lengthSq()<f*f&&(i=i.normalize().multiplyScalar(f),h.x=g.x+i.x,h.y=g.y+i.y);var j=a.getId();new b.CreateArrow(a,j,g,h,this.style).execute(),this.selectedMarkup=a.getMarkup(j),this.creationBegin()}},e.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var e=this.editor,f=this.getFinalMouseDraggingPosition(),g=this.initialX,h=this.initialY;if(e.snapper&&!e.snapper.isSnapped()&&this.lineSnapped){var i=e.project(this.lineSnapped.vertices[0]),j=e.project(this.lineSnapped.vertices[1]),k=new THREE.Vector3(f.x,f.y,i.z),l=d.nearestPointInPointToLine(k,i,j),m=-(i.x-j.x)/(i.y-j.y),n=h-m*g,o=g+1,p=m*o+n,q=new THREE.Vector3(o,p,i.z),r=new THREE.Vector3(g,h,i.z),s=d.nearestPointInPointToLine(k,r,q);l.distanceTo(k)<=20?(f.x=l.x,f.y=l.y):s.distanceTo(k)<=20&&(f.x=s.x,f.y=s.y)}var t=this.head,u=e.positionFromClientToMarkups(f.x,f.y),v=new THREE.Vector2(u.x-t.x,u.y-t.y),w=3.5*c.style["stroke-width"];v.lengthSq()<w*w&&(v=v.normalize().multiplyScalar(w),u.x=t.x+v.x,u.y=t.y+v.y),this.size=e.sizeFromClientToMarkups(f.x-g,f.y-h);new b.SetArrow(e,c,t,u).execute()}},b.EditModeArrow=a}(),function(){"use strict";function a(a){var c=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];b.EditMode.call(this,a,b.MARKUP_TYPE_CALLOUT,c),this.style["fill-opacity"]=1,this.style["fill-color"]="#ffffff";var d=new b.EditorTextInput(this.viewer.container,this.editor);d.addEventListener(d.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),d.addEventListener(d.EVENT_TEXT_SET_ACTIVE,this.onHelperSetActive.bind(this),!1),d.addEventListener(d.EVENT_TEXT_SET_INACTIVE,this.onHelperSetActive.bind(this),!1),this.textInputHelper=d,this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.minSize=0,this.creationMethod=this.CREATION_METHOD_CLICK}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type===this.type){var d=new b.DeleteCallout(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.setStyle=function(a){this.textInputHelper&&this.textInputHelper.isActive()?this.textInputHelper.setStyle(a):b.EditMode.prototype.setStyle.call(this,a)},c.notifyAllowNavigation=function(a){a&&this.textInputHelper&&this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit()},c.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.textInputHelper.destroy(),this.textInputHelper=null),b.EditMode.prototype.destroy.call(this)},c.onMouseDown=function(){if(this.textInputHelper&&this.textInputHelper.isActive())return void this.textInputHelper.acceptAndExit();if(!this.selectedMarkup){var a=this.editor,c=a.getMousePosition(),d=a.sizeFromMarkupsToClient(0,this.style["font-size"]).y,e=15*d,f=3*d,g=this.size=a.sizeFromClientToMarkups(e,f),h=a.positionFromClientToMarkups(c.x+.5*e,c.y+.5*f);this.creationBegin(),a.beginActionGroup();var i=new b.CreateCallout(a,a.getId(),h,g,"",this.style,!0);i.execute(),this.creationEnd(),this.selectedMarkup=a.getMarkup(i.targetId),this.textInputHelper&&this.textInputHelper.setActive(this.selectedMarkup,!0),this.editor.actionManager.addEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded)}},c.onMouseUp=function(a){},c.onMouseDoubleClick=function(a){a===this.selectedMarkup&&(this.editor.selectMarkup(null),this.textInputHelper&&this.textInputHelper.setActive(a,!1))},c.onHelperSetActive=function(a){var b=a.data,c=b.markup;c&&c.setIsFilledFrameVisible(!b.isActive)},c.onHelperTextChange=function(a){var c=a.data,d=c.markup,e=c.style;if(this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),""===c.newText){if(c.firstEdit)return this.editor.cancelActionGroup(),void this.editor.selectMarkup(null);return new b.DeleteCallout(this.editor,d).execute(),void this.editor.selectMarkup(null)}c.firstEdit||this.editor.beginActionGroup();var f=this.editor.positionFromClientToMarkups(c.newPos.x,c.newPos.y),g=this.editor.sizeFromClientToMarkups(c.width,c.height);new b.SetSize(this.editor,d,f,g.x,g.y).execute(),new b.SetCallout(this.editor,d,d.position,d.size,c.newText,d.isFrameUsed).execute(),new b.SetStyle(this.editor,d,e).execute(),this.editor.closeActionGroup(),this.editor.selectMarkup(null)},c.onHistoryChange=function(a){this.textInputHelper&&this.textInputHelper.isActive()&&(this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},c.onSave=function(){if(b.EditMode.prototype.onSave.call(this),this.textInputHelper&&this.textInputHelper.isActive()){var a=this.textInputHelper.firstEdit;this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive(),a&&this.editor.cancelActionGroup(),this.editor.selectMarkup(null),this.selectedMarkup=null}},c.updateTextBoxStyle=function(){this.isTextInputHelperActive()&&this.textInputHelper.onCameraChanged()},b.EditModeCallout=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_CIRCLE,c)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new b.DeleteCircle(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d=this.editor,e=this.getFinalMouseDraggingPosition();e=d.clientToMarkups(e.x,e.y);var f=Math.abs(this.firstPosition.x-e.x),g=Math.abs(this.firstPosition.y-e.y),h={x:.5*(this.firstPosition.x+e.x),y:.5*(this.firstPosition.y+e.y)},i=this.size={x:f,y:g};new b.SetCircle(d,c,h,i).execute()}},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,c=a.getMousePosition();this.initialX=c.x,this.initialY=c.y;var d=this.firstPosition=a.clientToMarkups(this.initialX,this.initialY),e=this.size=a.sizeFromClientToMarkups(1,1);a.beginActionGroup();var f=a.getId();new b.CreateCircle(a,f,d,e,0,this.style).execute(),this.selectedMarkup=a.getMarkup(f),this.creationBegin()}},b.EditModeCircle=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_CLOUD,c)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new b.DeleteCloud(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d=this.editor,e=this.getFinalMouseDraggingPosition(),f=d.clientToMarkups(e.x,e.y),g={x:(this.firstPosition.x+f.x)/2,y:(this.firstPosition.y+f.y)/2},h=this.size={x:Math.abs(f.x-this.firstPosition.x),y:Math.abs(f.y-this.firstPosition.y)};new b.SetCloud(d,c,g,h).execute()}},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,c=a.getMousePosition();this.initialX=c.x,this.initialY=c.y;var d=this.firstPosition=a.clientToMarkups(this.initialX,this.initialY),e=this.size=a.sizeFromClientToMarkups(1,1);a.beginActionGroup();var f=a.getId();new b.CreateCloud(a,f,d,e,0,this.style).execute(),this.selectedMarkup=a.getMarkup(f),this.creationBegin()}},b.EditModeCloud=a}(),function(){"use strict";function a(a){function b(){d.cancelEditModeChange=!0,a.leaveEditMode(),a.enterEditMode()}var d=this,f=["stroke-width","stroke-color","stroke-opacity","font-size","font-family","font-style","font-weight"];c.EditMode.call(this,a,c.MARKUP_TYPE_DIMENSION,f),this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.measurement=new e.Measurement(e.MEASUREMENT_DISTANCE);var g=this.viewer,h=g.getExtension("Autodesk.Measure");h||(console.error("Demension markup cant work without measure extension. Please load measure extension first"),b()),this.sharedMeasureConfig=h.sharedMeasureConfig,!h.forceCalibrate&&!g.model.getData().isLeaflet||h.calibrationTool.isCalibrated()||(h.openCalibrationRequiredDialog("dimension"),b())}var b,c=Autodesk.Viewing.Extensions.Markups.Core,d=Autodesk.Viewing.Extensions.Markups.Core.Utils,e=Autodesk.Viewing.Extensions.Measure,f=Autodesk.Viewing.Extensions.Measure.Functions;c.FINISHED_CALIBRATION_FOR_DIMENSION_EVENT="finished_calibration_for_dimension_event",a.prototype=Object.create(c.EditMode.prototype),a.prototype.constructor=a;var g=a.prototype;g.deleteMarkup=function(a,b){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new c.DeleteDimension(this.editor,a);return d.addToHistory=!b,d.execute(),this.creating=!1,this.dragging=!1,!0}return!1},g.updateTextBoxStyle=function(a){this.isTextInputHelperActive()&&(a||(a=this.textInputHelper.textMarkup.getStyle()),this.textInputHelper.setStyle(a),this.updateTextBox(this.textInputHelper.textMarkup))},g.setStyle=function(a){c.EditMode.prototype.setStyle.call(this,a),this.updateTextBoxStyle(a)},g.notifyAllowNavigation=function(a){a&&this.isTextInputHelperActive()&&this.textInputHelper.acceptAndExit()},g.creationBegin=function(){c.EditMode.prototype.creationBegin.call(this)},g.creationEnd=function(){this.dragging=!1,c.EditMode.prototype.creationEnd.call(this)},g.isMinSizeValid=function(){if(0!==this.minSize){var a=this.editor.sizeFromMarkupsToClient(this.selectedMarkup.size.x,this.selectedMarkup.size.y);return a.x*a.x>=this.minSize*this.minSize}return!0},g.creationCancel=function(){c.EditMode.prototype.creationCancel.call(this),this.creating=!1,this.dragging=!1},g.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.editor.actionManager.removeEventListener(c.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.destroy(),this.textInputHelper=null),c.EditMode.prototype.destroy.call(this)},g.getDistance=function(){if(this.measurement.computeResult(this.measurement.picks,this.viewer),this.viewer.model&&this.measurement.distanceXYZ){var a=Autodesk.Viewing.Private.convertUnits(this.viewer.model.getUnitString(),this.sharedMeasureConfig.units,this.sharedMeasureConfig.calibrationFactor,this.measurement.distanceXYZ);return Autodesk.Viewing.Private.formatValueWithUnits(a,this.sharedMeasureConfig.units,3,this.sharedMeasureConfig.precision)}return null},g.updateMeasurement=function(a){var c=this.editor,d=this.measurement.getPick(a);b?(d.geomType=e.SNAP_VERTEX,d.geomVertex=b,d.intersectPoint=b):c.snapper.copyResults(d)},g.pickFirstAnchor=function(){var a=this.editor;this.measurement.clearAllPicks();var d=a.getMousePosition();this.initialX=d.x,this.initialY=d.y,this.firstAnchor=a.positionFromClientToMarkups(this.initialX,this.initialY),a.beginActionGroup()
;var e=a.getId();new c.CreateDimension(a,e,this.firstAnchor,null,this.currentText,this.style).execute(),this.selectedMarkup=a.getMarkup(e),this.creationBegin(),a.snapper.isSnapped()||a.viewer.model&&a.viewer.model.is2d()&&(b=f.inverseProject(d,a.viewer)),this.updateMeasurement(1)},g.pickSecondAnchor=function(a){var b=this.editor,d=this.selectedMarkup;if(this.secondAnchor=this.getFinalMouseDraggingPosition(),this.updateMeasurement(2),f.correctPerpendicularPicks(this.measurement.getPick(1),this.measurement.getPick(2),this.viewer,b.snapper)){var e=f.getSnapResultPosition(this.measurement.getPick(2),this.viewer);this.secondAnchor=b.project(e),b.snapper.indicator.render()}var g=b.positionFromClientToMarkups(this.secondAnchor.x,this.secondAnchor.y);this.size.x=d.size.x,this.size.y=d.size.y,d.currentText=this.getDistance(),new c.SetDimension(b,d,this.firstAnchor,g,d.currentText).execute(),new c.SetStyle(b,d,this.style).execute(),a&&!d.currentText&&this.isMinSizeValid()&&(d.currentText="",this.editor.selectMarkup(null),this.updateTextBox(d))},g.onMouseDown=function(a){if(!Autodesk.Viewing.Private.isRightClick(a,this.viewer.navigation)){if(b=null,this.isTextInputHelperActive())return void this.textInputHelper.acceptAndExit();c.EditMode.prototype.onMouseDown.call(this),this.selectedMarkup&&!this.creating||(this.selectedMarkup||this.creating?this.selectedMarkup&&this.creating&&(this.pickSecondAnchor(!0),this.creationEnd()):this.pickFirstAnchor())}},g.onMouseUp=function(a){this.dragging&&(this.onMouseDown(a),this.dragging=!1)},g.onMouseMove=function(a){b=null,this.selectedMarkup&&this.creating&&(this.dragging=!0,this.pickSecondAnchor(!1))},g.getFinalMouseDraggingPosition=function(){var a=this.editor,c=a.getBounds(),d=a.getMousePosition();a.snapper.isSnapped()||a.viewer.model&&a.viewer.model.is2d()&&(b=f.inverseProject(d,a.viewer));var e=this.initialX,g=this.initialY,h=Math.min(Math.max(c.x,d.x),c.x+c.width),i=Math.min(Math.max(c.y,d.y),c.y+c.height);if(h==e&&i==g&&(h++,i++),a.input.constrainAxis&&a.viewer.model.is2d()){Math.abs(h-e)>Math.abs(i-g)?i=g:h=e,a.snapper.onMouseMove({x:h,y:i}),a.snapper.isSnapped()?(a.snapper.copyResults(this.measurement.getPick(2)),b=null):b=f.inverseProject({x:h,y:i},a.viewer)}return{x:h,y:i}},g.isVisibleChar=function(a){return a>47&&a<58||32==a||a>64&&a<91||a>95&&a<112||a>185&&a<193||a>218&&a<223},g.measureTextLine=function(a,b,c){return a=a.replace(new RegExp(" ","g")," "),a=0===a.length?b.initialText:a,d.measureTextLines([a+"|"],this.style,c)[0]},g.handleKeyDown=function(a){var b=this.textInputHelper;if(a.keyCode!==Autodesk.Viewing.KeyCode.ENTER){var c=b.textMarkup,d=b.textArea.value;a.keyCode===Autodesk.Viewing.KeyCode.BACKSPACE&&(d=d.substring(0,d.length-1)),d.length<15&&this.isVisibleChar(a.keyCode)&&(d+=a.key);var e=this.measureTextLine(d,c,this.editor);this.updateTextBox(c,e)}},g.updateTextBox=function(a,b){this.textInputHelper||(this.textInputHelper=new c.EditorTextInput(this.viewer.container,this.editor,!0,a.initialText,15),this.textInputHelper.addEventListener(this.textInputHelper.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),this.handleKeyDownBinded=this.handleKeyDown.bind(this)),a.text.style.display="none",b||(b=this.measureTextLine(this.textInputHelper.textArea.value,a,this.editor));var d=this.getTextAreaTransform(a,b);this.textInputHelper.styleTextArea.setAttribute("text-align","center"),this.textInputHelper.setActive(a,!1),this.textInputHelper.textArea.style.position="static",this.textInputHelper.textArea.style.padding="0",this.textInputHelper.textArea.style.width=b.width+"px",this.textInputHelper.textArea.style.height=b.height+"px",this.textInputHelper.textArea.style.transform=d,this.editor.actionManager.removeEventListener(c.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.editor.actionManager.addEventListener(c.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.textArea.removeEventListener("keydown",this.handleKeyDownBinded),this.textInputHelper.textArea.addEventListener("keydown",this.handleKeyDownBinded)},g.getTextAreaTransform=function(a,b){var c=a.getClientPosition(),e=d.radiansToDegrees(a.rotation)%360;return e>90&&e<=270&&a.shouldFlip()&&(e=180+e),["translate(",c.x-b.width/2+"px,",c.y-this.viewer.container.clientHeight-b.height+"px)","rotate(",e+"deg)","translate(0px,",b.height+"px)"].join(" ")},g.onMouseDoubleClick=function(a){a===this.selectedMarkup&&(this.editor.selectMarkup(null),this.updateTextBox(a))},g.onHelperTextChange=function(a){var b=a.data,d=b.markup,e=b.style,f=this.editor;d.text.style.display="block",""===b.newText&&(b.newText=d.initialText),b.firstEdit||f.beginActionGroup(),new c.SetStyle(f,d,e).execute(),new c.SetDimension(f,d,d.firstAnchor,d.secondAnchor,b.newText).execute(),f.closeActionGroup(),f.selectMarkup(null)},g.onHistoryChange=function(a){this.isTextInputHelperActive()&&(this.textInputHelper.textMarkup.text.style.display="block",this.editor.actionManager.removeEventListener(c.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},g.onSave=function(){if(c.EditMode.prototype.onSave.call(this),this.isTextInputHelperActive()){this.editor.actionManager.removeEventListener(c.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded);var a=this.textInputHelper.textMarkup;this.textInputHelper.acceptAndExit(),a.text.style.display="block"}},g.useWithSnapping=function(){return!0},c.EditModeDimension=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity"];b.EditModePen.call(this,a,b.MARKUP_TYPE_FREEHAND,c),this.style["stroke-opacity"]=.75}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditModePen.prototype),a.prototype.constructor=a;var c=a.prototype;c.createPen=function(a,c,d,e,f){return new b.CreateFreehand(this.editor,a,c,d,e,f,this.style)},c.deletePen=function(a){return new b.DeleteFreehand(this.editor,a)},c.setPen=function(a,c,d,e){return new b.SetFreehand(this.editor,this.selectedMarkup,a,c,d,e)},b.EditModeFreehand=a}(),function(){"use strict";function a(a){var d=["stroke-width","stroke-color","stroke-opacity"];b.EditModePen.call(this,a,b.MARKUP_TYPE_HIGHLIGHT,d);var e=c.getStrokeWidth(c.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS,a);this.style["stroke-opacity"]=.5,this.style["stroke-color"]="#ffff00",this.style["stroke-width"]=4*e}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditModePen.prototype),a.prototype.constructor=a;var d=a.prototype;d.createPen=function(a,c,d,e,f){return new b.CreateHighlight(this.editor,a,c,d,e,f,this.style)},d.deletePen=function(a){return new b.DeleteHighlight(this.editor,a)},d.setPen=function(a,c,d,e){return new b.SetHighlight(this.editor,this.selectedMarkup,a,c,d,e)},b.EditModeHighlight=a}(),function(){"use strict";function a(a){var b=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];c.EditMode.call(this,a,c.MARKUP_TYPE_POLYCLOUD,b),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}function b(a,b){var c=function(a,b){var c=a.map(function(a){return a[b]});return Math.min.apply(null,c)},d=function(a,b){var c=a.map(function(a){return a[b]});return Math.max.apply(null,c)},e=b.style["stroke-width"],f=2*e+.5*e,g=c(a,"x")-f,h=c(a,"y")-f,i=d(a,"x")+f,j=d(a,"y")+f,k=i-g,l=j-h;b.size={x:k,y:l},b.position={x:g+.5*k,y:h+.5*l};var m=b.position;return a.map(function(a){return{x:a.x-m.x,y:a.y-m.y}})}var c=Autodesk.Viewing.Extensions.Markups.Core,d=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(c.EditMode.prototype),a.prototype.constructor=a;var e=a.prototype;e.deleteMarkup=function(a,d){if((a=a||this.selectedMarkup)&&a.type==this.type){var e=this.movements;if(!(this.creating&&e.length>=2)){var f=new c.DeletePolycloud(this.editor,a);return f.addToHistory=!d,f.execute(),this.creationEnd(),!0}e.pop(),e.pop();var g=e.length-1;if(g>=0){var h=e[g];e.push(h);var i=b(e,this);new c.SetPolycloud(this.editor,a,this.position,this.size,i).execute()}}return!1},e.onMouseMove=function(a){c.EditMode.prototype.onMouseMove.call(this,a);var e=this.editor,f=this.selectedMarkup;if(f&&this.creating){this.dragging=!0;var g=this.movements;g.splice(g.length-1,1);var h=e.getMousePosition();h=e.clientToMarkups(h.x,h.y),g.length>=2&&d.areMarkupsPointsInClientRange(g[0],h,25,this.editor)&&(h=g[0]),g.push(h);var i=b(g,this);new c.SetPolycloud(e,f,this.position,this.size,i).execute()}},e.onMouseDown=function(){if(c.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var a=this.editor,b=a.getMousePosition();b=a.clientToMarkups(b.x,b.y);var d=this.size=a.sizeFromClientToMarkups(1,1);this.movements=[b,b],a.beginActionGroup();var e=a.getId();new c.CreatePolycloud(a,e,b,d,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=a.getMarkup(e),this.creationBegin()}},e.onMouseUp=function(a){if(c.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var e=this.editor,f=e.getMousePosition(),g=this.movements,h=!1;if(f=e.clientToMarkups(f.x,f.y),!(g.length>1&&d.areMarkupsPointsInClientRange(g[g.length-2],f,25,this.editor))){g.length>2&&d.areMarkupsPointsInClientRange(g[0],f,25,this.editor)&&(f=g[0],h=!0),g.splice(g.length-1,1),h||(g.push(f),g.push(f));var i=this.selectedMarkup,j=b(g,i);new c.SetPolycloud(e,i,i.position,i.size,j,h).execute(),h&&this.creationEnd()}}},e.onMouseDoubleClick=function(a){if(this.creating){var d=this.movements;if(d.splice(Math.max(0,d.length-1)),d.length<2)this.creationCancel();else{var e=this.selectedMarkup,f=b(d,e);new c.SetPolycloud(this.editor,e,e.position,e.size,f,!0).execute(),this.creationEnd()}}},e.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),c.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},e.creationCancel=function(){c.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},c.EditModePolycloud=a}(),function(){"use strict";function a(a){var b=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];c.EditMode.call(this,a,c.MARKUP_TYPE_POLYLINE,b),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}function b(a,b){var c=function(a,b){var c=a.map(function(a){return a[b]});return Math.min.apply(null,c)},d=function(a,b){var c=a.map(function(a){return a[b]});return Math.max.apply(null,c)},e=c(a,"x"),f=c(a,"y"),g=d(a,"x"),h=d(a,"y"),i=g-e,j=h-f;b.size={x:i,y:j},b.position={x:e+.5*i,y:f+.5*j};var k=b.position;return a.map(function(a){return{x:a.x-k.x,y:a.y-k.y}})}var c=Autodesk.Viewing.Extensions.Markups.Core,d=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(c.EditMode.prototype),a.prototype.constructor=a;var e=a.prototype;e.deleteMarkup=function(a,d){if((a=a||this.selectedMarkup)&&a.type==this.type){var e=this.movements;if(!(this.creating&&e.length>=2)){var f=new c.DeletePolyline(this.editor,a);return f.addToHistory=!d,f.execute(),this.creationEnd(),!0}e.pop(),e.pop();var g=e.length-1;if(g>=0){var h=e[g];e.push(h);var i=b(e,this);new c.SetPolyline(this.editor,a,this.position,this.size,i).execute()}}return!1},e.onMouseMove=function(a){c.EditMode.prototype.onMouseMove.call(this,a);var e=this.editor,f=this.selectedMarkup;if(f&&this.creating){this.dragging=!0;var g=this.movements;g.splice(g.length-1,1);var h=e.getMousePosition();h=e.clientToMarkups(h.x,h.y),g.length>=2&&d.areMarkupsPointsInClientRange(g[0],h,25,this.editor)&&(h=g[0]),g.push(h);var i=b(g,this);new c.SetPolyline(e,f,this.position,this.size,i).execute()}},e.onMouseDown=function(a){if(c.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var b=this.editor,d=b.getMousePosition();d=b.clientToMarkups(d.x,d.y);var e=this.size=b.sizeFromClientToMarkups(1,1);this.movements=[d,d],b.beginActionGroup();var f=b.getId();new c.CreatePolyline(b,f,d,e,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=b.getMarkup(f),this.creationBegin()}},e.onMouseUp=function(){if(c.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var a=this.editor,e=a.getMousePosition(),f=this.movements,g=!1;if(e=a.clientToMarkups(e.x,e.y),!(f.length>1&&d.areMarkupsPointsInClientRange(f[f.length-2],e,25,this.editor))){f.length>2&&d.areMarkupsPointsInClientRange(f[0],e,25,this.editor)&&(e=f[0],g=!0),f.splice(f.length-1,1),g||(f.push(e),f.push(e));var h=this.selectedMarkup,i=b(f,h);new c.SetPolyline(a,h,h.position,h.size,i,g).execute(),g&&this.creationEnd()}}},e.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),c.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},e.creationCancel=function(){c.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},e.onMouseDoubleClick=function(a){if(this.creating){var d=this.movements;if(d.splice(Math.max(0,d.length-1)),d.length<2)this.creationCancel();else{var e=this.selectedMarkup,f=b(d,e);new c.SetPolyline(this.editor,e,e.position,e.size,f,this.closed).execute(),this.creationEnd()}}},c.EditModePolyline=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_RECTANGLE,c)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Measure,d=Autodesk.Viewing.Extensions.Measure.Functions;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var e=a.prototype;e.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new b.DeleteRectangle(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},e.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var e,f,g=this.editor,h=this.getFinalMouseDraggingPosition(),i=g.clientToMarkups(h.x,h.y),j={x:(this.firstCorner.x+i.x)/2,y:(this.firstCorner.y+i.y)/2};if(g.snapper&&this.lineSnapped){var k=g.project(this.lineSnapped.vertices[0]),l=g.project(this.lineSnapped.vertices[1]),m=k.z;k=g.clientToMarkups(k.x,k.y),l=g.clientToMarkups(l.x,l.y),k=new THREE.Vector3(k.x,k.y,m),l=new THREE.Vector3(l.x,l.y,m);var n=new THREE.Vector3(i.x,i.y,m),o=d.nearestPointInPointToLine(n,k,l);f=n.distanceTo(o);var p=-(k.x-l.x)/(k.y-l.y),q=this.firstCorner.y-p*this.firstCorner.x,r=this.firstCorner.x+1,s=p*r+q,t=new THREE.Vector3(r,s,m),u=new THREE.Vector3(this.firstCorner.x,this.firstCorner.y,m),v=d.nearestPointInPointToLine(n,u,t);e=n.distanceTo(v)}else e=i.x-this.firstCorner.x,f=i.y-this.firstCorner.y;var w=this.size={x:Math.abs(e),y:Math.abs(f)};new b.SetRectangle(g,c,j,w).execute()}},e.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,d=a.getMousePosition();this.initialX=d.x,this.initialY=d.y;var e=this.firstCorner=a.clientToMarkups(this.initialX,this.initialY),f=this.size=a.sizeFromClientToMarkups(1,1),g=0;if(this.lineSnapped=null,a.snapper){if(a.snapper.getGeometryType()===c.SNAP_EDGE){this.lineSnapped=a.snapper.getEdge();var h=a.project(this.lineSnapped.vertices[0]),i=a.project(this.lineSnapped.vertices[1]),j=i.x-h.x,k=i.y-h.y;g=this.rotation=Math.atan2(k,j)}}a.beginActionGroup();var l=a.getId();new b.CreateRectangle(a,l,e,f,g,this.style).execute(),this.selectedMarkup=a.getMarkup(l),this.creationBegin()}},b.EditModeRectangle=a}(),function(){"use strict";function a(a){var c=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];b.EditMode.call(this,a,b.MARKUP_TYPE_TEXT,c);var d=new b.EditorTextInput(this.viewer.container,this.editor,!1,"Write Something",260);d.addEventListener(d.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),this.textInputHelper=d,this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.minSize=0,this.creationMethod=this.CREATION_METHOD_CLICK}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if((a=a||this.selectedMarkup)&&a.type==this.type){var d=new b.DeleteText(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.setStyle=function(a){this.textInputHelper&&this.textInputHelper.isActive()?this.textInputHelper.setStyle(a):b.EditMode.prototype.setStyle.call(this,a)},c.notifyAllowNavigation=function(a){a&&this.textInputHelper&&this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit()},c.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.textInputHelper.destroy(),this.textInputHelper=null),b.EditMode.prototype.destroy.call(this)},c.onMouseDown=function(){if(this.textInputHelper&&this.textInputHelper.isActive())return void this.textInputHelper.acceptAndExit();if(!this.selectedMarkup){var a=this.editor,c=a.getMousePosition(),d=a.sizeFromMarkupsToClient(0,this.style["font-size"]).y,e=15*d,f=3*d,g=this.size=a.sizeFromClientToMarkups(e,f),h=a.positionFromClientToMarkups(c.x+.5*e,c.y+.5*f);this.creationBegin(),a.beginActionGroup();var i=new b.CreateText(a,a.getId(),h,g,"",this.style);i.execute(),this.creationEnd(),this.selectedMarkup=a.getMarkup(i.targetId),this.textInputHelper&&this.textInputHelper.setActive(this.selectedMarkup,!0),this.editor.actionManager.addEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded)}},c.updateTextBoxStyle=function(){this.isTextInputHelperActive()&&this.textInputHelper.onCameraChanged()},c.onMouseUp=function(a){},c.onMouseDoubleClick=function(a){a===this.selectedMarkup&&(this.editor.selectMarkup(null),this.textInputHelper&&this.textInputHelper.setActive(a,!1))},c.onHelperTextChange=function(a){var c=a.data,d=c.markup,e=c.style;if(this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),""===c.newText){if(c.firstEdit)return this.editor.cancelActionGroup(),void this.editor.selectMarkup(null);return new b.DeleteText(this.editor,d).execute(),void this.editor.selectMarkup(null)}c.firstEdit||this.editor.beginActionGroup();var f=this.editor.positionFromClientToMarkups(c.newPos.x,c.newPos.y),g=this.editor.sizeFromClientToMarkups(c.width,c.height);new b.SetSize(this.editor,d,f,g.x,g.y).execute(),new b.SetText(this.editor,d,d.position,d.size,c.newText).execute(),new b.SetStyle(this.editor,d,e).execute(),this.editor.closeActionGroup(),this.editor.selectMarkup(null)},c.onHistoryChange=function(a){this.textInputHelper&&this.textInputHelper.isActive()&&(this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},c.onSave=function(){if(b.EditMode.prototype.onSave.call(this),this.textInputHelper&&this.textInputHelper.isActive()){var a=this.textInputHelper.firstEdit;this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive(),a&&this.editor.cancelActionGroup(),this.editor.selectMarkup(null),this.selectedMarkup=null}},b.EditModeText=a}(),function(){"use strict";function a(a,b,c,d,f){this.parentDiv=a,this.editor=b,this.EVENT_TEXT_CHANGE="EVENT_CO2_TEXT_CHANGE",this.EVENT_TEXT_SET_ACTIVE="EVENT_CO2_TEXT_SET_ACTIVE",this.EVENT_TEXT_SET_INACTIVE="EVENT_CO2_TEXT_SET_INACTIVE",c?(this.textArea=document.createElement("input"),this.textArea.setAttribute("type","text")):this.textArea=document.createElement("textarea"),this.defaultText=d,this.textArea.setAttribute("maxlength",f),this.textArea.setAttribute("data-i18n",d),this.onKeyHandlerBinded=this.onKeyHandler.bind(this),this.onTextAreaResizeBinded=this.onTextAreaResize.bind(this),this.textArea.addEventListener("keydown",this.onKeyHandlerBinded),this.textArea.addEventListener("mouseup",this.onTextAreaResizeBinded),this.styleTextArea=new e.DomElementStyle,this.styleTextArea.setAttribute("position","absolute").setAttribute("overflow-y","hidden"),this.measureDiv=document.createElement("div"),e.addTraitEventDispatcher(this),this.onResizeBinded=this.onWindowResize.bind(this)}function b(a){if(0===a.length)return"";for(var b=a.length-1,c=b;c>=0;--c)if(" "!==a.charAt(c)){b=c;break}return a.substr(0,b+1)}function c(a){if(0===a.length)return"";for(var b=0,c=0;c<a.length;++c)if(" "!==a.charAt(c)){b=c;break}return a.substr(b)}var d=Autodesk.Viewing.Extensions.Markups.Core,e=Autodesk.Viewing.Extensions.Markups.Core.Utils,f=a.prototype;f.destroy=function(){this.textArea.removeEventListener("keydown",this.onKeyHandlerBinded),this.textArea.removeEventListener("mouseup",this.onTextAreaResizeBinded),this.setInactive()},f.setActive=function(a,b){if(this.textMarkup!==a){var c=Autodesk.Viewing.i18n.translate(this.defaultText);if(this.textArea.setAttribute("placeholder",c),this.setInactive(),this.parentDiv.appendChild(this.textArea),this.textMarkup=a,this.firstEdit=b||!1,this.constrainToCanvas=b,this.initFromMarkup(),this.constrainToCanvas=!1,window.addEventListener("resize",this.onResizeBinded),!Autodesk.Viewing.isIOSDevice()){var d=this.textArea;window.requestAnimationFrame(function(){d.focus()})}var e={markup:this.textMarkup,firstEdit:this.firstEdit,isActive:!0};this.dispatchEvent({type:this.EVENT_TEXT_SET_ACTIVE,data:e})}},f.setInactive=function(){var a={markup:this.textMarkup,isActive:!1};Autodesk.Viewing.isIOSDevice()&&this.textArea.blur(),window.removeEventListener("resize",this.onResizeBinded),this.textMarkup&&(this.textMarkup=null,this.parentDiv.removeChild(this.textArea)),this.style=null,this.dispatchEvent({type:this.EVENT_TEXT_SET_INACTIVE,data:a})},f.isActive=function(){return!!this.textMarkup},f.initFromMarkup=function(){var a=this.textMarkup,b=a.getClientPosition(),c=a.getClientSize(),d=b.x-.5*c.x,e=b.y-.5*c.y,f=a.lineHeight+"%";this.styleTextArea.setAttribute("line-height",f),this.setPosAndSize(d,e,c.x,c.y),this.setStyle(a.getStyle()),this.textArea.value=a.getText()},f.setPosAndSize=function(a,b,c,d){this.constrainToCanvas&&(a+c>=this.editor.viewer.container.clientWidth&&(a=this.editor.viewer.container.clientWidth-(c+10)),b+d>=this.editor.viewer.container.clientHeight&&(b=this.editor.viewer.container.clientHeight-(d+10)),a<5&&(a=5,c=this.editor.viewer.container.clientWidth-10)),this.styleTextArea.setAttribute("left",a+"px").setAttribute("top",b+"px").setAttribute("width",c+"px").setAttribute("height",d+"px")},f.setStyle=function(a){if(this.style){var b={};this.injectSizeValues(b),this.setPosAndSize(b.newPos.x-.5*b.width,b.newPos.y-.5*b.height,b.width,b.height)}var c=this.editor.sizeFromMarkupsToClient(0,a["font-size"]).y,d=this.styleTextArea.setAttribute("color",a["stroke-color"]).setAttribute("font-family",a["font-family"]).setAttribute("font-size",c+"px").setAttribute("font-weight",a["font-weight"]).setAttribute("font-style",a["font-style"]).getStyleString();this.textArea.setAttribute("style",d),this.style=e.cloneStyle(a)},f.getTextValuesForMarkup=function(a){var b=this.isActive(),c=this.textMarkup,d=this.firstEdit;this.setActive(a,!1);var e=this.getTextValues();return b?this.setActive(c,d):this.setInactive(),e},f.getTextValues=function(){var a=this.textArea.value;return a===this.defaultText&&(a=""),{text:a,lines:this.generateLines()}},f.acceptAndExit=function(){var a=this.getTextValues(),b={markup:this.textMarkup,style:this.style,firstEdit:this.firstEdit,newText:a.text,newLines:a.lines};this.injectSizeValues(b),this.dispatchEvent({type:this.EVENT_TEXT_CHANGE,data:b}),this.setInactive()},f.injectSizeValues=function(a){var b=parseFloat(this.textArea.style.width),c=parseFloat(this.textArea.style.height),d=parseFloat(this.textArea.style.left),e=parseFloat(this.textArea.style.top);a.width=b,a.height=c,a.newPos={x:d+.5*b,y:e+.5*c}},f.onWindowResize=function(a){window.requestAnimationFrame(function(){this.onCameraChanged()}.bind(this))},f.onCameraChanged=function(a){var b=this.textArea.value;this.textMarkup.style=e.cloneStyle(this.style),this.style=null,this.initFromMarkup(!0),this.textArea.value=b},f.onKeyHandler=function(a){var b=a.keyCode;a.shiftKey||13!==b||(a.preventDefault(),this.acceptAndExit())},f.generateLines=function(){var a=this.textArea.value,c=a.split(/\r*\n/),d=this.styleTextArea.clone().removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString();this.measureDiv.setAttribute("style",d),this.parentDiv.appendChild(this.measureDiv);for(var e=parseFloat(this.textArea.style.width),f=[],g=0,h=c.length;g<h;++g){var i=b(c[g]);this.splitLine(i,e,f)}return this.parentDiv.removeChild(this.measureDiv),f},f.splitLine=function(a,b,d){if(""!==a)for(var e="",f=!1;!f;){this.measureDiv.innerHTML=a;var g=this.measureDiv.clientWidth;if(g<=b)d.push(a),this.splitLine(c(e),b,d),f=!0;else{var h=this.getShorterLine(a);1===h.length?(this.splitWord(a,e,b,d),f=!0):(a=h[0],e=h[1]+e)}}},f.getShorterLine=function(a){var b=a.lastIndexOf(" ");if(-1===b)return[a];for(;" "===a.charAt(b-1);)b--;var c=a.substr(b);return[a.substr(0,b),c]},f.splitWord=function(a,b,c,d){for(var e=1;;){var f=a.substr(0,e);this.measureDiv.innerHTML=f;if(this.measureDiv.clientWidth>c){if(1===e)return d.push(f),void this.splitWord(a.substr(1),b,c,d);var g=a.substr(0,e-1);d.push(g);var h=a.substr(e-1);return void this.splitLine(h+b,c,d)}if(++e>a.length)return void d.push(a)}},f.onTextAreaResize=function(){var a=parseFloat(this.textArea.style.width),b=parseFloat(this.textArea.style.height);this.textMarkup.size=this.editor.sizeFromClientToMarkups(a,b);var c=parseFloat(this.textArea.style.left),d=parseFloat(this.textArea.style.top);this.textMarkup.position=this.editor.positionFromClientToMarkups(c+.5*a,d+.5*b)},d.EditorTextInput=a}();